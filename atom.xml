<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hoooge&#39;s Blog</title>
  
  <subtitle>Life is short</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.ihoge.cn/"/>
  <updated>2018-04-15T10:15:07.833Z</updated>
  <id>http://www.ihoge.cn/</id>
  
  <author>
    <name>åˆ˜çŸ¥è¡Œ</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å¼¹æ€§å¼åˆ†å¸ƒæ•°æ®é›†RDDâ€”â€”PysparkåŸºç¡€ ï¼ˆäºŒï¼‰</title>
    <link href="http://www.ihoge.cn/2018/pyspark.html"/>
    <id>http://www.ihoge.cn/2018/pyspark.html</id>
    <published>2018-04-15T09:59:21.000Z</published>
    <updated>2018-04-15T10:15:07.833Z</updated>
    
    <content type="html"><![CDATA[<h2 id="RDDçš„å†…éƒ¨è¿è¡Œæ–¹å¼"><a href="#RDDçš„å†…éƒ¨è¿è¡Œæ–¹å¼" class="headerlink" title="RDDçš„å†…éƒ¨è¿è¡Œæ–¹å¼"></a>RDDçš„å†…éƒ¨è¿è¡Œæ–¹å¼</h2><p>RDDä¸ä»…æ˜¯ä¸€ç»„ä¸å¯å˜çš„JVMï¼ˆJavaè™šæ‹Ÿæœºï¼‰å¯¹è±¡çš„åˆ†å¸ƒé›†ï¼Œè€Œä¸”æ˜¯Sparkçš„æ ¸å¿ƒï¼Œå¯ä»¥è®©ä»»åŠ¡æ‰§è¡Œé«˜é€Ÿè¿ç®—ã€‚</p><p>RDDå°†<code>è·Ÿè¸ªï¼ˆè®¡å…¥æ—¥è®°ï¼‰åº”ç”¨äºæ¯ä¸ªå¿«çš„æ‰€æœ‰è½¬æ¢</code>ï¼Œä»¥åŠ é€Ÿè®¡ç®—é€Ÿåº¦ï¼Œå¹¶åœ¨å‘ç”Ÿé”™è¯¯å’Œéƒ¨åˆ†æ•°æ®ä¸¢å¤±æ—¶æä¾›å›é€€ï¼ˆå®¹é”™æœºåˆ¶ï¼‰ã€‚</p><p>RDDé‡‡ç”¨å¹¶è¡Œçš„è¿è¡Œæ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªè½¬æ¢æ“ä½œå¹¶è¡Œæ‰§è¡Œï¼Œä»è€Œæé«˜é€Ÿåº¦ã€‚<br>RDDæœ‰ä¸¤ç§å¹¶è¡Œæ“ä½œï¼š</p><ul><li>è½¬æ¢æ“ä½œï¼ˆè¿”å›æŒ‡å‘æ–°çš„RDDçš„æŒ‡é’ˆï¼‰</li><li>åŠ¨ä½œæ“ä½œï¼ˆåœ¨è¿è¡Œè®¡ç®—åå‘é©±åŠ¨ç¨‹åºè¿”å›å€¼ï¼‰</li></ul><p>æ•°æ®é›†çš„è½¬æ¢é€šå¸¸æ˜¯<code>æƒ°æ€§</code>çš„ï¼Œè¿™ä¹Ÿæ„å‘³ç€ä»»ä½•è½¬æ¢æ“ä½œä»…åœ¨è°ƒç”¨æ•°æ®é›†ä¸Šçš„æ“ä½œæ—¶æ‰æ‰§è¡Œã€‚è¯¥å»¶è¿Ÿæ‰§è¡Œä¼šäº§ç”Ÿé£å¤šçš„ç²¾ç»†æŸ¥è¯¢ï¼šé’ˆå¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–æŸ¥è¯¢ã€‚è¿™ç§ä¼˜åŒ–å§‹äºSparkçš„DAGSchedulerâ€”â€”é¢å‘é˜¶æ®µçš„è°ƒåº¦å™¨ã€‚DAGSchedulerè´Ÿè´£Stageçº§çš„è°ƒåº¦è¯¦è§:<a href="http://ihoge.cn/2018/Spark%20Scheduler.html" target="_blank" rel="noopener">Sparkè¿è¡ŒåŸç†å‰–æ</a></p><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fqdbpax6jbj31kw0hntga.jpg" alt=""></p><p><strong>ç”±äºå…·æœ‰å•ç‹¬çš„RDDè½¬æ¢å’ŒåŠ¨ä½œï¼ŒDAGSchedulerå¯ä»¥åœ¨æŸ¥è¯¢ä¸­æ‰§è¡Œä¼˜åŒ–ã€‚åŒ…æ‹¬ä½†ä¸é™äºé¿å…shuffleæ•°æ®ï¼ˆæœ€è€—è´¹èµ„æºçš„ä»»åŠ¡ï¼‰</strong></p><h2 id="åˆ›å»ºRDD"><a href="#åˆ›å»ºRDD" class="headerlink" title="åˆ›å»ºRDD"></a>åˆ›å»ºRDD</h2><p>æ–¹å¼ä¸€ï¼š ç”¨<code>.parallelize(...)</code>é›†åˆï¼ˆå…ƒç´ listæˆ–arrayï¼‰<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = sc.parallelize([(<span class="string">'a'</span>,<span class="number">1</span>),(<span class="string">'b'</span>,<span class="number">2</span>),(<span class="string">'c'</span>,<span class="number">3</span>),(<span class="string">'d'</span>,<span class="number">5</span>),(<span class="string">'e'</span>,<span class="number">5</span>)])</span><br></pre></td></tr></table></figure></p><p>æ–¹å¼äºŒï¼š è¯»å…¥å¤–éƒ¨æ–‡ä»¶</p><ul><li>æ”¯æŒå¤šæ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–ï¼šå¦‚NTFSã€FATã€HFS+ï¼ˆMac OS Extendedï¼‰ï¼Œæˆ–è€…å¦‚HDFSã€S3ã€Cassandraè¿™ç±»çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œè¿˜æœ‰å…¶ä»–ç±»æ–‡ä»¶ç³»ç»Ÿã€‚</li><li>æŒ‡å‡ºå¤šç§æ•°æ®æ ¼å¼ï¼šå¦‚æ–‡æœ¬ã€parquetã€JSONã€Hive tablesï¼ˆHiveè¡¨ï¼‰ä»¥åŠä½¿ç”¨JDBCé©±åŠ¨ç¨‹åºå¯è¯»å–çš„å…³ç³»æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚ï¼ˆæ³¨æ„ï¼šSparkå¯ä»¥è‡ªåŠ¨å¤„ç†å‹ç¼©æ•°æ®é›†ï¼‰</li></ul><p>ğŸ’¡<strong>Tip1ï¼š</strong>è¯»å–çš„æ–¹å¼ä¸åŒï¼ŒæŒæœ‰å¯¹è±¡è¡¨è¾¾æ–¹å¼ä¹Ÿä¸åŒã€‚ä»æ–‡ä»¶ä¸­è¯»å–çš„æ•°æ®è¡¨ç¤ºä¸º<code>MapPartitionsRDD</code>ï¼›ä½¿ç”¨é›†åˆæ–¹æ³•çš„æ•°æ®è¡¨ç¤ºä¸º<code>ParallelCollectionRDD</code></p><p>ğŸ’¡<strong>Tip2ï¼š</strong>RDDæ˜¯æ— schemaçš„æ•°æ®ç»“æ„ï¼ˆå’ŒDataFrameä¸åŒï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡ ä¹å¯ä»¥æ··ç”¨ä»»ä½•æ•°æ®ç»“æ„ï¼štupleã€dictã€listå’Œsparkç­‰éƒ½èƒ½æ”¯æŒã€‚å¦‚æœå¯¹æ•°æ®é›†ä½¿ç”¨<code>.collect()</code>æ–¹æ³•ï¼Œå°†æŠŠRDDå¯¹æ‰€æœ‰å…ƒç´ è¿”å›ç»™é©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨ç¨‹åºå°†å…¶åºåˆ—åŒ–æˆäº†ä¸€ä¸ªåˆ—è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_from_file = sc.textFile(<span class="string">"hdfs://master:9000/pydata/VS14MORT.txt.gz"</span>,<span class="number">4</span>) <span class="comment"># è¿™é‡Œè¡¨ç¤º4ä¸ªåˆ†åŒº</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extractInformation</span><span class="params">(row)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> re</span><br><span class="line">    <span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">    selected_indices = [</span><br><span class="line">         <span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,</span><br><span class="line">         <span class="number">19</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">34</span>,</span><br><span class="line">         <span class="number">36</span>,<span class="number">37</span>,<span class="number">38</span>,<span class="number">39</span>,<span class="number">40</span>,<span class="number">41</span>,<span class="number">42</span>,<span class="number">43</span>,<span class="number">44</span>,<span class="number">45</span>,<span class="number">46</span>,<span class="number">47</span>,<span class="number">48</span>,</span><br><span class="line">         <span class="number">49</span>,<span class="number">50</span>,<span class="number">51</span>,<span class="number">52</span>,<span class="number">53</span>,<span class="number">54</span>,<span class="number">55</span>,<span class="number">56</span>,<span class="number">58</span>,<span class="number">60</span>,<span class="number">61</span>,<span class="number">62</span>,<span class="number">63</span>,</span><br><span class="line">         <span class="number">64</span>,<span class="number">65</span>,<span class="number">66</span>,<span class="number">67</span>,<span class="number">68</span>,<span class="number">69</span>,<span class="number">70</span>,<span class="number">71</span>,<span class="number">72</span>,<span class="number">73</span>,<span class="number">74</span>,<span class="number">75</span>,<span class="number">76</span>,</span><br><span class="line">         <span class="number">77</span>,<span class="number">78</span>,<span class="number">79</span>,<span class="number">81</span>,<span class="number">82</span>,<span class="number">83</span>,<span class="number">84</span>,<span class="number">85</span>,<span class="number">87</span>,<span class="number">89</span></span><br><span class="line">    ]</span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        Input record schema</span></span><br><span class="line"><span class="string">        schema: n-m (o) -- xxx</span></span><br><span class="line"><span class="string">            n - position from</span></span><br><span class="line"><span class="string">            m - position to</span></span><br><span class="line"><span class="string">            o - number of characters</span></span><br><span class="line"><span class="string">            xxx - description</span></span><br><span class="line"><span class="string">        1. 1-19 (19) -- reserved positions</span></span><br><span class="line"><span class="string">        2. 20 (1) -- resident status</span></span><br><span class="line"><span class="string">        3. 21-60 (40) -- reserved positions</span></span><br><span class="line"><span class="string">        4. 61-62 (2) -- education code (1989 revision)</span></span><br><span class="line"><span class="string">        5. 63 (1) -- education code (2003 revision)</span></span><br><span class="line"><span class="string">        6. 64 (1) -- education reporting flag</span></span><br><span class="line"><span class="string">        7. 65-66 (2) -- month of death</span></span><br><span class="line"><span class="string">        8. 67-68 (2) -- reserved positions</span></span><br><span class="line"><span class="string">        9. 69 (1) -- sex</span></span><br><span class="line"><span class="string">        10. 70 (1) -- age: 1-years, 2-months, 4-days, 5-hours, 6-minutes, 9-not stated</span></span><br><span class="line"><span class="string">        11. 71-73 (3) -- number of units (years, months etc)</span></span><br><span class="line"><span class="string">        12. 74 (1) -- age substitution flag (if the age reported in positions 70-74 is calculated using dates of birth and death)</span></span><br><span class="line"><span class="string">        13. 75-76 (2) -- age recoded into 52 categories</span></span><br><span class="line"><span class="string">        14. 77-78 (2) -- age recoded into 27 categories</span></span><br><span class="line"><span class="string">        15. 79-80 (2) -- age recoded into 12 categories</span></span><br><span class="line"><span class="string">        16. 81-82 (2) -- infant age recoded into 22 categories</span></span><br><span class="line"><span class="string">        17. 83 (1) -- place of death</span></span><br><span class="line"><span class="string">        18. 84 (1) -- marital status</span></span><br><span class="line"><span class="string">        19. 85 (1) -- day of the week of death</span></span><br><span class="line"><span class="string">        20. 86-101 (16) -- reserved positions</span></span><br><span class="line"><span class="string">        21. 102-105 (4) -- current year</span></span><br><span class="line"><span class="string">        22. 106 (1) -- injury at work</span></span><br><span class="line"><span class="string">        23. 107 (1) -- manner of death</span></span><br><span class="line"><span class="string">        24. 108 (1) -- manner of disposition</span></span><br><span class="line"><span class="string">        25. 109 (1) -- autopsy</span></span><br><span class="line"><span class="string">        26. 110-143 (34) -- reserved positions</span></span><br><span class="line"><span class="string">        27. 144 (1) -- activity code</span></span><br><span class="line"><span class="string">        28. 145 (1) -- place of injury</span></span><br><span class="line"><span class="string">        29. 146-149 (4) -- ICD code</span></span><br><span class="line"><span class="string">        30. 150-152 (3) -- 358 cause recode</span></span><br><span class="line"><span class="string">        31. 153 (1) -- reserved position</span></span><br><span class="line"><span class="string">        32. 154-156 (3) -- 113 cause recode</span></span><br><span class="line"><span class="string">        33. 157-159 (3) -- 130 infant cause recode</span></span><br><span class="line"><span class="string">        34. 160-161 (2) -- 39 cause recode</span></span><br><span class="line"><span class="string">        35. 162 (1) -- reserved position</span></span><br><span class="line"><span class="string">        36. 163-164 (2) -- number of entity-axis conditions</span></span><br><span class="line"><span class="string">        37-56. 165-304 (140) -- list of up to 20 conditions</span></span><br><span class="line"><span class="string">        57. 305-340 (36) -- reserved positions</span></span><br><span class="line"><span class="string">        58. 341-342 (2) -- number of record axis conditions</span></span><br><span class="line"><span class="string">        59. 343 (1) -- reserved position</span></span><br><span class="line"><span class="string">        60-79. 344-443 (100) -- record axis conditions</span></span><br><span class="line"><span class="string">        80. 444 (1) -- reserve position</span></span><br><span class="line"><span class="string">        81. 445-446 (2) -- race</span></span><br><span class="line"><span class="string">        82. 447 (1) -- bridged race flag</span></span><br><span class="line"><span class="string">        83. 448 (1) -- race imputation flag</span></span><br><span class="line"><span class="string">        84. 449 (1) -- race recode (3 categories)</span></span><br><span class="line"><span class="string">        85. 450 (1) -- race recode (5 categories)</span></span><br><span class="line"><span class="string">        86. 461-483 (33) -- reserved positions</span></span><br><span class="line"><span class="string">        87. 484-486 (3) -- Hispanic origin</span></span><br><span class="line"><span class="string">        88. 487 (1) -- reserved</span></span><br><span class="line"><span class="string">        89. 488 (1) -- Hispanic origin/race recode</span></span><br><span class="line"><span class="string">     '''</span></span><br><span class="line">    record_split = re\</span><br><span class="line">        .compile(</span><br><span class="line">            <span class="string">r'([\s]&#123;19&#125;)([0-9]&#123;1&#125;)([\s]&#123;40&#125;)([0-9\s]&#123;2&#125;)([0-9\s]&#123;1&#125;)([0-9]&#123;1&#125;)([0-9]&#123;2&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([\s]&#123;2&#125;)([FM]&#123;1&#125;)([0-9]&#123;1&#125;)([0-9]&#123;3&#125;)([0-9\s]&#123;1&#125;)([0-9]&#123;2&#125;)([0-9]&#123;2&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([0-9]&#123;2&#125;)([0-9\s]&#123;2&#125;)([0-9]&#123;1&#125;)([SMWDU]&#123;1&#125;)([0-9]&#123;1&#125;)([\s]&#123;16&#125;)([0-9]&#123;4&#125;)'</span> +</span><br><span class="line">            <span class="string">r'([YNU]&#123;1&#125;)([0-9\s]&#123;1&#125;)([BCOU]&#123;1&#125;)([YNU]&#123;1&#125;)([\s]&#123;34&#125;)([0-9\s]&#123;1&#125;)([0-9\s]&#123;1&#125;)'</span> +</span><br><span class="line">            <span class="string">r'([A-Z0-9\s]&#123;4&#125;)([0-9]&#123;3&#125;)([\s]&#123;1&#125;)([0-9\s]&#123;3&#125;)([0-9\s]&#123;3&#125;)([0-9\s]&#123;2&#125;)([\s]&#123;1&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([0-9\s]&#123;2&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)([A-Z0-9\s]&#123;7&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([A-Z0-9\s]&#123;7&#125;)([\s]&#123;36&#125;)([A-Z0-9\s]&#123;2&#125;)([\s]&#123;1&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([A-Z0-9\s]&#123;5&#125;)([\s]&#123;1&#125;)([0-9\s]&#123;2&#125;)([0-9\s]&#123;1&#125;)'</span> + </span><br><span class="line">            <span class="string">r'([0-9\s]&#123;1&#125;)([0-9\s]&#123;1&#125;)([0-9\s]&#123;1&#125;)([\s]&#123;33&#125;)([0-9\s]&#123;3&#125;)([0-9\s]&#123;1&#125;)([0-9\s]&#123;1&#125;)'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        rs = np.array(record_split.split(row))[selected_indices]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        rs = np.array([<span class="string">'-99'</span>] * len(selected_indices))</span><br><span class="line">    <span class="keyword">return</span> rs</span><br><span class="line"></span><br><span class="line">data_file = data_from_file.map(extractInformation)</span><br><span class="line">data_file.map(<span class="keyword">lambda</span> row: row).take(<span class="number">1</span>)</span><br><span class="line">data_file.cache()</span><br><span class="line">data_file.is_cached</span><br></pre></td></tr></table></figure><pre><code>True</code></pre><h2 id="å…¨å±€ä½œç”¨åŸŸå’Œå±€éƒ¨ä½œç”¨åŸŸ"><a href="#å…¨å±€ä½œç”¨åŸŸå’Œå±€éƒ¨ä½œç”¨åŸŸ" class="headerlink" title="å…¨å±€ä½œç”¨åŸŸå’Œå±€éƒ¨ä½œç”¨åŸŸ"></a>å…¨å±€ä½œç”¨åŸŸå’Œå±€éƒ¨ä½œç”¨åŸŸ</h2><p>Sparkå¯ä»¥åœ¨ä¸¤ç§æ¨¡å¼ä¸‹è¿è¡Œï¼šæœ¬åœ°å’Œé›†ç¾¤ã€‚æœ¬åœ°è¿è¡ŒSparkä»£ç æ—¶å’Œç›®å‰ä½¿ç”¨çš„pythonæ²¡æœ‰è¯´æ˜ä¸åŒã€‚ç„¶è€Œä»–å¦‚æœå°†ç›¸åŒçš„ä»£ç éƒ¨ç½²åˆ°é›†ç¾¤ï¼Œä¾¿å¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„å›°æ‰°ï¼Œè¿™å°±éœ€è¦äº†è§£Sparkæ˜¯æ€ä¹ˆåœ¨é›†ç¾¤ä¸Šæ‰§è¡Œå·¥ä½œçš„ã€‚è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« ä»‹ç»çš„å¾ˆè¯¦ç»†ã€‚<a href="http://ihoge.cn/2018/Spark%20Scheduler.html" target="_blank" rel="noopener">å‚è€ƒï¼šSparkè¿è¡ŒåŸç†è¯¦è§£</a></p><p>åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œæäº¤ä»»åŠ¡æ—¶ä»»åŠ¡å‘é€ç»™äº†MasterèŠ‚ç‚¹ã€‚è¯¥é©±åŠ¨ç¨‹åºèŠ‚ç‚¹ä¸ºä»»åŠ¡åˆ›å»ºDAGï¼Œå¹¶ä¸”å†³å®šå“ªä¸€ä¸ªæ‰§è¡Œè€…ï¼ˆWorkerï¼‰èŠ‚ç‚¹è¿è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚ç„¶åè¯¥é©±åŠ¨ç¨‹åºçŸ¥è¯†å·¥ä½œè€…æ‰§è¡Œå®ƒä»¬çš„ä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨ç»“æŸæ—¶å°†ç»“æœè¿”å›ç»™é©±åŠ¨ç¨‹åºã€‚ç„¶è€Œåœ¨è¿™ä¹‹å‰ï¼Œé©±åŠ¨ç¨‹åºä¸ºæ¯ä¸€ä¸ªä»»åŠ¡çš„ç»ˆæ­¢åšå‡†å¤‡ï¼šé©±åŠ¨ç¨‹åºä¸­æœ‰ä¸€ç»„å˜é‡å’Œæ–¹æ³•ï¼Œä»¥å˜å·¥ä½œè€…åœ¨RDDä¸Šæ‰§è¡Œä»»åŠ¡ã€‚</p><p>è¿™ç»„å˜é‡å’Œæ–¹æ³•åœ¨æ‰§è¡Œè€…çš„ä¸Šä¸‹é—®æœ¬è´¨ä¸Šæ˜¯é™æ€çš„ï¼Œæ¯ä¸ªæ‰§è¡Œå™¨ä»é©±åŠ¨ç¨‹åºä¸­è·å–çš„ä¸€ä»½å˜é‡å’Œæ–¹æ³•çš„<strong>å‰¯æœ¬</strong>ã€‚è¿™æ„å‘³ç€è¿è¡Œä»»åŠ¡æ—¶ï¼Œå¦‚æœæ‰§è¡Œè€…æ”¹å˜è¿™äº›å˜é‡æˆ–è¦†ç›–è¿™äº›æ–¹æ³•ï¼Œå®ƒä¸å½±å“ä»»ä½•å…¶ä»–æ‰§è¡Œè€…çš„å‰¯æœ¬æˆ–è€…é©±åŠ¨ç¨‹åºçš„å˜é‡å’Œæ–¹æ³•ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ„æƒ³ä¸åˆ°çš„è¡Œä¸ºå’Œè¿è¡Œé”™è¯¯ï¼Œè¿™äº›è¡Œä¸ºå’Œé”™è¯¯é€šå¸¸éƒ½å¾ˆéš¾è¢«è¿½è¸ªåˆ°ã€‚</p><h2 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h2><p>è½¬æ¢æ“ä½œå¯ä»¥è°ƒæ•´æ•°æ®é›†ã€‚åŒ…æ‹¬æ˜ å°„ã€ç­›é€‰ã€é“¾æ¥ã€è½¬æ¢æ•°æ®é›†ä¸­çš„å€¼ã€‚</p><h3 id="map-è½¬æ¢"><a href="#map-è½¬æ¢" class="headerlink" title=".map()è½¬æ¢"></a>.map()è½¬æ¢</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_2014 = data_file.map(<span class="keyword">lambda</span> x: x[<span class="number">16</span>])</span><br><span class="line">data_2014.take(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><pre><code>[&apos;2014&apos;, &apos;2014&apos;, &apos;2014&apos;, &apos;2014&apos;, &apos;2014&apos;, &apos;2014&apos;, &apos;2014&apos;, &apos;2014&apos;, &apos;2014&apos;, &apos;-99&apos;]</code></pre><h3 id="filter-è½¬æ¢"><a href="#filter-è½¬æ¢" class="headerlink" title=".filter()è½¬æ¢"></a>.filter()è½¬æ¢</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data_filter = data_file.filter(<span class="keyword">lambda</span> x: x[<span class="number">16</span>] == <span class="string">'2014'</span> <span class="keyword">and</span> x[<span class="number">21</span>] == <span class="string">'0'</span>)</span><br><span class="line">print(data_filter.count())</span><br><span class="line">data_file.take(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><pre><code>22[array([&apos;1&apos;, &apos;  &apos;, &apos;2&apos;, &apos;1&apos;, &apos;01&apos;, &apos;M&apos;, &apos;1&apos;, &apos;087&apos;, &apos; &apos;, &apos;43&apos;, &apos;23&apos;, &apos;11&apos;,        &apos;  &apos;, &apos;4&apos;, &apos;M&apos;, &apos;4&apos;, &apos;2014&apos;, &apos;U&apos;, &apos;7&apos;, &apos;C&apos;, &apos;N&apos;, &apos; &apos;, &apos; &apos;, &apos;I64 &apos;,        &apos;238&apos;, &apos;070&apos;, &apos;   &apos;, &apos;24&apos;, &apos;01&apos;, &apos;11I64  &apos;, &apos;       &apos;, &apos;       &apos;,        &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;,        &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;,        &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;01&apos;,        &apos;I64  &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;,        &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;,        &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;01&apos;, &apos; &apos;,        &apos; &apos;, &apos;1&apos;, &apos;1&apos;, &apos;100&apos;, &apos;6&apos;], dtype=&apos;&lt;U40&apos;), array([&apos;1&apos;, &apos;  &apos;, &apos;2&apos;, &apos;1&apos;, &apos;01&apos;, &apos;M&apos;, &apos;1&apos;, &apos;058&apos;, &apos; &apos;, &apos;37&apos;, &apos;17&apos;, &apos;08&apos;,        &apos;  &apos;, &apos;4&apos;, &apos;D&apos;, &apos;3&apos;, &apos;2014&apos;, &apos;U&apos;, &apos;7&apos;, &apos;C&apos;, &apos;N&apos;, &apos; &apos;, &apos; &apos;, &apos;I250&apos;,        &apos;214&apos;, &apos;062&apos;, &apos;   &apos;, &apos;21&apos;, &apos;03&apos;, &apos;11I250 &apos;, &apos;61I272 &apos;, &apos;62E669 &apos;,        &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;,        &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;,        &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;       &apos;, &apos;03&apos;,        &apos;I250 &apos;, &apos;E669 &apos;, &apos;I272 &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;,        &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;,        &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;     &apos;, &apos;01&apos;, &apos; &apos;,        &apos; &apos;, &apos;1&apos;, &apos;1&apos;, &apos;100&apos;, &apos;6&apos;], dtype=&apos;&lt;U40&apos;)]</code></pre><h3 id="flatMap-è½¬æ¢"><a href="#flatMap-è½¬æ¢" class="headerlink" title=".flatMap()è½¬æ¢"></a>.flatMap()è½¬æ¢</h3><p><code>.flatMap()</code>æ–¹æ³•å’Œ.map()å·¥ä½œç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯flatMap()è¿”å›ä¸€ä¸ªæ‰å¹³çš„ç»“æœè€Œä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_flat = data_file.flatMap(<span class="keyword">lambda</span> x: (x[<span class="number">16</span>], int(x[<span class="number">16</span>])+<span class="number">1</span>))</span><br><span class="line">data_flat.take(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><pre><code>[&apos;2014&apos;, 2015, &apos;2014&apos;, 2015, &apos;2014&apos;, 2015, &apos;2014&apos;, 2015, &apos;2014&apos;, 2015]</code></pre><p>.flatMap()å¯ä»¥ç”¨äºè¿‡æ»¤ä¸€äº›æ ¼å¼ä¸æ­£ç¡®çš„è®°å½•ã€‚åœ¨è¿™ä¸ªæœºåˆ¶ä¸‹ï¼Œ.flatMap()æ–¹æ³•å§æ¯ä¸€è¡Œçœ‹ä½œä¸€ä¸ªåˆ—è¡¨å¯¹å¾…ï¼Œç„¶åå°†æ‰€æœ‰è®°å½•ç®€å•çš„åŠ å…¥åˆ°ä¸€èµ·ï¼Œé€šè¿‡ä¼ é€’ä¸€ä¸ªç©ºåˆ—è¡¨å¯ä»¥ä¸¢å¼ƒæ ¼å¼ä¸æ­£ç¡®çš„è®°å½•ã€‚</p><h3 id="distinct-è½¬æ¢"><a href="#distinct-è½¬æ¢" class="headerlink" title=".distinct()è½¬æ¢"></a>.distinct()è½¬æ¢</h3><p>è¿™é‡Œç”¨è¯¥æ–¹æ³•æ£€æŸ¥æ€§åˆ«åˆ—è¡¨æ˜¯å¦åªåŒ…å«äº†ç”·æ€§å’Œå¥³æ€§éªŒè¯æˆ‘ä»¬æ˜¯å¦å‡†ç¡®è§£é‡Šäº†æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">distinct_gender = data_file.map(<span class="keyword">lambda</span> x: x[<span class="number">5</span>]).distinct()</span><br><span class="line">distinct_gender.collect()</span><br></pre></td></tr></table></figure><pre><code>[&apos;M&apos;, &apos;F&apos;, &apos;-99&apos;]</code></pre><h3 id="sample-è½¬æ¢"><a href="#sample-è½¬æ¢" class="headerlink" title=".sample() è½¬æ¢"></a>.sample() è½¬æ¢</h3><p>è¯¥æ–¹æ³•è¿”å›æ•°æ®é›†çš„éšæœºæ ·æœ¬ã€‚ç¬¬ä¸€ä¸ªå‚æ•°<code>withReplacement</code>æŒ‡å®šé‡‡æ ·æ˜¯å¦åº”è¯¥æ›¿æ¢ï¼Œç¬¬äºŒä¸ªå‚æ•°<code>fraction</code>å®šä¹‰è¿”å›æ•°æ®é‡çš„ç™¾åˆ†æ¯”ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¼ªéšæœºæ•°äº§ç”Ÿå™¨çš„ç§å­<code>seed</code>ã€‚</p><p>ä¸ºäº†èŠ‚çœè¿ç®—æ—¶é—´ï¼Œè¿™é‡Œé€‰å–æ„¿æ•°æ®åƒåˆ†ä¹‹ä¸€çš„éšæœºæ•°æ®ä½œä¸ºä¸‹é¢çš„ç»ƒä¹ æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_sample = data_file.sample(<span class="keyword">False</span>, <span class="number">0.001</span>, <span class="number">666</span>)</span><br><span class="line">data_sample.cache()</span><br></pre></td></tr></table></figure><pre><code>PythonRDD[25] at RDD at PythonRDD.scala:48</code></pre><h3 id="leftOuterJoin-è½¬æ¢"><a href="#leftOuterJoin-è½¬æ¢" class="headerlink" title=".leftOuterJoin()è½¬æ¢"></a>.leftOuterJoin()è½¬æ¢</h3><ul><li>.leftOuterJoin()ï¼š æ ¹æ®ä¸¤ä¸ªæ•°æ®é›†ä¸­éƒ½æœ‰å¾—å€¼æ¥è¿æ¥ä¸¤ä¸ªRDDï¼Œå¹¶è¿”å›<code>å·¦ä¾§</code>çš„RDDè®°å½•ï¼Œè€Œå³è¾¹çš„è®°å½•å‰¯åŠ è½½ä¸¤ä¸ªRDDåŒ¹é…çš„åœ°æ–¹ã€‚</li><li>.join() ï¼šåªè¿”å›ä¸¤ä¸ªRDDä¹‹é—´çš„å…³è”æ•°å€¼</li><li>.intersection()ï¼šè¿”å›ä¸¤ä¸ªRDDä¸­ç›¸ç­‰çš„è®°å½•</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rdd1 = sc.parallelize([(<span class="string">'a'</span>,<span class="number">1</span>), (<span class="string">'b'</span>,<span class="number">4</span>), (<span class="string">'c'</span>,<span class="number">10</span>)])</span><br><span class="line">rdd2 = sc.parallelize([(<span class="string">'a'</span>,<span class="number">4</span>), (<span class="string">'a'</span>,<span class="number">1</span>), (<span class="string">'b'</span>,<span class="number">6</span>), (<span class="string">'d'</span>,<span class="number">15</span>)])</span><br><span class="line">print(<span class="string">"leftOuterJoin: "</span>,rdd1.leftOuterJoin(rdd2).collect())</span><br><span class="line">print(<span class="string">"Join: "</span>,rdd1.join(rdd2).collect())</span><br><span class="line">print(<span class="string">"intersection: "</span>, rdd1.intersection(rdd2).collect())</span><br></pre></td></tr></table></figure><pre><code>leftOuterJoin:  [(&apos;c&apos;, (10, None)), (&apos;b&apos;, (4, 6)), (&apos;a&apos;, (1, 1)), (&apos;a&apos;, (1, 4))]Join:  [(&apos;b&apos;, (4, 6)), (&apos;a&apos;, (1, 1)), (&apos;a&apos;, (1, 4))]intersection:  [(&apos;a&apos;, 1)]</code></pre><h3 id="repartition-è½¬æ¢"><a href="#repartition-è½¬æ¢" class="headerlink" title=".repartition()è½¬æ¢"></a>.repartition()è½¬æ¢</h3><p>é‡æ–°å¯¹æ•°æ®é›†è¿›è¡Œåˆ†åŒºï¼Œæ”¹å˜æ•°æ®é›†åˆ†èµ›åŒºçš„æ•°é‡ã€‚æ­¤åŠŸèƒ½åº”è¯¥è°¨æ…å¹¶ä¸”ä»…å½“çœŸæ­£éœ€è¦çš„æ—¶å€™ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä¼šå……è¶³æ•°æ®ï¼Œå¯¼è‡´æ€§èƒ½äº§ç”Ÿå·¨å¤§çš„å½±å“ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(len(rdd2.glom().collect()))</span><br><span class="line">rdd2 = rdd2.repartition(<span class="number">4</span>)</span><br><span class="line">print(len(rdd2.glom().collect()))</span><br></pre></td></tr></table></figure><pre><code>34</code></pre><h2 id="åŠ¨ä½œ"><a href="#åŠ¨ä½œ" class="headerlink" title="åŠ¨ä½œ"></a>åŠ¨ä½œ</h2><h3 id="collect-åŠ¨ä½œ"><a href="#collect-åŠ¨ä½œ" class="headerlink" title=".collect() åŠ¨ä½œ"></a>.collect() åŠ¨ä½œ</h3><p>è¿”å›æ‰€æœ‰RDDçš„å…ƒç´ ç»™é©±åŠ¨ç¨‹åº</p><p>ğŸ’¡åŒæ—¶å¸¸ç”¨çš„è¿˜æœ‰: <code>.collectAsMap()</code>æ–¹æ³•</p><h3 id="take-åŠ¨ä½œ"><a href="#take-åŠ¨ä½œ" class="headerlink" title=".take() åŠ¨ä½œ"></a>.take() åŠ¨ä½œ</h3><p>å¯ä»¥è¯´è¿™äº‹æœ€æœ‰ç”¨çš„æ–¹æ³•ï¼Œè¿”å›<strong>å•ä¸ªæ•°æ®åˆ†åŒº</strong>çš„å‰nè¡Œã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rdd.take(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#ç­‰åŒäº:</span></span><br><span class="line">rdd.first()</span><br></pre></td></tr></table></figure></p><h3 id="reduce-åŠ¨ä½œ"><a href="#reduce-åŠ¨ä½œ" class="headerlink" title=".reduce() åŠ¨ä½œ"></a>.reduce() åŠ¨ä½œ</h3><p>è¯¥æ–¹æ³•ä½¿ç”¨æŒ‡å®šçš„æ–¹æ³•å‡å°‘RDDä¸­çš„å…ƒç´ ã€‚å¯ä»¥ç”¨è¯¥æ–¹æ³•è®¡ç®—RDDæ€»çš„å…ƒç´ ä¹‹å’Œï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd1.map(<span class="keyword">lambda</span> x: x[<span class="number">1</span>]).reduce(<span class="keyword">lambda</span> x, y: x + y)</span><br></pre></td></tr></table></figure></p><p>åœ¨æ¯ä¸€ä¸ªåˆ†åŒºé‡Œï¼Œreduce()æ–¹æ³•è¿è¡Œæ±‚å’Œæ–¹æ³•ï¼Œå°†æ”¹æ€»å’Œè¿”å›ç»™æœ€ç»ˆèšåˆæ‰€åœ¨çš„ç¨‹åºèŠ‚ç‚¹ã€‚</p><p>âš ï¸<strong>è­¦å‘Šï¼š</strong><br>è¦è°¨æ…æ³¨æ„çš„æ˜¯ï¼Œreduceä¼ é€’çš„å‡½æ•°éœ€è¦æ—¶å…³è”çš„ï¼Œæ—¢æ»¡è¶³å…ƒç´ é¡ºåºæ”¹å˜ç»“æœä¸å˜ï¼Œæ“ä½œç¬¦é¡ºåºæ”¹å˜ç»“æœä¸å˜ã€‚å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rdd = sc.parallelize([1, 2, 0.5, 0.1],1)</span><br><span class="line">rdd.reduce(lambda x, y: x / y)</span><br><span class="line"></span><br><span class="line">out: 10.0</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rdd = sc.parallelize([1, 2, 0.5, 0.1],2)</span><br><span class="line">rdd.reduce(lambda x, y: x / y)</span><br><span class="line"></span><br><span class="line">out: 0.1</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å¸Œæœ›è¾“å‡ºç»“æœæ˜¯10.0ï¼Œç¬¬ä¸€ä¸ªåªæŠŠRDDæ”¾åœ¨ä¸€ä¸ªåˆ†åŒºï¼Œè¾“å‡ºç»“æœç¬¦åˆé¢„æœŸã€‚ä½†æ˜¯åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œåˆ†äº†2ä¸ªåŒºï¼Œç»“æœå°±ä¸å¯¹äº†ã€‚å› ä¸ºè¯¥æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªåˆ†åŒºå¹¶è¡Œè®¡ç®—çš„ã€‚</p><h3 id="reduceByKey-åŠ¨ä½œ"><a href="#reduceByKey-åŠ¨ä½œ" class="headerlink" title=".reduceByKey()  åŠ¨ä½œ"></a>.reduceByKey()  åŠ¨ä½œ</h3><p>è¯¥æ–¹æ³•å’Œ.reduce()æ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯å®åœ¨key-keyåŸºç¡€ä¸Šè¿è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_key = sc.parallelize([(<span class="string">'a'</span>,<span class="number">3</span>), (<span class="string">'a'</span>,<span class="number">1</span>), (<span class="string">'b'</span>,<span class="number">6</span>), (<span class="string">'d'</span>,<span class="number">1</span>), (<span class="string">'b'</span>,<span class="number">6</span>), (<span class="string">'d'</span>,<span class="number">15</span>), (<span class="string">'d'</span>,<span class="number">3</span>), (<span class="string">'a'</span>,<span class="number">7</span>), (<span class="string">'b'</span>, <span class="number">8</span>)],<span class="number">4</span>)</span><br><span class="line">data_key.reduceByKey(<span class="keyword">lambda</span> x, y: x+y).collect()</span><br></pre></td></tr></table></figure><pre><code>[(&apos;b&apos;, 20), (&apos;a&apos;, 11), (&apos;d&apos;, 19)]</code></pre><h3 id="count-åŠ¨ä½œ"><a href="#count-åŠ¨ä½œ" class="headerlink" title=".count()  åŠ¨ä½œ"></a>.count()  åŠ¨ä½œ</h3><p>.count() æ–¹æ³•ç»Ÿè®¡å‡ºäº†RDDé‡Œæ‰€æœ‰çš„å…ƒç´ æ•°é‡ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.count()</span><br></pre></td></tr></table></figure></p><p>.count() æ–¹æ³•äº§ç”Ÿå…¥æˆæ–¹æ³•åŒæ ·çš„ç»“æœï¼Œä½†ä¸éœ€è¦æŠŠæ•´ä¸ªæ•°æ®é›†ç§»åŠ¨åˆ°é©±åŠ¨ç¨‹åºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len(rdd.collect()). # âš ï¸è­¦å‘Šï¼šä¸è¦è¿™æ ·åšï¼ï¼</span><br></pre></td></tr></table></figure></p><h3 id="countByKey-åŠ¨ä½œ"><a href="#countByKey-åŠ¨ä½œ" class="headerlink" title=".countByKey() åŠ¨ä½œ"></a>.countByKey() åŠ¨ä½œ</h3><p>å¦‚æœæ•°æ®é›†æ˜¯Ket-Valueå½¢å¼ï¼Œå¯ä»¥ä½¿ç”¨.countByKey()æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_key.countByKey().items()</span><br></pre></td></tr></table></figure><pre><code>dict_items([(&apos;a&apos;, 3), (&apos;b&apos;, 3), (&apos;d&apos;, 3)])</code></pre><h3 id="saveAsTextFile-åŠ¨ä½œ"><a href="#saveAsTextFile-åŠ¨ä½œ" class="headerlink" title=".saveAsTextFile()  åŠ¨ä½œ"></a>.saveAsTextFile()  åŠ¨ä½œ</h3><p>è¯¥æ–¹æ³•å°†RDDä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼šæ¯ä¸ªæ–‡ä»¶ä¸€ä¸ªåˆ†åŒº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_key.saveAsTextFile(<span class="string">'hdfs://master:9000/out/data_key.txt'</span>)</span><br></pre></td></tr></table></figure><p>è¦è¯»å–å®ƒçš„æ—¶å€™éœ€è¦è§£æï¼Œå› ä¸ºæ‰€æœ‰è¡Œéƒ½è¢«è§†ä¸ºå­—ç¬¦ä¸²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parseInput</span><span class="params">(row)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> re</span><br><span class="line">    pattern = re.compile(<span class="string">r"\(\'([a-z]+)\',.([0-9]+)\)"</span>) <span class="comment"># è¿™é‡Œâ€œ+â€å·ä»£è¡¨åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªåŒ¹é…å­—ç¬¦ï¼Œå¦åˆ™é’ˆå¯¹åŒä½æ•°åŠ¨ä½œæ“ä½œä¼šæŠ¥é”™</span></span><br><span class="line">    row_split = pattern.split(row)</span><br><span class="line">    <span class="keyword">return</span> (row_split[<span class="number">1</span>], row_split[<span class="number">2</span>])</span><br><span class="line">data_key_read = sc.textFile(<span class="string">'hdfs://master:9000/out/data_key.txt'</span>)</span><br><span class="line">data_key_read.map(parseInput).collect()</span><br></pre></td></tr></table></figure><pre><code>[(&apos;a&apos;, &apos;3&apos;), (&apos;a&apos;, &apos;1&apos;), (&apos;b&apos;, &apos;6&apos;), (&apos;d&apos;, &apos;1&apos;), (&apos;b&apos;, &apos;6&apos;), (&apos;d&apos;, &apos;15&apos;), (&apos;d&apos;, &apos;3&apos;), (&apos;a&apos;, &apos;7&apos;), (&apos;b&apos;, &apos;8&apos;)]</code></pre><p>ğŸ’¡åŒæ—¶è¿˜æœ‰ï¼š</p><ul><li>rdd.saveAsHadoopDataset</li><li>rdd.saveAsSequenceFile</li><li>â€¦<br>ç­‰æ–¹æ³•</li></ul><h3 id="foreach-åŠ¨ä½œ"><a href="#foreach-åŠ¨ä½œ" class="headerlink" title=".foreach()  åŠ¨ä½œ"></a>.foreach()  åŠ¨ä½œ</h3><p>è¿™ä¸ªæ–¹æ³•å¯¹RDDé‡Œçš„æ¯ä¸ªå…ƒç´ ï¼Œç”¨è¿­ä»£æ–¹æ³•åº”ç”¨ç›¸åŒçš„å‡½æ•°ï¼›å’Œ<code>.map()</code>ç›¸æ¯”ï¼Œ<code>.foreach()</code>æ–¹æ³•æŒ‰ç…§ä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ–¹å¼ï¼Œå¯¹æ¯ä¸€æ¡è®°å½•åº”ç”¨ä¸€ä¸ªå®šä¹‰å¥½çš„å‡½æ•°ã€‚å½“å¸Œæœ›å°†æ•°æ®æ›¹æ‘é“PySparkæœ¬èº«ä¸æ”¯æŒçš„æ•°æ®åº“æ˜¯ï¼Œè¯¥æ–¹æ³•å¾ˆæœ‰ç”¨ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line">    print(x)</span><br><span class="line"></span><br><span class="line">rdd.foreach(f)</span><br></pre></td></tr></table></figure></p><h2 id="å°ç»“ï¼š"><a href="#å°ç»“ï¼š" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h2><ul><li><code>RDDæ˜¯Sparkçš„æ ¸å¿ƒ</code>ï¼›è¿™äº›æ— <code>schema</code>æ•°æ®ç»“æ„æ—©Sparkä¸­å¤„ç†çš„æœ€åŸºæœ¬çš„æ•°æ®ç»“æ„ã€‚</li><li>RDDçš„ä¸¤ç§åˆ›å»ºæ–¹å¼ï¼š parallelize å’Œ æ–‡ä»¶è¯»å–</li><li>Sparkä¸­çš„è½¬åŒ–æ˜¯æƒ°æ€§çš„ï¼Œåªåœ¨æ“ä½œè¢«è°ƒç”¨æ—¶åº”ç”¨ã€‚</li><li>Scala å’Œ Python RDDä¹‹é—´ä¸€ä¸ªä¸»è¦çš„åŒºåˆ«æ˜¯é€Ÿåº¦ï¼š Python RDD æ¯” Scala æ…¢å¾ˆå¤šï¼</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;RDDçš„å†…éƒ¨è¿è¡Œæ–¹å¼&quot;&gt;&lt;a href=&quot;#RDDçš„å†…éƒ¨è¿è¡Œæ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;RDDçš„å†…éƒ¨è¿è¡Œæ–¹å¼&quot;&gt;&lt;/a&gt;RDDçš„å†…éƒ¨è¿è¡Œæ–¹å¼&lt;/h2&gt;&lt;p&gt;RDDä¸ä»…æ˜¯ä¸€ç»„ä¸å¯å˜çš„JVMï¼ˆJavaè™šæ‹Ÿæœºï¼‰å¯¹è±¡çš„åˆ†å¸ƒé›†ï¼Œè€Œä¸”æ˜¯Spar
      
    
    </summary>
    
      <category term="Spark" scheme="http://www.ihoge.cn/categories/Spark/"/>
    
    
      <category term="pyspark" scheme="http://www.ihoge.cn/tags/pyspark/"/>
    
  </entry>
  
  <entry>
    <title>Sparkè¿è¡ŒåŸç†å‰–æ</title>
    <link href="http://www.ihoge.cn/2018/Spark%20Scheduler.html"/>
    <id>http://www.ihoge.cn/2018/Spark Scheduler.html</id>
    <published>2018-04-15T09:59:21.000Z</published>
    <updated>2018-04-15T10:15:35.501Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>Apache Sparkæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œå¼ºå¤§çš„åˆ†å¸ƒå¼æŸ¥è¯¢å’Œå¤„ç†å¼•æ“ã€‚å®ƒæä¾›MapReduceçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä½†é€Ÿåº¦æ˜æ˜¾æ›´é«˜ã€‚<br><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fqd8rm8qdtj30er07a74i.jpg" alt=""></p><p>Sparkçš„æ ¸å¿ƒæ˜¯æ ¹æ®RDDæ¥å®ç°çš„ï¼ŒSpark Scheduleråˆ™ä¸ºSparkæ ¸å¿ƒå®ç°çš„é‡è¦ä¸€ç¯ï¼Œå…¶ä½œç”¨å°±æ˜¯ä»»åŠ¡è°ƒåº¦ã€‚Sparkçš„ä»»åŠ¡è°ƒåº¦å°±æ˜¯å¦‚ä½•ç»„ç»‡ä»»åŠ¡å»å¤„ç†RDDä¸­æ¯ä¸ªåˆ†åŒºçš„æ•°æ®ï¼Œæ ¹æ®RDDçš„ä¾èµ–å…³ç³»æ„å»ºDAGï¼ŒåŸºäºDAGåˆ’åˆ†Stageï¼Œå°†æ¯ä¸ªStageä¸­çš„ä»»åŠ¡å‘åˆ°æŒ‡å®šèŠ‚ç‚¹è¿è¡Œã€‚åŸºäºSparkçš„ä»»åŠ¡è°ƒåº¦åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥åˆç†è§„åˆ’èµ„æºåˆ©ç”¨ï¼Œåšåˆ°å°½å¯èƒ½ç”¨æœ€å°‘çš„èµ„æºé«˜æ•ˆåœ°å®Œæˆä»»åŠ¡è®¡ç®—ã€‚</p><h2 id="åˆ†å¸ƒå¼è¿è¡Œæ¡†æ¶"><a href="#åˆ†å¸ƒå¼è¿è¡Œæ¡†æ¶" class="headerlink" title="åˆ†å¸ƒå¼è¿è¡Œæ¡†æ¶"></a>åˆ†å¸ƒå¼è¿è¡Œæ¡†æ¶</h2><p>Sparkå¯ä»¥éƒ¨ç½²åœ¨å¤šç§èµ„æºç®¡ç†å¹³å°ï¼Œä¾‹å¦‚Yarnã€Mesosç­‰ï¼ŒSparkæœ¬èº«ä¹Ÿå®ç°äº†ä¸€ä¸ªç®€æ˜“çš„èµ„æºç®¡ç†æœºåˆ¶ï¼Œç§°ä¹‹ä¸ºStandaloneæ¨¡å¼ã€‚ä»¥ä¸‹æ‰€è¿°å‡è¡¨ç¤ºSpark-on-Yarnã€‚Sparkéƒ¨ç½²åœ¨Yarnä¸Šæœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼Œåˆ†åˆ«ä¸ºyarn-clientå’Œyarn-clusteræ¨¡å¼ï¼Œå®ƒä»¬çš„åŒºåˆ«ä»…ä»…åœ¨äºSpark Driveræ˜¯è¿è¡Œåœ¨Clientç«¯è¿˜æ˜¯ApplicationMaterç«¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºSparkéƒ¨ç½²åœ¨Yarnä¸Šï¼Œä»¥yarn-clusteræ¨¡å¼è¿è¡Œçš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ã€‚<br><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fqd9qs2x4ej31920n4n11.jpg" alt=""></p><p>å…¶ä¸­è“è‰²éƒ¨åˆ†æ˜¯Sparké‡Œçš„æ¦‚å¿µï¼ŒåŒ…æ‹¬Clientã€ApplicationMasterã€Driverå’ŒExecutorï¼Œå…¶ä¸­Clientå’ŒApplicationMasterä¸»è¦æ˜¯è´Ÿè´£ä¸Yarnè¿›è¡Œäº¤äº’ï¼›Driverä½œä¸ºSparkåº”ç”¨ç¨‹åºçš„æ€»æ§ï¼Œè´Ÿè´£åˆ†å‘ä»»åŠ¡ä»¥åŠç›‘æ§ä»»åŠ¡è¿è¡ŒçŠ¶æ€ï¼›Executorè´Ÿè´£æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶ä¸ŠæŠ¥çŠ¶æ€ä¿¡æ¯ç»™Driverï¼Œä»é€»è¾‘ä¸Šæ¥çœ‹Executoræ˜¯è¿›ç¨‹ï¼Œè¿è¡Œåœ¨å…¶ä¸­çš„ä»»åŠ¡æ˜¯çº¿ç¨‹ï¼Œæ‰€ä»¥è¯´Sparkçš„ä»»åŠ¡æ˜¯çº¿ç¨‹çº§åˆ«çš„ã€‚é€šè¿‡ä¸‹é¢çš„æ—¶åºå›¾å¯ä»¥æ›´æ¸…æ™°åœ°ç†è§£ä¸€ä¸ªSparkåº”ç”¨ç¨‹åºä»æäº¤åˆ°è¿è¡Œçš„å®Œæ•´æµç¨‹ã€‚</p><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fqd9s947htj31am11mafh.jpg" alt=""></p><p><strong>Client</strong><br>æäº¤ä¸€ä¸ªSparkåº”ç”¨ç¨‹åºï¼Œé¦–å…ˆé€šè¿‡Clientå‘ResourceManagerè¯·æ±‚å¯åŠ¨ä¸€ä¸ªApplicationï¼ŒåŒæ—¶æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„æºæ»¡è¶³Applicationçš„éœ€æ±‚ï¼Œå¦‚æœèµ„æºæ¡ä»¶æ»¡è¶³ï¼Œåˆ™å‡†å¤‡ApplicationMasterçš„å¯åŠ¨ä¸Šä¸‹æ–‡ï¼Œäº¤ç»™ResourceManagerï¼Œå¹¶å¾ªç¯ç›‘æ§ApplicationçŠ¶æ€ã€‚</p><p><strong>ResourceManager</strong><br>å½“æäº¤çš„èµ„æºé˜Ÿåˆ—ä¸­æœ‰èµ„æºæ—¶ï¼ŒResourceManagerä¼šåœ¨æŸä¸ªNodeManagerä¸Šå¯åŠ¨ApplicationMasterè¿›ç¨‹ï¼ŒApplicationMasterä¼šå•ç‹¬å¯åŠ¨Driveråå°çº¿ç¨‹ï¼Œå½“Driverå¯åŠ¨åï¼ŒApplicationMasterä¼šé€šè¿‡æœ¬åœ°çš„RPCè¿æ¥Driverï¼Œå¹¶å¼€å§‹å‘ResourceManagerç”³è¯·Containerèµ„æºè¿è¡ŒExecutorè¿›ç¨‹ï¼ˆä¸€ä¸ªExecutorå¯¹åº”ä¸ä¸€ä¸ªContainerï¼‰ï¼Œå½“ResourceManagerè¿”å›Containerèµ„æºï¼Œåˆ™åœ¨å¯¹åº”çš„Containerä¸Šå¯åŠ¨Executorã€‚</p><p><strong>Driver</strong><br>Driverçº¿ç¨‹ä¸»è¦æ˜¯åˆå§‹åŒ–SparkContextå¯¹è±¡ï¼Œå‡†å¤‡è¿è¡Œæ‰€éœ€çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åä¸€æ–¹é¢ä¿æŒä¸ApplicationMasterçš„RPCè¿æ¥ï¼Œé€šè¿‡ApplicationMasterç”³è¯·èµ„æºï¼Œå¦ä¸€æ–¹é¢æ ¹æ®ç”¨æˆ·ä¸šåŠ¡é€»è¾‘å¼€å§‹è°ƒåº¦ä»»åŠ¡ï¼Œå°†ä»»åŠ¡ä¸‹å‘åˆ°å·²æœ‰çš„ç©ºé—²Executorä¸Šã€‚</p><p><strong>Executor</strong><br>å½“ResourceManagerå‘ApplicationMasterè¿”å›Containerèµ„æºæ—¶ï¼ŒApplicationMasterå°±å°è¯•åœ¨å¯¹åº”çš„Containerä¸Šå¯åŠ¨Executorè¿›ç¨‹ï¼ŒExecutorè¿›ç¨‹èµ·æ¥åï¼Œä¼šå‘Driveræ³¨å†Œï¼Œæ³¨å†ŒæˆåŠŸåä¿æŒä¸Driverçš„å¿ƒè·³ï¼ŒåŒæ—¶ç­‰å¾…Driveråˆ†å‘ä»»åŠ¡ï¼Œå½“åˆ†å‘çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå°†ä»»åŠ¡çŠ¶æ€ä¸ŠæŠ¥ç»™Driverã€‚</p><blockquote><p>DriveræŠŠèµ„æºç”³è¯·çš„é€»è¾‘ç»™æŠ½è±¡å‡ºæ¥ï¼Œä»¥é€‚é…ä¸åŒçš„èµ„æºç®¡ç†ç³»ç»Ÿï¼Œæ‰€ä»¥æ‰é—´æ¥åœ°é€šè¿‡ApplicationMasterå»å’ŒYarnæ‰“äº¤é“ã€‚</p></blockquote><p>ä»ä¸Šè¿°æ—¶åºå›¾å¯çŸ¥ï¼Œ<strong>Clientåªç®¡æäº¤Applicationå¹¶ç›‘æ§Applicationçš„çŠ¶æ€</strong>ã€‚å¯¹äºSparkçš„ä»»åŠ¡è°ƒåº¦ä¸»è¦æ˜¯é›†ä¸­åœ¨ä¸¤ä¸ªæ–¹é¢: <code>èµ„æºç”³è¯·</code>å’Œ<code>ä»»åŠ¡åˆ†å‘</code>ï¼Œå…¶ä¸»è¦æ˜¯é€šè¿‡<code>ApplicationMaster</code>ã€<code>Driver</code>ä»¥åŠ<code>Executor</code>ä¹‹é—´æ¥å®Œæˆï¼Œä¸‹é¢è¯¦ç»†å‰–æSparkä»»åŠ¡è°ƒåº¦æ¯ä¸ªç»†èŠ‚ã€‚</p><h2 id="Sparkä»»åŠ¡è°ƒåº¦æ€»è§ˆ"><a href="#Sparkä»»åŠ¡è°ƒåº¦æ€»è§ˆ" class="headerlink" title="Sparkä»»åŠ¡è°ƒåº¦æ€»è§ˆ"></a>Sparkä»»åŠ¡è°ƒåº¦æ€»è§ˆ</h2><p>å½“Driverèµ·æ¥åï¼ŒDriveråˆ™ä¼šæ ¹æ®ç”¨æˆ·ç¨‹åºé€»è¾‘å‡†å¤‡ä»»åŠ¡ï¼Œå¹¶æ ¹æ®Executorèµ„æºæƒ…å†µé€æ­¥åˆ†å‘ä»»åŠ¡ã€‚åœ¨è¯¦ç»†é˜è¿°ä»»åŠ¡è°ƒåº¦å‰ï¼Œé¦–å…ˆè¯´æ˜ä¸‹Sparké‡Œçš„å‡ ä¸ªæ¦‚å¿µã€‚ä¸€ä¸ªSparkåº”ç”¨ç¨‹åºåŒ…æ‹¬Jobã€Stageä»¥åŠTaskä¸‰ä¸ªæ¦‚å¿µï¼š</p><ul><li>Jobæ˜¯ä»¥Actionæ–¹æ³•ä¸ºç•Œï¼Œé‡åˆ°ä¸€ä¸ªActionæ–¹æ³•åˆ™è§¦å‘ä¸€ä¸ªJobï¼›</li><li>Stageæ˜¯Jobçš„å­é›†ï¼Œä»¥RDDå®½ä¾èµ–(å³Shuffle)ä¸ºç•Œï¼Œé‡åˆ°Shuffleåšä¸€æ¬¡åˆ’åˆ†ï¼›</li><li>Taskæ˜¯Stageçš„å­é›†ï¼Œä»¥å¹¶è¡Œåº¦(åˆ†åŒºæ•°)æ¥è¡¡é‡ï¼Œåˆ†åŒºæ•°æ˜¯å¤šå°‘ï¼Œåˆ™æœ‰å¤šå°‘ä¸ªtaskã€‚</li></ul><p>Sparkçš„ä»»åŠ¡è°ƒåº¦æ€»ä½“æ¥è¯´åˆ†ä¸¤è·¯è¿›è¡Œï¼Œä¸€è·¯æ˜¯Stageçº§çš„è°ƒåº¦ï¼Œä¸€è·¯æ˜¯Taskçº§çš„è°ƒåº¦ï¼Œæ€»ä½“è°ƒåº¦æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fqda2pc5qcj31dw12sn79.jpg" alt=""></p><p>Spark RDDé€šè¿‡å…¶Transactionsæ“ä½œï¼Œå½¢æˆäº†RDDè¡€ç¼˜å…³ç³»å›¾ï¼Œå³DAGï¼Œæœ€åé€šè¿‡Actionçš„è°ƒç”¨ï¼Œè§¦å‘Jobå¹¶è°ƒåº¦æ‰§è¡Œã€‚DAGSchedulerè´Ÿè´£Stageçº§çš„è°ƒåº¦ï¼Œä¸»è¦æ˜¯å°†DAGåˆ‡åˆ†æˆè‹¥å¹²Stagesï¼Œå¹¶å°†æ¯ä¸ªStageæ‰“åŒ…æˆTaskSetäº¤ç»™TaskSchedulerè°ƒåº¦ã€‚TaskSchedulerè´Ÿè´£Taskçº§çš„è°ƒåº¦ï¼Œå°†DAGSchedulerç»™è¿‡æ¥çš„TaskSetæŒ‰ç…§æŒ‡å®šçš„è°ƒåº¦ç­–ç•¥åˆ†å‘åˆ°Executorä¸Šæ‰§è¡Œï¼Œè°ƒåº¦è¿‡ç¨‹ä¸­SchedulerBackendè´Ÿè´£æä¾›å¯ç”¨èµ„æºï¼Œå…¶ä¸­SchedulerBackendæœ‰å¤šç§å®ç°ï¼Œåˆ†åˆ«å¯¹æ¥ä¸åŒçš„èµ„æºç®¡ç†ç³»ç»Ÿã€‚æœ‰äº†ä¸Šè¿°æ„Ÿæ€§çš„è®¤è¯†åï¼Œä¸‹é¢è¿™å¼ å›¾æè¿°äº†Spark-On-Yarnæ¨¡å¼ä¸‹åœ¨ä»»åŠ¡è°ƒåº¦æœŸé—´ï¼ŒApplicationMasterã€Driverä»¥åŠExecutorå†…éƒ¨æ¨¡å—çš„äº¤äº’è¿‡ç¨‹ã€‚</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fqda6xygpnj31kw0vzgue.jpg" alt=""></p><p>Driveråˆå§‹åŒ–SparkContextè¿‡ç¨‹ä¸­ï¼Œä¼šåˆ†åˆ«åˆå§‹åŒ–DAGSchedulerã€TaskSchedulerã€SchedulerBackendä»¥åŠHeartbeatReceiverï¼Œå¹¶å¯åŠ¨SchedulerBackendä»¥åŠHeartbeatReceiverã€‚SchedulerBackendé€šè¿‡ApplicationMasterç”³è¯·èµ„æºï¼Œå¹¶ä¸æ–­ä»TaskSchedulerä¸­æ‹¿åˆ°åˆé€‚çš„Taskåˆ†å‘åˆ°Executoræ‰§è¡Œã€‚HeartbeatReceiverè´Ÿè´£æ¥æ”¶Executorçš„å¿ƒè·³ä¿¡æ¯ï¼Œç›‘æ§Executorçš„å­˜æ´»çŠ¶å†µï¼Œå¹¶é€šçŸ¥åˆ°TaskSchedulerã€‚ä¸‹é¢ç€é‡å‰–æDAGSchedulerè´Ÿè´£çš„Stageè°ƒåº¦ä»¥åŠTaskSchedulerè´Ÿè´£çš„Taskè°ƒåº¦ã€‚</p><h3 id="Stageçº§çš„è°ƒåº¦"><a href="#Stageçº§çš„è°ƒåº¦" class="headerlink" title="Stageçº§çš„è°ƒåº¦"></a>Stageçº§çš„è°ƒåº¦</h3><p>Sparkçš„ä»»åŠ¡è°ƒåº¦æ˜¯ä»DAGåˆ‡å‰²å¼€å§‹ï¼Œä¸»è¦æ˜¯ç”±DAGScheduleræ¥å®Œæˆã€‚å½“é‡åˆ°ä¸€ä¸ªActionæ“ä½œåå°±ä¼šè§¦å‘ä¸€ä¸ªJobçš„è®¡ç®—ï¼Œå¹¶äº¤ç»™DAGScheduleræ¥æäº¤ï¼Œä¸‹å›¾æ˜¯æ¶‰åŠåˆ°Jobæäº¤çš„ç›¸å…³æ–¹æ³•è°ƒç”¨æµç¨‹å›¾ã€‚</p><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fqda8al64mj31kw0hdq7n.jpg" alt=""></p><p>Jobç”±æœ€ç»ˆçš„RDDå’ŒActionæ–¹æ³•å°è£…è€Œæˆï¼ŒSparkContextå°†Jobäº¤ç»™DAGScheduleræäº¤ï¼Œå®ƒä¼šæ ¹æ®RDDçš„è¡€ç¼˜å…³ç³»æ„æˆçš„DAGè¿›è¡Œåˆ‡åˆ†ï¼Œå°†ä¸€ä¸ªJobåˆ’åˆ†ä¸ºè‹¥å¹²Stagesï¼Œå…·ä½“åˆ’åˆ†ç­–ç•¥æ˜¯ï¼Œç”±æœ€ç»ˆçš„RDDä¸æ–­é€šè¿‡ä¾èµ–å›æº¯åˆ¤æ–­çˆ¶ä¾èµ–æ˜¯å¦æ˜¯æ¬¾ä¾èµ–ï¼Œå³ä»¥Shuffleä¸ºç•Œï¼Œåˆ’åˆ†Stageï¼Œçª„ä¾èµ–çš„RDDä¹‹é—´è¢«åˆ’åˆ†åˆ°åŒä¸€ä¸ªStageä¸­ï¼Œå¯ä»¥è¿›è¡Œpipelineå¼çš„è®¡ç®—ï¼Œå¦‚ä¸Šå›¾ç´«è‰²æµç¨‹éƒ¨åˆ†ã€‚åˆ’åˆ†çš„Stagesåˆ†ä¸¤ç±»ï¼Œä¸€ç±»å«åšResultStageï¼Œä¸ºDAGæœ€ä¸‹æ¸¸çš„Stageï¼Œç”±Actionæ–¹æ³•å†³å®šï¼Œå¦ä¸€ç±»å«åšShuffleMapStageï¼Œä¸ºä¸‹æ¸¸Stageå‡†å¤‡æ•°æ®ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­WordCountã€‚</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fqda8um68bj31cw0huahy.jpg" alt=""></p><p>Jobç”±saveAsTextFileè§¦å‘ï¼Œè¯¥Jobç”±RDD-3å’ŒsaveAsTextFileæ–¹æ³•ç»„æˆï¼Œæ ¹æ®RDDä¹‹é—´çš„ä¾èµ–å…³ç³»ä»RDD-3å¼€å§‹å›æº¯æœç´¢ï¼Œç›´åˆ°æ²¡æœ‰ä¾èµ–çš„RDD-0ï¼Œåœ¨å›æº¯æœç´¢è¿‡ç¨‹ä¸­ï¼ŒRDD-3ä¾èµ–RDD-2ï¼Œå¹¶ä¸”æ˜¯å®½ä¾èµ–ï¼Œæ‰€ä»¥åœ¨RDD-2å’ŒRDD-3ä¹‹é—´åˆ’åˆ†Stageï¼ŒRDD-3è¢«åˆ’åˆ°æœ€åä¸€ä¸ªStageï¼Œå³ResultStageä¸­ï¼ŒRDD-2ä¾èµ–RDD-1ï¼ŒRDD-1ä¾èµ–RDD-0ï¼Œè¿™äº›ä¾èµ–éƒ½æ˜¯çª„ä¾èµ–ï¼Œæ‰€ä»¥å°†RDD-0ã€RDD-1å’ŒRDD-2åˆ’åˆ†åˆ°åŒä¸€ä¸ªStageï¼Œå³ShuffleMapStageä¸­ï¼Œå®é™…æ‰§è¡Œçš„æ—¶å€™ï¼Œæ•°æ®è®°å½•ä¼šä¸€æ°”å‘µæˆåœ°æ‰§è¡ŒRDD-0åˆ°RDD-2çš„è½¬åŒ–ã€‚ä¸éš¾çœ‹å‡ºï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ã€‚</p><p>ä¸€ä¸ªStageæ˜¯å¦è¢«æäº¤ï¼Œéœ€è¦åˆ¤æ–­å®ƒçš„çˆ¶Stageæ˜¯å¦æ‰§è¡Œï¼Œåªæœ‰åœ¨çˆ¶Stageæ‰§è¡Œå®Œæ¯•æ‰èƒ½æäº¤å½“å‰Stageï¼Œå¦‚æœä¸€ä¸ªStageæ²¡æœ‰çˆ¶Stageï¼Œé‚£ä¹ˆä»è¯¥Stageå¼€å§‹æäº¤ã€‚Stageæäº¤æ—¶ä¼šå°†Taskä¿¡æ¯ï¼ˆåˆ†åŒºä¿¡æ¯ä»¥åŠæ–¹æ³•ç­‰ï¼‰åºåˆ—åŒ–å¹¶è¢«æ‰“åŒ…æˆTaskSetäº¤ç»™TaskSchedulerï¼Œä¸€ä¸ªPartitionå¯¹åº”ä¸€ä¸ªTaskï¼Œå¦ä¸€æ–¹é¢ç›‘æ§Stageçš„è¿è¡ŒçŠ¶æ€ï¼Œåªæœ‰Executorä¸¢å¤±æˆ–è€…Taskç”±äºFetchå¤±è´¥æ‰éœ€è¦é‡æ–°æäº¤å¤±è´¥çš„Stageä»¥è°ƒåº¦è¿è¡Œå¤±è´¥çš„ä»»åŠ¡ï¼Œå…¶ä»–ç±»å‹çš„Taskå¤±è´¥ä¼šåœ¨TaskSchedulerçš„è°ƒåº¦è¿‡ç¨‹ä¸­é‡è¯•ã€‚</p><p>ç›¸å¯¹æ¥è¯´DAGScheduleråšçš„äº‹æƒ…è¾ƒä¸ºç®€å•ï¼Œä»…ä»…æ˜¯åœ¨Stageå±‚é¢ä¸Šåˆ’åˆ†DAGï¼Œæäº¤Stageå¹¶ç›‘æ§ç›¸å…³çŠ¶æ€ä¿¡æ¯ã€‚TaskScheduleråˆ™ç›¸å¯¹è¾ƒä¸ºå¤æ‚ï¼Œä¸‹é¢è¯¦ç»†é˜è¿°å…¶ç»†èŠ‚ã€‚</p><h3 id="Taskçº§çš„è°ƒåº¦"><a href="#Taskçº§çš„è°ƒåº¦" class="headerlink" title="Taskçº§çš„è°ƒåº¦"></a>Taskçº§çš„è°ƒåº¦</h3><p>Spark Taskçš„è°ƒåº¦æ˜¯ç”±TaskScheduleræ¥å®Œæˆï¼Œç”±å‰æ–‡å¯çŸ¥ï¼ŒDAGSchedulerå°†Stageæ‰“åŒ…åˆ°TaskSetäº¤ç»™TaskSchedulerï¼ŒTaskSchedulerä¼šå°†å…¶å°è£…ä¸ºTaskSetManageråŠ å…¥åˆ°è°ƒåº¦é˜Ÿåˆ—ä¸­ï¼ŒTaskSetManagerè´Ÿè´£ç›‘æ§ç®¡ç†åŒä¸€ä¸ªStageä¸­çš„Tasksï¼ŒTaskSchedulerå°±æ˜¯ä»¥TaskSetManagerä¸ºå•å…ƒæ¥è°ƒåº¦ä»»åŠ¡ã€‚å‰é¢ä¹Ÿæåˆ°ï¼ŒTaskScheduleråˆå§‹åŒ–åä¼šå¯åŠ¨SchedulerBackendï¼Œå®ƒè´Ÿè´£è·Ÿå¤–ç•Œæ‰“äº¤é“ï¼Œæ¥æ”¶Executorçš„æ³¨å†Œä¿¡æ¯ï¼Œå¹¶ç»´æŠ¤Executorçš„çŠ¶æ€ï¼Œæ‰€ä»¥è¯´SchedulerBackendæ˜¯ç®¡â€œç²®é£Ÿâ€çš„ï¼ŒåŒæ—¶å®ƒåœ¨å¯åŠ¨åä¼šå®šæœŸåœ°å»â€œè¯¢é—®â€TaskScheduleræœ‰æ²¡æœ‰ä»»åŠ¡è¦è¿è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šå®šæœŸåœ°â€œé—®â€TaskSchedulerâ€œæˆ‘æœ‰è¿™ä¹ˆä½™é‡ï¼Œä½ è¦ä¸è¦å•Šâ€ï¼ŒTaskScheduleråœ¨SchedulerBackendâ€œé—®â€å®ƒçš„æ—¶å€™ï¼Œä¼šä»è°ƒåº¦é˜Ÿåˆ—ä¸­æŒ‰ç…§æŒ‡å®šçš„è°ƒåº¦ç­–ç•¥é€‰æ‹©TaskSetManagerå»è°ƒåº¦è¿è¡Œï¼Œå¤§è‡´æ–¹æ³•è°ƒç”¨æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fqda9kfl3dj31kw0lqq8i.jpg" alt=""></p><h4 id="è°ƒåº¦ç­–ç•¥"><a href="#è°ƒåº¦ç­–ç•¥" class="headerlink" title="è°ƒåº¦ç­–ç•¥"></a>è°ƒåº¦ç­–ç•¥</h4><p>å‰é¢è®²åˆ°ï¼ŒTaskSchedulerä¼šå…ˆæŠŠDAGSchedulerç»™è¿‡æ¥çš„TaskSetå°è£…æˆTaskSetManageræ‰”åˆ°ä»»åŠ¡é˜Ÿåˆ—é‡Œï¼Œç„¶åå†ä»ä»»åŠ¡é˜Ÿåˆ—é‡ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™æŠŠå®ƒä»¬å–å‡ºæ¥åœ¨SchedulerBackendç»™è¿‡æ¥çš„Executorä¸Šè¿è¡Œã€‚è¿™ä¸ªè°ƒåº¦è¿‡ç¨‹å®é™…ä¸Šè¿˜æ˜¯æ¯”è¾ƒç²—ç²’åº¦çš„ï¼Œæ˜¯é¢å‘TaskSetManagerçš„ã€‚</p><p>TaskScheduleræ˜¯ä»¥æ ‘çš„æ–¹å¼æ¥ç®¡ç†ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ ‘ä¸­çš„èŠ‚ç‚¹ç±»å‹ä¸ºSchdulableï¼Œå¶å­èŠ‚ç‚¹ä¸ºTaskSetManagerï¼Œéå¶å­èŠ‚ç‚¹ä¸ºPoolï¼Œä¸‹å›¾æ˜¯å®ƒä»¬ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fqdaa1sdk7j313o0qc0uz.jpg" alt=""></p><p>TaskScheduleræ”¯æŒä¸¤ç§è°ƒåº¦ç­–ç•¥ï¼Œä¸€ç§æ˜¯FIFOï¼Œä¹Ÿæ˜¯é»˜è®¤çš„è°ƒåº¦ç­–ç•¥ï¼Œå¦ä¸€ç§æ˜¯FAIRã€‚åœ¨TaskScheduleråˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šå®ä¾‹åŒ–rootPoolï¼Œè¡¨ç¤ºæ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ˜¯Poolç±»å‹ã€‚å¦‚æœæ˜¯é‡‡ç”¨FIFOè°ƒåº¦ç­–ç•¥ï¼Œåˆ™ç›´æ¥ç®€å•åœ°å°†TaskSetManageræŒ‰ç…§å…ˆæ¥å…ˆåˆ°çš„æ–¹å¼å…¥é˜Ÿï¼Œå‡ºé˜Ÿæ—¶ç›´æ¥æ‹¿å‡ºæœ€å…ˆè¿›é˜Ÿçš„TaskSetManagerï¼Œå…¶æ ‘ç»“æ„å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒTaskSetManagerä¿å­˜åœ¨ä¸€ä¸ªFIFOé˜Ÿåˆ—ä¸­ã€‚<br><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fqdaa8cgqwj316u0j2q6a.jpg" alt=""></p><p>åœ¨é˜è¿°FAIRè°ƒåº¦ç­–ç•¥å‰ï¼Œå…ˆè´´ä¸€æ®µä½¿ç”¨FAIRè°ƒåº¦ç­–ç•¥çš„åº”ç”¨ç¨‹åºä»£ç ï¼Œåé¢é’ˆå¯¹è¯¥ä»£ç é€»è¾‘æ¥è¯¦ç»†é˜è¿°FAIRè°ƒåº¦çš„å®ç°ç»†èŠ‚ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">MultiJobTest</span> </span>&#123;</span><br><span class="line">  <span class="comment">// spark.scheduler.mode=FAIR</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> spark = <span class="type">SparkSession</span>.builder().getOrCreate()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> rdd = spark.sparkContext.textFile(...)</span><br><span class="line">      .map(_.split(<span class="string">"\\s+"</span>))</span><br><span class="line">      .map(x =&gt; (x(<span class="number">0</span>), x(<span class="number">1</span>)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> jobExecutor = <span class="type">Executors</span>.newFixedThreadPool(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    jobExecutor.execute(<span class="keyword">new</span> <span class="type">Runnable</span> &#123;</span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">        spark.sparkContext.setLocalProperty(<span class="string">"spark.scheduler.pool"</span>, <span class="string">"count-pool"</span>)</span><br><span class="line">        <span class="keyword">val</span> cnt = rdd.groupByKey().count()</span><br><span class="line">        println(<span class="string">s"Count: <span class="subst">$cnt</span>"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    jobExecutor.execute(<span class="keyword">new</span> <span class="type">Runnable</span> &#123;</span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">        spark.sparkContext.setLocalProperty(<span class="string">"spark.scheduler.pool"</span>, <span class="string">"take-pool"</span>)</span><br><span class="line">        <span class="keyword">val</span> data = rdd.sortByKey().take(<span class="number">10</span>)</span><br><span class="line">        println(<span class="string">s"Data Samples: "</span>)</span><br><span class="line">        data.foreach &#123; x =&gt; println(x.mkString(<span class="string">", "</span>)) &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    jobExecutor.shutdown()</span><br><span class="line">    <span class="keyword">while</span> (!jobExecutor.isTerminated) &#123;&#125;</span><br><span class="line">    println(<span class="string">"Done!"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è°ƒç”¨äº†Actionæ–¹æ³•ï¼Œå³æœ‰ä¸¤ä¸ªJobä¼šå¹¶å‘æäº¤ï¼Œä½†æ˜¯ä¸ç®¡æ€æ ·ï¼Œè¿™ä¸¤ä¸ªJobè¢«åˆ‡åˆ†æˆè‹¥å¹²TaskSetåç»ˆç©¶ä¼šè¢«äº¤åˆ°TaskSchedulerè¿™é‡Œç»Ÿä¸€ç®¡ç†ï¼Œå…¶è°ƒåº¦æ ‘å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fqdac0cfroj31kw0pf0zt.jpg" alt=""></p><p>åœ¨å‡ºé˜Ÿæ—¶ï¼Œåˆ™ä¼šå¯¹æ‰€æœ‰TaskSetManageræ’åºï¼Œå…·ä½“æ’åºè¿‡ç¨‹æ˜¯ä»æ ¹èŠ‚ç‚¹rootPoolå¼€å§‹ï¼Œé€’å½’åœ°å»æ’åºå­èŠ‚ç‚¹ï¼Œæœ€ååˆå¹¶åˆ°ä¸€ä¸ªArrayBufferé‡Œï¼Œä»£ç é€»è¾‘å¦‚ä¸‹ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSortedTaskSetQueue</span></span>: <span class="type">ArrayBuffer</span>[<span class="type">TaskSetManager</span>] = &#123;</span><br><span class="line">    <span class="keyword">var</span> sortedTaskSetQueue = <span class="keyword">new</span> <span class="type">ArrayBuffer</span>[<span class="type">TaskSetManager</span>]</span><br><span class="line">    <span class="keyword">val</span> sortedSchedulableQueue = schedulableQueue.asScala.toSeq.sortWith(taskSetSchedulingAlgorithm.comparator)</span><br><span class="line">    <span class="keyword">for</span> (schedulable &lt;- sortedSchedulableQueue) &#123;</span><br><span class="line">      sortedTaskSetQueue ++= schedulable.getSortedTaskSetQueue</span><br><span class="line">    &#125;</span><br><span class="line">    sortedTaskSetQueue</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨FAIRè°ƒåº¦ç­–ç•¥æ—¶ï¼Œä¸Šé¢ä»£ç ä¸­çš„taskSetSchedulingAlgorithmçš„ç±»å‹ä¸ºFairSchedulingAlgorithmï¼Œæ’åºè¿‡ç¨‹çš„æ¯”è¾ƒæ˜¯åŸºäºFair-shareæ¥æ¯”è¾ƒçš„ï¼Œæ¯ä¸ªè¦æ’åºçš„å¯¹è±¡åŒ…å«ä¸‰ä¸ªå±æ€§: runningTaskså€¼ï¼ˆæ­£åœ¨è¿è¡Œçš„Taskæ•°ï¼‰ã€minShareå€¼ã€weightå€¼ï¼Œæ¯”è¾ƒæ—¶ä¼šç»¼åˆè€ƒé‡runningTaskså€¼ï¼ŒminShareä»¥åŠweightå€¼ã€‚å¦‚æœAå¯¹è±¡çš„runningTaskså¤§äºå®ƒçš„minShareï¼ŒBå¯¹è±¡çš„runningTaskså°äºå®ƒçš„minShareï¼Œé‚£ä¹ˆBæ’åœ¨Aå‰é¢ï¼›å¦‚æœAã€Bå¯¹è±¡çš„runningTaskséƒ½å°äºå®ƒä»¬çš„minShareï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒrunningTasksä¸minShareçš„æ¯”å€¼ï¼Œè°å°è°æ’å‰é¢ï¼›å¦‚æœAã€Bå¯¹è±¡çš„runningTaskséƒ½å¤§äºå®ƒä»¬çš„minShareï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒrunningTasksä¸weightçš„æ¯”å€¼ï¼Œè°å°è°æ’å‰é¢ã€‚æ•´ä½“ä¸Šæ¥è¯´å°±æ˜¯é€šè¿‡minShareå’Œweightè¿™ä¸¤ä¸ªå‚æ•°æ§åˆ¶æ¯”è¾ƒè¿‡ç¨‹ï¼Œå¯ä»¥åšåˆ°ä¸è®©èµ„æºè¢«æŸäº›é•¿æ—¶é—´Taskç»™ä¸€ç›´å äº†ã€‚</p><p>ä»è°ƒåº¦é˜Ÿåˆ—ä¸­æ‹¿åˆ°TaskSetManageråï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯TaskSetManageræŒ‰ç…§ä¸€å®šçš„è§„åˆ™ä¸€ä¸ªä¸ªå–å‡ºTaskç»™TaskSchedulerï¼ŒTaskSchedulerå†äº¤ç»™SchedulerBackendå»å‘åˆ°Executorä¸Šæ‰§è¡Œã€‚å‰é¢ä¹Ÿæåˆ°ï¼ŒTaskSetManagerå°è£…äº†ä¸€ä¸ªStageçš„æ‰€æœ‰Taskï¼Œå¹¶è´Ÿè´£ç®¡ç†è°ƒåº¦è¿™äº›Taskã€‚</p><h4 id="æœ¬åœ°åŒ–è°ƒåº¦"><a href="#æœ¬åœ°åŒ–è°ƒåº¦" class="headerlink" title="æœ¬åœ°åŒ–è°ƒåº¦"></a>æœ¬åœ°åŒ–è°ƒåº¦</h4><p>ä»è°ƒåº¦é˜Ÿåˆ—ä¸­æ‹¿åˆ°TaskSetManageråï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯TaskSetManageræŒ‰ç…§ä¸€å®šçš„è§„åˆ™ä¸€ä¸ªä¸ªå–å‡ºTaskç»™TaskSchedulerï¼ŒTaskSchedulerå†äº¤ç»™SchedulerBackendå»å‘åˆ°Executorä¸Šæ‰§è¡Œã€‚å‰é¢ä¹Ÿæåˆ°ï¼ŒTaskSetManagerå°è£…äº†ä¸€ä¸ªStageçš„æ‰€æœ‰Taskï¼Œå¹¶è´Ÿè´£ç®¡ç†è°ƒåº¦è¿™äº›Taskã€‚<br><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fqdadrcr1pj31ai068q4f.jpg" alt=""></p><p>åœ¨TaskSetManageråˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹TasksæŒ‰ç…§Localityçº§åˆ«è¿›è¡Œåˆ†ç±»ï¼ŒTaskçš„Localityæœ‰äº”ç§ï¼Œä¼˜å…ˆçº§ç”±é«˜åˆ°ä½é¡ºåºï¼šPROCESS_LOCAL(æŒ‡å®šçš„Executor)ï¼ŒNODE_LOCAL(æŒ‡å®šçš„ä¸»æœºèŠ‚ç‚¹)ï¼ŒNO_PREF(æ— æ‰€è°“)ï¼ŒRACK_LOCAL(æŒ‡å®šçš„æœºæ¶)ï¼ŒANY(æ»¡è¶³ä¸äº†Taskçš„Localityå°±éšä¾¿è°ƒåº¦)ã€‚è¿™äº”ç§Localityçº§åˆ«å­˜åœ¨åŒ…å«å…³ç³»ï¼ŒRACK_LOCALåŒ…å«NODE_LOCALï¼ŒNODE_LOCALåŒ…å«PROCESS_LOCALï¼Œç„¶è€ŒANYåŒ…å«å…¶ä»–æ‰€æœ‰å››ç§ã€‚åˆå§‹åŒ–é˜¶æ®µåœ¨å¯¹Taskåˆ†ç±»æ—¶ï¼Œæ ¹æ®Taskçš„preferredLocationsåˆ¤æ–­å®ƒå±äºå“ªä¸ªLocalityçº§åˆ«ï¼Œå±äºPROCESS_LOCALçš„TaskåŒæ—¶ä¹Ÿä¼šè¢«åŠ å…¥åˆ°NODE_LOCALã€RACK_LOCALç±»åˆ«ä¸­ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªTaskçš„preferredLocationsæŒ‡å®šäº†åœ¨Executor-2ä¸Šæ‰§è¡Œï¼Œé‚£ä¹ˆå®ƒå±äºExecutor-2å¯¹åº”çš„PROCESS_LOCALç±»åˆ«ï¼ŒåŒæ—¶ä¹ŸæŠŠä»–åŠ å…¥åˆ°Executor-2æ‰€åœ¨çš„ä¸»æœºå¯¹åº”çš„NODE_LOCALç±»åˆ«ï¼ŒExecutor-2æ‰€åœ¨çš„ä¸»æœºçš„æœºæ¶å¯¹åº”çš„RACK_LOCALç±»åˆ«ä¸­ï¼Œä»¥åŠANYç±»åˆ«ï¼Œè¿™æ ·åœ¨è°ƒåº¦æ‰§è¡Œæ—¶ï¼Œæ»¡è¶³ä¸äº†PROCESS_LOCALï¼Œå°±é€æ­¥é€€åŒ–åˆ°NODE_LOCALï¼ŒRACK_LOCALï¼ŒANYã€‚</p><p>TaskSetManageråœ¨å†³å®šè°ƒåº¦å“ªäº›Taskæ—¶ï¼Œæ˜¯é€šè¿‡ä¸Šé¢æµç¨‹å›¾ä¸­çš„resourceOfferæ–¹æ³•æ¥å®ç°ï¼Œä¸ºäº†å°½å¯èƒ½åœ°å°†Taskè°ƒåº¦åˆ°å®ƒçš„preferredLocationsä¸Šï¼Œå®ƒé‡‡ç”¨ä¸€ç§å»¶è¿Ÿè°ƒåº¦ç®—æ³•ã€‚resourceOfferæ–¹æ³•åŸå‹å¦‚ä¸‹ï¼Œå‚æ•°åŒ…æ‹¬è¦è°ƒåº¦ä»»åŠ¡çš„Executor Idã€ä¸»æœºåœ°å€ä»¥åŠæœ€å¤§å¯å®¹å¿çš„Localityçº§åˆ«ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">resourceOffer</span></span>(</span><br><span class="line">      execId: <span class="type">String</span>,</span><br><span class="line">      host: <span class="type">String</span>,</span><br><span class="line">      maxLocality: <span class="type">TaskLocality</span>.<span class="type">TaskLocality</span>)</span><br><span class="line">    : <span class="type">Option</span>[<span class="type">TaskDescription</span>]</span><br></pre></td></tr></table></figure><p>å»¶è¿Ÿè°ƒåº¦ç®—æ³•çš„å¤§è‡´æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fqdaela7nrj31kw0pvgr7.jpg" alt=""></p><p>é¦–å…ˆçœ‹æ˜¯å¦å­˜åœ¨execIdå¯¹åº”çš„PROCESS_LOCALç±»åˆ«çš„ä»»åŠ¡ï¼Œå¦‚æœå­˜åœ¨ï¼Œå–å‡ºæ¥è°ƒåº¦ï¼Œå¦åˆ™æ ¹æ®å½“å‰æ—¶é—´ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡äº†PROCESS_LOCALç±»åˆ«æœ€å¤§å®¹å¿çš„å»¶è¿Ÿï¼Œå¦‚æœè¶…è¿‡ï¼Œåˆ™é€€åŒ–åˆ°ä¸‹ä¸€ä¸ªçº§åˆ«NODE_LOCALï¼Œå¦åˆ™ç­‰å¾…ä¸è°ƒåº¦ã€‚é€€åŒ–åˆ°ä¸‹ä¸€ä¸ªçº§åˆ«NODE_LOCALåè°ƒåº¦æµç¨‹ä¹Ÿç±»ä¼¼ï¼Œçœ‹æ˜¯å¦å­˜åœ¨hostå¯¹åº”çš„NODE_LOCALç±»åˆ«çš„ä»»åŠ¡ï¼Œå¦‚æœå­˜åœ¨ï¼Œå–å‡ºæ¥è°ƒåº¦ï¼Œå¦åˆ™æ ¹æ®å½“å‰æ—¶é—´ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡äº†NODE_LOCALç±»åˆ«æœ€å¤§å®¹å¿çš„å»¶è¿Ÿï¼Œå¦‚æœè¶…è¿‡ï¼Œåˆ™é€€åŒ–åˆ°ä¸‹ä¸€ä¸ªçº§åˆ«RACK_LOCALï¼Œå¦åˆ™ç­‰å¾…ä¸è°ƒåº¦ï¼Œä»¥æ­¤ç±»æ¨â€¦..ã€‚å½“ä¸æ»¡è¶³Locatityç±»åˆ«ä¼šé€‰æ‹©ç­‰å¾…ï¼Œç›´åˆ°ä¸‹ä¸€è½®è°ƒåº¦é‡å¤ä¸Šè¿°æµç¨‹ï¼Œå¦‚æœä½ æ¯”è¾ƒæ¿€è¿›ï¼Œå¯ä»¥è°ƒå¤§æ¯ä¸ªç±»åˆ«çš„æœ€å¤§å®¹å¿å»¶è¿Ÿæ—¶é—´ï¼Œå¦‚æœä¸æ»¡è¶³Locatityæ—¶å°±ä¼šç­‰å¾…å¤šä¸ªè°ƒåº¦å‘¨æœŸï¼Œç›´åˆ°æ»¡è¶³æˆ–è€…è¶…è¿‡å»¶è¿Ÿæ—¶é—´é€€åŒ–åˆ°ä¸‹ä¸€ä¸ªçº§åˆ«ä¸ºæ­¢ã€‚</p><h4 id="å¤±è´¥é‡è¯•ä¸é»‘åå•æœºåˆ¶"><a href="#å¤±è´¥é‡è¯•ä¸é»‘åå•æœºåˆ¶" class="headerlink" title="å¤±è´¥é‡è¯•ä¸é»‘åå•æœºåˆ¶"></a>å¤±è´¥é‡è¯•ä¸é»‘åå•æœºåˆ¶</h4><p>é™¤äº†é€‰æ‹©åˆé€‚çš„Taskè°ƒåº¦è¿è¡Œå¤–ï¼Œè¿˜éœ€è¦ç›‘æ§Taskçš„æ‰§è¡ŒçŠ¶æ€ï¼Œå‰é¢ä¹Ÿæåˆ°ï¼Œä¸å¤–éƒ¨æ‰“äº¤é“çš„æ˜¯SchedulerBackendï¼ŒTaskè¢«æäº¤åˆ°Executorå¯åŠ¨æ‰§è¡Œåï¼ŒExecutorä¼šå°†æ‰§è¡ŒçŠ¶æ€ä¸ŠæŠ¥ç»™SchedulerBackendï¼ŒSchedulerBackendåˆ™å‘Šè¯‰TaskSchedulerï¼ŒTaskScheduleræ‰¾åˆ°è¯¥Taskå¯¹åº”çš„TaskSetManagerï¼Œå¹¶é€šçŸ¥åˆ°è¯¥TaskSetManagerï¼Œè¿™æ ·TaskSetManagerå°±çŸ¥é“Taskçš„å¤±è´¥ä¸æˆåŠŸçŠ¶æ€ï¼Œå¯¹äºå¤±è´¥çš„Taskï¼Œä¼šè®°å½•å®ƒå¤±è´¥çš„æ¬¡æ•°ï¼Œå¦‚æœå¤±è´¥æ¬¡æ•°è¿˜æ²¡æœ‰è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé‚£ä¹ˆå°±æŠŠå®ƒæ”¾å›å¾…è°ƒåº¦çš„Taskæ± å­ä¸­ï¼Œå¦åˆ™æ•´ä¸ªApplicationå¤±è´¥ã€‚</p><p>åœ¨è®°å½•Taskå¤±è´¥æ¬¡æ•°è¿‡ç¨‹ä¸­ï¼Œä¼šè®°å½•å®ƒä¸Šä¸€æ¬¡å¤±è´¥æ‰€åœ¨çš„Executor Idå’ŒHostï¼Œè¿™æ ·ä¸‹æ¬¡å†è°ƒåº¦è¿™ä¸ªTaskæ—¶ï¼Œä¼šä½¿ç”¨é»‘åå•æœºåˆ¶ï¼Œé¿å…å®ƒè¢«è°ƒåº¦åˆ°ä¸Šä¸€æ¬¡å¤±è´¥çš„èŠ‚ç‚¹ä¸Šï¼Œèµ·åˆ°ä¸€å®šçš„å®¹é”™ä½œç”¨ã€‚é»‘åå•è®°å½•Taskä¸Šä¸€æ¬¡å¤±è´¥æ‰€åœ¨çš„Executor Idå’ŒHostï¼Œä»¥åŠå…¶å¯¹åº”çš„â€œé»‘æš—â€æ—¶é—´ï¼Œâ€œé»‘æš—â€æ—¶é—´æ˜¯æŒ‡è¿™æ®µæ—¶é—´å†…ä¸è¦å†å¾€è¿™ä¸ªèŠ‚ç‚¹ä¸Šè°ƒåº¦è¿™ä¸ªTaskäº†ã€‚</p><h4 id="æ¨æµ‹å¼æ‰§è¡Œ"><a href="#æ¨æµ‹å¼æ‰§è¡Œ" class="headerlink" title="æ¨æµ‹å¼æ‰§è¡Œ"></a>æ¨æµ‹å¼æ‰§è¡Œ</h4><p>TaskScheduleråœ¨å¯åŠ¨SchedulerBackendåï¼Œè¿˜ä¼šå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ä¸“é—¨è´Ÿè´£æ¨æµ‹ä»»åŠ¡çš„è°ƒåº¦ï¼Œæ¨æµ‹ä»»åŠ¡æ˜¯æŒ‡å¯¹ä¸€ä¸ªTaskåœ¨ä¸åŒçš„Executorä¸Šå¯åŠ¨å¤šä¸ªå®ä¾‹ï¼Œå¦‚æœæœ‰Taskå®ä¾‹è¿è¡ŒæˆåŠŸï¼Œåˆ™ä¼šå¹²æ‰å…¶ä»–Executorä¸Šè¿è¡Œçš„å®ä¾‹ã€‚æ¨æµ‹è°ƒåº¦çº¿ç¨‹ä¼šæ¯éš”å›ºå®šæ—¶é—´æ£€æŸ¥æ˜¯å¦æœ‰Taskéœ€è¦æ¨æµ‹æ‰§è¡Œï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¼šè°ƒç”¨SchedulerBackendçš„reviveOfferså»å°è¯•æ‹¿èµ„æºè¿è¡Œæ¨æµ‹ä»»åŠ¡ã€‚</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fqdah2m113j31ho0gstau.jpg" alt=""></p><p>æ£€æŸ¥æ˜¯å¦æœ‰Taskéœ€è¦æ¨æµ‹æ‰§è¡Œçš„é€»è¾‘æœ€åä¼šäº¤åˆ°TaskSetManagerï¼ŒTaskSetManageré‡‡ç”¨åŸºäºç»Ÿè®¡çš„ç®—æ³•ï¼Œæ£€æŸ¥Taskæ˜¯å¦éœ€è¦æ¨æµ‹æ‰§è¡Œï¼Œç®—æ³•æµç¨‹å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fqdaj1pwd0j31au11oq9z.jpg" alt=""><br>TaskSetManageré¦–å…ˆä¼šç»Ÿè®¡æˆåŠŸçš„Taskæ•°ï¼Œå½“æˆåŠŸçš„Taskæ•°è¶…è¿‡75%(å¯é€šè¿‡å‚æ•°spark.speculation.quantileæ§åˆ¶)æ—¶ï¼Œå†ç»Ÿè®¡æ‰€æœ‰æˆåŠŸçš„Tasksçš„è¿è¡Œæ—¶é—´ï¼Œå¾—åˆ°ä¸€ä¸ªä¸­ä½æ•°ï¼Œç”¨è¿™ä¸ªä¸­ä½æ•°ä¹˜ä»¥1.5(å¯é€šè¿‡å‚æ•°spark.speculation.multiplieræ§åˆ¶)å¾—åˆ°è¿è¡Œæ—¶é—´é—¨é™ï¼Œå¦‚æœåœ¨è¿è¡Œçš„Tasksçš„è¿è¡Œæ—¶é—´è¶…è¿‡è¿™ä¸ªé—¨é™ï¼Œåˆ™å¯¹å®ƒå¯ç”¨æ¨æµ‹ã€‚ç®—æ³•é€»è¾‘è¾ƒä¸ºç®€å•ï¼Œå…¶å®å°±æ˜¯å¯¹é‚£äº›æ‹–æ…¢æ•´ä½“è¿›åº¦çš„Taskså¯ç”¨æ¨æµ‹ï¼Œä»¥åŠ é€Ÿæ•´ä¸ªTaskSetå³Stageçš„è¿è¡Œã€‚</p><h2 id="èµ„æºç”³è¯·æœºåˆ¶"><a href="#èµ„æºç”³è¯·æœºåˆ¶" class="headerlink" title="èµ„æºç”³è¯·æœºåˆ¶"></a>èµ„æºç”³è¯·æœºåˆ¶</h2><p>åœ¨å‰æ–‡å·²ç»æè¿‡ï¼ŒApplicationMasterå’ŒSchedulerBackendèµ·æ¥åï¼ŒSchedulerBackendé€šè¿‡ApplicationMasterç”³è¯·èµ„æºï¼ŒApplicationMasterå°±æ˜¯ç”¨æ¥ä¸“é—¨é€‚é…YARNç”³è¯·Containerèµ„æºçš„ï¼Œå½“ç”³è¯·åˆ°Containerï¼Œä¼šåœ¨ç›¸åº”Containerä¸Šå¯åŠ¨Executorè¿›ç¨‹ï¼Œå…¶ä»–äº‹æƒ…å°±äº¤ç»™SchedulerBackendã€‚Sparkæ—©æœŸç‰ˆæœ¬åªæ”¯æŒé™æ€èµ„æºç”³è¯·ï¼Œå³ä¸€å¼€å§‹å°±æŒ‡å®šç”¨å¤šå°‘èµ„æºï¼Œåœ¨æ•´ä¸ªSparkåº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­èµ„æºéƒ½ä¸èƒ½æ”¹å˜ï¼Œåæ¥æ”¯æŒåŠ¨æ€Executorç”³è¯·ï¼Œç”¨æˆ·ä¸éœ€è¦æŒ‡å®šç¡®åˆ‡çš„Executoræ•°é‡ï¼ŒSparkä¼šåŠ¨æ€è°ƒæ•´Executorçš„æ•°é‡ä»¥è¾¾åˆ°èµ„æºåˆ©ç”¨çš„æœ€å¤§åŒ–ã€‚</p><h3 id="é™æ€èµ„æºç”³è¯·"><a href="#é™æ€èµ„æºç”³è¯·" class="headerlink" title="é™æ€èµ„æºç”³è¯·"></a>é™æ€èµ„æºç”³è¯·</h3><p>é™æ€èµ„æºç”³è¯·æ˜¯ç”¨æˆ·åœ¨æäº¤Sparkåº”ç”¨ç¨‹åºæ—¶ï¼Œå°±è¦æå‰ä¼°è®¡åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨çš„èµ„æºï¼ŒåŒ…æ‹¬Executoræ•°(num_executor)ã€æ¯ä¸ªExecutorä¸Šçš„coreæ•°(executor_cores)ã€æ¯ä¸ªExecutorçš„å†…å­˜(executor_memory)ä»¥åŠDriverçš„å†…å­˜(driver_memory)ã€‚</p><p>åœ¨ä¼°è®¡èµ„æºä½¿ç”¨æ—¶ï¼Œåº”å½“é¦–å…ˆäº†è§£è¿™äº›èµ„æºæ˜¯æ€ä¹ˆç”¨çš„ã€‚ä»»åŠ¡çš„å¹¶è¡Œåº¦ç”±åˆ†åŒºæ•°(Partitions)å†³å®šï¼Œä¸€ä¸ªStageæœ‰å¤šå°‘åˆ†åŒºï¼Œå°±ä¼šæœ‰å¤šå°‘Taskã€‚æ¯ä¸ªTaské»˜è®¤å ç”¨ä¸€ä¸ªCoreï¼Œä¸€ä¸ªExecutorä¸Šçš„æ‰€æœ‰coreå…±äº«Executorä¸Šçš„å†…å­˜ï¼Œä¸€æ¬¡å¹¶è¡Œè¿è¡Œçš„Taskæ•°ç­‰äºnum_executor*executor_coresï¼Œå¦‚æœåˆ†åŒºæ•°è¶…è¿‡è¯¥å€¼ï¼Œåˆ™éœ€è¦è¿è¡Œå¤šä¸ªè½®æ¬¡ï¼Œä¸€èˆ¬æ¥è¯´å»ºè®®è¿è¡Œ3ï½5è½®è¾ƒä¸ºåˆé€‚ï¼Œå¦åˆ™è€ƒè™‘å¢åŠ num_executoræˆ–executor_coresã€‚ç”±äºä¸€ä¸ªExecutorçš„æ‰€æœ‰tasksä¼šå…±äº«å†…å­˜executor_memoryï¼Œæ‰€ä»¥å»ºè®®executor_coresä¸å®œè¿‡å¤§ã€‚executor_memoryçš„è®¾ç½®åˆ™éœ€è¦ç»¼åˆæ¯ä¸ªåˆ†åŒºçš„æ•°æ®é‡ä»¥åŠæ˜¯å¦æœ‰ç¼“å­˜ç­‰é€»è¾‘ã€‚ä¸‹å›¾æç»˜äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºå†…éƒ¨èµ„æºåˆ©ç”¨æƒ…å†µã€‚<br><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fqdak8sm5bj31kw0uj16a.jpg" alt=""></p><h3 id="åŠ¨æ€èµ„æºç”³è¯·"><a href="#åŠ¨æ€èµ„æºç”³è¯·" class="headerlink" title="åŠ¨æ€èµ„æºç”³è¯·"></a>åŠ¨æ€èµ„æºç”³è¯·</h3><p>åŠ¨æ€èµ„æºç”³è¯·ç›®å‰åªæ”¯æŒåˆ°Executorï¼Œå³å¯ä»¥ä¸ç”¨æŒ‡å®šnum_executorï¼Œé€šè¿‡å‚æ•°spark.dynamicAllocation.enabledæ¥æ§åˆ¶ã€‚ç”±äºè®¸å¤šSparkåº”ç”¨ç¨‹åºä¸€å¼€å§‹å¯èƒ½ä¸éœ€è¦é‚£ä¹ˆå¤šExecutoræˆ–è€…å…¶æœ¬èº«å°±ä¸éœ€è¦å¤ªå¤šExecutorï¼Œæ‰€ä»¥ä¸å¿…ä¸€æ¬¡æ€§ç”³è¯·é‚£ä¹ˆå¤šExecutorï¼Œæ ¹æ®å…·ä½“çš„ä»»åŠ¡æ•°åŠ¨æ€è°ƒæ•´Executorçš„æ•°é‡ï¼Œå°½å¯èƒ½åšåˆ°èµ„æºçš„ä¸æµªè´¹ã€‚ç”±äºåŠ¨æ€Executorçš„è°ƒæ•´ä¼šå¯¼è‡´ExecutoråŠ¨æ€çš„æ·»åŠ ä¸åˆ é™¤ï¼Œå¦‚æœåˆ é™¤Executorï¼Œå…¶ä¸Šé¢çš„ä¸­é—´Shuffleç»“æœå¯èƒ½ä¼šä¸¢å¤±ï¼Œè¿™å°±éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹çš„ShuffleServiceäº†ï¼Œå¦‚æœSparkæ˜¯éƒ¨ç½²åœ¨Yarnä¸Šï¼Œåˆ™å¯ä»¥åœ¨Yarnä¸Šé…ç½®Sparkçš„ShuffleServiceï¼Œå…·ä½“æ“ä½œä»…éœ€åšä¸¤ç‚¹:</p><p>1.é¦–å…ˆåœ¨yarn-site.xmlä¸­åŠ ä¸Šå¦‚ä¸‹é…ç½®ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle,spark_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services.spark_shuffle.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.spark.network.yarn.YarnShuffleService<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.shuffle.service.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>7337<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>2.å°†Spark ShuffleService jaråŒ…<code>$SPARK_HOME/lib/spark-*-yarn-shuffle.jar</code>æ‹·è´åˆ°æ¯å°NodeManagerçš„<code>$HADOOP_HOME/share/hadoop/yarn/lib/</code>ä¸‹ï¼Œå¹¶é‡å¯æ‰€æœ‰çš„NodeManagerã€‚</p><p>å½“å¯ç”¨åŠ¨æ€Executorç”³è¯·æ—¶ï¼Œåœ¨SparkContextåˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šå®ä¾‹åŒ–ExecutorAllocationManagerï¼Œå®ƒæ˜¯è¢«ç”¨æ¥ä¸“é—¨æ§åˆ¶åŠ¨æ€Executorç”³è¯·é€»è¾‘çš„ï¼ŒåŠ¨æ€Executorç”³è¯·æ˜¯ä¸€ç§åŸºäºå½“å‰Taskè´Ÿè½½å‹åŠ›å®ç°åŠ¨æ€å¢åˆ Executorçš„æœºåˆ¶ã€‚ä¸€å¼€å§‹ä¼šæŒ‰ç…§å‚æ•°spark.dynamicAllocation.initialExecutorsè®¾ç½®çš„åˆå§‹Executoræ•°ç”³è¯·ï¼Œç„¶åæ ¹æ®å½“å‰ç§¯å‹çš„Taskæ•°é‡ï¼Œé€æ­¥å¢é•¿ç”³è¯·çš„Executoræ•°ï¼Œå¦‚æœå½“å‰æœ‰ç§¯å‹çš„Taskï¼Œé‚£ä¹ˆå–ç§¯å‹çš„Taskæ•°å’Œspark.dynamicAllocation.maxExecutorsä¸­çš„æœ€å°å€¼ä½œä¸ºExecutoræ•°ä¸Šé™ï¼Œæ¯æ¬¡æ–°å¢åŠ ç”³è¯·çš„Executorä¸º2çš„æ¬¡æ–¹ï¼Œå³ç¬¬ä¸€æ¬¡å¢åŠ 1ï¼Œç¬¬äºŒæ¬¡å¢åŠ 2ï¼Œç¬¬ä¸‰æ¬¡å¢åŠ 4ï¼Œâ€¦ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸€ä¸ªExecutoråœ¨ä¸€æ®µæ—¶é—´å†…éƒ½æ²¡æœ‰Taskè¿è¡Œï¼Œåˆ™å°†å…¶å›æ”¶ï¼Œä½†æ˜¯åœ¨Remove Executoræ—¶ï¼Œè¦ä¿è¯æœ€å°‘çš„Executoræ•°ï¼Œè¯¥å€¼é€šè¿‡å‚æ•°spark.dynamicAllocation.minExecutorsæ¥æ§åˆ¶ï¼Œå¦‚æœExecutorä¸Šæœ‰Cacheçš„æ•°æ®ï¼Œåˆ™æ°¸è¿œä¸ä¼šè¢«Removeï¼Œä»¥ä¿è¯ä¸­é—´æ•°æ®ä¸ä¸¢å¤±ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æœ¬æ–‡è¯¦ç»†é˜è¿°äº†Sparkçš„ä»»åŠ¡è°ƒåº¦ï¼Œç€é‡è®¨è®ºSpark on Yarnçš„éƒ¨ç½²è°ƒåº¦ï¼Œå‰–æäº†ä»åº”ç”¨ç¨‹åºæäº¤åˆ°è¿è¡Œçš„å…¨è¿‡ç¨‹ã€‚Spark Scheduleç®—æ˜¯Sparkä¸­çš„ä¸€ä¸ªå¤§æ¨¡å—ï¼Œå®ƒè´Ÿè´£ä»»åŠ¡ä¸‹å‘ä¸ç›‘æ§ç­‰ï¼ŒåŸºæœ¬ä¸Šæ‰®æ¼”äº†Sparkå¤§è„‘çš„è§’è‰²ã€‚äº†è§£Spark Scheduleæœ‰åŠ©äºå¸®åŠ©æˆ‘ä»¬æ¸…æ¥šåœ°è®¤è¯†Sparkåº”ç”¨ç¨‹åºçš„è¿è¡Œè½¨è¿¹ï¼ŒåŒæ—¶åœ¨æˆ‘ä»¬å®ç°å…¶ä»–ç³»ç»Ÿæ—¶ï¼Œä¹Ÿå¯ä»¥å€Ÿé‰´Sparkçš„å®ç°ã€‚</p><p>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š<a href="http://sharkdtu.com/posts/spark-scheduler.html" target="_blank" rel="noopener">http://sharkdtu.com/posts/spark-scheduler.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;Apache Sparkæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œå¼ºå¤§çš„åˆ†å¸ƒå¼æŸ¥è¯¢å’Œå¤„ç†å¼•æ“ã€‚å®ƒæä¾›MapReduceçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä½†é€Ÿåº¦æ˜æ˜¾æ›´é«˜ã€‚&lt;br&gt;&lt;img src=&quot;https://ws2.sinaimg.cn/large/006tNc79ly1fq
      
    
    </summary>
    
      <category term="Spark" scheme="http://www.ihoge.cn/categories/Spark/"/>
    
    
  </entry>
  
  <entry>
    <title>SparkSQL DataFrameè¿›é˜¶ç¯‡</title>
    <link href="http://www.ihoge.cn/2018/Sparksql2.html"/>
    <id>http://www.ihoge.cn/2018/Sparksql2.html</id>
    <published>2018-04-14T09:59:21.000Z</published>
    <updated>2018-04-14T10:38:20.169Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h1 id="1-åˆ›å»ºSparkSessionã€2-0ã€‘å’Œ-SQLContextå®ä¾‹ã€1-xã€‘"><a href="#1-åˆ›å»ºSparkSessionã€2-0ã€‘å’Œ-SQLContextå®ä¾‹ã€1-xã€‘" class="headerlink" title="1.åˆ›å»ºSparkSessionã€2.0ã€‘å’Œ SQLContextå®ä¾‹ã€1.xã€‘"></a>1.åˆ›å»ºSparkSessionã€2.0ã€‘å’Œ SQLContextå®ä¾‹ã€1.xã€‘</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>åˆ›å»º<span class="type">SparkSession</span>ã€<span class="number">2.0</span>ã€‘</span><br><span class="line"><span class="comment">///spark2.0åï¼Œç”¨sparksessionä»£æ›¿sparkcontextå’Œsqlcontextçš„åˆ›å»º</span></span><br><span class="line"><span class="keyword">val</span> spark= <span class="type">SparkSession</span>.builder().appName(<span class="string">"SparkSQLTest"</span>).getOrCreate()</span><br><span class="line"><span class="keyword">val</span> numbers=spark.range(<span class="number">1</span> ,<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line">numbers.show()</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>åˆ›å»º<span class="type">SQLContext</span>å®ä¾‹ã€<span class="number">1.</span>xã€‘</span><br><span class="line"><span class="keyword">val</span> conf= <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"SQL_Advanced_case"</span>).setMaster(<span class="string">"local"</span>)</span><br><span class="line"><span class="keyword">val</span> sc=<span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line"><span class="keyword">val</span> sqlContext=<span class="keyword">new</span> <span class="type">SQLContext</span>(sc)</span><br><span class="line"><span class="keyword">import</span>.sqlContext.implicits._</span><br></pre></td></tr></table></figure><h1 id="2-åˆ›å»ºDataFrame"><a href="#2-åˆ›å»ºDataFrame" class="headerlink" title="2.åˆ›å»ºDataFrame"></a>2.åˆ›å»ºDataFrame</h1><h2 id="æ–¹å¼1-ä¸åˆ›å»ºRDD"><a href="#æ–¹å¼1-ä¸åˆ›å»ºRDD" class="headerlink" title="æ–¹å¼1:ä¸åˆ›å»ºRDD"></a>æ–¹å¼1:ä¸åˆ›å»ºRDD</h2><p>ä½¿ç”¨createDataFramæ–¹æ³•ï¼Œç›´æ¥åŸºäºåˆ—è¡¨Liståˆ›å»ºDataFrame.ç¼ºç‚¹æ˜¯åˆ›å»ºå‡ºæ¥çš„DataFrameæ²¡æœ‰åˆ—å<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val customerData=List((&quot;Alex&quot;,&quot;æµ™æ±Ÿ&quot;,39,230.00), (&quot;Bob&quot;,&quot;åŒ—äº¬&quot;, 18, 170.00), (&quot;Chris&quot;, &quot;æ±Ÿè‹&quot;, 45, 529.95), (&quot;Dave&quot;, &quot;åŒ—äº¬&quot;, 25, 99.99), (&quot;Ellie&quot;, &quot;æµ™æ±Ÿ&quot;, 23, 1299.95), (&quot;Fred&quot;, &quot;åŒ—äº¬&quot;, 21, 1099.00))</span><br><span class="line">val customerDF1=sqlContext.createDataFrame(customerData)</span><br><span class="line">customerDF1.printSchema</span><br></pre></td></tr></table></figure></p><h2 id="æ–¹å¼2-ä¸åˆ›å»ºRDD"><a href="#æ–¹å¼2-ä¸åˆ›å»ºRDD" class="headerlink" title="æ–¹å¼2:ä¸åˆ›å»ºRDD"></a>æ–¹å¼2:ä¸åˆ›å»ºRDD</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨createDataFramæ–¹æ³•ï¼Œç›´æ¥åŸºäºåˆ—è¡¨<span class="type">List</span>åˆ›å»º<span class="type">DataFrame</span>.å³ä¾¿å®šä¹‰äº†æ ·ä¾‹ç±»ï¼Œä½†åŸºäºcreateDataFrameåˆ›å»ºå‡ºæ¥çš„<span class="type">DataFrame</span>ç¼ºç‚¹æ˜¯åˆ›å»ºå‡ºæ¥çš„<span class="type">DataFrame</span>æ²¡æœ‰åˆ—å</span><br><span class="line"><span class="keyword">val</span> customerData=<span class="type">List</span>((<span class="string">"Alex"</span>,<span class="string">"æµ™æ±Ÿ"</span>,<span class="number">39</span>,<span class="number">230.00</span>), (<span class="string">"Bob"</span>,<span class="string">"åŒ—äº¬"</span>, <span class="number">18</span>, <span class="number">170.00</span>), (<span class="string">"Chris"</span>, <span class="string">"æ±Ÿè‹"</span>, <span class="number">45</span>, <span class="number">529.95</span>), (<span class="string">"Dave"</span>, <span class="string">"åŒ—äº¬"</span>, <span class="number">25</span>, <span class="number">99.99</span>), (<span class="string">"Ellie"</span>, <span class="string">"æµ™æ±Ÿ"</span>, <span class="number">23</span>, <span class="number">1299.95</span>), (<span class="string">"Fred"</span>, <span class="string">"åŒ—äº¬"</span>, <span class="number">21</span>, <span class="number">1099.00</span>))</span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerInfo</span>(<span class="params">customer:<span class="type">String</span>, province:<span class="type">String</span>, age: <span class="type">Int</span>, total:<span class="type">Double</span> </span>)</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">cdf=cDataRDD</span>.<span class="title">map</span>(<span class="params">x=&gt;x.split(","</span>)).<span class="title">map</span>(<span class="params">x=&gt;<span class="type">CustomerInfo</span>(x(0</span>),<span class="title">x</span>(<span class="params">1</span>),<span class="title">x</span>(<span class="params">2</span>).<span class="title">toInt</span>,<span class="title">x</span>(<span class="params">3</span>).<span class="title">toDouble</span>)).<span class="title">toDF</span></span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">customerDF1=sqlContext</span>.<span class="title">createDataFrame</span>(<span class="params">customerData</span>)</span></span><br><span class="line"><span class="class"><span class="title">customerDF1</span>.<span class="title">printSchema</span></span></span><br></pre></td></tr></table></figure><h2 id="æ–¹å¼3ï¼šä¼ ç»Ÿæ–¹å¼"><a href="#æ–¹å¼3ï¼šä¼ ç»Ÿæ–¹å¼" class="headerlink" title="æ–¹å¼3ï¼šä¼ ç»Ÿæ–¹å¼"></a>æ–¹å¼3ï¼šä¼ ç»Ÿæ–¹å¼</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å…ˆåˆ›å»º<span class="type">RDD</span>å’Œæ ·ä¾‹ç±»ï¼Œç„¶åé€šè¿‡toDFåˆ›å»º<span class="type">DataFrame</span>ã€‚æ­¤æ—¶<span class="type">DataFrame</span>ä¸­åŒ…å«åˆ—ä¿¡æ¯ã€‚</span><br><span class="line"><span class="keyword">val</span> customerData=<span class="type">Array</span>(<span class="string">"Alex,æµ™æ±Ÿ,39,230.00"</span>,<span class="string">"Bob,åŒ—äº¬,18,170.00"</span>,<span class="string">"Chris,æ±Ÿè‹,45,529.95"</span>,<span class="string">"Dave,åŒ—äº¬,25,99.99"</span>,<span class="string">"Ellie,æµ™æ±Ÿ,23,1299.95"</span>,<span class="string">"Fred,åŒ—äº¬,21,1099.00"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerInfo</span>(<span class="params">customer:<span class="type">String</span>, province:<span class="type">String</span>, age: <span class="type">Int</span>, total:<span class="type">Double</span> </span>)</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">customerRDD=sc</span>.<span class="title">makeRDD</span>(<span class="params">customerData</span>)</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">customerDF1=customerRDD</span>.<span class="title">map</span>(<span class="params">x=&gt;x.split(","</span>)).<span class="title">map</span>(<span class="params">x=&gt;<span class="type">CustomerInfo</span>(x(0</span>),<span class="title">x</span>(<span class="params">1</span>),<span class="title">x</span>(<span class="params">2</span>).<span class="title">toInt</span>,<span class="title">x</span>(<span class="params">3</span>).<span class="title">toDouble</span>)).<span class="title">toDF</span></span></span><br><span class="line"><span class="class"><span class="title">customerDF1</span>.<span class="title">printSchema</span></span></span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="ä¿®æ”¹åˆ—å"><a href="#ä¿®æ”¹åˆ—å" class="headerlink" title="ä¿®æ”¹åˆ—å"></a>ä¿®æ”¹åˆ—å</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> customerDF=customerDF1.withColumnRenamed(<span class="string">"_1"</span>,<span class="string">"customer"</span>).withColumnRenamed(<span class="string">"_2"</span>,<span class="string">"province"</span>).withColumnRenamed(<span class="string">"_3"</span>, <span class="string">"age"</span>).withColumnRenamed(<span class="string">"_4"</span>, <span class="string">"total"</span>)</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹è¡¨æ¨¡å¼"><a href="#æŸ¥çœ‹è¡¨æ¨¡å¼" class="headerlink" title="æŸ¥çœ‹è¡¨æ¨¡å¼"></a>æŸ¥çœ‹è¡¨æ¨¡å¼</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">customerDF.printSchema</span><br></pre></td></tr></table></figure><h3 id="æ•°å€¼å‹æ•°æ®åŸºæœ¬çš„ç»Ÿè®¡ä¸åˆ†æ"><a href="#æ•°å€¼å‹æ•°æ®åŸºæœ¬çš„ç»Ÿè®¡ä¸åˆ†æ" class="headerlink" title="æ•°å€¼å‹æ•°æ®åŸºæœ¬çš„ç»Ÿè®¡ä¸åˆ†æ"></a>æ•°å€¼å‹æ•°æ®åŸºæœ¬çš„ç»Ÿè®¡ä¸åˆ†æ</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">customerDF.describe().show</span><br></pre></td></tr></table></figure><h1 id="3-DataFrameæ–¹æ³•"><a href="#3-DataFrameæ–¹æ³•" class="headerlink" title="3.DataFrameæ–¹æ³•"></a>3.DataFrameæ–¹æ³•</h1><h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">customerDF.select(customerDF.col(<span class="string">"customer"</span>)).show</span><br><span class="line">customerDF.select(customerDF(<span class="string">"customer"</span>)).show</span><br><span class="line">customerDF.select(<span class="string">"customer"</span>, <span class="string">"province"</span>).show</span><br><span class="line">customerDF.select($<span class="string">"customer"</span>, $<span class="string">"province"</span>).show</span><br><span class="line">customerDF.select(col(<span class="string">"customer"</span>), col(<span class="string">"province"</span>)).show</span><br><span class="line">customerDF.select(customerDF(<span class="string">"customer"</span>), col(<span class="string">"province"</span>)).show</span><br><span class="line">customerDF.select(<span class="string">"customer"</span>, $<span class="string">"province"</span>).show<span class="comment">//é”™è¯¯,å­—ç¬¦ä¸²ä¸$ä¸èƒ½æ··ç”¨ã€‚</span></span><br><span class="line">customerDF.select(col(<span class="string">"customer"</span>), $<span class="string">"province"</span>).show<span class="comment">//æ˜¯å¦æ­£ç¡®ï¼Ÿæ­£ç¡®ï¼ï¼</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨è¡¨è¾¾å¼"><a href="#ä½¿ç”¨è¡¨è¾¾å¼" class="headerlink" title="ä½¿ç”¨è¡¨è¾¾å¼"></a>ä½¿ç”¨è¡¨è¾¾å¼</h3><p>ï¼ˆColumnå¯¹è±¡ä¸­çš„æ–¹æ³•ï¼‰<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">customerDF. select($<span class="string">"customer"</span>,( $<span class="string">"age"</span>*<span class="number">2</span>)+<span class="number">10</span>, $<span class="string">"province"</span>===<span class="string">"æµ™æ±Ÿ"</span>).show <span class="comment">//è®¡ç®—$"province"==="æµ™æ±Ÿ"è¿™ä¸€å…³ç³»è¡¨è¾¾å¼çš„å€¼</span></span><br></pre></td></tr></table></figure></p><h3 id="asã€aliasåˆ—çš„é‡å‘½å"><a href="#asã€aliasåˆ—çš„é‡å‘½å" class="headerlink" title="asã€aliasåˆ—çš„é‡å‘½å"></a>asã€aliasåˆ—çš„é‡å‘½å</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">customerDF. select($<span class="string">"customer"</span> as <span class="string">"name"</span>,( $<span class="string">"age"</span>*<span class="number">2</span>)+<span class="number">10</span> alias <span class="string">"newAge"</span>, $<span class="string">"province"</span>===<span class="string">"æµ™æ±Ÿ"</span> as <span class="string">"isZJ"</span>).show</span><br></pre></td></tr></table></figure><h3 id="litæ·»åŠ åˆ—"><a href="#litæ·»åŠ åˆ—" class="headerlink" title="litæ·»åŠ åˆ—"></a>litæ·»åŠ åˆ—</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">org.apache.spark.sql.functionsä¸­çš„æ–¹æ³•lit</span><br><span class="line"><span class="keyword">val</span> cdf1=customerDF.select($<span class="string">"customer"</span>, $<span class="string">"age"</span>, when($<span class="string">"age"</span>&lt;<span class="number">20</span>,<span class="number">1</span>).when($<span class="string">"age"</span>&lt;<span class="number">30</span>, <span class="number">2</span>).otherwise(<span class="number">3</span>) as <span class="string">"ageGroup"</span>, lit(<span class="literal">false</span>) as <span class="string">"trusted"</span>)</span><br><span class="line">cdf1.show</span><br><span class="line">cdf1.printSchema</span><br></pre></td></tr></table></figure><h3 id="drop"><a href="#drop" class="headerlink" title="drop"></a>drop</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> cdf2=cdf1.drop(<span class="string">"trusted"</span>)</span><br><span class="line">cdf2.show</span><br><span class="line">cdf2.printSchema</span><br></pre></td></tr></table></figure><h2 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">customerDF.select($<span class="string">"province"</span>).distinct.show</span><br></pre></td></tr></table></figure><h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">customerDF.filter($<span class="string">"age"</span>&gt;<span class="number">30</span>).show</span><br><span class="line">customerDF.filter(<span class="string">"age&gt;30"</span>).show</span><br><span class="line">customerDF.filter($<span class="string">"age"</span>&lt;=<span class="number">30</span> and $<span class="string">"province"</span>===<span class="string">"æµ™æ±Ÿ"</span> )</span><br><span class="line">customerDF.filter(<span class="string">"age&lt;=30 and province =â€™æµ™æ±Ÿâ€™"</span>)</span><br></pre></td></tr></table></figure><h2 id="èšåˆæ“ä½œ"><a href="#èšåˆæ“ä½œ" class="headerlink" title="èšåˆæ“ä½œ"></a>èšåˆæ“ä½œ</h2><h3 id="withColumn"><a href="#withColumn" class="headerlink" title="withColumn"></a>withColumn</h3><p>å‘å·²æœ‰çš„DataFrameæ·»åŠ ä¸€ä¸ªæ–°åˆ—ï¼Œä¸åˆ é™¤ä¹‹å‰çš„åˆ—<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> customerAgeGroupDF=customerDF.withColumn(<span class="string">"agegroup"</span>, when($<span class="string">"age"</span>&lt;<span class="number">20</span>, <span class="number">1</span>).when($<span class="string">"age"</span>&lt;<span class="number">30</span>, <span class="number">2</span>).otherwise(<span class="number">3</span>))</span><br><span class="line">customerAgeGroupDF.show</span><br></pre></td></tr></table></figure></p><h3 id="groupBy"><a href="#groupBy" class="headerlink" title="groupBy"></a>groupBy</h3><p>æ“ä½œè¿”å›GroupedDataå¯¹è±¡ã€2.0ä¸­ä¸ºRelationalGroupedDataSetã€‘<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…¶ä¸­å°è£…äº†å¤§é‡èšåˆæ–¹æ³•ã€‚</span></span><br><span class="line">customerAgeGroupDF.groupBy(<span class="string">"agegroup"</span>).max().show()</span><br><span class="line">customerAgeGroupDF.groupBy(<span class="string">"agegroup"</span>,<span class="string">"province"</span>).count().show()</span><br><span class="line">customerAgeGroupDF.groupBy(<span class="string">"agegroup"</span>).min(<span class="string">"age"</span>, <span class="string">"total"</span>).show()</span><br></pre></td></tr></table></figure></p><h3 id="agg"><a href="#agg" class="headerlink" title="agg"></a>agg</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">customerAgeGroupDF.groupBy(<span class="string">"agegroup"</span>).agg(sum($<span class="string">"total"</span>), min($<span class="string">"total"</span>)).show()</span><br></pre></td></tr></table></figure><h3 id="pivot"><a href="#pivot" class="headerlink" title="pivot"></a>pivot</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">customerAgeGroupDF.groupBy(<span class="string">"province"</span>).pivot(<span class="string">"agegroup"</span>).sum(<span class="string">"total"</span>).show()</span><br><span class="line">customerAgeGroupDF.groupBy(<span class="string">"province"</span>).pivot(<span class="string">"agegroup"</span>,<span class="type">Seq</span>(<span class="number">1</span>,<span class="number">2</span>)). agg(<span class="string">"total"</span>).show()</span><br><span class="line">customerAgeGroupDF.groupBy(<span class="string">"province"</span>).pivot(<span class="string">"agegroup"</span>,<span class="type">Seq</span>(<span class="number">2</span>,<span class="number">3</span>)).agg(sum($<span class="string">"total"</span>), min($<span class="string">"total"</span>)).filter($<span class="string">"provice"</span>=!=<span class="string">"åŒ—äº¬"</span>).show</span><br></pre></td></tr></table></figure><h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">customerDF.orderBy(<span class="string">"age"</span>).show</span><br><span class="line">customerDF.orderBy($<span class="string">"age"</span>).show</span><br><span class="line">customerDF.orderBy(desc(<span class="string">"age"</span>)).show()</span><br><span class="line"><span class="comment">/*æ­¤å¤„orderByæ–¹æ³•ä¸€å®šè¦ç”¨åœ¨æ‰€æœ‰èšåˆå‡½æ•°ä¹‹åï¼Œå› ä¸ºgroupByæ–¹æ³•è¿”å›çš„æ˜¯GroupedDataç±»å‹æ•°æ®,</span></span><br><span class="line"><span class="comment">è¯¥ç±»å‹æ•°æ®ä¸­çš„èšåˆæ–¹æ³•è¿”å›DateFrameç±»å‹å¯¹è±¡ï¼Œè€ŒorderByæ˜¯DataFrameä¸­çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç”¨åœ¨groupBy</span></span><br><span class="line"><span class="comment">ä¹‹åä¼šæç¤ºé”™è¯¯ï¼šorderByä¸æ˜¯GroupedDataçš„æˆå‘˜æ–¹æ³•ã€‚*/</span></span><br><span class="line">customerAgeGroupDF.groupBy(<span class="string">"agegroup"</span>,<span class="string">"province"</span>).count().orderBy($<span class="string">"agegroup"</span>.desc).show()</span><br><span class="line">students.sort($<span class="string">"age"</span>.asc).show(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;1-åˆ›å»ºSparkSessionã€2-0ã€‘å’Œ-SQLContextå®ä¾‹ã€1-xã€‘&quot;&gt;&lt;a href=&quot;#1-åˆ›å»ºSparkSessionã€2-0ã€‘å’Œ-SQLContextå®ä¾‹ã€1-xã€‘&quot; class=&quot;headerlink&quot; t
      
    
    </summary>
    
      <category term="Spark" scheme="http://www.ihoge.cn/categories/Spark/"/>
    
    
      <category term="Sparksql" scheme="http://www.ihoge.cn/tags/Sparksql/"/>
    
  </entry>
  
  <entry>
    <title>SparkSQL DataFrameåŸºç¡€ç¯‡</title>
    <link href="http://www.ihoge.cn/2018/SparkSQl.html"/>
    <id>http://www.ihoge.cn/2018/SparkSQl.html</id>
    <published>2018-04-14T05:59:21.000Z</published>
    <updated>2018-04-14T10:31:23.224Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>#SparkSQL DataFrameåŸºç¡€ç¯‡</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Spark</span> <span class="number">2.2</span>åŠä»¥åçš„<span class="type">SparkSession</span>æ›¿æ¢äº†<span class="type">Spark</span>ä»¥å‰ç‰ˆæœ¬ä¸­çš„<span class="type">SparkContext</span>å’Œ<span class="type">SQLContext</span>ï¼Œä¸º<span class="type">Spark</span>é›†ç¾¤æä¾›äº†å”¯ä¸€çš„å…¥å£ç‚¹ã€‚</span><br><span class="line"><span class="keyword">val</span> spark =<span class="type">SparkSession</span>.builder().</span><br><span class="line">appName(â€œ<span class="type">SparkExample</span>â€).</span><br><span class="line">getOrCreate()</span><br><span class="line">ä¸ºäº†å‘åå…¼å®¹ï¼Œ<span class="type">SparkSession</span>å¯¹è±¡åŒ…å«<span class="type">SparkContext</span>å’Œ<span class="type">SQLContext</span>å¯¹è±¡ã€‚å½“ä½¿ç”¨äº¤äº’å¼<span class="type">Spark</span> shellæ—¶ï¼Œåˆ›å»ºä¸€ä¸ª<span class="type">SparkSession</span>ç±»å‹å¯¹è±¡åä¸ºsparkã€‚</span><br><span class="line"></span><br><span class="line">å› æ­¤è¯¥æ–‡æ¡£é‡Œæ‰€æœ‰çš„<span class="type">SQLContext</span>åœ¨spark2<span class="number">.2</span>+ä¸­éƒ½å¯ä»¥æ›¿æ¢æˆspark</span><br></pre></td></tr></table></figure><h2 id="åŸºäºåå°„æœºåˆ¶åˆ›å»ºDataFrame"><a href="#åŸºäºåå°„æœºåˆ¶åˆ›å»ºDataFrame" class="headerlink" title="åŸºäºåå°„æœºåˆ¶åˆ›å»ºDataFrame"></a>åŸºäºåå°„æœºåˆ¶åˆ›å»ºDataFrame</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//students.txt</span><br><span class="line">160201,Michael,17</span><br><span class="line">160101,Andy,23</span><br><span class="line">160301,justin,23</span><br><span class="line">160202,John,22</span><br><span class="line">160102,Herry,17</span><br><span class="line">160203,Brewster,18</span><br><span class="line">160302,Brice,20</span><br><span class="line">160303,Justin,25</span><br><span class="line">160103,Jerry,22</span><br><span class="line">160304,Tom,24</span><br></pre></td></tr></table></figure><p>ä¸ç»“åˆhiveï¼Œä½¿ç”¨sparkå®ä¾‹(é€‚ç”¨äºspark1+)<br>val spark=new org.apache.spark.sql.spark(sc)<br>import spark.implicits._</p><p>ç»“åˆhiveåï¼Œè®¿é—®hiveæ—¶ä½¿ç”¨HiveContextå®ä¾‹<br>val hiveContext=new org.apache.spark.sql.hive.HiveContext(sc)<br>import hiveContext.implicits._</p><p><code>è¿™é‡Œä¸Spark2.2+æœ‰æ‰€ä¸åŒ</code></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">id: <span class="type">String</span>, name : <span class="type">String</span>, age: <span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">rdd=sc</span>.<span class="title">textFile</span>(<span class="params">"hdfs://master:9000/sqldata/students.txt"</span>).<span class="title">map</span>(<span class="params">_.split(","</span>)).<span class="title">map</span>(<span class="params">p =&gt; <span class="type">Student</span>(p(0</span>), <span class="title">p</span>(<span class="params">1</span>), <span class="title">p</span>(<span class="params">2</span>).<span class="title">trim</span>.<span class="title">toInt</span>))</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">students</span> </span>= rdd.toDF()</span><br><span class="line">students.registerTempTable(<span class="string">"tb_students"</span>)</span><br><span class="line"><span class="keyword">val</span> youngstudents=spark.sql(<span class="string">"SELECT name FROM tb_students WHERE age&gt;=19 AND age&lt;=22"</span>)</span><br><span class="line">youngstudents.show</span><br></pre></td></tr></table></figure><h2 id="åŸºäºç¼–ç¨‹åˆ›å»ºDataFrame"><a href="#åŸºäºç¼–ç¨‹åˆ›å»ºDataFrame" class="headerlink" title="åŸºäºç¼–ç¨‹åˆ›å»ºDataFrame"></a>åŸºäºç¼–ç¨‹åˆ›å»ºDataFrame</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.types._   </span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql._         </span><br><span class="line"><span class="keyword">import</span> org.apache.spark._</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> students=sc.textFile(<span class="string">"hdfs://master:9000/sqldata/students.txt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> schemaString=<span class="string">"id name age"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> schema=<span class="type">StructType</span>(schemaString.split(<span class="string">" "</span>).map(fieldname=&gt; <span class="type">StructField</span>(fieldname, <span class="type">StringType</span>, <span class="literal">true</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> rowRDD=students.map(_.split(<span class="string">","</span>)).map(p=&gt;<span class="type">Row</span>(p(<span class="number">0</span>), p(<span class="number">1</span>), p(<span class="number">2</span>).trim))</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> studentsDataFrame=spark.createDataFrame(rowRDD, schema) </span><br><span class="line"></span><br><span class="line">studentsDataFrame.registerTempTable(<span class="string">"tb_students"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> names=spark.sql(<span class="string">"SELECT name FROM tb_students"</span>)</span><br><span class="line"></span><br><span class="line">names.show</span><br></pre></td></tr></table></figure><h2 id="åŸºäºDataFrameåˆ›å»ºJsonæ–‡ä»¶"><a href="#åŸºäºDataFrameåˆ›å»ºJsonæ–‡ä»¶" class="headerlink" title="åŸºäºDataFrameåˆ›å»ºJsonæ–‡ä»¶"></a>åŸºäºDataFrameåˆ›å»ºJsonæ–‡ä»¶</h2><h3 id="1-åˆ›å»ºDataFrame"><a href="#1-åˆ›å»ºDataFrame" class="headerlink" title="1.åˆ›å»ºDataFrame"></a>1.åˆ›å»ºDataFrame</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spark.implicits._</span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">id: <span class="type">String</span>, name : <span class="type">String</span>, age: <span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">rdd=sc</span>.<span class="title">textFile</span>(<span class="params">"hdfs://master:9000/sqldata/students.txt"</span>).<span class="title">map</span>(<span class="params">_.split(","</span>)).<span class="title">map</span>(<span class="params">p =&gt; <span class="type">Student</span>(p(0</span>), <span class="title">p</span>(<span class="params">1</span>), <span class="title">p</span>(<span class="params">2</span>).<span class="title">trim</span>.<span class="title">toInt</span>))</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">students</span> </span>= rdd.toDF()</span><br></pre></td></tr></table></figure><h3 id="2-å¦å­˜ä¸ºjsonç±»å‹æ–‡ä»¶"><a href="#2-å¦å­˜ä¸ºjsonç±»å‹æ–‡ä»¶" class="headerlink" title="2.å¦å­˜ä¸ºjsonç±»å‹æ–‡ä»¶"></a>2.å¦å­˜ä¸ºjsonç±»å‹æ–‡ä»¶</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//students.save("hdfs://master:9000/sqldata/students.json")//æ— æ³•æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">spark1<span class="number">.4</span>åŠä»¥åï¼Œdataframeä¸­çš„saveæ–¹æ³•ä¸å»ºè®®ä½¿ç”¨ï¼Œæœ‰çš„ç›´æ¥è¢«å¼ƒç”¨ï¼Œ</span><br><span class="line">ä½¿ç”¨<span class="type">DataFrame</span>ä¸­çš„writeæ–¹æ³•è¿”å›ä¸€ä¸ª<span class="type">DataFrameWriter</span>ç±»å‹å¯¹è±¡ï¼Œå†ä½¿ç”¨é‡Œé¢çš„saveæ–¹æ³•ã€format().save()ã€parquet()ç­‰æ–¹æ³•</span><br><span class="line"></span><br><span class="line">students.write.save(<span class="string">"hdfs://master:9000/sqldata/students.json"</span>)</span><br><span class="line">students.write.format(<span class="string">"json"</span>).save(<span class="string">"hdfs://master:9000/sqldata/s1.json"</span>)<span class="comment">//Spark 1.4 DataFrameWriterä¸­æ–¹æ³•formatã€save</span></span><br><span class="line">students.write.json(<span class="string">"hdfs://master:9000/sqldata/s2.json"</span>)<span class="comment">//Spark 1.4 DataFrameWriterä¸­æ–¹æ³•json</span></span><br></pre></td></tr></table></figure><h2 id="åŸºäºDataFrameåˆ›å»ºParquetæ–‡ä»¶"><a href="#åŸºäºDataFrameåˆ›å»ºParquetæ–‡ä»¶" class="headerlink" title="åŸºäºDataFrameåˆ›å»ºParquetæ–‡ä»¶"></a>åŸºäºDataFrameåˆ›å»ºParquetæ–‡ä»¶</h2><h3 id="1-åˆ›å»ºDataFrame-1"><a href="#1-åˆ›å»ºDataFrame-1" class="headerlink" title="1.åˆ›å»ºDataFrame"></a>1.åˆ›å»ºDataFrame</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spark.implicits._</span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">id: <span class="type">String</span>, name : <span class="type">String</span>, age: <span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">rdd=sc</span>.<span class="title">textFile</span>(<span class="params">"hdfs://master:9000/sqldata/students.txt"</span>).<span class="title">map</span>(<span class="params">_.split(","</span>)).<span class="title">map</span>(<span class="params">p =&gt; <span class="type">Student</span>(p(0</span>), <span class="title">p</span>(<span class="params">1</span>), <span class="title">p</span>(<span class="params">2</span>).<span class="title">trim</span>.<span class="title">toInt</span>))</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">students</span> </span>= rdd.toDF()</span><br></pre></td></tr></table></figure><h3 id="2-å¦å­˜ä¸ºparquetç±»å‹æ–‡ä»¶"><a href="#2-å¦å­˜ä¸ºparquetç±»å‹æ–‡ä»¶" class="headerlink" title="2.å¦å­˜ä¸ºparquetç±»å‹æ–‡ä»¶"></a>2.å¦å­˜ä¸ºparquetç±»å‹æ–‡ä»¶</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//students.save("hdfs://master:9000/sqldata/students.parquet")//æ— æ³•æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">spark1<span class="number">.4</span>åŠä»¥åï¼Œdataframeä¸­çš„saveæ–¹æ³•ä¸å»ºè®®ä½¿ç”¨ï¼Œæœ‰çš„ç›´æ¥è¢«å¼ƒç”¨ï¼Œ</span><br><span class="line">ä½¿ç”¨<span class="type">DataFrame</span>ä¸­çš„writeæ–¹æ³•è¿”å›ä¸€ä¸ª<span class="type">DataFrameWriter</span>ç±»å‹å¯¹è±¡ï¼Œå†ä½¿ç”¨é‡Œé¢çš„saveæ–¹æ³•ã€format().save()ã€parquet()ç­‰æ–¹æ³•</span><br><span class="line"></span><br><span class="line">students.write.save(<span class="string">"hdfs://master:9000/sqldata/students.parquet"</span>)</span><br><span class="line">students.write.format(<span class="string">"parquet"</span>).save(<span class="string">"hdfs://master:9000/sqldata/s1.parquet"</span>)</span><br><span class="line">students.write.parquet(<span class="string">"hdfs://master:9000/sqldata/s2.parquet"</span>)</span><br></pre></td></tr></table></figure><h2 id="åŸºäºJsonåˆ›å»ºDataFrame"><a href="#åŸºäºJsonåˆ›å»ºDataFrame" class="headerlink" title="åŸºäºJsonåˆ›å»ºDataFrame"></a>åŸºäºJsonåˆ›å»ºDataFrame</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//readæ–¹æ³•æ˜¯sparkä¸­çš„æ–¹æ³•ï¼Œè¿”å›å€¼ç±»å‹æ˜¯DataFrameReader,ä»¥å¾€çš„jsonFileæ–¹æ³•å·²ç»ä¸å»ºè®®ä½¿ç”¨ </span></span><br><span class="line"><span class="keyword">val</span> students=spark.read.json(<span class="string">"hdfs://master:9000/sqldata/s2.json"</span>)<span class="comment">//read.json()æ˜¯æœ€é€šç”¨çš„ä¸€ç§æ–¹æ³•s1.json,s2.jsonéƒ½å¯è¯»     </span></span><br><span class="line">students.registerTempTable(<span class="string">"tb_students"</span>)</span><br><span class="line">spark.sql(<span class="string">"select * from tb_students"</span>).show</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">val students=spark.read.load("hdfs://master:9000/sqldata/students.json")//å¯æ‰§è¡Œï¼Œä½†æ¢åšè¯»s1.json,s2.jsonä¸å¯è¯»</span></span><br><span class="line"><span class="comment">val students=spark.read.load("hdfs://master:9000/sqldata/s1.json") //ä¸å¯æ‰§è¡Œï¼Œloadé»˜è®¤è¯»å–parquetç±»å‹æ–‡ä»¶</span></span><br><span class="line"><span class="comment">val students=spark.jsonFile("hdfs://master:9000/sqldata/students.json") //jsonFileä¸å¯ç”¨</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="åŸºäºParquetåˆ›å»ºDataFrame"><a href="#åŸºäºParquetåˆ›å»ºDataFrame" class="headerlink" title="åŸºäºParquetåˆ›å»ºDataFrame"></a>åŸºäºParquetåˆ›å»ºDataFrame</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//readæ–¹æ³•æ˜¯sparkä¸­çš„æ–¹æ³•ï¼Œè¿”å›å€¼ç±»å‹æ˜¯DataFrameReader,ä»¥å¾€çš„parquetFileæ–¹æ³•å·²ç»ä¸å»ºè®®ä½¿ç”¨ </span></span><br><span class="line"><span class="keyword">val</span> students=spark.read.parquet(<span class="string">"hdfs://master:9000/sqldata/students.parquet"</span>) <span class="comment">//æœ€é€šç”¨çš„ä¸€ç§æ–¹æ³•,students.parquet,s1.parquet,s2.parquetéƒ½å¯è¯»</span></span><br><span class="line">students.registerTempTable(<span class="string">"tb_students"</span>)</span><br><span class="line">spark.sql(<span class="string">"select * from tb_students"</span>).show</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">val students=spark.read.load("hdfs://master:9000/sqldata/students.parquet")</span></span><br><span class="line"><span class="comment">val students=spark.load.parquet("hdfs://master:9000/sqldata/s1.parquet")//æ­¤å¤„ä¸å¯æ‰§è¡Œå› ä¸ºloadéSparkSessionä¸­æ–¹æ³•ï¼ŒSpark1.Xä¸­loadæ–¹æ³•å¯æ‰§è¡Œï¼Œé»˜è®¤è¯»å–parquetæ–‡ä»¶</span></span><br><span class="line"><span class="comment">val students=spark.parquetFile("hdfs://master:9000/sqldata/students.parquet")//parquetFileä¸å¯ç”¨</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="DataFrameçš„å…¶ä»–æ“ä½œ"><a href="#DataFrameçš„å…¶ä»–æ“ä½œ" class="headerlink" title="DataFrameçš„å…¶ä»–æ“ä½œ"></a>DataFrameçš„å…¶ä»–æ“ä½œ</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">students.head    </span><br><span class="line"></span><br><span class="line">students.head(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">students.show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">students.columns</span><br><span class="line"></span><br><span class="line">students.dtypes</span><br><span class="line"></span><br><span class="line">students.printSchema</span><br><span class="line"><span class="comment">//æ›´è¯¦ç»†çš„Schemaä¿¡æ¯</span></span><br></pre></td></tr></table></figure><h3 id="withColumn"><a href="#withColumn" class="headerlink" title="withColumn"></a>withColumn</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">students.withColumn(<span class="string">"bonus"</span>, students(<span class="string">"age"</span>)*<span class="number">50</span>).show</span><br><span class="line">students.withColumn(<span class="string">"bonus"</span>, $<span class="string">"age"</span>*<span class="number">50</span>).show<span class="comment">//å¯ä»¥è¿è¡Œ</span></span><br><span class="line">students.withColumn(<span class="string">"bonus"</span>, <span class="string">"age"</span>*<span class="number">50</span>).show<span class="comment">//ä¸å¯è¿è¡Œ</span></span><br></pre></td></tr></table></figure><h3 id="withColumnRenamed"><a href="#withColumnRenamed" class="headerlink" title="withColumnRenamed"></a>withColumnRenamed</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> newstudents=students.withColumnRenamed(<span class="string">"age"</span>, <span class="string">"newage"</span>)</span><br><span class="line"></span><br><span class="line">newstudents.printSchema</span><br></pre></td></tr></table></figure><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">id: <span class="type">String</span>, name : <span class="type">String</span>, age: <span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">rdd=sc</span>.<span class="title">textFile</span>(<span class="params">"hdfs://master:9000/sqldata/students.txt"</span>).<span class="title">map</span>(<span class="params">_.split(","</span>)).<span class="title">map</span>(<span class="params">p =&gt; <span class="type">Student</span>(p(0</span>), <span class="title">p</span>(<span class="params">1</span>), <span class="title">p</span>(<span class="params">2</span>).<span class="title">trim</span>.<span class="title">toInt</span>))</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">students</span> </span>= rdd.toDF()</span><br><span class="line"></span><br><span class="line">students.select(<span class="string">"age"</span>, <span class="string">"name"</span>).show</span><br><span class="line">students.select( $<span class="string">"age"</span>, $<span class="string">"name"</span>).show</span><br><span class="line">students.selectExpr(<span class="string">"age+1"</span>, <span class="string">"name"</span>, <span class="string">"abs(age)"</span>).show</span><br><span class="line">students.selectExpr(<span class="string">"age+1 as newage1"</span>, <span class="string">"name as newName"</span>, <span class="string">"sqrt(age) as newage2"</span>).show</span><br></pre></td></tr></table></figure><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">students.filter(<span class="string">"age&gt;20"</span>).show</span><br><span class="line">students.filter($<span class="string">"age"</span>&gt;<span class="number">20</span>).show</span><br><span class="line">students.filter($<span class="string">"age"</span>&gt;<span class="number">23</span> &amp;&amp; $<span class="string">"name"</span>===<span class="string">"Justin"</span>).show  <span class="comment">//å¯ä»¥æ‰§è¡Œ</span></span><br><span class="line">students.filter(<span class="symbol">'age</span>&gt;<span class="number">20</span>).show <span class="comment">//å¯ä»¥æ‰§è¡Œ</span></span><br><span class="line">students.filter(<span class="string">"age&gt;23 &amp;&amp; name===Justin"</span>).show        <span class="comment">//ä¸å¯ä»¥æ‰§è¡Œï¼Œå­—ç¬¦ä¸²ä¸­ä¸èƒ½ç”¨é€»è¾‘è¿ç®—ç¬¦</span></span><br></pre></td></tr></table></figure><h3 id="where"><a href="#where" class="headerlink" title="where"></a>where</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">students.where(<span class="symbol">'age</span>&gt;<span class="number">20</span>).show   </span><br><span class="line">students.where($<span class="string">"age"</span>&gt;<span class="number">20</span>).show </span><br><span class="line">students.where($<span class="string">"age"</span>&gt;<span class="number">23</span> &amp;&amp; $<span class="string">"name"</span>===<span class="string">"Justin"</span>).show</span><br><span class="line">students.where(<span class="symbol">'age</span>&gt;<span class="number">23</span> &amp;&amp; <span class="symbol">'name</span>===<span class="string">"Justin"</span>).show</span><br><span class="line">students.where(<span class="string">"age&gt;23 &amp;&amp; name===Justin"</span>).show      <span class="comment">//ä¸å¯ä»¥æ‰§è¡Œ,å­—ç¬¦ä¸²ä¸­ä¸èƒ½ç”¨é€»è¾‘è¿ç®—ç¬¦</span></span><br></pre></td></tr></table></figure><h3 id="orderBy"><a href="#orderBy" class="headerlink" title="orderBy"></a>orderBy</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">students.orderBy(<span class="string">"age"</span>, <span class="string">"id"</span>).show(<span class="number">5</span>)</span><br><span class="line">students.orderBy(students(<span class="string">"age"</span>)).show(<span class="number">5</span>)</span><br><span class="line">students.orderBy($<span class="string">"age"</span>).show(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><h3 id="groupBy"><a href="#groupBy" class="headerlink" title="groupBy"></a>groupBy</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">newstudents.groupBy(&apos;course_id).mean(&quot;score&quot;).orderBy(&apos;course_id).show</span><br><span class="line"></span><br><span class="line">max(&quot;col&quot;)</span><br><span class="line">min(&quot;col&quot;)</span><br><span class="line">mean(&quot;col&quot;)</span><br><span class="line">sum(&quot;col&quot;)</span><br><span class="line">è¯¥å››ç§æ–¹æ³•åªé€‚ç”¨äºæ•°å€¼å‹çš„GroupedDataå¯¹è±¡</span><br></pre></td></tr></table></figure><h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">students.sort(<span class="string">"age"</span>).show(<span class="number">5</span>)</span><br><span class="line">students.sort($<span class="string">"age"</span>.desc).show(<span class="number">5</span>)</span><br><span class="line">students.sort(<span class="string">"age"</span>.desc).show(<span class="number">5</span>)<span class="comment">//ä¸å¯æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><h3 id="toDF"><a href="#toDF" class="headerlink" title="toDF"></a>toDF</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> newstudents=students.toDF(<span class="string">"newid"</span>, <span class="string">"newage"</span>, <span class="string">"newname"</span>)</span><br><span class="line">newstudents.printSchema</span><br></pre></td></tr></table></figure><h3 id="join"><a href="#join" class="headerlink" title="join"></a>join</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Score</span>(<span class="params">id:<span class="type">String</span>,course_id:<span class="type">String</span>,score:<span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">scores_rdd=sc</span>.<span class="title">textFile</span>(<span class="params">"hdfs://master:9000/sqldata/scores.txt"</span>).<span class="title">map</span>(<span class="params">_.split(","</span>)).<span class="title">map</span>(<span class="params">p =&gt; <span class="type">Score</span>(p(0</span>), <span class="title">p</span>(<span class="params">1</span>), <span class="title">p</span>(<span class="params">2</span>).<span class="title">trim</span>.<span class="title">toInt</span>))</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">scores</span> </span>= scores_rdd.toDF()</span><br><span class="line">students.join(scores, students(<span class="string">"id"</span> )===scores(<span class="string">"id"</span>), <span class="string">"outer"</span>).show</span><br></pre></td></tr></table></figure><h2 id="æ¡ˆä¾‹ç»ƒä¹ "><a href="#æ¡ˆä¾‹ç»ƒä¹ " class="headerlink" title="æ¡ˆä¾‹ç»ƒä¹ "></a>æ¡ˆä¾‹ç»ƒä¹ </h2><h3 id="Spark-SQLåŸºæœ¬æ¡ˆä¾‹1"><a href="#Spark-SQLåŸºæœ¬æ¡ˆä¾‹1" class="headerlink" title="Spark SQLåŸºæœ¬æ¡ˆä¾‹1"></a>Spark SQLåŸºæœ¬æ¡ˆä¾‹1</h3><p><strong>scores.txt</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">scores å­¦å·ã€è¯¾ç¨‹ç¼–å·ã€æˆç»©</span><br><span class="line">160201,1,60</span><br><span class="line">160101,2,90</span><br><span class="line">160301,1,70</span><br><span class="line">160202,3,70</span><br><span class="line">160102,3,50</span><br><span class="line">160102,4,95</span><br><span class="line">160302,1,98</span><br><span class="line">160303,2,57</span><br><span class="line">160103,3,64</span><br><span class="line">160304,3,50</span><br><span class="line">160201,2,77</span><br><span class="line">160101,3,57</span><br><span class="line">160301,3,72</span><br><span class="line">160202,2,80</span><br><span class="line">160102,2,58</span><br><span class="line">160102,3,97</span><br><span class="line">160302,4,91</span><br><span class="line">160303,1,67</span><br><span class="line">160103,2,62</span><br><span class="line">160304,4,71</span><br></pre></td></tr></table></figure></p><p><strong>students.txt</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">160201,Michael,17</span><br><span class="line">160101,Andy,23</span><br><span class="line">160301,justin,23</span><br><span class="line">160202,John,22</span><br><span class="line">160102,Herry,17</span><br><span class="line">160203,Brewster,18</span><br><span class="line">160302,Brice,20</span><br><span class="line">160303,Justin,25</span><br><span class="line">160103,Jerry,22</span><br><span class="line">160304,Tom,24</span><br></pre></td></tr></table></figure></p><p>1.åˆ©ç”¨åå°„æœºåˆ¶åˆ›å»ºstudents.txtå¯¹åº”çš„DataFrameï¼Œå…¶ä¸­åŒ…å«idã€nameã€ageä¸‰ä¸ªå­—æ®µã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val rdd=sc.textFile(&quot;hdfs://master:9000/sqldata/students.txt&quot;).map(_.split(&quot;,&quot;)).map(p=&gt;Student(p(0),p(1),p(2).toInt))</span><br><span class="line">students = rdd.toDF</span><br><span class="line">students.show</span><br></pre></td></tr></table></figure></p><p>2.æŸ¥çœ‹æ‰€æœ‰å­¦ç”Ÿçš„å§“åã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">students.select(&apos;name).show</span><br></pre></td></tr></table></figure></p><p>3.æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„å¹´é¾„ï¼Œå¹¶æŒ‰ç…§å¹´é¾„é™åºæ’åºã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">students.select(&apos;age).show</span><br><span class="line">students.sort(&quot;age&quot;.desc).show()</span><br></pre></td></tr></table></figure></p><p>4.æŸ¥è¯¢å¹´é¾„å°äº19æˆ–å¹´é¾„å¤§äº21çš„æ‰€æœ‰å­¦ç”Ÿã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">students.where($&quot;age&quot;&gt;21 || $&quot;age&quot;&lt;19).show</span><br></pre></td></tr></table></figure></p><p>5.æ·»åŠ scholarshipå­—æ®µï¼Œæ¯ä¸ªå­¦ç”Ÿçš„scholarshipé¡¹æ˜¯å…¶é¾„*20ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val newstudents = students.withColumn(&quot;scholarship&quot;,$&quot;age&quot;*20)</span><br><span class="line">newstudents.show(5)</span><br></pre></td></tr></table></figure></p><p>6.å°†æ·»åŠ scholarshipå­—æ®µåçš„DataFrameåˆ†åˆ«ä»¥Parquetå’ŒJSONæ ¼å¼ä¿å­˜è‡³HDFSä¸Šã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">newstudents.write.format(&quot;json&quot;).save(&quot;hdfs://master:9000/sqldata/newstudents.json&quot;)</span><br><span class="line">newstudents.write.format(&quot;parquet&quot;).save(&quot;hdfs://master:9000/sqldata/newstudents.parquet&quot;)</span><br></pre></td></tr></table></figure></p><p>7.åˆ©ç”¨SQLè¯­å¥å®ç°æ¡ˆä¾‹1ä¸­2-4ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">students.registerTempTable(&quot;tb_students&quot;)</span><br><span class="line"></span><br><span class="line">spark.sql(&quot;SELECT name FROM tb_students WHERE age&gt;=19 AND age&lt;=21&quot;)</span><br></pre></td></tr></table></figure></p><p>8.åˆ©ç”¨è‡ªå®šä¹‰æ¥å£åˆ›å»ºscores.txtå¯¹åº”çš„DataFrameï¼Œå…¶ä¸­åŒ…å«idã€course_idã€scoreä¸‰ä¸ªå­—æ®µã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val scores_rdd=sc.textFile(&quot;hdfs://master:9000/sqldata/scores.txt&quot;).map(_.split(&quot;,&quot;)).map(p =&gt; Score(p(0), p(1), p(2).trim.toInt))</span><br><span class="line"></span><br><span class="line">val scores = scores.toDF()</span><br><span class="line">val newstudents = students.join(scores, students(&quot;id&quot; )==scores(&quot;id&quot;), &quot;outer&quot;)</span><br><span class="line">newstudents.show</span><br></pre></td></tr></table></figure></p><p>9.æŒ‰ç…§è¯¾ç¨‹ç¼–å·åˆ†ç»„ï¼ŒæŸ¥çœ‹æ¯é—¨è¯¾çš„å¹³å‡æˆç»©ï¼Œå¹¶æŒ‰è¯¾ç¨‹ç¼–å·å‡åºæ’åºã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newstudents.groupBy(&apos;course_id).mean(&quot;score&quot;).orderBy(&apos;course_id).show</span><br></pre></td></tr></table></figure></p><p>10.æŒ‰ç…§å­¦ç”Ÿç¼–å·åˆ†ç»„ï¼ŒæŸ¥çœ‹ä¸ªå­¦ç”Ÿçš„å§“åå’Œå…¶æ‰€æœ‰è¯¾ç¨‹çš„å¹³å‡æˆç»©ï¼Œå¹¶åœ¨ç»Ÿè®¡ç»“æœä¸­ç­›é€‰å‡ºå¹³å‡æˆç»©å¤§äº72çš„åŒå­¦ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val newstudents = students.join(scores, students(&quot;id&quot; )==scores(&quot;id&quot;), &quot;outer&quot;)</span><br><span class="line">newstudents.groupBy($&quot;name&quot;).mean(&quot;score&quot;).where($&quot;avg(score)&quot;&gt;72).orderBy(&quot;name&quot;).show</span><br></pre></td></tr></table></figure></p><h3 id="Spark-SQLåŸºæœ¬æ¡ˆä¾‹2"><a href="#Spark-SQLåŸºæœ¬æ¡ˆä¾‹2" class="headerlink" title="Spark SQLåŸºæœ¬æ¡ˆä¾‹2"></a>Spark SQLåŸºæœ¬æ¡ˆä¾‹2</h3><p><strong>students.txt</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å­¦å·/å§“å/æ€§åˆ«/å¹´é¾„/å­¦å¹´/ç³»åˆ«/</span><br><span class="line">160201,Michael,male,37,2012,2,2</span><br><span class="line">160101,Rose,female,33,2011,1,1</span><br><span class="line">160301,justin,male,23,2013,3,3</span><br><span class="line">160202,John,male,22,2012,2,2</span><br><span class="line">160102,Lucy,female,27,2011,2,1</span><br><span class="line">160203,Brewster,male,37,2012,1,2</span><br><span class="line">160302,Susan,female,30,2013,1,3</span><br><span class="line">160303,Justin,male,23,2013,3,3</span><br><span class="line">160103,John,male,22,2011,2,1</span><br><span class="line">160304,Lucy,female,27,2013,3,3</span><br></pre></td></tr></table></figure></p><p><strong>departments.txt</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Computer,1</span><br><span class="line">Math,2</span><br><span class="line">Art,3</span><br></pre></td></tr></table></figure></p><p><strong>projects.txt</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å­¦å·/åˆ›æ–°é¡¹ç›®ç¼–å·/å­¦å¹´/</span><br><span class="line">160201,XC2014001,2014,16,64,2</span><br><span class="line">160101,XC201213,2012,32,48,3</span><br><span class="line">160301,RW201103,2011,32,48,3</span><br><span class="line">160202,XC2014002,2014,16,64,1</span><br><span class="line">160102,XC2013002,2013,16,64,2</span><br><span class="line">160102,XC2012011,2012,16,48,2</span><br><span class="line">160302,RW201401,2014,32,32,2</span><br><span class="line">160304,RW201503,2015,16,32,1</span><br></pre></td></tr></table></figure></p><p><strong>scores.txt</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">160201,90</span><br><span class="line">160101,83</span><br><span class="line">160301,80</span><br><span class="line">160202,70</span><br><span class="line">160102,67</span><br><span class="line">160102,89</span><br><span class="line">160302,91</span><br><span class="line">160303,58</span><br><span class="line">160103,64</span><br></pre></td></tr></table></figure></p><p><strong>scholarship.txt</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">160201,2013,2000</span><br><span class="line">160201,2014,3000</span><br><span class="line">160102,2013,2000</span><br><span class="line">160101,2013,2000</span><br><span class="line">160301,2014,2000</span><br><span class="line">160302,2014,2000</span><br><span class="line">160302,2015,3000</span><br><span class="line">160302,2016,4000</span><br></pre></td></tr></table></figure></p><p>1.æŸ¥è¯¢åˆ›å»ºçš„äº”ä¸ªè¡¨çš„æ¦‚è¦ä¿¡æ¯ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>2.æŸ¥è¯¢å„é™¢ç³»å­¦ç”Ÿæ€»æ•°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>3.æŸ¥è¯¢å„é™¢ç³»å­¦ç”Ÿå¥–å­¦é‡‘çš„æ€»å’Œå¹¶æ’åºã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>4.æŸ¥è¯¢å„é™¢ç³»å­¦ç”Ÿçš„å¹³å‡å­¦åˆ†ç»©å€¼å¹¶æ’åºã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>5.ç»Ÿè®¡å„å­¦é™¢æ¯å¹´å­¦ç”Ÿå‚ä¸åˆ›æ–°é¡¹ç›®æ‰€è·å¾—çš„åˆ›æ–°å­¦åˆ†æ•°æ€»æ•°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;#SparkSQL DataFrameåŸºç¡€ç¯‡&lt;/p&gt;
&lt;figure class=&quot;highlight scala&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/spa
      
    
    </summary>
    
      <category term="Spark" scheme="http://www.ihoge.cn/categories/Spark/"/>
    
    
      <category term="Sparksql" scheme="http://www.ihoge.cn/tags/Sparksql/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨aconda3-5.1.0ï¼ˆPython3.6.4ï¼‰ æ­å»ºpysparkè¿œç¨‹éƒ¨ç½²</title>
    <link href="http://www.ihoge.cn/2018/anacondaPyspark.html"/>
    <id>http://www.ihoge.cn/2018/anacondaPyspark.html</id>
    <published>2018-04-13T17:59:21.000Z</published>
    <updated>2018-04-14T10:47:55.079Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>é¦–æ¬¡å®‰è£…çš„ç¯å¢ƒæ­é…æ˜¯è¿™æ ·çš„ï¼š<br> jdk8<br> hadoop2.6.5<br> spark2.1<br> scala2.12.4<br> Anaconda3-5.1.0<br>ä¸€è¿ä¸²çš„æŠ¥é”™è®©äººæƒŠå–œæ— é™ï¼Œå°½ç®¡åå¤è°ƒæ•´é…ç½®å§‹ç»ˆæ— æ³•è§£å†³ã€‚<br><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fqavez8o4aj310q094jsn.jpg" alt=""></p><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fqavfnihv5j316g0katdf.jpg" alt=""></p><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fqavgahjl2j315y0e00vm.jpg" alt=""></p><p>å‘äº†ä¸€æ•´å¤©åæœ€åæœ€ç»ˆå‘ç°æ˜¯<strong>ç‰ˆæœ¬ä¸å…¼å®¹ï¼ï¼</strong>å†æ¬¡æé†’è‡ªå·±ä¸€å®šè¦é‡è§†å„ç»„ä»¶ç‰ˆæœ¬çš„é—®é¢˜ã€‚è¿™é‡Œæœ€ä¸»è¦çš„æ˜¯sparkå’ŒAnacondaç‰ˆæœ¬çš„å…¼å®¹é—®é¢˜ï¼Œä¸ºäº†å…¼å®¹python3å°½é‡ç”¨æ–°ç‰ˆçš„sparkã€‚æœ€ç»ˆè§£å†³æ–¹æ¡ˆçš„ç‰ˆæœ¬æ­é…å¦‚ä¸‹ï¼š<br> jdk8<br> hadoop2.7.5<br> spark2.3.0<br> scala2.11.12<br> Anaconda3-5.1.0</p><h3 id="ä¸€ã€VMå®‰è£…Ubuntu16-04è™šæ‹Ÿæœº"><a href="#ä¸€ã€VMå®‰è£…Ubuntu16-04è™šæ‹Ÿæœº" class="headerlink" title="ä¸€ã€VMå®‰è£…Ubuntu16.04è™šæ‹Ÿæœº"></a>ä¸€ã€VMå®‰è£…Ubuntu16.04è™šæ‹Ÿæœº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install vim</span><br><span class="line">sudo apt-get install openssh-server</span><br><span class="line"></span><br><span class="line"># é…ç½®sshå…å¯†ç™»é™†</span><br><span class="line">ssh localhost</span><br><span class="line">ssh-keygen -t rsa //ä¸€è·¯å›è½¦</span><br><span class="line">cat id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line"></span><br><span class="line">sudo vi /etc/hosts //æ·»åŠ å„ä¸ªèŠ‚ç‚¹ip</span><br><span class="line">192.168.221.132 master</span><br><span class="line">192.168.221.133 slave1</span><br><span class="line">192.168.221.134 slave2</span><br><span class="line"></span><br><span class="line"># sudo vi /etc/hostname</span><br><span class="line">master</span><br></pre></td></tr></table></figure><h3 id="äºŒã€é…ç½®profileç¯å¢ƒå˜é‡"><a href="#äºŒã€é…ç½®profileç¯å¢ƒå˜é‡" class="headerlink" title="äºŒã€é…ç½®profileç¯å¢ƒå˜é‡"></a>äºŒã€é…ç½®profileç¯å¢ƒå˜é‡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#Java</span><br><span class="line">export JAVA_HOME=/home/hadoop/jdk1.8.0_161</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jar</span><br><span class="line">#Hadoop</span><br><span class="line">export HADOOP_HOME=/home/hadoop/hadoop</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</span><br><span class="line">#Scala</span><br><span class="line">export SCALA_HOME=/home/hadoop/scala</span><br><span class="line">export PATH=$PATH:$SCALA_HOME/bin</span><br><span class="line">#Anaconda</span><br><span class="line">export PATH=/home/hadoop/anaconda3/bin:$PATH</span><br><span class="line">export PYSPARK_DRIVER_PYTHON=/home/hadoop/anaconda3/bin/jupyter</span><br><span class="line">export PYSPARK_DRIVER_PYTHON_OPTS=&quot;notebook&quot;</span><br><span class="line">export PYSPARK_PYTHON=/home/hadoop/anaconda3/bin/python</span><br><span class="line">#Spark</span><br><span class="line">export SPARK_HOME=/home/hadoop/spark</span><br><span class="line">export PATH=$PATH:$SPARK_HOME/bin</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€hadoop-å…­ä¸ªé…ç½®æ–‡ä»¶"><a href="#ä¸‰ã€hadoop-å…­ä¸ªé…ç½®æ–‡ä»¶" class="headerlink" title="ä¸‰ã€hadoop å…­ä¸ªé…ç½®æ–‡ä»¶"></a>ä¸‰ã€hadoop å…­ä¸ªé…ç½®æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"># hadoop-env.sh</span><br><span class="line">export JAVA_HOME=/home/hadoop/hadoop/jdk1.8.0_161</span><br><span class="line"></span><br><span class="line"># core-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;file:/home/hadoop/hadoop/tmp&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;Abase for other temporary directories.&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hdfs://master:9000&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"># hdfs-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;master:50090&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;3&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;file:/home/hadoop/hadoop/tmp/dfs/name&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;file:/home/hadoop/hadoop/tmp/dfs/data&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"># mapred-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;master:10020&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;master:19888&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"># yarn-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;master&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"># slaves</span><br><span class="line">slave1</span><br><span class="line">slave2</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€sparkä¸¤ä¸ªé…ç½®æ–‡ä»¶"><a href="#ä¸‰ã€sparkä¸¤ä¸ªé…ç½®æ–‡ä»¶" class="headerlink" title="ä¸‰ã€sparkä¸¤ä¸ªé…ç½®æ–‡ä»¶"></a>ä¸‰ã€sparkä¸¤ä¸ªé…ç½®æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># spark-env.sh</span><br><span class="line">#java</span><br><span class="line">export JAVA_HOME=/home/hadoop/jdk1.8.0_161</span><br><span class="line">#scala</span><br><span class="line">export SCALA_HOME=/home/hadoop/scala</span><br><span class="line">#hadoop</span><br><span class="line">export HADOOP_HOME=/home/hadoop/hadoop</span><br><span class="line">export HADOOP_CONF_DIR=/home/hadoop/hadoop/etc/hadoop</span><br><span class="line">export YARN_CONF_DIR=/home/hadoop/hadoop/etc/hadoop</span><br><span class="line">#spark</span><br><span class="line">export SPARK_HOME=/home/hadoop/spark</span><br><span class="line">export SPARK_LOCAL_DIRS=/home/hadoop/spark</span><br><span class="line">export SPARK_DIST_CLASSPATH=$(/home/hadoop/hadoop/bin/hadoop classpath)</span><br><span class="line">export SPARK_WORKER_CORES=1</span><br><span class="line">export SPARK_WORKER_INSTANCES=1</span><br><span class="line">export SPARK_WORKER_MEMORY=1g</span><br><span class="line">export SPARK_MASTER_IP=master</span><br><span class="line">export SPARK_LIBRARY_PATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$HADOOP_HOME/lib/native</span><br><span class="line"></span><br><span class="line"># slaves</span><br><span class="line">slave1</span><br><span class="line">slave2</span><br></pre></td></tr></table></figure><h3 id="å››ã€è§£å‹ç¼©æ–‡ä»¶"><a href="#å››ã€è§£å‹ç¼©æ–‡ä»¶" class="headerlink" title="å››ã€è§£å‹ç¼©æ–‡ä»¶"></a>å››ã€è§£å‹ç¼©æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">scp jdk-8u161-linux-x64.tar hadoop@master:~</span><br><span class="line">scp Anaconda3-5.1.0-Linux-x86_64.sh hadoop@master:~</span><br><span class="line">scp -r hadoop/ hadoop@master:~</span><br><span class="line">scp -r scala/ hadoop@master:~</span><br><span class="line">scp -r spark/ hadoop@master:~</span><br><span class="line"></span><br><span class="line">tar -xvf jdk-8u161-linux-x64.tar -C ./</span><br><span class="line"></span><br><span class="line">source ~/.profile</span><br><span class="line">åˆ†åˆ«æŸ¥çœ‹jdkç‰ˆæœ¬ã€hadoopç‰ˆæœ¬ã€scalaç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line"># é›†ç¾¤æ¨¡å¼å¯åŠ¨sparkæŸ¥çœ‹jps</span><br><span class="line">spark-shell --master spark://master:7077 --executor-memory 512m --total-executor-cores 2</span><br></pre></td></tr></table></figure><h3 id="äº”ã€å®‰è£…Anaconda"><a href="#äº”ã€å®‰è£…Anaconda" class="headerlink" title="äº”ã€å®‰è£…Anaconda"></a>äº”ã€å®‰è£…Anaconda</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">bash Anaconda3-5.1.0-Linux-x86_64.sh -b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># åˆ›å»ºé…ç½®jupyter_notebook_config.py</span><br><span class="line">jupyter notebook --generate-config</span><br><span class="line">vim ~/.jupyter/jupyter_notebook_config.py</span><br><span class="line"></span><br><span class="line">c = get_config()</span><br><span class="line">c.IPKernelApp.pylab = &apos;inline&apos;</span><br><span class="line">c.NotebookApp.ip = &apos;*&apos; </span><br><span class="line">c.NotebookApp.open.browser = False</span><br><span class="line">c.NotebookApp.password = u&apos;&apos;</span><br><span class="line">c.NotebookApp.port = 8888</span><br></pre></td></tr></table></figure><h3 id="å…­ã€å…³æœºåå…‹éš†å‡ºä¸¤ä¸ªæ–°èŠ‚ç‚¹å¹¶é…ç½®ç›¸å…³å†…å®¹"><a href="#å…­ã€å…³æœºåå…‹éš†å‡ºä¸¤ä¸ªæ–°èŠ‚ç‚¹å¹¶é…ç½®ç›¸å…³å†…å®¹" class="headerlink" title="å…­ã€å…³æœºåå…‹éš†å‡ºä¸¤ä¸ªæ–°èŠ‚ç‚¹å¹¶é…ç½®ç›¸å…³å†…å®¹"></a>å…­ã€å…³æœºåå…‹éš†å‡ºä¸¤ä¸ªæ–°èŠ‚ç‚¹å¹¶é…ç½®ç›¸å…³å†…å®¹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/hostname</span><br><span class="line"></span><br><span class="line">sudo vi /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="ä¸ƒã€è¿œç¨‹æµ‹è¯•pysparké›†ç¾¤"><a href="#ä¸ƒã€è¿œç¨‹æµ‹è¯•pysparké›†ç¾¤" class="headerlink" title="ä¸ƒã€è¿œç¨‹æµ‹è¯•pysparké›†ç¾¤"></a>ä¸ƒã€è¿œç¨‹æµ‹è¯•pysparké›†ç¾¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># æœåŠ¡å™¨ç«¯å¯åŠ¨é›†ç¾¤</span><br><span class="line">start-all.sh</span><br><span class="line">spark/sbin/start-all.sh</span><br><span class="line"></span><br><span class="line"># hadoopå’Œsparkçš„è¿›ç¨‹éƒ½æ˜¾ç¤ºæ­£å¸¸åå¼€å§‹å¯åŠ¨pyspark</span><br><span class="line">1ã€localæ¨¡å¼è¿è¡Œ</span><br><span class="line">pyspark</span><br><span class="line"></span><br><span class="line">2ã€Stand Aloneè¿è¡Œæ¨¡å¼</span><br><span class="line">MASTER=spark://master:7077 pyspark --num-executors 1 --total-executor-cores 3 --executor-memory 512m</span><br><span class="line"></span><br><span class="line">3ã€Hadoop YARN-client æ¨¡å¼</span><br><span class="line">HADOOP_CONF_DIR=/home/hadoop/hadoop/etc/hadoop pyspark --master yarn --deploy-mode client</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨è¿œç¨‹Webç«¯è¾“å…¥192.168.221.132:8888<br>é¡µé¢æ‰“å¼€åéœ€è¦è¾“å…¥éªŒè¯ä¿¡æ¯ï¼ˆç¬¬ä¸€æ¬¡éªŒè¯å³å¯ï¼‰ï¼š<br>è¾“å…¥ä¸Šå›¾<code>token</code>åé¢çš„å­—ç¬¦ä¸²å’Œç”¨æˆ·å¯†ç <br><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fqbhup77mqj31fu0j0wu2.jpg" alt=""><br>è¾“å…¥<code>sc</code>æµ‹è¯•<br><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fqbhwgb3wdj310m0dowfj.jpg" alt=""></p><p>è‡³æ­¤ï¼Œaconda3-5.1.0ï¼ˆPython3.6.4ï¼‰ æ­å»ºpysparkè¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²æˆåŠŸã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;é¦–æ¬¡å®‰è£…çš„ç¯å¢ƒæ­é…æ˜¯è¿™æ ·çš„ï¼š&lt;br&gt; jdk8&lt;br&gt; hadoop2.6.5&lt;br&gt; spark2.1
      
    
    </summary>
    
      <category term="Hadoop" scheme="http://www.ihoge.cn/categories/Hadoop/"/>
    
    
      <category term="Environment" scheme="http://www.ihoge.cn/tags/Environment/"/>
    
  </entry>
  
  <entry>
    <title>Hiveé›†æˆSpark+Sql</title>
    <link href="http://www.ihoge.cn/2018/HiveSpark.html"/>
    <id>http://www.ihoge.cn/2018/HiveSpark.html</id>
    <published>2018-04-13T03:59:21.000Z</published>
    <updated>2018-04-13T08:18:16.776Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="ä¸€ã€Hiveå®‰è£…"><a href="#ä¸€ã€Hiveå®‰è£…" class="headerlink" title="ä¸€ã€Hiveå®‰è£…"></a>ä¸€ã€Hiveå®‰è£…</h2><h3 id="1-Hiveç®€ä»‹"><a href="#1-Hiveç®€ä»‹" class="headerlink" title="1.Hiveç®€ä»‹"></a>1.Hiveç®€ä»‹</h3><p>â€‹    Hiveæ˜¯Facebookå¼€å‘çš„æ„å»ºäºHadoopé›†ç¾¤ä¹‹ä¸Šçš„æ•°æ®ä»“åº“åº”ç”¨ï¼Œå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ æ•°æ®åº“è¡¨ï¼Œå¹¶æä¾›å®Œæ•´çš„SQLæŸ¥è¯¢åŠŸèƒ½ï¼Œå¯ä»¥å°†SQLè¯­å¥è½¬æ¢ä¸ºMapReduceä»»åŠ¡è¿›è¡Œè¿è¡Œã€‚</p><p>â€‹    Hiveæ˜¯ä¸€ä¸ªå¯ä»¥æä¾›æœ‰æ•ˆçš„ã€åˆç†çš„ä¸”ç›´è§‚çš„ç»„ç»‡å’Œä½¿ç”¨æ•°æ®çš„æ¨¡å‹ï¼Œå³ä½¿å¯¹äºç»éªŒä¸°å¯Œçš„Javaå¼€å‘å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œå°†è¿™äº›å¸¸è§çš„æ•°æ®è¿ç®—å¯¹åº”åˆ°åº•å±‚çš„MapReduce Java APIä¹Ÿæ˜¯ä»¤äººæ•¬ç•çš„ã€‚Hiveå¯ä»¥å¸®ç”¨æˆ·åšè¿™äº›å·¥ä½œï¼Œç”¨æˆ·å°±å¯ä»¥é›†ä¸­ç²¾åŠ›å…³æ³¨æŸ¥è¯¢æœ¬èº«äº†ã€‚Hiveå¯ä»¥å°†å¤§å¤šæ•°çš„æŸ¥è¯¢è½¬æ¢ä¸ºMapReduceä»»åŠ¡ã€‚Hiveæœ€é€‚åˆäºæ•°æ®ä»“åº“åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºè¿›è¡Œç›¸å…³çš„é™æ€æ•°æ®åˆ†æï¼Œä¸éœ€è¦å¿«é€Ÿå“åº”ç»™å‡ºç»“æœï¼Œè€Œä¸”æ•°æ®æœ¬èº«ä¹Ÿä¸ä¼šé¢‘ç¹å˜åŒ–ã€‚</p><p>â€‹    Hiveä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åº“ã€‚Hadoopä»¥åŠHDFSçš„è®¾è®¡æœ¬èº«çº¦æŸå’Œå±€é™æ€§é™åˆ¶äº†Hiveæ‰€èƒ½èƒœä»»çš„å·¥ä½œã€‚æœ€å¤§çš„é™åˆ¶å°±æ˜¯Hiveä¸æ”¯æŒè®°å½•çº§åˆ«çš„æ›´æ–°ã€æ’å…¥æˆ–è€…åˆ é™¤ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æŸ¥è¯¢ç”Ÿæˆæ–°è¡¨æˆ–å°†æŸ¥è¯¢ç»“æœå¯¼å…¥åˆ°æ–‡ä»¶ä¸­å»ã€‚å› ä¸ºï¼ŒHadoopæ˜¯ä¸€ä¸ªé¢å‘æ‰¹å¤„ç†çš„ç³»ç»Ÿï¼Œè€ŒMapReduceå¯åŠ¨ä»»åŠ¡å¯åŠ¨è¿‡ç¨‹éœ€è¦æ¶ˆè€—å¾ˆé•¿æ—¶é—´ï¼Œæ‰€ä»¥Hiveå»¶æ—¶ä¹Ÿæ¯”è¾ƒé•¿ã€‚Hiveè¿˜ä¸æ”¯æŒäº‹åŠ¡ã€‚å› æ­¤ï¼ŒHiveä¸æ”¯æŒè”æœºäº‹åŠ¡å¤„ç†ï¼ˆOLTPï¼‰ï¼Œæ›´æ¥è¿‘äºä¸€ä¸ªè”æœºåˆ†ææŠ€æœ¯ï¼ˆOLAPï¼‰å·¥å…·ï¼Œä½†æ˜¯ï¼Œç›®å‰è¿˜æ²¡æœ‰æ»¡è¶³â€œè”æœºâ€éƒ¨åˆ†ã€‚</p><p>â€‹    Hiveæä¾›äº†ä¸€ç³»åˆ—çš„å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œæ•°æ®æå–è½¬åŒ–åŠ è½½(ETL)ï¼Œå…¶ä¸­ï¼ŒETLæ˜¯ä¸€ç§å¯ä»¥å­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†æå­˜å‚¨åœ¨Hadoopä¸­çš„å¤§è§„æ¨¡æ•°æ®çš„æœºåˆ¶ã€‚å› æ­¤ï¼ŒHiveæ˜¯æœ€é€‚åˆæ•°æ®ä»“åº“åº”ç”¨ç¨‹åºçš„ï¼Œå®ƒå¯ä»¥ç»´æŠ¤æµ·é‡æ•°æ®ï¼Œè€Œä¸”å¯ä»¥å¯¹æ•°æ®è¿›è¡ŒæŒ–æ˜ï¼Œç„¶åå½¢æˆæ„è§å’ŒæŠ¥å‘Šç­‰ã€‚</p><p>â€‹    å› ä¸ºå¤§å¤šæ•°çš„æ•°æ®ä»“åº“åº”ç”¨ç¨‹åºæ˜¯åŸºäºSQLçš„å…³ç³»æ•°æ®åº“ç°å®çš„ï¼Œæ‰€ä»¥ï¼ŒHiveé™ä½äº†å°†è¿™äº›åº”ç”¨ç¨‹åºç§»æ¤åˆ°Hadoopä¸Šçš„éšœç¢ã€‚å¦‚æœç”¨æˆ·æ‡‚å¾—SQLï¼Œé‚£ä¹ˆå­¦ä¹ ä½¿ç”¨Hiveä¼šå¾ˆå®¹æ˜“ã€‚å› ä¸ºHiveå®šä¹‰äº†ç®€å•çš„ç±»SQL æŸ¥è¯¢è¯­è¨€â€”â€”HiveQLï¼Œè¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¸SQLServerã€Oracleç›¸æ¯”ï¼ŒHiveQLå’ŒMySQLæä¾›çš„SQLè¯­è¨€æ›´æ¥è¿‘ã€‚åŒæ ·çš„ï¼Œç›¸å¯¹äºå…¶ä»–çš„Hadoopè¯­è¨€å’Œå·¥å…·æ¥è¯´ï¼ŒHiveä¹Ÿä½¿å¾—å¼€å‘è€…å°†åŸºäºSQLçš„åº”ç”¨ç¨‹åºç§»æ¤åˆ°Hadoopå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p><h3 id="2-Hiveå®‰è£…"><a href="#2-Hiveå®‰è£…" class="headerlink" title="2.Hiveå®‰è£…"></a>2.Hiveå®‰è£…</h3><p>â€‹    æ¥ä¸‹æ¥ï¼Œå¼€å§‹Hiveçš„å®‰è£…ï¼Œå®‰è£…Hiveä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦è£…å¥½Hadoopå’ŒSparkã€‚åœ¨<strong><a href="https://hive.apache.org/" target="_blank" rel="noopener">Hiveå®˜ç½‘</a></strong>å¯ä¸‹è½½æœ€æ–°ç‰ˆæœ¬Hiveï¼Œå¹¶ä¸”èƒ½å¤ŸæŸ¥é˜…ç‰ˆæœ¬æ”¹åŠ¨è¯´æ˜ï¼Œæœ¬æ¬¡è¯¾ç¨‹é‡‡ç”¨1.2.2ç‰ˆæœ¬è¿›è¡Œå®‰è£…ã€‚å¯ä»¥é‡‡ç”¨WinSCPä¼ è¾“apache-hive-1.2.2-bin.tarè‡³è™šæ‹Ÿæœºâ€œä¸‹è½½â€æ–‡ä»¶å¤¹ä¸­ï¼Œå†è¿›è¡Œåç»­å®‰è£…ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd ~/ä¸‹è½½                                              # è¿›å…¥ä¸‹è½½æ–‡ä»¶å¤¹</span><br><span class="line">sudo tar -zxf apache-hive-1.2.2-bin.tar.gz -C /usr/local    # å®‰è£…è‡³/usr/localæ–‡ä»¶å¤¹å†…</span><br><span class="line">cd /usr/local                                         # è¿›å…¥/usr/localæ–‡ä»¶å¤¹</span><br><span class="line">sudo mv ./apache-hive-1.2.2-bin/ ./hive               # æ›´åä¸ºhive</span><br><span class="line">sudo chown -R hadoop ./hive                           # ä¿®æ”¹hiveæƒé™</span><br><span class="line">mkdir -p /usr/local/hive/warehouse                    # åˆ›å»ºå…ƒæ•°æ®å­˜å‚¨æ–‡ä»¶å¤¹</span><br><span class="line">sudo chmod a+rwx /usr/local/hive/warehouse            # ä¿®æ”¹æ–‡ä»¶æƒé™</span><br></pre></td></tr></table></figure><p>ç„¶åæ·»åŠ Hiveå®‰è£…è·¯å¾„è‡³ç³»ç»Ÿç¯å¢ƒå˜é‡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.profile</span><br></pre></td></tr></table></figure><p>æ·»åŠ ä¸‹è¿°è·¯å¾„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">Hive</span></span><br><span class="line">export HIVE_HOME=/usr/local/hive</span><br><span class="line">export PATH=$PATH:$HIVE_HOME/bin</span><br></pre></td></tr></table></figure><p>å¹¶ä½¿ä¹‹ç”Ÿæ•ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.profile</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹hiveè¯»å–sparkçš„jaråŒ…åœ°å€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/hive/bin</span><br><span class="line">vim hive</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸º</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add Spark assembly jar to the classpath</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="string">"<span class="variable">$SPARK_HOME</span>"</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  sparkAssemblyPath=`ls <span class="variable">$&#123;SPARK_HOME&#125;</span>/jars/*.jar`</span><br><span class="line">  CLASSPATH=<span class="string">"<span class="variable">$&#123;CLASSPATH&#125;</span>:<span class="variable">$&#123;sparkAssemblyPath&#125;</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>ç„¶åé‡‡ç”¨hiveé»˜è®¤é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/hive/conf</span><br><span class="line">cp hive-default.xml.template hive-default.xml</span><br></pre></td></tr></table></figure><p>å°è¯•å¯åŠ¨Hiveï¼Œæ­¤æ—¶å¯åŠ¨æ˜¯ä»¥æœ¬åœ°æ¨¡å¼è¿›è¡Œå¯åŠ¨ï¼Œèƒ½æ­£å¸¸å¯åŠ¨åˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start-all.sh</span><br><span class="line">hive</span><br></pre></td></tr></table></figure><p>â€‹    è‹¥å‡ºç°jlineç­‰jaråŒ…é”™è¯¯ï¼Œåˆ™éœ€è¦è¿›å…¥åˆ°hadoopå®‰è£…ç›®å½•ä¸‹çš„share/hadoop/yarn/libä¸‹åˆ é™¤jline-0.9.94.jaræ–‡ä»¶ï¼Œå†å¯åŠ¨hiveå³å¯ï¼ˆå› ä¸ºé«˜ç‰ˆæœ¬çš„Hadoopå¯¹Hiveæœ‰æ†ç»‘ï¼‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/hadoop/share/hadoop/yarn/lib</span><br><span class="line">rm -rf jline-0.9.94.jar</span><br></pre></td></tr></table></figure><p>###3. Hiveçš„åŸºæœ¬é…ç½®</p><p>â€‹    åœ¨å®‰è£…Hiveæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒæ•°æ®å­˜å‚¨åœ¨Derbyæ•°æ®åº“ä¸­ã€‚Derbyæ˜¯ä¸€ä¸ªå®Œå…¨ç”¨Javaç¼–å†™çš„æ•°æ®åº“ï¼Œæ‰€ä»¥å¯ä»¥è·¨å¹³å°ï¼Œä½†éœ€è¦åœ¨JVMä¸­è¿è¡Œ ã€‚å› ä¸ºå¤šç”¨æˆ·å’Œç³»ç»Ÿå¯èƒ½éœ€è¦å¹¶å‘è®¿é—®å…ƒæ•°æ®å­˜å‚¨ï¼Œæ‰€ä»¥é»˜è®¤çš„å†…ç½®æ•°æ®åº“å¹¶ä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ä»»ä½•ä¸€ä¸ªé€‚ç”¨äºJDBCè¿›è¡Œè¿æ¥çš„æ•°æ®åº“éƒ½å¯ç”¨ä½œå…ƒæ•°æ®åº“å­˜å‚¨ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠMySQLä½œä¸ºå­˜å‚¨å…ƒæ•°æ®çš„æ•°æ®åº“ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†åˆ«å¯¹è¿™ä¸¤ç§æ–¹å¼è¿›è¡Œä»‹ç»ï¼Œå³ä½¿ç”¨Derbyæ•°æ®åº“çš„æ–¹å¼å’Œä½¿ç”¨MySQLæ•°æ®åº“çš„æ–¹å¼ã€‚</p><h4 id="3-1-ä½¿ç”¨Derbyä½œä¸ºå…ƒæ•°æ®åº“"><a href="#3-1-ä½¿ç”¨Derbyä½œä¸ºå…ƒæ•°æ®åº“" class="headerlink" title="3.1 ä½¿ç”¨Derbyä½œä¸ºå…ƒæ•°æ®åº“"></a>3.1 ä½¿ç”¨Derbyä½œä¸ºå…ƒæ•°æ®åº“</h4><p>â€‹    æœ¬åœ°æ¨¡å¼ä¸­ï¼Œç”¨æˆ·çš„â€œè¡¨â€ç­‰å…ƒæ•°æ®ä¿¡æ¯ï¼Œéƒ½é»˜è®¤å­˜å‚¨åœ¨file://user/hive/warehouseï¼Œå¯¹äºå…¶ä»–æ¨¡å¼é»˜è®¤å­˜å‚¨è·¯å¾„æ˜¯hdfs://namenode_server/user/hive/warehouseã€‚ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç¼–è¾‘hive-site.xmlæ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/hive/conf/hive-site.xml</span><br></pre></td></tr></table></figure><p>åœ¨hive-site.xmlæ–‡ä»¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span><br><span class="line">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/hive/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>location of default database for the warehouse<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:derby:;databaseName=/usr/local/hive/metastore_db;create=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span>                           </span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹    è‹¥è¦ä»¥ä¼ªåˆ†å¸ƒå¼æ¨¡å¼å’Œåˆ†å¸ƒå¼æ¨¡å¼é…ç½®Hiveï¼Œåªéœ€æ ¹æ®Hadoopé…ç½®æ–‡ä»¶core-site.xmlä¸­fs.defaultFSçš„å€¼å¯¹hive.metastore.warehouse.dir è¿›è¡Œç›¸åº”ä¿®æ”¹å³å¯ã€‚é…ç½®å®Œæˆä¹‹åå³å¯å¯åŠ¨Hiveï¼Œç„¶åå°è¯•ä½¿ç”¨HiveQLå‘½ä»¤åˆ›å»ºè¡¨ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> derby;</span><br><span class="line"><span class="keyword">use</span> derby;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> x(a <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> x;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> x;</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure><h4 id="3-2-ä½¿ç”¨MySQLä½œä¸ºå…ƒæ•°æ®åº“"><a href="#3-2-ä½¿ç”¨MySQLä½œä¸ºå…ƒæ•°æ®åº“" class="headerlink" title="3.2 ä½¿ç”¨MySQLä½œä¸ºå…ƒæ•°æ®åº“"></a>3.2 ä½¿ç”¨MySQLä½œä¸ºå…ƒæ•°æ®åº“</h4><h5 id="3-2-1-å®‰è£…MySQL"><a href="#3-2-1-å®‰è£…MySQL" class="headerlink" title="3.2.1 å®‰è£…MySQL"></a>3.2.1 å®‰è£…MySQL</h5><p>é¦–å…ˆï¼ŒæŸ¥çœ‹å¹¶å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„MySQLç›¸å…³å®‰è£…åŒ…ï¼ˆæˆ–ä¹‹å‰å®‰è£…è¿‡MySQLï¼‰ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install rpm</span><br><span class="line">rpm -qa | grep mysql</span><br></pre></td></tr></table></figure><p>è‹¥æ²¡æœ‰å®‰è£…rpmå·¥å…·ï¼Œç³»ç»Ÿä¼šæœ‰æç¤ºï¼ŒæŒ‰ç…§æç¤ºå®‰è£…å³å¯ã€‚æ¥ä¸‹æ¥æŸ¥çœ‹æ˜¯å¦æœ‰ç³»ç»Ÿè‡ªå¸¦çš„MySQLç›¸å…³å®‰è£…åŒ…ï¼Œè‹¥æœ‰ï¼ŒæŒ‰ä¸‹é¢å‘½ä»¤åˆ é™¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -e --nodeps mysql-libs-xxxxxx</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šxxxxxæ˜¯å·²ç»å®‰è£…çš„mysqlçš„ç‰ˆæœ¬å·ï¼Œç„¶åè¿›è¡ŒMySQLçš„å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mysql-server</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œå¯åŠ¨è®¾ç½®MySQLæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo service mysql start</span><br><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿˜å¯ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤è¿›è¡Œé¢å¤–è®¾ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chkconfig mysql on                              # è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</span><br><span class="line">sudo /usr/bin/mysqladmin -u root password '123'      # è®¾ç½®rootç”¨æˆ·å¯†ç </span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºhiveç”¨æˆ·åŠå…¶æ•°æ®åº“ç­‰ï¼Œç”¨äºå­˜æ”¾Hiveçš„å…ƒæ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/mysql/my.cnf</span><br><span class="line">æ³¨é‡Šæ‰ï¼šbind-address            = 127.0.0.1</span><br><span class="line"></span><br><span class="line">create database hive;</span><br><span class="line">grant all on *.* to hive@localhost identified by &apos;hive&apos;; </span><br><span class="line">flush privileges;</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure><p>åˆ‡æ¢hiveç”¨æˆ·ç™»é™†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u hive -p hive</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure><p>è‹¥èƒ½çœ‹åˆ°hiveæ•°æ®åº“å­˜åœ¨ï¼Œåˆ™è¯´æ˜åˆ›å»ºæˆåŠŸã€‚</p><h5 id="3-2-2-ä¿®æ”¹Hiveé…ç½®"><a href="#3-2-2-ä¿®æ”¹Hiveé…ç½®" class="headerlink" title="3.2.2 ä¿®æ”¹Hiveé…ç½®"></a>3.2.2 ä¿®æ”¹Hiveé…ç½®</h5><p>æ¥ä¸‹æ¥ï¼Œä¿®æ”¹hive-site.xmlæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/hive/conf/hive-site.xml</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä¸‹åˆ—ä¿¡æ¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span><br><span class="line">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>username to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>password to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…æŒ‡å®šå…ƒæ•°æ®æ–‡ä»¶å¤¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span><br><span class="line">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/hive/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>location of default database for the warehouse<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://localhost:3306/hive;createDatebaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span>                           </span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword <span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Username to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°†JDBCæ–‡ä»¶æ”¾åˆ°hiveçš„libæ–‡ä»¶å¤¹å†…ï¼ŒJDBCåŒ…çš„ä¸‹è½½å‚è€ƒå‰è¿°éƒ¨åˆ†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ~/ä¸‹è½½</span><br><span class="line">cp mysql-connector-java-5.1.26-bin.jar /usr/local/hive/lib</span><br><span class="line">mkdir -p /usr/local/hive/tmp</span><br><span class="line">sudo chmod a+rwx /usr/local/hive/tmp</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»å®˜ç½‘ç›´æ¥ä¸‹è½½æœ€æ–°ç‰ˆjdbc</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.45.tar.gz</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œè§£å‹å®‰è£…ã€‚å½“ç„¶ï¼Œå¦‚æœä¹‹å‰åˆ é™¤äº†jline-0.9.94.jarï¼Œæ­¤æ—¶éœ€è¦æŠŠhiveå¯¹åº”çš„jaråŒ…æ”¾è¿›å»</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/hive/lib/jline-2.12.jar  /usr/local/hadoop/share/hadoop/yarn/lib</span><br></pre></td></tr></table></figure><p>ç„¶åå°è¯•å¯åŠ¨hive</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schematool -dbType mysql -initSchema</span><br><span class="line">start-all.sh</span><br><span class="line">hive</span><br></pre></td></tr></table></figure><p>æˆå¯åŠ¨åï¼Œå³å¯è¾“å…¥hive â€“helpæŸ¥çœ‹hiveå¸¸ç”¨å‘½ä»¤ã€‚</p><h2 id="äºŒã€Hiveä½¿ç”¨"><a href="#äºŒã€Hiveä½¿ç”¨" class="headerlink" title="äºŒã€Hiveä½¿ç”¨"></a>äºŒã€Hiveä½¿ç”¨</h2><h3 id="1-HiveåŸºæœ¬æ•°æ®ç±»å‹"><a href="#1-HiveåŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="1.HiveåŸºæœ¬æ•°æ®ç±»å‹"></a>1.HiveåŸºæœ¬æ•°æ®ç±»å‹</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç®€å•å™è¿°ä¸€ä¸‹HiveQLçš„åŸºæœ¬æ•°æ®ç±»å‹ã€‚</p><p>Hiveæ”¯æŒåŸºæœ¬æ•°æ®ç±»å‹å’Œå¤æ‚ç±»å‹, åŸºæœ¬æ•°æ®ç±»å‹ä¸»è¦æœ‰æ•°å€¼ç±»å‹(INTã€FLOATã€DOUBLE ) ã€å¸ƒå°”å‹å’Œå­—ç¬¦ä¸², å¤æ‚ç±»å‹æœ‰ä¸‰ç§:ARRAYã€MAP å’Œ STRUCTã€‚</p><h4 id="1-1-åŸºæœ¬æ•°æ®ç±»å‹"><a href="#1-1-åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="1.1 åŸºæœ¬æ•°æ®ç±»å‹"></a>1.1 åŸºæœ¬æ•°æ®ç±»å‹</h4><ul><li>TINYINT: 1ä¸ªå­—èŠ‚</li><li>SMALLINT: 2ä¸ªå­—èŠ‚</li><li>INT: 4ä¸ªå­—èŠ‚</li><li>BIGINT: 8ä¸ªå­—èŠ‚</li><li>BOOLEAN: TRUE/FALSE </li><li>FLOAT: 4ä¸ªå­—èŠ‚ï¼Œå•ç²¾åº¦æµ®ç‚¹å‹</li><li>DOUBLE: 8ä¸ªå­—èŠ‚ï¼ŒåŒç²¾åº¦æµ®ç‚¹å‹STRING å­—ç¬¦ä¸²</li></ul><h4 id="1-2-å¤æ‚æ•°æ®ç±»å‹"><a href="#1-2-å¤æ‚æ•°æ®ç±»å‹" class="headerlink" title="1. 2 å¤æ‚æ•°æ®ç±»å‹"></a>1. 2 å¤æ‚æ•°æ®ç±»å‹</h4><ul><li>ARRAY: æœ‰åºå­—æ®µ</li><li>MAP: æ— åºå­—æ®µ</li><li>STRUCT: ä¸€ç»„å‘½åçš„å­—æ®µ</li></ul><h3 id="2-å¸¸ç”¨çš„HiveQLæ“ä½œå‘½ä»¤"><a href="#2-å¸¸ç”¨çš„HiveQLæ“ä½œå‘½ä»¤" class="headerlink" title="2.å¸¸ç”¨çš„HiveQLæ“ä½œå‘½ä»¤"></a>2.å¸¸ç”¨çš„HiveQLæ“ä½œå‘½ä»¤</h3><p>â€‹    Hiveå¸¸ç”¨çš„HiveQLæ“ä½œå‘½ä»¤ä¸»è¦åŒ…æ‹¬ï¼šæ•°æ®å®šä¹‰ã€æ•°æ®æ“ä½œã€‚æ¥ä¸‹æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™äº›å‘½ä»¤å³ç”¨æ³•ï¼ˆæƒ³è¦äº†è§£æ›´å¤šè¯·å‚ç…§ã€ŠHiveç¼–ç¨‹æŒ‡å—ã€‹ä¸€ä¹¦ï¼‰ã€‚</p><h4 id="2-1-æ•°æ®å®šä¹‰"><a href="#2-1-æ•°æ®å®šä¹‰" class="headerlink" title="2.1 æ•°æ®å®šä¹‰"></a>2.1 æ•°æ®å®šä¹‰</h4><p>ä¸»è¦ç”¨äºåˆ›å»ºä¿®æ”¹å’Œåˆ é™¤æ•°æ®åº“ã€è¡¨ã€è§†å›¾ã€å‡½æ•°å’Œç´¢å¼•ã€‚</p><ul><li><p>åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®åº“</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create database if not exists hive;       #åˆ›å»ºæ•°æ®åº“</span><br><span class="line">show databases;                           #æŸ¥çœ‹Hiveä¸­åŒ…å«æ•°æ®åº“</span><br><span class="line">show databases like 'h.*';                #æŸ¥çœ‹Hiveä¸­ä»¥hå¼€å¤´æ•°æ®åº“</span><br><span class="line">describe databases;                       #æŸ¥çœ‹hiveæ•°æ®åº“ä½ç½®ç­‰ä¿¡æ¯</span><br><span class="line">alter database hive set dbproperties;     #ä¸ºhiveè®¾ç½®é”®å€¼å¯¹å±æ€§</span><br><span class="line">use hive;                                 #åˆ‡æ¢åˆ°hiveæ•°æ®åº“ä¸‹</span><br><span class="line">drop database if exists hive;             #åˆ é™¤ä¸å«è¡¨çš„æ•°æ®åº“</span><br><span class="line">drop database if exists hive cascade;     #åˆ é™¤æ•°æ®åº“å’Œå®ƒä¸­çš„è¡¨</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œé™¤ dbpropertieså±æ€§å¤–ï¼Œæ•°æ®åº“çš„å…ƒæ•°æ®ä¿¡æ¯éƒ½æ˜¯ä¸å¯æ›´æ”¹çš„ï¼ŒåŒ…æ‹¬æ•°æ®åº“åå’Œæ•°æ®åº“æ‰€åœ¨çš„ç›®å½•ä½ç½®ï¼Œæ²¡æœ‰åŠæ³•åˆ é™¤æˆ–é‡ç½®æ•°æ®åº“å±æ€§ã€‚</p></li><li><p>åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤è¡¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºå†…éƒ¨è¡¨ï¼ˆç®¡ç†è¡¨ï¼‰</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> hive.usr(</span><br><span class="line">      <span class="keyword">name</span> <span class="keyword">string</span> <span class="keyword">comment</span> <span class="string">'username'</span>,</span><br><span class="line">      pwd <span class="keyword">string</span> <span class="keyword">comment</span> <span class="string">'password'</span>,</span><br><span class="line">      address <span class="keyword">struct</span>&lt;street:<span class="keyword">string</span>,city:<span class="keyword">string</span>,state:<span class="keyword">string</span>,zip:<span class="built_in">int</span>&gt;,</span><br><span class="line">      <span class="keyword">comment</span>  <span class="string">'home address'</span>,</span><br><span class="line">      identify <span class="keyword">map</span>&lt;<span class="built_in">int</span>,tinyint&gt; <span class="keyword">comment</span> <span class="string">'number,sex'</span>) </span><br><span class="line">      <span class="keyword">comment</span> <span class="string">'description of the table'</span>  </span><br><span class="line">     tblproperties(<span class="string">'creator'</span>=<span class="string">'me'</span>,<span class="string">'time'</span>=<span class="string">'2016.1.1'</span>); </span><br><span class="line">#åˆ›å»ºå¤–éƒ¨è¡¨</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> usr2(</span><br><span class="line">      <span class="keyword">name</span> <span class="keyword">string</span>,</span><br><span class="line">      pwd <span class="keyword">string</span>,</span><br><span class="line">  address <span class="keyword">struct</span>&lt;street:<span class="keyword">string</span>,city:<span class="keyword">string</span>,state:<span class="keyword">string</span>,zip:<span class="built_in">int</span>&gt;,</span><br><span class="line">      identify <span class="keyword">map</span>&lt;<span class="built_in">int</span>,tinyint&gt;) </span><br><span class="line">      <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">     location <span class="string">'/usr/local/hive/warehouse/hive.db/usr'</span>; </span><br><span class="line">#åˆ›å»ºåˆ†åŒºè¡¨</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> usr3(</span><br><span class="line">      <span class="keyword">name</span> <span class="keyword">string</span>,</span><br><span class="line">      pwd <span class="keyword">string</span>,</span><br><span class="line">      address <span class="keyword">struct</span>&lt;street:<span class="keyword">string</span>,city:<span class="keyword">string</span>,state:<span class="keyword">string</span>,zip:<span class="built_in">int</span>&gt;,</span><br><span class="line">      identify <span class="keyword">map</span>&lt;<span class="built_in">int</span>,tinyint&gt;) </span><br><span class="line">      partitioned <span class="keyword">by</span>(city <span class="keyword">string</span>,state <span class="keyword">string</span>);    </span><br><span class="line">#å¤åˆ¶usrè¡¨çš„è¡¨æ¨¡å¼  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> hive.usr1 <span class="keyword">like</span> hive.usr;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span> <span class="keyword">in</span> hive;  </span><br><span class="line">show tables 'u.*';        #æŸ¥çœ‹hiveä¸­ä»¥uå¼€å¤´çš„è¡¨</span><br><span class="line">describe hive.usr;        #æŸ¥çœ‹usrè¡¨ç›¸å…³ä¿¡æ¯</span><br><span class="line">alter table usr rename to custom;      #é‡å‘½åè¡¨ </span><br><span class="line">#ä¸ºè¡¨å¢åŠ ä¸€ä¸ªåˆ†åŒº</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> usr2 <span class="keyword">add</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> </span><br><span class="line">     <span class="keyword">partition</span>(city=â€beijingâ€,state=â€Chinaâ€) </span><br><span class="line">     location <span class="string">'/usr/local/hive/warehouse/usr2/China/beijing'</span>; </span><br><span class="line">#ä¿®æ”¹åˆ†åŒºè·¯å¾„</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> usr2 <span class="keyword">partition</span>(city=â€beijingâ€,state=â€Chinaâ€)</span><br><span class="line">     <span class="keyword">set</span> location <span class="string">'/usr/local/hive/warehouse/usr2/CH/beijing'</span>;</span><br><span class="line">#åˆ é™¤åˆ†åŒº</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> usr2 <span class="keyword">drop</span> <span class="keyword">if</span> <span class="keyword">exists</span>  <span class="keyword">partition</span>(city=â€beijingâ€,state=â€Chinaâ€)</span><br><span class="line">#ä¿®æ”¹åˆ—ä¿¡æ¯</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> usr <span class="keyword">change</span> <span class="keyword">column</span> pwd <span class="keyword">password</span> <span class="keyword">string</span> <span class="keyword">after</span> address;</span><br><span class="line">alter table usr add columns(hobby string);                  #å¢åŠ åˆ—</span><br><span class="line">alter table usr replace columns(uname string);              #åˆ é™¤æ›¿æ¢åˆ—</span><br><span class="line">alter table usr set tblproperties('creator'='liming');      #ä¿®æ”¹è¡¨å±æ€§</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> usr2 <span class="keyword">partition</span>(city=â€beijingâ€,state=â€Chinaâ€)    #ä¿®æ”¹å­˜å‚¨å±æ€§</span><br><span class="line"><span class="keyword">set</span> fileformat sequencefile;             </span><br><span class="line">use hive;                                                   #åˆ‡æ¢åˆ°hiveæ•°æ®åº“ä¸‹</span><br><span class="line">drop table if exists usr1;                                  #åˆ é™¤è¡¨</span><br><span class="line">drop database if exists hive cascade;                       #åˆ é™¤æ•°æ®åº“å’Œå®ƒä¸­çš„è¡¨</span><br></pre></td></tr></table></figure></li><li><p>è§†å›¾å’Œç´¢å¼•çš„åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤</p><p>åŸºæœ¬è¯­æ³•æ ¼å¼</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create view view_name as....;                #åˆ›å»ºè§†å›¾</span><br><span class="line">alter view view_name set tblproperties(â€¦);   #ä¿®æ”¹è§†å›¾</span><br></pre></td></tr></table></figure><p>å› ä¸ºè§†å›¾æ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥ å¯¹äºè§†å›¾åªå…è®¸æ”¹å˜å…ƒæ•°æ®ä¸­çš„ tblpropertieså±æ€§ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#åˆ é™¤è§†å›¾</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> <span class="keyword">if</span> <span class="keyword">exists</span> view_name;</span><br><span class="line">#åˆ›å»ºç´¢å¼•</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> index_name <span class="keyword">on</span> <span class="keyword">table</span> table_name(partition_name/column_name)  </span><br><span class="line"><span class="keyword">as</span> <span class="string">'org.apache.hadoop.hive.ql.index.compact.CompactIndexHandler'</span> <span class="keyword">with</span> <span class="keyword">deferred</span> rebuild....;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œâ€™org.apache.hadoop.hive.ql.index.compact.CompactIndexHandlerâ€™æ˜¯ä¸€ä¸ªç´¢å¼•å¤„ç†å™¨ï¼Œå³ä¸€ä¸ªå®ç°äº†ç´¢å¼•æ¥å£çš„Javaç±»ï¼Œå¦å¤–Hiveè¿˜æœ‰å…¶ä»–çš„ç´¢å¼•å®ç°ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter index index_name on table table_name partition(...)  rebulid;   #é‡å»ºç´¢å¼•</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ deferred rebuildï¼Œé‚£ä¹ˆæ–°ç´¢å¼•æˆç©ºç™½çŠ¶æ€ï¼Œä»»ä½•æ—¶å€™å¯ä»¥è¿›è¡Œç¬¬ä¸€æ¬¡ç´¢å¼•åˆ›å»ºæˆ–é‡å»ºã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show formatted index on table_name;                       #æ˜¾ç¤ºç´¢å¼•</span><br><span class="line">drop index if exists index_name on table table_name;      #åˆ é™¤ç´¢å¼•</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-2-æ•°æ®æ“ä½œ"><a href="#2-2-æ•°æ®æ“ä½œ" class="headerlink" title="2.2 æ•°æ®æ“ä½œ"></a>2.2 æ•°æ®æ“ä½œ</h4><p>ä¸»è¦å®ç°çš„æ˜¯å°†æ•°æ®è£…è½½åˆ°è¡¨ä¸­ï¼ˆæˆ–æ˜¯ä»è¡¨ä¸­å¯¼å‡ºï¼‰ï¼Œå¹¶è¿›è¡Œç›¸åº”æŸ¥è¯¢æ“ä½œ</p><ul><li><p>å‘è¡¨ä¸­è£…è½½æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> hive.stu(<span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="keyword">string</span>) </span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\t'</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> hive.course(cid <span class="built_in">int</span>,<span class="keyword">sid</span> <span class="built_in">int</span>) </span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\t'</span>;</span><br></pre></td></tr></table></figure><p>å‘è¡¨ä¸­è£…è½½æ•°æ®æœ‰ä¸¤ç§æ–¹æ³•ï¼šä»æ–‡ä»¶ä¸­å¯¼å…¥å’Œé€šè¿‡æŸ¥è¯¢è¯­å¥æ’å…¥ã€‚</p><ul><li><p>ä»æ–‡ä»¶ä¸­å¯¼å…¥</p><p>å‡å¦‚è¿™ä¸ªè¡¨ä¸­çš„è®°å½•å­˜å‚¨äºæ–‡ä»¶stu.txtä¸­ï¼Œè¯¥æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ä¸ºusr/local/hadoop/examples/stu.txtï¼Œå†…å®¹å¦‚ä¸‹ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 Hello</span><br><span class="line">2 World</span><br><span class="line">3 CDA</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/usr/local/hadoop/examples/stu.txt'</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> stu;</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡æŸ¥è¯¢è¯­å¥æ’å…¥</p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºstu1è¡¨ï¼Œå®ƒå’Œstuè¡¨å±æ€§ç›¸åŒï¼Œæˆ‘ä»¬è¦æŠŠä»stuè¡¨ä¸­æŸ¥è¯¢å¾—åˆ°çš„æ•°æ®æ’å…¥åˆ°stu1ä¸­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu1 <span class="keyword">as</span> <span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> stu;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯åˆ›å»ºè¡¨ï¼Œå¹¶ç›´æ¥å‘æ–°è¡¨æ’å…¥æ•°æ®ï¼›è‹¥è¡¨å·²ç»å­˜åœ¨ï¼Œå‘è¡¨ä¸­æ’å…¥æ•°æ®éœ€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> stu1 <span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> stu <span class="keyword">where</span>ï¼ˆæ¡ä»¶ï¼‰;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…³é”®å­—overwriteçš„ä½œç”¨æ˜¯æ›¿æ¢æ‰è¡¨ï¼ˆæˆ–åˆ†åŒºï¼‰ä¸­åŸæœ‰æ•°æ®ï¼Œæ¢æˆintoå…³é”®å­—ï¼Œç›´æ¥è¿½åŠ åˆ°åŸæœ‰å†…å®¹åã€‚</p></li></ul></li><li><p>å†™å…¥ä¸´æ—¶æ–‡ä»¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> <span class="keyword">directory</span> <span class="string">'/usr/local/hadoop/tmp/stu'</span>  <span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> stu;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢æ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,</span><br><span class="line">  <span class="keyword">case</span> </span><br><span class="line">  <span class="keyword">when</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">then</span> <span class="string">'first'</span> </span><br><span class="line">  <span class="keyword">when</span> <span class="keyword">id</span>=<span class="number">2</span> <span class="keyword">then</span> <span class="string">'second'</span></span><br><span class="line">  <span class="keyword">else</span> <span class="string">'third'</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="2-3-è¿æ¥"><a href="#2-3-è¿æ¥" class="headerlink" title="2.3 è¿æ¥"></a>2.3 è¿æ¥</h4><p>â€‹    è¿æ¥ï¼ˆjoinï¼‰æ˜¯å°†ä¸¤ä¸ªè¡¨ä¸­åœ¨å…±åŒæ•°æ®é¡¹ä¸Šç›¸äº’åŒ¹é…çš„é‚£äº›è¡Œåˆå¹¶èµ·æ¥, HiveQL çš„è¿æ¥åˆ†ä¸ºå†…è¿æ¥ã€å·¦å‘å¤–è¿æ¥ã€å³å‘å¤–è¿æ¥ã€å…¨å¤–è¿æ¥å’ŒåŠè¿æ¥ 5 ç§ã€‚</p><ul><li><p>å†…è¿æ¥(ç­‰å€¼è¿æ¥)</p><p>å†…è¿æ¥ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦æ ¹æ®æ¯ä¸ªè¡¨å…±æœ‰çš„åˆ—çš„å€¼åŒ¹é…ä¸¤ä¸ªè¡¨ä¸­çš„è¡Œã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæŠŠä»¥ä¸‹å†…å®¹æ’å…¥åˆ°courseè¡¨ä¸­ï¼ˆè‡ªè¡Œå®Œæˆï¼‰ã€‚</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 3</span><br><span class="line">2 1</span><br><span class="line">3 1</span><br></pre></td></tr></table></figure><p>â€‹    ä¸‹é¢, æŸ¥è¯¢stuå’Œcourseè¡¨ä¸­å­¦å·ç›¸åŒçš„æ‰€æœ‰è¡Œï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> stu.*, course.* <span class="keyword">from</span> stu <span class="keyword">join</span> course <span class="keyword">on</span>(stu .id=course .sid);</span><br></pre></td></tr></table></figure><ul><li><p>å·¦è¿æ¥</p><p>â€‹    å·¦è¿æ¥çš„ç»“æœé›†åŒ…æ‹¬â€œLEFT OUTERâ€å­å¥ä¸­æŒ‡å®šçš„å·¦è¡¨çš„æ‰€æœ‰è¡Œ, è€Œä¸ä»…ä»…æ˜¯è¿æ¥åˆ—æ‰€åŒ¹é…çš„è¡Œã€‚å¦‚æœå·¦è¡¨çš„æŸè¡Œåœ¨å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…è¡Œ, åˆ™åœ¨ç›¸å…³è”çš„ç»“æœé›†ä¸­å³è¡¨çš„æ‰€æœ‰é€‰æ‹©åˆ—å‡ä¸ºç©ºå€¼ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> stu.*, course.* <span class="keyword">from</span> stu <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> course <span class="keyword">on</span>(stu .id=course .sid);</span><br></pre></td></tr></table></figure><ul><li><p>å³è¿æ¥</p><p>â€‹    å³è¿æ¥æ˜¯å·¦å‘å¤–è¿æ¥çš„åå‘è¿æ¥,å°†è¿”å›å³è¡¨çš„æ‰€æœ‰è¡Œã€‚å¦‚æœå³è¡¨çš„æŸè¡Œåœ¨å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…è¡Œ,åˆ™å°†ä¸ºå·¦è¡¨è¿”å›ç©ºå€¼ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> stu.*, course.* <span class="keyword">from</span> stu <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> course <span class="keyword">on</span>(stu .id=course .sid);</span><br></pre></td></tr></table></figure><ul><li><p>å…¨è¿æ¥</p><p>â€‹    å…¨è¿æ¥è¿”å›å·¦è¡¨å’Œå³è¡¨ä¸­çš„æ‰€æœ‰è¡Œã€‚å½“æŸè¡Œåœ¨å¦ä¸€è¡¨ä¸­æ²¡æœ‰åŒ¹é…è¡Œæ—¶,åˆ™å¦ä¸€ä¸ªè¡¨çš„é€‰æ‹©åˆ—è¡¨åŒ…å«ç©ºå€¼ã€‚å¦‚æœè¡¨ä¹‹é—´æœ‰åŒ¹é…è¡Œ,åˆ™æ•´ä¸ªç»“æœé›†åŒ…å«åŸºè¡¨çš„æ•°æ®å€¼ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> stu.*, course.* <span class="keyword">from</span> stu <span class="keyword">full</span> <span class="keyword">outer</span> <span class="keyword">join</span> course <span class="keyword">on</span>(stu .id=course .sid);</span><br></pre></td></tr></table></figure><ul><li><p>åŠè¿æ¥</p><p>â€‹    åŠè¿æ¥æ˜¯ Hive æ‰€ç‰¹æœ‰çš„, Hive ä¸æ”¯æŒ in æ“ä½œ,ä½†æ˜¯æ‹¥æœ‰æ›¿ä»£çš„æ–¹æ¡ˆ; left semi join, ç§°ä¸ºåŠè¿æ¥, éœ€è¦æ³¨æ„çš„æ˜¯è¿æ¥çš„è¡¨ä¸èƒ½åœ¨æŸ¥è¯¢çš„åˆ—ä¸­,åªèƒ½å‡ºç°åœ¨ on å­å¥ä¸­ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> stu.* <span class="keyword">from</span> stu <span class="keyword">left</span> semi <span class="keyword">join</span> course <span class="keyword">on</span>(stu .id=course .sid);</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€Sparkä¸Hiveé›†æˆ"><a href="#ä¸‰ã€Sparkä¸Hiveé›†æˆ" class="headerlink" title="ä¸‰ã€Sparkä¸Hiveé›†æˆ"></a>ä¸‰ã€Sparkä¸Hiveé›†æˆ</h2><h3 id="1-å®‰è£…Spark"><a href="#1-å®‰è£…Spark" class="headerlink" title="1.å®‰è£…Spark"></a>1.å®‰è£…Spark</h3><p>â€‹    ä¸ºäº†è®©Sparkèƒ½å¤Ÿè®¿é—®Hiveï¼Œå¿…é¡»ä¸ºSparkæ·»åŠ Hiveæ”¯æŒã€‚Sparkå®˜æ–¹æä¾›çš„é¢„ç¼–è¯‘ç‰ˆæœ¬ï¼Œé€šå¸¸æ˜¯ä¸åŒ…å«Hiveæ”¯æŒçš„ï¼Œéœ€è¦é‡‡ç”¨æºç ç¼–è¯‘ï¼Œç¼–è¯‘å¾—åˆ°ä¸€ä¸ªåŒ…å«Hiveæ”¯æŒçš„Sparkç‰ˆæœ¬ã€‚é¦–å…ˆæµ‹è¯•ä¸€ä¸‹ç”µè„‘ä¸Šå·²ç»å®‰è£…çš„Sparkç‰ˆæœ¬æ˜¯å¦æ”¯æŒHive</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-shell</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯åŠ¨è¿›å…¥äº†spark-shellï¼Œç„¶åè¾“å…¥ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.hive.<span class="type">HiveContext</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæŠ¥é”™ï¼Œåˆ™è¯´æ˜sparkæ— æ³•è¯†åˆ«org.apache.spark.sql.hive.HiveContextï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦é‡‡ç”¨æºç ç¼–è¯‘æ–¹æ³•å¾—åˆ°æ”¯æŒhiveçš„sparkç‰ˆæœ¬ã€‚</p><ul><li><p>ä¸‹è½½æºç æ–‡ä»¶</p><p>â€‹    è¿›å…¥å®˜ç½‘åï¼Œå¯ä»¥æŒ‰ç…§ä¸‹å›¾é…ç½®é€‰æ‹©â€œ2.1.0(Dec 28, 2016)â€å’Œâ€œSourceCodeâ€ï¼Œç„¶åï¼Œåœ¨å›¾ä¸­çº¢è‰²æ–¹æ¡†å†…ï¼Œæœ‰ä¸ªâ€œDownload Spark: spark-2.1.0.tgzâ€çš„ä¸‹è½½é“¾æ¥ï¼Œç‚¹å‡»è¯¥é“¾æ¥å°±å¯ä»¥ä¸‹è½½Sparkæºç æ–‡ä»¶äº†ã€‚</p></li></ul><ul><li><p>ç¼–è¯‘è¿‡ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/hadoop/spark-2.0.2</span><br><span class="line">./dev/make-distribution.sh â€”tgz â€”name h27hive -Pyarn -Phadoop-2.7 -Dhadoop.version=2.7.1 -Phive -Phive-thriftserver -DskipTests</span><br></pre></td></tr></table></figure><p>æˆ–å¯é€‰æ‹©ç›´æ¥å®‰è£…å·²ç¼–è¯‘å¥½çš„ç‰ˆæœ¬ï¼ŒæŠŠä¸‹å¥½çš„<code>spark-2.0.2-bin-h27hive.tgz</code>æ”¾åˆ°ä¸‹è½½æ–‡ä»¶å¤¹å†…</p></li><li><p>Sparkè§£å‹å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd ~/ä¸‹è½½                                              # è¿›å…¥ä¸‹è½½æ–‡ä»¶å¤¹</span><br><span class="line">sudo tar -zxf spark-2.0.2-bin-h27hive.tgz -C /usr/local   # å®‰è£…è‡³/usr/localæ–‡ä»¶å¤¹å†…</span><br><span class="line">cd /usr/local                                         # è¿›å…¥/usr/localæ–‡ä»¶å¤¹</span><br><span class="line">sudo mv ./spark-1.4.0-bin-hadoop2.4/ ./spark          # æ›´åä¸ºspark</span><br><span class="line">sudo chown -R hadoop ./spark                          # ä¿®æ”¹sqoopæƒé™</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ ç¯å¢ƒå˜é‡</p><p>æ³¨ï¼Œå¦‚æœç”µè„‘ä¸Šå·²ç»è£…äº†å¦ä¸€ä¸ªsparkï¼Œæ­¤å¤„å¯ä¸å¢è®¾ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.profile</span><br></pre></td></tr></table></figure><p>æ·»åŠ sparkå®‰è£…è·¯å¾„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">spark</span></span><br><span class="line">export SPARK_HOME=/usr/local/spark</span><br><span class="line">export PATH=$PATH:$SPARK_HOME/bin</span><br></pre></td></tr></table></figure><p>å¹¶ä¿å­˜ä¿®æ”¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.profile</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹Sparké…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/spark/conf                              # è¿›å…¥sparké…ç½®æ–‡ä»¶å¤¹</span><br><span class="line">sudo cp spark-env.sh.template spark-env.sh            # å¤åˆ¶spark-envä¸´æ—¶æ–‡ä»¶ä¸ºé…ç½®æ–‡ä»¶</span><br><span class="line">vim spark-env.sh                                      # ç¼–è¾‘sparké…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>æ·»åŠ ä¸‹è¿°é…ç½®ä¿¡æ¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> SPARK_DIST_CLASSPATH=$(/usr/<span class="built_in">local</span>/hadoop/bin/hadoop classpath)</span><br></pre></td></tr></table></figure><p>æœ‰äº†ä¸Šé¢çš„é…ç½®ä¿¡æ¯ä»¥åï¼ŒSparkå°±å¯ä»¥æŠŠæ•°æ®å­˜å‚¨åˆ°Hadoopåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸHDFSä¸­ï¼Œä¹Ÿå¯ä»¥ä»HDFSä¸­è¯»å–æ•°æ®ã€‚å¦‚æœæ²¡æœ‰é…ç½®ä¸Šé¢ä¿¡æ¯ï¼ŒSparkå°±åªèƒ½è¯»å†™æœ¬åœ°æ•°æ®ï¼Œæ— æ³•è¯»å†™HDFSæ•°æ®ã€‚åœ¨ä¼ªåˆ†å¸ƒå¼æ¨¡å¼ä¸‹ä»…æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸæ—¶ï¼Œå…¶ä»–é…ç½®æš‚æ—¶å¯ä¸åšä¿®æ”¹ã€‚</p></li><li><p>è¿è¡Œæ ·ä¾‹ç¨‹åº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/spark</span><br><span class="line">bin/run-example SparkPi 2&gt;&amp;1 | grep "Pi is"</span><br></pre></td></tr></table></figure></li><li><p>æ”¾ç½®Hiveé…ç½®æ–‡ä»¶</p><p>ä¸ºäº†è®©Sparkèƒ½å¤Ÿè®¿é—®Hiveï¼Œéœ€è¦æŠŠHiveçš„é…ç½®æ–‡ä»¶hive-site.xmlæ‹·è´åˆ°Sparkçš„confç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/spark/conf</span><br><span class="line">cp /usr/local/hive/conf/hive-site.xml .</span><br><span class="line">ll</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•æ˜¯å¦é›†æˆæˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-shell</span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.hive.<span class="type">HiveContext</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-åœ¨Hiveä¸­åˆ›å»ºæ•°æ®åº“å’Œè¡¨"><a href="#2-åœ¨Hiveä¸­åˆ›å»ºæ•°æ®åº“å’Œè¡¨" class="headerlink" title="2.åœ¨Hiveä¸­åˆ›å»ºæ•°æ®åº“å’Œè¡¨"></a>2.åœ¨Hiveä¸­åˆ›å»ºæ•°æ®åº“å’Œè¡¨</h3><p>é¦–å…ˆå¯åŠ¨MySQLæ•°æ®åº“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql start</span><br></pre></td></tr></table></figure><p>â€‹    ç”±äºHiveæ˜¯åŸºäºHadoopçš„æ•°æ®ä»“åº“ï¼Œä½¿ç”¨HiveQLè¯­è¨€æ’°å†™çš„æŸ¥è¯¢è¯­å¥ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«Hiveè‡ªåŠ¨è§£ææˆMapReduceä»»åŠ¡ç”±Hadoopå»å…·ä½“æ‰§è¡Œï¼Œå› æ­¤ï¼Œéœ€è¦å¯åŠ¨Hadoopï¼Œç„¶åå†å¯åŠ¨Hiveã€‚<br>ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨Hadoopï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-all.sh</span><br></pre></td></tr></table></figure><p>Hadoopå¯åŠ¨æˆåŠŸä»¥åï¼Œå¯ä»¥å†å¯åŠ¨Hiveï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨hiveå‘½ä»¤æç¤ºç¬¦å†…è¿›è¡Œæ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> sparktest;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line"> <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> sparktest.student(</span><br><span class="line">&gt; <span class="keyword">id</span> <span class="built_in">int</span>,</span><br><span class="line">&gt; <span class="keyword">name</span> <span class="keyword">string</span>,</span><br><span class="line">&gt; gender <span class="keyword">string</span>,</span><br><span class="line">&gt; age <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">use</span> sparktest;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'Xueqian'</span>,<span class="string">'F'</span>,<span class="number">23</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">'Weiliang'</span>,<span class="string">'M'</span>,<span class="number">24</span>);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢æ“ä½œï¼Œæˆ‘ä»¬å°±åœ¨Hiveä¸­åˆ›å»ºäº†sparktest.studentè¡¨ï¼Œè¿™ä¸ªè¡¨æœ‰ä¸¤æ¡æ•°æ®ã€‚</p><h3 id="3-è¿æ¥Hiveè¯»å†™æ•°æ®"><a href="#3-è¿æ¥Hiveè¯»å†™æ•°æ®" class="headerlink" title="3.è¿æ¥Hiveè¯»å†™æ•°æ®"></a>3.è¿æ¥Hiveè¯»å†™æ•°æ®</h3><p>â€‹    ç°åœ¨æˆ‘ä»¬çœ‹å¦‚ä½•ä½¿ç”¨Sparkè¯»å†™Hiveä¸­çš„æ•°æ®ã€‚æ³¨æ„ï¼Œæ“ä½œåˆ°è¿™é‡Œä¹‹å‰ï¼Œä½ ä¸€å®šå·²ç»æŒ‰ç…§å‰é¢çš„å„ä¸ªæ“ä½œæ­¥éª¤ï¼Œå¯åŠ¨äº†Hadoopã€Hiveã€MySQLå’Œspark-shellï¼ˆåŒ…å«Hiveæ”¯æŒï¼‰ã€‚åœ¨è¿›è¡Œç¼–ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹â€œ/usr/local/sparkwithhive/conf/spark-env.shâ€è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/spark/conf/</span><br><span class="line">vim spark-env.sh</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä½¿ç”¨vimç¼–è¾‘å™¨æ‰“å¼€äº†spark-env.shè¿™ä¸ªæ–‡ä»¶ï¼Œè¾“å…¥ä¸‹é¢å†…å®¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> SPARK_DIST_CLASSPATH=$(/usr/<span class="built_in">local</span>/hadoop/bin/hadoop classpath)</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$CLASSPATH</span>:/usr/<span class="built_in">local</span>/hive/lib</span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/scala</span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=/usr/<span class="built_in">local</span>/hadoop/etc/hadoop</span><br><span class="line"><span class="built_in">export</span> HIVE_CONF_DIR=/usr/<span class="built_in">local</span>/hive/conf</span><br><span class="line"><span class="built_in">export</span> SPARK_CLASSPATH=<span class="variable">$SPARK_CLASSPATH</span>:/usr/<span class="built_in">local</span>/hive/lib/mysql-connector-java-5.1.26-bin.jar</span><br></pre></td></tr></table></figure><p>ä¿å­˜å¹¶æ¨å‡ºï¼Œç„¶åå¯åŠ¨spark-shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-shell</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨shellç•Œé¢ä¸­è¾“å…¥</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">Row</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">SparkSession</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Record</span>(<span class="params">key: <span class="type">Int</span>, value: <span class="type">String</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">warehouseLocation</span> </span>= <span class="string">"spark-warehouse"</span></span><br><span class="line"><span class="keyword">val</span> spark = <span class="type">SparkSession</span>.builder().appName(<span class="string">"Spark Hive Example"</span>).config(<span class="string">"spark.sql.warehouse.dir"</span>, warehouseLocation).enableHiveSupport().getOrCreate()</span><br><span class="line"><span class="keyword">import</span> spark.implicits._</span><br><span class="line"><span class="keyword">import</span> spark.sql</span><br><span class="line">sql(<span class="string">"SELECT * FROM sparktest.student"</span>).show()</span><br></pre></td></tr></table></figure><p>ç„¶åå†å¼€ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼Œå¯åŠ¨hiveç•Œé¢ï¼ŒæŸ¥çœ‹spark-shellä¸­å¯¹hiveè¡¨æ’å…¥æ•°æ®çš„ç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive</span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> sparktest;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨spark-shellä¸­è¿›è¡Œæ•°æ®æ’å…¥</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.<span class="type">Properties</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.types._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">Row</span></span><br><span class="line"><span class="comment">//ä¸‹é¢æˆ‘ä»¬è®¾ç½®ä¸¤æ¡æ•°æ®è¡¨ç¤ºä¸¤ä¸ªå­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="keyword">val</span> studentRDD = spark.sparkContext.parallelize(<span class="type">Array</span>(<span class="string">"3 Rongcheng M 26"</span>,<span class="string">"4 Guanhua M 27"</span>)).map(_.split(<span class="string">" "</span>))</span><br><span class="line"><span class="comment">//ä¸‹é¢è¦è®¾ç½®æ¨¡å¼ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">val</span> schema = <span class="type">StructType</span>(<span class="type">List</span>(<span class="type">StructField</span>(<span class="string">"id"</span>, <span class="type">IntegerType</span>, <span class="literal">true</span>),<span class="type">StructField</span>(<span class="string">"name"</span>, <span class="type">StringType</span>, <span class="literal">true</span>),<span class="type">StructField</span>(<span class="string">"gender"</span>, <span class="type">StringType</span>, <span class="literal">true</span>),<span class="type">StructField</span>(<span class="string">"age"</span>, <span class="type">IntegerType</span>, <span class="literal">true</span>)))</span><br><span class="line"><span class="comment">//ä¸‹é¢åˆ›å»ºRowå¯¹è±¡ï¼Œæ¯ä¸ªRowå¯¹è±¡éƒ½æ˜¯rowRDDä¸­çš„ä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">val</span> rowRDD = studentRDD.map(p =&gt; <span class="type">Row</span>(p(<span class="number">0</span>).toInt, p(<span class="number">1</span>).trim, p(<span class="number">2</span>).trim, p(<span class="number">3</span>).toInt))</span><br><span class="line"><span class="comment">//å»ºç«‹èµ·Rowå¯¹è±¡å’Œæ¨¡å¼ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œä¹Ÿå°±æ˜¯æŠŠæ•°æ®å’Œæ¨¡å¼å¯¹åº”èµ·æ¥</span></span><br><span class="line"><span class="keyword">val</span> studentDF = spark.createDataFrame(rowRDD, schema)</span><br><span class="line"><span class="comment">//æŸ¥çœ‹studentDF</span></span><br><span class="line">studentDF.show()</span><br><span class="line"><span class="comment">//ä¸‹é¢æ³¨å†Œä¸´æ—¶è¡¨</span></span><br><span class="line">studentDF.registerTempTable(<span class="string">"tempTable"</span>)</span><br><span class="line">sql(<span class="string">"insert into sparktest.student select * from tempTable"</span>)</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ‡æ¢åˆ°hiveçª—å£ï¼ŒæŸ¥çœ‹æ•°æ®åº“å†…å®¹å˜åŒ–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure><p>èƒ½å¤ŸæŸ¥è¯¢åˆ°æ–°å¢æ•°æ®ç»“æœï¼Œåˆ™è¯´æ˜æ“ä½œæˆåŠŸã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;ä¸€ã€Hiveå®‰è£…&quot;&gt;&lt;a href=&quot;#ä¸€ã€Hiveå®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€Hiveå®‰è£…&quot;&gt;&lt;/a&gt;ä¸€ã€Hiveå®‰è£…&lt;/h2&gt;&lt;h3 id=&quot;1-Hiveç®€ä»‹&quot;&gt;&lt;a href=&quot;#1-H
      
    
    </summary>
    
      <category term="Hadoop" scheme="http://www.ihoge.cn/categories/Hadoop/"/>
    
    
      <category term="Environment" scheme="http://www.ihoge.cn/tags/Environment/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®æŒ–æ˜çš„9å¤§æˆç†ŸæŠ€æœ¯å’Œå•†ä¸šåº”ç”¨</title>
    <link href="http://www.ihoge.cn/2018/DataMining.html"/>
    <id>http://www.ihoge.cn/2018/DataMining.html</id>
    <published>2018-04-10T17:05:59.000Z</published>
    <updated>2018-04-10T17:39:15.681Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>åŸºäºæ•°æ®æŒ–æ˜çš„9å¤§ä¸»è¦æˆç†ŸæŠ€æœ¯ä»¥åŠåœ¨æ•°æ®åŒ–è¿è¥ä¸­çš„ä¸»è¦åº”ç”¨ï¼š<br>1ã€å†³ç­–æ ‘<br>2ã€ç¥ç»ç½‘ç»œ<br>3ã€å›å½’<br>4ã€å…³è”è§„åˆ™<br>5ã€èšç±»<br>6ã€è´å¶æ–¯åˆ†ç±»<br>7ã€æ”¯æŒå‘é‡æœº<br>8ã€ä¸»æˆåˆ†åˆ†æ<br>9ã€å‡è®¾æ£€éªŒ</p><h3 id="1-å†³ç­–æ ‘"><a href="#1-å†³ç­–æ ‘" class="headerlink" title="1ã€€å†³ç­–æ ‘"></a>1ã€€å†³ç­–æ ‘</h3><p>å†³ç­–æ ‘ï¼ˆDecision Treeï¼‰æ˜¯ä¸€ç§éå¸¸æˆç†Ÿçš„ã€æ™®éé‡‡ç”¨çš„æ•°æ®æŒ–æ˜æŠ€æœ¯ã€‚ä¹‹æ‰€ä»¥ç§°ä¸ºæ ‘ï¼Œæ˜¯å› ä¸ºå…¶å»ºæ¨¡è¿‡ç¨‹ç±»ä¼¼ä¸€æ£µæ ‘çš„æˆé•¿è¿‡ç¨‹ï¼Œå³ä»æ ¹éƒ¨å¼€å§‹ï¼Œåˆ°æ ‘å¹²ï¼Œåˆ°åˆ†æï¼Œå†åˆ°ç»†ææœ«èŠ‚çš„åˆ†å‰ï¼Œæœ€ç»ˆç”Ÿé•¿å‡ºä¸€ç‰‡ç‰‡çš„æ ‘å¶ã€‚åœ¨å†³ç­–æ ‘é‡Œï¼Œæ‰€åˆ†æçš„æ•°æ®æ ·æœ¬å…ˆæ˜¯é›†æˆä¸ºä¸€ä¸ªæ ‘æ ¹ï¼Œç„¶åç»è¿‡å±‚å±‚åˆ†æï¼Œæœ€ç»ˆå½¢æˆè‹¥å¹²ä¸ªç»“ç‚¹ï¼Œæ¯ä¸ªç»“ç‚¹ä»£è¡¨ä¸€ä¸ªç»“è®ºã€‚</p><p>å†³ç­–æ ‘ç®—æ³•ä¹‹æ‰€ä»¥åœ¨æ•°æ®åˆ†ææŒ–æ˜åº”ç”¨ä¸­å¦‚æ­¤æµè¡Œï¼Œä¸»è¦åŸå› åœ¨äºå†³ç­–æ ‘çš„æ„é€ ä¸éœ€è¦ä»»ä½•é¢†åŸŸçš„çŸ¥è¯†ï¼Œå¾ˆé€‚åˆæ¢ç´¢å¼çš„çŸ¥è¯†å‘æ˜ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†é«˜ç»´åº¦çš„æ•°æ®ã€‚åœ¨ä¼—å¤šçš„æ•°æ®æŒ–æ˜ã€ç»Ÿè®¡åˆ†æç®—æ³•ä¸­ï¼Œå†³ç­–æ ‘æœ€å¤§çš„ä¼˜ç‚¹åœ¨äºå®ƒæ‰€äº§ç”Ÿçš„ä¸€ç³»åˆ—ä»æ ‘æ ¹åˆ°æ ‘æï¼ˆæˆ–æ ‘å¶ï¼‰çš„è§„åˆ™ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«åˆ†æå¸ˆå’Œä¸šåŠ¡äººå‘˜ç†è§£ï¼Œè€Œä¸”è¿™äº›å…¸å‹çš„è§„åˆ™ç”šè‡³ä¸ç”¨æ•´ç†ï¼ˆæˆ–ç¨åŠ æ•´ç†ï¼‰ï¼Œå°±æ˜¯ç°æˆçš„å¯ä»¥åº”ç”¨çš„ä¸šåŠ¡ä¼˜åŒ–ç­–ç•¥å’Œä¸šåŠ¡ä¼˜åŒ–è·¯å¾„ã€‚å¦å¤–ï¼Œå†³ç­–æ ‘æŠ€æœ¯å¯¹æ•°æ®çš„åˆ†å¸ƒç”šè‡³ç¼ºå¤±éå¸¸å®½å®¹ï¼Œä¸å®¹æ˜“å—åˆ°æå€¼çš„å½±å“ã€‚</p><p>ç›®å‰ï¼Œæœ€å¸¸ç”¨çš„3ç§å†³ç­–æ ‘ç®—æ³•åˆ†åˆ«æ˜¯<code>CHAIDã€CART</code>å’Œ<code>ID3ï¼ˆåŒ…æ‹¬åæ¥çš„C4.5ï¼Œä¹ƒè‡³C5.0ï¼‰</code>ã€‚</p><p>CHAID(Chi-square Automatic Interaction Detector)ç®—æ³•çš„å†å²è¾ƒé•¿ï¼Œä¸­æ–‡ç®€ç§°ä¸ºå¡æ–¹è‡ªåŠ¨ç›¸äº’å…³ç³»æ£€æµ‹ã€‚CHAIDä¾æ®å±€éƒ¨æœ€ä¼˜åŸåˆ™ï¼Œåˆ©ç”¨å¡æ–¹æ£€éªŒæ¥é€‰æ‹©å¯¹å› å˜é‡æœ€æœ‰å½±å“çš„è‡ªå˜é‡ï¼ŒCHAIDåº”ç”¨çš„å‰ææ˜¯å› å˜é‡ä¸ºç±»åˆ«å‹å˜é‡ï¼ˆCategoryï¼‰ã€‚</p><p>CART(Classification and Regression Tree)ç®—æ³•äº§ç”Ÿäº20ä¸–çºª80å¹´ä»£ä¸­æœŸï¼Œä¸­æ–‡ç®€ç§°ä¸ºåˆ†ç±»ä¸å›å½’æ ‘ï¼ŒCARTçš„åˆ†å‰²é€»è¾‘ä¸CHAIDç›¸åŒï¼Œæ¯ä¸€å±‚çš„åˆ’åˆ†éƒ½æ˜¯åŸºäºå¯¹æ‰€æœ‰è‡ªå˜é‡çš„æ£€éªŒå’Œé€‰æ‹©ä¸Šçš„ã€‚ä½†æ˜¯ï¼ŒCARTé‡‡ç”¨çš„æ£€éªŒæ ‡å‡†ä¸æ˜¯å¡æ–¹æ£€éªŒï¼Œè€Œæ˜¯åŸºå°¼ç³»æ•°ï¼ˆGiniï¼‰ç­‰ä¸çº¯åº¦çš„æŒ‡æ ‡ã€‚ä¸¤è€…æœ€å¤§çš„åŒºåˆ«åœ¨äºCHAIDé‡‡ç”¨çš„æ˜¯å±€éƒ¨æœ€ä¼˜åŸåˆ™ï¼Œå³ç»“ç‚¹ä¹‹é—´äº’ä¸ç›¸å¹²ï¼Œä¸€ä¸ªç»“ç‚¹ç¡®å®šäº†ä¹‹åï¼Œä¸‹é¢çš„ç”Ÿé•¿è¿‡ç¨‹å®Œå…¨åœ¨ç»“ç‚¹å†…è¿›è¡Œã€‚è€ŒCARTåˆ™ç€çœ¼äºæ€»ä½“ä¼˜åŒ–ï¼Œå³å…ˆè®©æ ‘å°½å¯èƒ½åœ°ç”Ÿé•¿ï¼Œç„¶åå†å›è¿‡å¤´æ¥å¯¹æ ‘è¿›è¡Œä¿®å‰ªï¼ˆPruneï¼‰ï¼Œè¿™ä¸€ç‚¹éå¸¸ç±»ä¼¼ç»Ÿè®¡åˆ†æä¸­å›å½’ç®—æ³•é‡Œçš„åå‘é€‰æ‹©ï¼ˆBackward Selectionï¼‰ã€‚CARTæ‰€ç”Ÿäº§çš„å†³ç­–æ ‘æ˜¯äºŒåˆ†çš„ï¼Œæ¯ä¸ªç»“ç‚¹åªèƒ½åˆ†å‡ºä¸¤æï¼Œå¹¶ä¸”åœ¨æ ‘çš„ç”Ÿé•¿è¿‡ç¨‹ä¸­ï¼ŒåŒä¸€ä¸ªè‡ªå˜é‡å¯ä»¥åå¤ä½¿ç”¨å¤šæ¬¡ï¼ˆåˆ†å‰²ï¼‰ï¼Œè¿™äº›éƒ½æ˜¯ä¸åŒäºCHAIDçš„ç‰¹ç‚¹ã€‚å¦å¤–ï¼Œå¦‚æœæ˜¯è‡ªå˜é‡å­˜åœ¨æ•°æ®ç¼ºå¤±ï¼ˆMissingï¼‰çš„æƒ…å†µï¼ŒCARTçš„å¤„ç†æ–¹å¼å°†ä¼šæ˜¯å¯»æ‰¾ä¸€ä¸ªæ›¿ä»£æ•°æ®æ¥ä»£æ›¿ï¼ˆå¡«å……ï¼‰ç¼ºå¤±å€¼ï¼Œè€ŒCHAIDåˆ™æ˜¯æŠŠç¼ºå¤±æ•°å€¼ä½œä¸ºå•ç‹¬çš„ä¸€ç±»æ•°å€¼ã€‚</p><p><code>ID3</code>ï¼ˆIterative Dichotomiserï¼‰ç®—æ³•ä¸CARTæ˜¯åŒä¸€æ—¶æœŸäº§ç”Ÿçš„ï¼Œä¸­æ–‡ç®€ç§°ä¸ºè¿­ä»£çš„äºŒåˆ†å™¨ï¼Œå…¶æœ€å¤§çš„ç‰¹ç‚¹åœ¨äºè‡ªå˜é‡çš„æŒ‘é€‰æ ‡å‡†æ˜¯ï¼šåŸºäºä¿¡æ¯å¢ç›Šçš„åº¦é‡é€‰æ‹©å…·æœ‰æœ€é«˜ä¿¡æ¯å¢ç›Šçš„å±æ€§ä½œä¸ºç»“ç‚¹çš„åˆ†è£‚ï¼ˆåˆ†å‰²ï¼‰å±æ€§ï¼Œå…¶ç»“æœå°±æ˜¯å¯¹åˆ†å‰²åçš„ç»“ç‚¹è¿›è¡Œåˆ†ç±»æ‰€éœ€çš„ä¿¡æ¯é‡æœ€å°ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§åˆ’åˆ†çº¯åº¦çš„æ€æƒ³ã€‚è‡³äºä¹‹åå‘å±•èµ·æ¥çš„<code>C4.5</code>å¯ä»¥ç†è§£ä¸ºID3çš„å‘å±•ç‰ˆï¼ˆåç»§ç‰ˆï¼‰ï¼Œä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºC4.5é‡‡ç”¨ä¿¡æ¯<code>å¢ç›Šç‡</code>ï¼ˆGain Ratioï¼‰ä»£æ›¿äº†ID3ä¸­çš„ä¿¡æ¯å¢ç›Šåº¦é‡ï¼Œå¦‚æ­¤æ›¿æ¢çš„ä¸»è¦åŸå› æ˜¯ä¿¡æ¯å¢ç›Šåº¦é‡æœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å€¾å‘äºé€‰æ‹©å…·æœ‰å¤§é‡å€¼çš„å±æ€§ã€‚è¿™é‡Œç»™ä¸ªæç«¯çš„ä¾‹å­ï¼Œå¯¹äºMember_Idçš„åˆ’åˆ†ï¼Œæ¯ä¸ªIdéƒ½æ˜¯ä¸€ä¸ªæœ€çº¯çš„ç»„ï¼Œä½†æ˜¯è¿™æ ·çš„åˆ’åˆ†æ²¡æœ‰ä»»ä½•å®é™…æ„ä¹‰ã€‚è€ŒC4.5æ‰€é‡‡ç”¨çš„ä¿¡æ¯å¢ç›Šç‡å°±å¯ä»¥è¾ƒå¥½åœ°å…‹æœè¿™ä¸ªç¼ºç‚¹ï¼Œå®ƒåœ¨ä¿¡æ¯å¢ç›Šçš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€ä¸ªåˆ†è£‚ä¿¡æ¯ï¼ˆSplitInformationï¼‰å¯¹å…¶è¿›è¡Œè§„èŒƒåŒ–çº¦æŸã€‚</p><p>å†³ç­–æ ‘æŠ€æœ¯åœ¨æ•°æ®åŒ–è¿è¥ä¸­çš„ä¸»è¦ç”¨é€”ä½“ç°åœ¨ï¼šä½œä¸ºåˆ†ç±»ã€é¢„æµ‹é—®é¢˜çš„å…¸å‹æ”¯æŒæŠ€æœ¯ï¼Œå®ƒåœ¨ç”¨æˆ·åˆ’åˆ†ã€è¡Œä¸ºé¢„æµ‹ã€è§„åˆ™æ¢³ç†ç­‰æ–¹é¢å…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯ï¼Œå†³ç­–æ ‘ç”šè‡³å¯ä»¥ä½œä¸ºå…¶ä»–å»ºæ¨¡æŠ€æœ¯å‰æœŸè¿›è¡Œå˜é‡ç­›é€‰çš„ä¸€ç§æ–¹æ³•ï¼Œå³é€šè¿‡å†³ç­–æ ‘çš„åˆ†å‰²æ¥ç­›é€‰æœ‰æ•ˆåœ°è¾“å…¥è‡ªå˜é‡ã€‚</p><h3 id="2-ç¥ç»ç½‘ç»œ"><a href="#2-ç¥ç»ç½‘ç»œ" class="headerlink" title="2ã€€ç¥ç»ç½‘ç»œ"></a>2ã€€ç¥ç»ç½‘ç»œ</h3><p>ç¥ç»ç½‘ç»œï¼ˆNeural Networkï¼‰æ˜¯é€šè¿‡æ•°å­¦ç®—æ³•æ¥æ¨¡ä»¿äººè„‘æ€ç»´çš„ï¼Œå®ƒæ˜¯æ•°æ®æŒ–æ˜ä¸­æœºå™¨å­¦ä¹ çš„å…¸å‹ä»£è¡¨ã€‚ç¥ç»ç½‘ç»œæ˜¯äººè„‘çš„æŠ½è±¡è®¡ç®—æ¨¡å‹ï¼Œæˆ‘ä»¬çŸ¥é“äººè„‘ä¸­æœ‰æ•°ä»¥ç™¾äº¿ä¸ªç¥ç»å…ƒï¼ˆäººè„‘å¤„ç†ä¿¡æ¯çš„å¾®å•å…ƒï¼‰ï¼Œè¿™äº›ç¥ç»å…ƒä¹‹é—´ç›¸äº’è¿æ¥ï¼Œä½¿å¾—äººçš„å¤§è„‘äº§ç”Ÿç²¾å¯†çš„é€»è¾‘æ€ç»´ã€‚è€Œæ•°æ®æŒ–æ˜ä¸­çš„â€œç¥ç»ç½‘ç»œâ€ä¹Ÿæ˜¯ç”±å¤§é‡å¹¶è¡Œåˆ†å¸ƒçš„äººå·¥ç¥ç»å…ƒï¼ˆå¾®å¤„ç†å•å…ƒï¼‰ç»„æˆçš„ï¼Œå®ƒæœ‰é€šè¿‡è°ƒæ•´è¿æ¥å¼ºåº¦ä»ç»éªŒçŸ¥è¯†ä¸­è¿›è¡Œå­¦ä¹ çš„èƒ½åŠ›ï¼Œå¹¶å¯ä»¥å°†è¿™äº›çŸ¥è¯†è¿›è¡Œåº”ç”¨ã€‚</p><p>ç®€å•æ¥è®²ï¼Œâ€œç¥ç»ç½‘ç»œâ€å°±æ˜¯é€šè¿‡è¾“å…¥å¤šä¸ªéçº¿æ€§æ¨¡å‹ä»¥åŠä¸åŒæ¨¡å‹ä¹‹é—´çš„åŠ æƒäº’è”ï¼ˆåŠ æƒçš„è¿‡ç¨‹åœ¨éšè”½å±‚å®Œæˆï¼‰ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªè¾“å‡ºæ¨¡å‹ã€‚å…¶ä¸­ï¼Œéšè”½å±‚æ‰€åŒ…å«çš„å°±æ˜¯éçº¿æ€§å‡½æ•°ã€‚</p><p>ç›®å‰æœ€ä¸»æµçš„â€œç¥ç»ç½‘ç»œâ€ç®—æ³•æ˜¯<code>åé¦ˆä¼ æ’­ï¼ˆBackpropagationï¼‰</code>ï¼Œè¯¥ç®—æ³•åœ¨å¤šå±‚å‰å‘å‹ï¼ˆMultilayer Feed-Forwardï¼‰ç¥ç»ç½‘ç»œä¸Šè¿›è¡Œå­¦ä¹ ï¼Œè€Œå¤šå±‚å‰å‘å‹ç¥ç»ç½‘ç»œåˆæ˜¯ç”±ä¸€ä¸ªè¾“å…¥å±‚ã€ä¸€ä¸ªæˆ–å¤šä¸ªéšè”½å±‚ä»¥åŠä¸€ä¸ªè¾“å‡ºå±‚ç»„æˆçš„ï¼Œâ€œç¥ç»ç½‘ç»œâ€çš„å…¸å‹ç»“æ„å¦‚å›¾æ‰€ç¤ºã€‚<br><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fq81j3ffllj30s20dawfw.jpg" alt=""></p><p>ç”±äºâ€œç¥ç»ç½‘ç»œâ€æ‹¥æœ‰ç‰¹æœ‰çš„å¤§è§„æ¨¡å¹¶è¡Œç»“æ„å’Œä¿¡æ¯çš„å¹¶è¡Œå¤„ç†ç­‰ç‰¹ç‚¹ï¼Œå› æ­¤å®ƒå…·æœ‰è‰¯å¥½çš„<code>è‡ªé€‚åº”æ€§</code>ã€<code>è‡ªç»„ç»‡æ€§</code>å’Œ<code>é«˜å®¹é”™æ€§</code>ï¼Œå¹¶ä¸”å…·æœ‰è¾ƒå¼ºçš„å­¦ä¹ ã€è®°å¿†å’Œè¯†åˆ«åŠŸèƒ½ã€‚ç›®å‰ç¥ç»ç½‘ç»œå·²ç»åœ¨ä¿¡å·å¤„ç†ã€æ¨¡å¼è¯†åˆ«ã€ä¸“å®¶ç³»ç»Ÿã€é¢„æµ‹ç³»ç»Ÿç­‰ä¼—å¤šé¢†åŸŸä¸­å¾—åˆ°å¹¿æ³›çš„åº”ç”¨ã€‚</p><p>â€œç¥ç»ç½‘ç»œâ€çš„ä¸»è¦ç¼ºç‚¹å°±æ˜¯å…¶çŸ¥è¯†å’Œ<code>ç»“æœçš„ä¸å¯è§£é‡Šæ€§</code>ï¼Œæ²¡æœ‰äººçŸ¥é“éšè”½å±‚é‡Œçš„éçº¿æ€§å‡½æ•°åˆ°åº•æ˜¯å¦‚ä½•å¤„ç†è‡ªå˜é‡çš„ï¼Œâ€œç¥ç»ç½‘ç»œâ€åº”ç”¨ä¸­çš„äº§å‡ºç‰©åœ¨å¾ˆå¤šæ—¶å€™è®©äººçœ‹ä¸æ¸…å…¶ä¸­çš„é€»è¾‘å…³ç³»ã€‚ä½†æ˜¯ï¼Œå®ƒçš„è¿™ä¸ªç¼ºç‚¹å¹¶æ²¡æœ‰å½±å“è¯¥æŠ€æœ¯åœ¨æ•°æ®åŒ–è¿è¥ä¸­çš„å¹¿æ³›åº”ç”¨ï¼Œç”šè‡³å¯ä»¥è¿™æ ·è®¤ä¸ºï¼Œæ­£æ˜¯å› ä¸ºå…¶ç»“æœå…·æœ‰ä¸å¯è§£é‡Šæ€§ï¼Œåè€Œæ›´æœ‰å¯èƒ½ä¿ƒä½¿æˆ‘ä»¬å‘ç°æ–°çš„æ²¡æœ‰è®¤è¯†åˆ°çš„è§„å¾‹å’Œå…³ç³»ã€‚</p><p>åœ¨åˆ©ç”¨â€œç¥ç»ç½‘ç»œâ€æŠ€æœ¯å»ºæ¨¡çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä»¥ä¸‹5ä¸ªå› ç´ å¯¹æ¨¡å‹ç»“æœæœ‰ç€é‡å¤§å½±å“ï¼š</p><p>â‘å±‚æ•°ã€‚</p><p>â‘æ¯å±‚ä¸­è¾“å…¥å˜é‡çš„æ•°é‡ã€‚</p><p>â‘è”ç³»çš„ç§ç±»ã€‚</p><p>â‘è”ç³»çš„ç¨‹åº¦ã€‚</p><p>â‘è½¬æ¢å‡½æ•°ï¼Œåˆç§°æ¿€æ´»å‡½æ•°æˆ–æŒ¤å‹å‡½æ•°ã€‚</p><p>â€œç¥ç»ç½‘ç»œâ€æŠ€æœ¯åœ¨æ•°æ®åŒ–è¿è¥ä¸­çš„ä¸»è¦ç”¨é€”ä½“ç°åœ¨ï¼šä½œä¸º<code>åˆ†ç±»</code>ã€<code>é¢„æµ‹</code>é—®é¢˜çš„é‡è¦æŠ€æœ¯æ”¯æŒï¼Œåœ¨ç”¨æˆ·åˆ’åˆ†ã€è¡Œä¸ºé¢„æµ‹ã€è¥é”€å“åº”ç­‰è¯¸å¤šæ–¹é¢å…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚</p><h3 id="3-å›å½’"><a href="#3-å›å½’" class="headerlink" title="3ã€€å›å½’"></a>3ã€€å›å½’</h3><p>å›å½’ï¼ˆRegressionï¼‰åˆ†æåŒ…æ‹¬çº¿æ€§å›å½’ï¼ˆLinear Regressionï¼‰ï¼Œè¿™é‡Œä¸»è¦æ˜¯æŒ‡å¤šå…ƒçº¿æ€§å›å½’å’Œé€»è¾‘æ–¯è’‚å›å½’ï¼ˆLogistic Regressionï¼‰ã€‚å…¶ä¸­ï¼Œ<strong>åœ¨æ•°æ®åŒ–è¿è¥ä¸­æ›´å¤šä½¿ç”¨çš„æ˜¯é€»è¾‘æ–¯è’‚å›å½’</strong>ï¼Œå®ƒåˆåŒ…æ‹¬å“åº”é¢„æµ‹ã€åˆ†ç±»åˆ’åˆ†ç­‰å†…å®¹ã€‚</p><p>å¤šå…ƒçº¿æ€§å›å½’ä¸»è¦æè¿°ä¸€ä¸ªå› å˜é‡å¦‚ä½•éšç€ä¸€æ‰¹è‡ªå˜é‡çš„å˜åŒ–è€Œå˜åŒ–ï¼Œå…¶å›å½’å…¬å¼ï¼ˆå›å½’æ–¹ç¨‹ï¼‰å°±æ˜¯å› å˜é‡ä¸è‡ªå˜é‡å…³ç³»çš„æ•°æ®åæ˜ ã€‚å› å˜é‡çš„å˜åŒ–åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šç³»ç»Ÿæ€§å˜åŒ–ä¸éšæœºå˜åŒ–ï¼Œå…¶ä¸­ï¼Œç³»ç»Ÿæ€§å˜åŒ–æ˜¯ç”±è‡ªå˜é‡å¼•èµ·çš„ï¼ˆè‡ªå˜é‡å¯ä»¥è§£é‡Šçš„ï¼‰ï¼Œéšæœºå˜åŒ–æ˜¯ä¸èƒ½ç”±è‡ªå˜é‡è§£é‡Šçš„ï¼Œé€šå¸¸ä¹Ÿç§°ä½œæ®‹å€¼ã€‚</p><p>åœ¨ç”¨æ¥ä¼°ç®—å¤šå…ƒçº¿æ€§å›å½’æ–¹ç¨‹ä¸­è‡ªå˜é‡ç³»æ•°çš„æ–¹æ³•ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯æœ€å°äºŒä¹˜æ³•ï¼Œå³æ‰¾å‡ºä¸€ç»„å¯¹åº”è‡ªå˜é‡çš„ç›¸åº”å‚æ•°ï¼Œä»¥ä½¿å› å˜é‡çš„å®é™…è§‚æµ‹å€¼ä¸å›å½’æ–¹ç¨‹çš„é¢„æµ‹å€¼ä¹‹é—´çš„æ€»æ–¹å·®å‡åˆ°æœ€å°ã€‚</p><p>å¯¹å¤šå…ƒçº¿æ€§å›å½’æ–¹ç¨‹çš„å‚æ•°ä¼°è®¡ï¼Œæ˜¯åŸºäºä¸‹åˆ—å‡è®¾çš„ï¼š</p><p>â‘è¾“å…¥å˜é‡æ˜¯ç¡®å®šçš„å˜é‡ï¼Œä¸æ˜¯éšæœºå˜é‡ï¼Œè€Œä¸”è¾“å…¥çš„å˜é‡é—´æ— çº¿æ€§ç›¸å…³ï¼Œå³æ— å…±çº¿æ€§ã€‚</p><p>â‘éšæœºè¯¯å·®çš„æœŸæœ›å€¼æ€»å’Œä¸ºé›¶ï¼Œå³éšæœºè¯¯å·®ä¸è‡ªå˜é‡ä¸ç›¸å…³ã€‚</p><p>â‘éšæœºè¯¯å·®å‘ˆç°æ­£æ€åˆ†å¸ƒ [1]ã€‚</p><p>å¦‚æœä¸æ»¡è¶³ä¸Šè¿°å‡è®¾ï¼Œå°±ä¸èƒ½ç”¨æœ€å°äºŒä¹˜æ³•è¿›è¡Œå›å½’ç³»æ•°çš„ä¼°ç®—äº†ã€‚</p><p><strong>é€»è¾‘æ–¯è’‚å›å½’ï¼ˆLogistic Regressionï¼‰ç›¸æ¯”äºçº¿æ€§å›å½’æ¥è¯´ï¼Œåœ¨æ•°æ®åŒ–è¿è¥ä¸­æœ‰æ›´ä¸»æµæ›´é¢‘ç¹çš„åº”ç”¨</strong>ï¼Œä¸»è¦æ˜¯å› ä¸ºè¯¥åˆ†ææŠ€æœ¯å¯ä»¥å¾ˆå¥½åœ°å›ç­”è¯¸å¦‚é¢„æµ‹ã€åˆ†ç±»ç­‰æ•°æ®åŒ–è¿è¥å¸¸è§çš„åˆ†æé¡¹ç›®ä¸»é¢˜ã€‚ç®€å•æ¥è®²ï¼Œå‡¡æ˜¯é¢„æµ‹â€œä¸¤é€‰ä¸€â€äº‹ä»¶çš„å¯èƒ½æ€§ï¼ˆæ¯”å¦‚ï¼Œâ€œå“åº”â€è¿˜æ˜¯â€œä¸å“åº”â€ï¼›â€œä¹°â€è¿˜æ˜¯â€œä¸ä¹°â€ï¼›â€œæµå¤±â€è¿˜æ˜¯â€œä¸æµå¤±â€ï¼‰ï¼Œéƒ½å¯ä»¥é‡‡ç”¨é€»è¾‘æ–¯è’‚å›å½’æ–¹ç¨‹ã€‚</p><p>é€»è¾‘æ–¯è’‚å›å½’é¢„æµ‹çš„å› å˜é‡æ˜¯ä»‹äº0å’Œ1ä¹‹é—´çš„æ¦‚ç‡ï¼Œå¦‚æœå¯¹è¿™ä¸ªæ¦‚ç‡è¿›è¡Œæ¢ç®—ï¼Œå°±å¯ä»¥ç”¨çº¿æ€§å…¬å¼æè¿°å› å˜é‡ä¸è‡ªå˜é‡çš„å…³ç³»äº†ï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š<br><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fq81p6q5gnj30al021t8k.jpg" alt=""></p><p>ä¸å¤šå…ƒçº¿æ€§å›å½’æ‰€é‡‡ç”¨çš„æœ€å°äºŒä¹˜æ³•çš„å‚æ•°ä¼°è®¡æ–¹æ³•ç›¸å¯¹åº”ï¼Œæœ€å¤§ä¼¼ç„¶æ³•æ˜¯é€»è¾‘æ–¯è’‚å›å½’æ‰€é‡‡ç”¨çš„å‚æ•°ä¼°è®¡æ–¹æ³•ï¼Œå…¶åŸç†æ˜¯æ‰¾åˆ°è¿™æ ·ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥è®©æ ·æœ¬æ•°æ®æ‰€åŒ…å«çš„è§‚å¯Ÿå€¼è¢«è§‚å¯Ÿåˆ°çš„å¯èƒ½æ€§æœ€å¤§ã€‚è¿™ç§å¯»æ‰¾æœ€å¤§å¯èƒ½æ€§çš„æ–¹æ³•éœ€è¦åå¤è®¡ç®—ï¼Œå¯¹è®¡ç®—èƒ½åŠ›æœ‰å¾ˆé«˜çš„è¦æ±‚ã€‚æœ€å¤§ä¼¼ç„¶æ³•çš„ä¼˜ç‚¹æ˜¯åœ¨å¤§æ ·æœ¬æ•°æ®ä¸­å‚æ•°çš„ä¼°å€¼ç¨³å®šã€åå·®å°ï¼Œä¼°å€¼æ–¹å·®å°ã€‚</p><h3 id="4-å…³è”è§„åˆ™"><a href="#4-å…³è”è§„åˆ™" class="headerlink" title="4ã€€å…³è”è§„åˆ™"></a>4ã€€å…³è”è§„åˆ™</h3><p>å…³è”è§„åˆ™ï¼ˆAssociation Ruleï¼‰æ˜¯åœ¨æ•°æ®åº“å’Œæ•°æ®æŒ–æ˜é¢†åŸŸä¸­è¢«å‘æ˜å¹¶è¢«å¹¿æ³›ç ”ç©¶çš„ä¸€ç§é‡è¦æ¨¡å‹ï¼Œå…³è”è§„åˆ™æ•°æ®æŒ–æ˜çš„ä¸»è¦ç›®çš„æ˜¯<code>æ‰¾å‡ºæ•°æ®é›†ä¸­çš„é¢‘ç¹æ¨¡å¼ï¼ˆFrequent Patternï¼‰</code>ï¼Œå³å¤šæ¬¡é‡å¤å‡ºç°çš„æ¨¡å¼å’Œå¹¶å‘å…³ç³»ï¼ˆCooccurrence Relationshipsï¼‰ï¼Œ<code>å³åŒæ—¶å‡ºç°çš„å…³ç³»ï¼Œé¢‘ç¹å’Œå¹¶å‘å…³ç³»ä¹Ÿç§°ä½œå…³è”ï¼ˆAssociationï¼‰</code>ã€‚</p><p>åº”ç”¨å…³è”è§„åˆ™æœ€ç»å…¸çš„æ¡ˆä¾‹å°±æ˜¯è´­ç‰©ç¯®åˆ†æï¼ˆBasket Analysisï¼‰ï¼Œé€šè¿‡åˆ†æé¡¾å®¢è´­ç‰©ç¯®ä¸­å•†å“ä¹‹é—´çš„å…³è”ï¼Œå¯ä»¥æŒ–æ˜é¡¾å®¢çš„è´­ç‰©ä¹ æƒ¯ï¼Œä»è€Œå¸®åŠ©é›¶å”®å•†æ›´å¥½åœ°åˆ¶å®šæœ‰é’ˆå¯¹æ€§çš„è¥é”€ç­–ç•¥ã€‚</p><p>ä»¥ä¸‹åˆ—ä¸¾ä¸€ä¸ªç®€å•çš„å…³è”è§„åˆ™çš„ä¾‹å­ï¼š</p><p>å©´å„¿å°¿ä¸æ¹¿â†’å•¤é…’[æ”¯æŒåº¦=10%ï¼Œç½®ä¿¡åº¦=70%]</p><p>è¿™ä¸ªè§„åˆ™è¡¨æ˜ï¼Œåœ¨æ‰€æœ‰é¡¾å®¢ä¸­ï¼Œæœ‰10%çš„é¡¾å®¢åŒæ—¶è´­ä¹°äº†å©´å„¿å°¿ä¸æ¹¿å’Œå•¤é…’ï¼Œè€Œåœ¨æ‰€æœ‰è´­ä¹°äº†å©´å„¿å°¿ä¸æ¹¿çš„é¡¾å®¢ä¸­ï¼Œå 70%çš„äººåŒæ—¶è¿˜è´­ä¹°äº†å•¤é…’ã€‚å‘ç°è¿™ä¸ªå…³è”è§„åˆ™åï¼Œè¶…å¸‚é›¶å”®å•†å†³å®šæŠŠå©´å„¿å°¿ä¸æ¹¿å’Œå•¤é…’æ‘†æ”¾åœ¨ä¸€èµ·è¿›è¡Œä¿ƒé”€ï¼Œç»“æœæ˜æ˜¾æå‡äº†é”€å”®é¢ï¼Œè¿™å°±æ˜¯å‘ç”Ÿåœ¨æ²ƒå°”ç›è¶…å¸‚ä¸­â€œå•¤é…’å’Œå°¿ä¸æ¹¿â€çš„ç»å…¸è¥é”€æ¡ˆä¾‹ã€‚</p><p>ä¸Šé¢çš„æ¡ˆä¾‹æ˜¯å¦è®©ä½ å¯¹æ”¯æŒåº¦å’Œç½®ä¿¡åº¦æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Ÿäº‹å®ä¸Šï¼Œæ”¯æŒåº¦ï¼ˆSupportï¼‰å’Œç½®ä¿¡åº¦ï¼ˆConfidenceï¼‰æ˜¯è¡¡é‡å…³è”è§„åˆ™å¼ºåº¦çš„ä¸¤ä¸ªé‡è¦æŒ‡æ ‡ï¼Œå®ƒä»¬åˆ†åˆ«åæ˜ ç€æ‰€å‘ç°è§„åˆ™çš„æœ‰ç”¨æ€§å’Œç¡®å®šæ€§ã€‚å…¶ä¸­<code>æ”¯æŒåº¦ï¼šè§„åˆ™Xâ†’Yçš„æ”¯æŒåº¦æ˜¯æŒ‡äº‹ç‰©å…¨é›†ä¸­åŒ…å«XâˆªYçš„äº‹ç‰©ç™¾åˆ†æ¯”</code>ã€‚æ”¯æŒåº¦ä¸»è¦è¡¡é‡è§„åˆ™çš„æœ‰ç”¨æ€§ï¼Œå¦‚æœæ”¯æŒåº¦å¤ªå°ï¼Œåˆ™è¯´æ˜ç›¸åº”è§„åˆ™åªæ˜¯å¶å‘äº‹ä»¶ã€‚åœ¨å•†ä¸šå®æˆ˜ä¸­ï¼Œå¶å‘äº‹ä»¶å¾ˆå¯èƒ½æ²¡æœ‰å•†ä¸šä»·å€¼ï¼›<code>ç½®ä¿¡åº¦ï¼šè§„åˆ™Xâ†’Yçš„ç½®ä¿¡åº¦æ˜¯æŒ‡æ—¢åŒ…å«äº†XåˆåŒ…å«äº†Yçš„äº‹ç‰©æ•°é‡å æ‰€æœ‰åŒ…å«äº†Xçš„äº‹ç‰©æ•°é‡çš„ç™¾åˆ†æ¯”</code>ã€‚ç½®ä¿¡åº¦ä¸»è¦è¡¡é‡è§„åˆ™çš„ç¡®å®šæ€§ï¼ˆå¯é¢„æµ‹æ€§ï¼‰ï¼Œå¦‚æœç½®ä¿¡åº¦å¤ªä½ï¼Œé‚£ä¹ˆä»Xå°±å¾ˆéš¾å¯é åœ°æ¨æ–­å‡ºYæ¥ï¼Œç½®ä¿¡åº¦å¤ªä½çš„è§„åˆ™åœ¨å®è·µåº”ç”¨ä¸­ä¹Ÿæ²¡æœ‰å¤ªå¤§ç”¨å¤„ã€‚</p><p>åœ¨ä¼—å¤šçš„å…³è”è§„åˆ™æ•°æ®æŒ–æ˜ç®—æ³•ä¸­ï¼Œæœ€è‘—åçš„å°±æ˜¯<code>Apriori</code>ç®—æ³•ï¼Œè¯¥ç®—æ³•å…·ä½“åˆ†ä¸ºä»¥ä¸‹ä¸¤æ­¥è¿›è¡Œï¼š</p><p>ï¼ˆ1ï¼‰ç”Ÿæˆæ‰€æœ‰çš„é¢‘ç¹é¡¹ç›®é›†ã€‚ä¸€ä¸ªé¢‘ç¹é¡¹ç›®é›†ï¼ˆFrequent Itemsetï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒåº¦é«˜äºæœ€å°æ”¯æŒåº¦é˜€å€¼ï¼ˆmin-supï¼‰çš„é¡¹ç›®é›†ã€‚</p><p>ï¼ˆ2ï¼‰ä»é¢‘ç¹é¡¹ç›®é›†ä¸­ç”Ÿæˆæ‰€æœ‰çš„å¯ä¿¡å…³è”è§„åˆ™ã€‚è¿™é‡Œå¯ä¿¡å…³è”è§„åˆ™æ˜¯æŒ‡ç½®ä¿¡åº¦å¤§äºæœ€å°ç½®ä¿¡åº¦é˜€å€¼ï¼ˆmin-confï¼‰çš„è§„åˆ™ã€‚</p><p>å…³è”è§„åˆ™ç®—æ³•ä¸ä½†åœ¨æ•°å€¼å‹æ•°æ®é›†çš„åˆ†æä¸­æœ‰å¾ˆå¤§ç”¨é€”ï¼Œè€Œä¸”åœ¨çº¯æ–‡æœ¬æ–‡æ¡£å’Œç½‘é¡µæ–‡ä»¶ä¸­ï¼Œä¹Ÿæœ‰ç€é‡è¦ç”¨é€”ã€‚æ¯”å¦‚å‘ç°å•è¯é—´çš„å¹¶å‘å…³ç³»ä»¥åŠWebçš„ä½¿ç”¨æ¨¡å¼ç­‰ï¼Œè¿™äº›éƒ½æ˜¯Webæ•°æ®æŒ–æ˜ã€æœç´¢åŠæ¨èçš„åŸºç¡€ã€‚</p><h3 id="5-èšç±»"><a href="#5-èšç±»" class="headerlink" title="5ã€€èšç±»"></a>5ã€€èšç±»</h3><p>èšç±»ï¼ˆClusteringï¼‰åˆ†ææœ‰ä¸€ä¸ªé€šä¿—çš„è§£é‡Šå’Œæ¯”å–»ï¼Œé‚£å°±æ˜¯â€œç‰©ä»¥ç±»èšï¼Œäººä»¥ç¾¤åˆ†â€ã€‚é’ˆå¯¹å‡ ä¸ªç‰¹å®šçš„ä¸šåŠ¡æŒ‡æ ‡ï¼Œå¯ä»¥å°†è§‚å¯Ÿå¯¹è±¡çš„ç¾¤ä½“æŒ‰ç…§ç›¸ä¼¼æ€§å’Œç›¸å¼‚æ€§è¿›è¡Œä¸åŒç¾¤ç»„çš„åˆ’åˆ†ã€‚ç»è¿‡åˆ’åˆ†åï¼Œæ¯ä¸ªç¾¤ç»„å†…éƒ¨å„å¯¹è±¡é—´çš„ç›¸ä¼¼åº¦ä¼šå¾ˆé«˜ï¼Œè€Œåœ¨ä¸åŒç¾¤ç»„ä¹‹é—´çš„å¯¹è±¡å½¼æ­¤é—´å°†å…·æœ‰å¾ˆé«˜çš„ç›¸å¼‚åº¦ã€‚</p><p>èšç±»åˆ†æçš„ç®—æ³•å¯ä»¥åˆ†ä¸º<code>åˆ’åˆ†çš„æ–¹æ³•</code>ï¼ˆPartitioning Methodï¼‰ã€<code>å±‚æ¬¡çš„æ–¹æ³•</code>ï¼ˆHierarchical Methodï¼‰ã€åŸºäºå¯†åº¦çš„æ–¹æ³•ï¼ˆDensity-based Methodï¼‰ã€åŸºäºç½‘æ ¼çš„æ–¹æ³•ï¼ˆGrid-based Methodï¼‰ã€åŸºäºæ¨¡å‹çš„æ–¹æ³•ï¼ˆModel-based Methodï¼‰ç­‰ï¼Œå…¶ä¸­ï¼Œå‰é¢ä¸¤ç§æ–¹æ³•æœ€ä¸ºå¸¸ç”¨ã€‚</p><p>å¯¹äºåˆ’åˆ†çš„æ–¹æ³•ï¼ˆPartitioning Methodï¼‰ï¼Œ<code>å½“ç»™å®šmä¸ªå¯¹è±¡çš„æ•°æ®é›†ï¼Œä»¥åŠå¸Œæœ›ç”Ÿæˆçš„ç»†åˆ†ç¾¤ä½“æ•°é‡Kåï¼Œå³å¯é‡‡ç”¨è¿™ç§æ–¹æ³•å°†è¿™äº›å¯¹è±¡åˆ†æˆKç»„</code>ï¼ˆKâ‰¤mï¼‰ï¼Œä½¿å¾—æ¯ä¸ªç»„å†…å¯¹è±¡æ˜¯ç›¸ä¼¼çš„ï¼Œè€Œç»„é—´çš„å¯¹è±¡æ˜¯ç›¸å¼‚çš„ã€‚æœ€å¸¸ç”¨çš„åˆ’åˆ†æ–¹æ³•æ˜¯<code>K-Means</code>æ–¹æ³•ï¼Œå…¶å…·ä½“åŸç†æ˜¯ï¼šé¦–å…ˆï¼Œéšæœºé€‰æ‹©Kä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”æ‰€é€‰æ‹©çš„æ¯ä¸ªå¯¹è±¡éƒ½ä»£è¡¨ä¸€ä¸ªç»„çš„åˆå§‹å‡å€¼æˆ–åˆå§‹çš„ç»„ä¸­å¿ƒå€¼ï¼›å¯¹å‰©ä½™çš„æ¯ä¸ªå¯¹è±¡ï¼Œæ ¹æ®å…¶ä¸å„ä¸ªç»„åˆå§‹å‡å€¼çš„è·ç¦»ï¼Œå°†å®ƒä»¬åˆ†é…ç»™æœ€è¿‘çš„ï¼ˆæœ€ç›¸ä¼¼ï¼‰å°ç»„ï¼›ç„¶åï¼Œé‡æ–°è®¡ç®—æ¯ä¸ªå°ç»„æ–°çš„å‡å€¼ï¼›è¿™ä¸ªè¿‡ç¨‹ä¸æ–­é‡å¤ï¼Œç›´åˆ°æ‰€æœ‰çš„å¯¹è±¡åœ¨Kç»„åˆ†å¸ƒä¸­éƒ½æ‰¾åˆ°ç¦»è‡ªå·±æœ€è¿‘çš„ç»„ã€‚</p><p><code>å±‚æ¬¡çš„æ–¹æ³•ï¼ˆHierarchical Methodï¼‰åˆ™æ˜¯æŒ‡ä¾æ¬¡è®©æœ€ç›¸ä¼¼çš„æ•°æ®å¯¹è±¡ä¸¤ä¸¤åˆå¹¶ï¼Œè¿™æ ·ä¸æ–­åœ°åˆå¹¶ï¼Œæœ€åå°±å½¢æˆäº†ä¸€æ£µèšç±»æ ‘</code>ã€‚</p><p>èšç±»æŠ€æœ¯åœ¨æ•°æ®åˆ†æå’Œæ•°æ®åŒ–è¿è¥ä¸­çš„ä¸»è¦ç”¨é€”è¡¨ç°åœ¨ï¼šæ—¢å¯ä»¥ç›´æ¥ä½œä¸ºæ¨¡å‹å¯¹è§‚å¯Ÿå¯¹è±¡è¿›è¡Œç¾¤ä½“åˆ’åˆ†ï¼Œä¸ºä¸šåŠ¡æ–¹çš„ç²¾ç»†åŒ–è¿è¥æä¾›å…·ä½“çš„ç»†åˆ†ä¾æ®å’Œç›¸åº”çš„è¿è¥æ–¹æ¡ˆå»ºè®®ï¼Œåˆå¯åœ¨æ•°æ®å¤„ç†é˜¶æ®µç”¨ä½œæ•°æ®æ¢ç´¢çš„å·¥å…·ï¼ŒåŒ…æ‹¬å‘ç°ç¦»ç¾¤ç‚¹ã€å­¤ç«‹ç‚¹ï¼Œæ•°æ®é™ç»´çš„æ‰‹æ®µå’Œæ–¹æ³•ï¼Œé€šè¿‡èšç±»å‘ç°æ•°æ®é—´çš„æ·±å±‚æ¬¡çš„å…³ç³»ç­‰ã€‚</p><h3 id="6-è´å¶æ–¯åˆ†ç±»æ–¹æ³•"><a href="#6-è´å¶æ–¯åˆ†ç±»æ–¹æ³•" class="headerlink" title="6ã€€è´å¶æ–¯åˆ†ç±»æ–¹æ³•"></a>6ã€€è´å¶æ–¯åˆ†ç±»æ–¹æ³•</h3><p>è´å¶æ–¯åˆ†ç±»æ–¹æ³•ï¼ˆBayesian Classifierï¼‰æ˜¯éå¸¸æˆç†Ÿçš„ç»Ÿè®¡å­¦åˆ†ç±»æ–¹æ³•ï¼Œå®ƒä¸»è¦ç”¨æ¥é¢„æµ‹ç±»æˆå‘˜é—´å…³ç³»çš„å¯èƒ½æ€§ã€‚æ¯”å¦‚é€šè¿‡ä¸€ä¸ªç»™å®šè§‚å¯Ÿå€¼çš„ç›¸å…³å±æ€§æ¥åˆ¤æ–­å…¶å±äºä¸€ä¸ªç‰¹å®šç±»åˆ«çš„æ¦‚ç‡ã€‚è´å¶æ–¯åˆ†ç±»æ–¹æ³•æ˜¯åŸºäºè´å¶æ–¯å®šç†çš„ï¼Œå·²ç»æœ‰ç ”ç©¶è¡¨æ˜ï¼Œæœ´ç´ è´å¶æ–¯åˆ†ç±»æ–¹æ³•ä½œä¸ºä¸€ç§ç®€å•è´å¶æ–¯åˆ†ç±»ç®—æ³•ç”šè‡³å¯ä»¥è·Ÿå†³ç­–æ ‘å’Œç¥ç»ç½‘ç»œç®—æ³•ç›¸åª²ç¾ã€‚</p><p>è´å¶æ–¯å®šç†çš„å…¬å¼å¦‚ä¸‹ï¼š<br><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fq820l60g6j307201smx0.jpg" alt=""></p><p>å…¶ä¸­ï¼ŒXè¡¨ç¤ºnä¸ªå±æ€§çš„æµ‹é‡æè¿°ï¼›Hä¸ºæŸç§å‡è®¾ï¼Œæ¯”å¦‚å‡è®¾æŸè§‚å¯Ÿå€¼Xå±äºæŸä¸ªç‰¹å®šçš„ç±»åˆ«Cï¼›å¯¹äºåˆ†ç±»é—®é¢˜ï¼Œå¸Œæœ›ç¡®å®šP(H|X)ï¼Œå³èƒ½é€šè¿‡ç»™å®šçš„Xçš„æµ‹é‡æè¿°ï¼Œæ¥å¾—åˆ°Hæˆç«‹çš„æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯ç»™å‡ºXçš„å±æ€§å€¼ï¼Œè®¡ç®—å‡ºè¯¥è§‚å¯Ÿå€¼å±äºç±»åˆ«Cçš„æ¦‚ç‡ã€‚å› ä¸ºP(H|X)æ˜¯åéªŒæ¦‚ç‡ï¼ˆPosterior Probabilityï¼‰ï¼Œæ‰€ä»¥åˆç§°å…¶ä¸ºåœ¨æ¡ä»¶Xä¸‹ï¼ŒHçš„åéªŒæ¦‚ç‡ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾æ•°æ®å±æ€§ä»…é™äºç”¨æ•™è‚²èƒŒæ™¯å’Œæ”¶å…¥æ¥æè¿°é¡¾å®¢ï¼Œè€ŒXæ˜¯ä¸€ä½ç¡•å£«å­¦å†ï¼Œæ”¶å…¥10ä¸‡å…ƒçš„é¡¾å®¢ã€‚å‡å®šHè¡¨ç¤ºå‡è®¾æˆ‘ä»¬çš„é¡¾å®¢å°†è´­ä¹°è‹¹æœæ‰‹æœºï¼Œåˆ™P(H|X)è¡¨ç¤ºå½“æˆ‘ä»¬çŸ¥é“é¡¾å®¢çš„æ•™è‚²èƒŒæ™¯å’Œæ”¶å…¥æƒ…å†µåï¼Œè¯¥é¡¾å®¢å°†è´­ä¹°è‹¹æœæ‰‹æœºçš„æ¦‚ç‡ï¼›ç›¸åï¼ŒP(X|H)åˆ™è¡¨ç¤ºå¦‚æœå·²çŸ¥é¡¾å®¢è´­ä¹°è‹¹æœæ‰‹æœºï¼Œåˆ™è¯¥é¡¾å®¢æ˜¯ç¡•å£«å­¦å†å¹¶ä¸”æ”¶å…¥10ä¸‡å…ƒçš„æ¦‚ç‡ï¼›è€ŒP(X)åˆ™æ˜¯Xçš„å…ˆéªŒæ¦‚ç‡ï¼Œè¡¨ç¤ºé¡¾å®¢ä¸­çš„æŸä¸ªäººå±äºç¡•å£«å­¦å†ä¸”æ”¶å…¥10ä¸‡å…ƒçš„æ¦‚ç‡ï¼›P(H)ä¹Ÿæ˜¯å…ˆéªŒæ¦‚ç‡ï¼Œåªä¸è¿‡æ˜¯ä»»æ„ç»™å®šé¡¾å®¢å°†è´­ä¹°è‹¹æœæ‰‹æœºçš„æ¦‚ç‡ï¼Œè€Œä¸ä¼šå»ç®¡ä»–ä»¬çš„æ•™è‚²èƒŒæ™¯å’Œæ”¶å…¥æƒ…å†µã€‚</p><p>ä»ä¸Šé¢çš„ä»‹ç»å¯è§ï¼Œç›¸æ¯”äºå…ˆéªŒæ¦‚ç‡P(H)ï¼ŒåéªŒæ¦‚ç‡P(H|X)åŸºäºäº†æ›´å¤šçš„ä¿¡æ¯ï¼ˆæ¯”å¦‚é¡¾å®¢çš„ä¿¡æ¯å±æ€§ï¼‰ï¼Œè€ŒP(H)æ˜¯ç‹¬ç«‹äºXçš„ã€‚</p><p>è´å¶æ–¯å®šç†æ˜¯æœ´ç´ è´å¶æ–¯åˆ†ç±»æ³•ï¼ˆNaive Bayesian Classifierï¼‰çš„åŸºç¡€ï¼Œå¦‚æœç»™å®šæ•°æ®é›†é‡Œæœ‰Mä¸ªåˆ†ç±»ç±»åˆ«ï¼Œé€šè¿‡æœ´ç´ è´å¶æ–¯åˆ†ç±»æ³•ï¼Œå¯ä»¥é¢„æµ‹ç»™å®šè§‚å¯Ÿå€¼æ˜¯å¦å±äºå…·æœ‰æœ€é«˜åéªŒæ¦‚ç‡çš„ç‰¹å®šç±»åˆ«ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ´ç´ è´å¶æ–¯åˆ†ç±»æ–¹æ³•é¢„æµ‹Xå±äºç±»åˆ«$C_i$æ—¶ï¼Œè¡¨ç¤ºå½“ä¸”ä»…å½“<br>$$P(C_i|X)ï¼P(C_j|X)1â‰¤jâ‰¤mï¼Œjâ‰ i$$<br>æ­¤æ—¶å¦‚æœæœ€å¤§åŒ–$P(C_i|X)$ï¼Œå…¶$P(C_i|X)$æœ€å¤§çš„ç±»$C_i$è¢«ç§°ä¸ºæœ€å¤§åéªŒå‡è®¾ï¼Œæ ¹æ®è´å¶æ–¯å®šç†å¯çŸ¥ï¼Œç”±äº$P(X)$å¯¹äºæ‰€æœ‰çš„ç±»åˆ«æ˜¯å‡ç­‰çš„ï¼Œå› æ­¤åªéœ€è¦$P(X|C_i)P(C_i)$å–æœ€å¤§å³å¯ã€‚</p><p>ä¸ºäº†é¢„æµ‹ä¸€ä¸ªæœªçŸ¥æ ·æœ¬$X$çš„ç±»åˆ«ï¼Œå¯å¯¹æ¯ä¸ªç±»åˆ«$C_i$ä¼°ç®—ç›¸åº”çš„$P(X|C_i)P(C_i)$ã€‚æ ·æœ¬$X$å½’å±äºç±»åˆ«$C_i$ï¼Œå½“ä¸”ä»…å½“<br>$$P(C_i|X)ï¼P(C_j|X)1â‰¤jâ‰¤mï¼Œjâ‰ i$$</p><p>è´å¶æ–¯åˆ†ç±»æ–¹æ³•åœ¨æ•°æ®åŒ–è¿è¥å®è·µä¸­ä¸»è¦ç”¨äºåˆ†ç±»é—®é¢˜çš„å½’ç±»ç­‰åº”ç”¨åœºæ™¯ã€‚</p><h3 id="7-æ”¯æŒå‘é‡æœº"><a href="#7-æ”¯æŒå‘é‡æœº" class="headerlink" title="7ã€€æ”¯æŒå‘é‡æœº"></a>7ã€€æ”¯æŒå‘é‡æœº</h3><p>æ”¯æŒå‘é‡æœºï¼ˆSupport Vector Machineï¼‰æ˜¯Vapnikç­‰äººäº1995å¹´ç‡å…ˆæå‡ºçš„ï¼Œæ˜¯è¿‘å¹´æ¥æœºå™¨å­¦ä¹ ç ”ç©¶çš„ä¸€ä¸ªé‡å¤§æˆæœã€‚ä¸ä¼ ç»Ÿçš„ç¥ç»ç½‘ç»œæŠ€æœ¯ç›¸æ¯”ï¼Œæ”¯æŒå‘é‡æœºä¸ä»…ç»“æ„ç®€å•ï¼Œè€Œä¸”å„é¡¹æŠ€æœ¯çš„æ€§èƒ½ä¹Ÿæ˜æ˜¾æå‡ï¼Œå› æ­¤å®ƒæˆä¸ºå½“ä»Šæœºå™¨å­¦ä¹ é¢†åŸŸçš„çƒ­ç‚¹ä¹‹ä¸€ã€‚</p><p>ä½œä¸ºä¸€ç§æ–°çš„åˆ†ç±»æ–¹æ³•ï¼Œæ”¯æŒå‘é‡æœºä»¥ç»“æ„é£é™©æœ€å°ä¸ºåŸåˆ™ã€‚åœ¨çº¿æ€§çš„æƒ…å†µä¸‹ï¼Œå°±åœ¨åŸç©ºé—´å¯»æ‰¾ä¸¤ç±»æ ·æœ¬çš„æœ€ä¼˜åˆ†ç±»è¶…å¹³é¢ã€‚åœ¨éçº¿æ€§çš„æƒ…å†µä¸‹ï¼Œå®ƒ<code>ä½¿ç”¨ä¸€ç§éçº¿æ€§çš„æ˜ å°„ï¼Œå°†åŸè®­ç»ƒé›†æ•°æ®æ˜ å°„åˆ°è¾ƒé«˜çš„ç»´ä¸Š</code>ã€‚åœ¨æ–°çš„ç»´ä¸Šï¼Œå®ƒæœç´¢çº¿æ€§æœ€ä½³åˆ†ç¦»è¶…å¹³é¢ã€‚ä½¿ç”¨ä¸€ä¸ªé€‚å½“çš„å¯¹è¶³å¤Ÿé«˜ç»´çš„éçº¿æ€§æ˜ å°„ï¼Œä¸¤ç±»æ•°æ®æ€»å¯ä»¥è¢«è¶…å¹³é¢åˆ†å¼€ã€‚</p><p>æ”¯æŒå‘é‡æœºçš„åŸºæœ¬æ¦‚å¿µå¦‚ä¸‹ï¼š</p><p>è®¾ç»™å®šçš„è®­ç»ƒæ ·æœ¬é›†ä¸º${(x_1,y_1),(x_2,y_2),â€¦,(x_n,y_n)}$ï¼Œå…¶ä¸­$x_iâˆˆR_n,yâˆˆ[-1,1]$ã€‚</p><p>å†å‡è®¾è¯¥è®­ç»ƒé›†å¯è¢«ä¸€ä¸ªè¶…å¹³é¢çº¿æ€§åˆ’åˆ†ï¼Œè®¾è¯¥è¶…å¹³é¢è®°ä¸º$(w,x)+b=0$ã€‚</p><p>æ”¯æŒå‘é‡æœºçš„åŸºæœ¬æ€æƒ³å¯ç”¨ä¸‹å›¾çš„ä¸¤ç»´æƒ…å†µä¸¾ä¾‹è¯´æ˜ã€‚ï¼ˆçº¿æ€§å¯åˆ†æƒ…å†µä¸‹çš„æœ€ä¼˜åˆ†ç±»çº¿ï¼‰<br><img src="https://ws3.sinaimg.cn/large/006tKfTcly1fq82c0jkiaj30m50g3dgg.jpg" alt=""></p><p>å›¾ä¸­åœ†å½¢å’Œæ–¹å½¢ä»£è¡¨ä¸¤ç±»æ ·æœ¬ï¼ŒHä¸ºåˆ†ç±»çº¿ï¼ŒH1ã€H2ï¼Œåˆ†åˆ«ä¸ºè¿‡å„ç±»æ ·æœ¬ä¸­ç¦»åˆ†ç±»çº¿æœ€è¿‘çš„æ ·æœ¬å¹¶ä¸”å¹³è¡Œäºåˆ†ç±»çº¿çš„ç›´çº¿ï¼Œå®ƒä»¬ä¹‹é—´çš„è·ç¦»å«åš<code>åˆ†ç±»é—´éš”ï¼ˆMarginï¼‰</code>ã€‚æ‰€è°“çš„æœ€ä¼˜åˆ†ç±»çº¿å°±æ˜¯è¦æ±‚åˆ†ç±»çº¿<code>ä¸ä½†èƒ½å°†ä¸¤ç±»æ­£ç¡®åˆ†å¼€ï¼ˆè®­ç»ƒé”™è¯¯ä¸º0ï¼‰ï¼Œè€Œä¸”èƒ½ä½¿åˆ†ç±»é—´éš”æœ€å¤§</code>ã€‚æ¨å¹¿åˆ°é«˜ç»´ç©ºé—´ï¼Œæœ€ä¼˜åˆ†ç±»çº¿å°±æˆäº†æœ€ä¼˜åˆ†ç±»é¢ã€‚</p><p>å…¶ä¸­ï¼Œè·ç¦»è¶…å¹³é¢æœ€è¿‘çš„ä¸€ç±»å‘é‡è¢«ç§°ä¸º<code>æ”¯æŒå‘é‡ï¼ˆSupport Vectorï¼‰</code>ï¼Œ<code>ä¸€ç»„æ”¯æŒå‘é‡å¯ä»¥å”¯ä¸€åœ°ç¡®å®šä¸€ä¸ªè¶…å¹³é¢</code>ã€‚é€šè¿‡å­¦ä¹ ç®—æ³•ï¼ŒSVMå¯ä»¥è‡ªåŠ¨å¯»æ‰¾å‡ºé‚£äº›å¯¹åˆ†ç±»æœ‰è¾ƒå¥½åŒºåˆ†èƒ½åŠ›çš„æ”¯æŒå‘é‡ï¼Œç”±æ­¤æ„é€ å‡ºçš„åˆ†ç±»å™¨åˆ™å¯ä»¥æœ€å¤§åŒ–ç±»ä¸ç±»çš„é—´éš”ï¼Œå› è€Œæœ‰è¾ƒå¥½çš„é€‚åº”èƒ½åŠ›å’Œè¾ƒé«˜çš„åˆ†ç±»å‡†ç¡®ç‡ã€‚</p><p>æ”¯æŒå‘é‡æœºçš„ç¼ºç‚¹æ˜¯è®­ç»ƒæ•°æ®è¾ƒå¤§ï¼Œä½†æ˜¯ï¼Œå®ƒçš„ä¼˜ç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„â€”â€”å¯¹äºå¤æ‚çš„éçº¿æ€§çš„å†³ç­–è¾¹ç•Œçš„å»ºæ¨¡èƒ½åŠ›é«˜åº¦å‡†ç¡®ï¼Œå¹¶ä¸”ä¹Ÿä¸å¤ªå®¹æ˜“è¿‡æ‹Ÿåˆ ã€‚</p><p>æ”¯æŒå‘é‡æœºä¸»è¦ç”¨åœ¨é¢„æµ‹ã€åˆ†ç±»è¿™æ ·çš„å®é™…åˆ†æéœ€æ±‚åœºæ™¯ä¸­ã€‚</p><h3 id="8-ä¸»æˆåˆ†åˆ†æ"><a href="#8-ä¸»æˆåˆ†åˆ†æ" class="headerlink" title="8ã€€ä¸»æˆåˆ†åˆ†æ"></a>8ã€€ä¸»æˆåˆ†åˆ†æ</h3><p>ä¸¥æ ¼æ„ä¹‰ä¸Šè®²ï¼Œä¸»æˆåˆ†åˆ†æï¼ˆPrincipal Components Analysisï¼‰å±äºä¼ ç»Ÿçš„ç»Ÿè®¡åˆ†ææŠ€æœ¯èŒƒç•´ï¼Œä½†æ˜¯æ­£å¦‚æœ¬ç« å‰é¢æ‰€é˜è¿°çš„ï¼Œç»Ÿè®¡åˆ†æä¸æ•°æ®æŒ–æ˜å¹¶æ²¡æœ‰ä¸¥æ ¼çš„åˆ†å‰²ï¼Œå› æ­¤åœ¨æ•°æ®æŒ–æ˜å®æˆ˜åº”ç”¨ä¸­ä¹Ÿå¸¸å¸¸ä¼šç”¨åˆ°è¿™ç§æ–¹å¼ï¼Œä»è¿™ä¸ªè§’åº¦è®²ï¼Œä¸»æˆåˆ†åˆ†æä¹Ÿæ˜¯æ•°æ®æŒ–æ˜å•†ä¸šå®æˆ˜ä¸­å¸¸ç”¨çš„ä¸€ç§åˆ†ææŠ€æœ¯å’Œæ•°æ®å¤„ç†æŠ€æœ¯ã€‚</p><p>ä¸»æˆåˆ†åˆ†æä¼šé€šè¿‡çº¿æ€§ç»„åˆå°†å¤šä¸ªåŸå§‹å˜é‡åˆå¹¶æˆè‹¥å¹²ä¸ªä¸»æˆåˆ†ï¼Œè¿™æ ·<code>æ¯ä¸ªä¸»æˆåˆ†éƒ½å˜æˆäº†åŸå§‹å˜é‡çš„çº¿æ€§ç»„åˆ</code>ã€‚è¿™ç§è½¬å˜çš„ç›®çš„ï¼Œä¸€æ–¹é¢æ˜¯å¯ä»¥å¤§å¹…é™ä½åŸå§‹æ•°æ®çš„ç»´åº¦ï¼ŒåŒæ—¶ä¹Ÿåœ¨æ­¤è¿‡ç¨‹ä¸­å‘ç°åŸå§‹æ•°æ®å±æ€§ä¹‹é—´çš„å…³ç³»ã€‚</p><p>ä¸»æˆåˆ†åˆ†æçš„ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1ï¼‰é€šå¸¸è¦å…ˆè¿›è¡Œå„å˜é‡çš„æ ‡å‡†åŒ–å·¥ä½œï¼Œæ ‡å‡†åŒ–çš„ç›®çš„æ˜¯å°†æ•°æ®æŒ‰ç…§æ¯”ä¾‹è¿›è¡Œç¼©æ”¾ï¼Œä½¿ä¹‹è½å…¥ä¸€ä¸ªå°çš„åŒºé—´èŒƒå›´ä¹‹å†…ï¼Œä»è€Œè®©ä¸åŒçš„å˜é‡ç»è¿‡æ ‡å‡†åŒ–å¤„ç†åå¯ä»¥æœ‰å¹³ç­‰çš„åˆ†æå’Œæ¯”è¾ƒåŸºç¡€ã€‚</p><p>2ï¼‰é€‰æ‹©<code>åæ–¹å·®é˜µ</code>æˆ–è€…<code>ç›¸å…³é˜µè®¡ç®—ç‰¹å¾æ ¹</code>åŠå¯¹åº”çš„<code>ç‰¹å¾å‘é‡</code>ã€‚</p><p>3ï¼‰<code>è®¡ç®—æ–¹å·®è´¡çŒ®ç‡</code>ï¼Œå¹¶æ ¹æ®æ–¹å·®è´¡çŒ®ç‡çš„é˜€å€¼é€‰å–åˆé€‚çš„ä¸»æˆåˆ†ä¸ªæ•°ã€‚</p><p>4ï¼‰æ ¹æ®ä¸»æˆåˆ†è½½è·çš„å¤§å°å¯¹é€‰æ‹©çš„ä¸»æˆåˆ†è¿›è¡Œå‘½åã€‚</p><p>5ï¼‰æ ¹æ®ä¸»æˆåˆ†è½½è·è®¡ç®—å„ä¸ªä¸»æˆåˆ†çš„å¾—åˆ†ã€‚</p><p>å°†ä¸»æˆåˆ†è¿›è¡Œæ¨å¹¿å’Œå»¶ä¼¸å³æˆä¸º<code>å› å­åˆ†æï¼ˆFactor Analysisï¼‰</code>ï¼Œå› å­åˆ†æåœ¨<code>ç»¼åˆåŸå§‹å˜é‡ä¿¡æ¯çš„åŸºç¡€ä¸Šå°†ä¼šåŠ›å›¾æ„ç­‘è‹¥å¹²ä¸ªæ„ä¹‰è¾ƒä¸ºæ˜ç¡®çš„å…¬å› å­</code>ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œé‡‡ç”¨å°‘æ•°å‡ ä¸ªå› å­æè¿°å¤šä¸ªæŒ‡æ ‡ä¹‹é—´çš„è”ç³»ï¼Œå°†æ¯”è¾ƒå¯†åˆ‡çš„å˜é‡å½’ä¸ºåŒä¸€ç±»ä¸­ï¼Œæ¯ç±»å˜é‡å³æ˜¯ä¸€ä¸ªå› å­ã€‚ä¹‹æ‰€ä»¥ç§°å…¶ä¸ºå› å­ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å®é™…ä¸Šæ˜¯<code>ä¸å¯æµ‹é‡çš„ï¼Œåªèƒ½è§£é‡Š</code>ã€‚</p><p><code>ä¸»æˆåˆ†åˆ†ææ˜¯å› å­åˆ†æçš„ä¸€ä¸ªç‰¹ä¾‹</code>ï¼Œä¸¤è€…çš„åŒºåˆ«å’Œè”ç³»ä¸»è¦è¡¨ç°åœ¨ä»¥ä¸‹æ–¹é¢ï¼š</p><p>â‘ä¸»æˆåˆ†åˆ†æä¼šæŠŠä¸»æˆåˆ†è¡¨ç¤ºæˆå„ä¸ªåŸå§‹å˜é‡çš„çº¿æ€§ç»„åˆï¼Œè€Œå› å­åˆ†æåˆ™æŠŠåŸå§‹å˜é‡è¡¨ç¤ºæˆå„ä¸ªå› å­çš„çº¿æ€§ç»„åˆã€‚è¿™ä¸ªåŒºåˆ«æœ€ç›´è§‚ä¹Ÿæœ€å®¹æ˜“è®°ä½ã€‚</p><p>â‘ä¸»æˆåˆ†åˆ†æçš„é‡ç‚¹åœ¨äºè§£é‡ŠåŸå§‹å˜é‡çš„æ€»æ–¹å·®ï¼Œè€Œå› å­åˆ†æçš„é‡ç‚¹åœ¨äºè§£é‡ŠåŸå§‹å˜é‡çš„åæ–¹å·®ã€‚</p><p>â‘åœ¨ä¸»æˆåˆ†åˆ†æä¸­ï¼Œæœ‰å‡ ä¸ªåŸå§‹å˜é‡å°±æœ‰å‡ ä¸ªä¸»æˆåˆ†ï¼Œè€Œåœ¨å› å­åˆ†æä¸­ï¼Œå› å­ä¸ªæ•°å¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯çš„éœ€è¦äººä¸ºæŒ‡å®šï¼Œå¹¶ä¸”æŒ‡å®šçš„å› å­æ•°é‡ä¸åŒï¼Œåˆ™åˆ†æç»“æœä¹Ÿä¼šæœ‰å·®å¼‚ã€‚</p><p>â‘åœ¨ä¸»æˆåˆ†åˆ†æä¸­ï¼Œç»™å®šçš„åæ–¹å·®çŸ©é˜µæˆ–è€…ç›¸å…³çŸ©é˜µçš„ç‰¹å¾å€¼æ˜¯å”¯ä¸€æ—¶ï¼Œä¸»æˆåˆ†ä¹Ÿæ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯åœ¨å› å­åˆ†æä¸­ï¼Œå› å­ä¸æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”é€šè¿‡æ—‹è½¬å¯ä»¥å¾—åˆ°ä¸åŒçš„å› å­ã€‚</p><p>ä¸»æˆåˆ†åˆ†æå’Œå› å­åˆ†æåœ¨æ•°æ®åŒ–è¿è¥å®è·µä¸­ä¸»è¦ç”¨äºæ•°æ®å¤„ç†ã€é™ç»´ã€å˜é‡é—´å…³ç³»çš„æ¢ç´¢ç­‰æ–¹é¢ï¼ŒåŒæ—¶ä½œä¸ºç»Ÿè®¡å­¦é‡Œçš„åŸºæœ¬è€Œé‡è¦çš„åˆ†æå·¥å…·å’Œåˆ†ææ–¹æ³•ï¼Œå®ƒä»¬åœ¨ä¸€äº›ä¸“é¢˜åˆ†æä¸­ä¹Ÿæœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚</p><h3 id="9-å‡è®¾æ£€éªŒ"><a href="#9-å‡è®¾æ£€éªŒ" class="headerlink" title="9ã€€å‡è®¾æ£€éªŒ"></a>9ã€€å‡è®¾æ£€éªŒ</h3><p>å‡è®¾æ£€éªŒï¼ˆHypothesis Testï¼‰æ˜¯ç°ä»£ç»Ÿè®¡å­¦çš„åŸºç¡€å’Œæ ¸å¿ƒä¹‹ä¸€ï¼Œå…¶ä¸»è¦ç ”ç©¶åœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹ï¼Œæ€»ä½“æ˜¯å¦å…·å¤‡æŸäº›ç‰¹å®šç‰¹å¾ã€‚</p><p>å‡è®¾æ£€éªŒçš„åŸºæœ¬åŸç†å°±æ˜¯å°æ¦‚ç‡äº‹ä»¶åŸç†ï¼Œå³è§‚æµ‹å°æ¦‚ç‡äº‹ä»¶åœ¨å‡è®¾æˆç«‹çš„æƒ…å†µä¸‹æ˜¯å¦å‘ç”Ÿã€‚å¦‚æœåœ¨ä¸€æ¬¡è¯•éªŒä¸­ï¼Œå°æ¦‚ç‡äº‹ä»¶å‘ç”Ÿäº†ï¼Œé‚£ä¹ˆè¯´æ˜å‡è®¾åœ¨ä¸€å®šçš„æ˜¾è‘—æ€§æ°´å¹³ä¸‹ä¸å¯é æˆ–è€…ä¸æˆç«‹ï¼›å¦‚æœåœ¨ä¸€æ¬¡è¯•éªŒä¸­ï¼Œå°æ¦‚ç‡äº‹ä»¶æ²¡æœ‰å‘ç”Ÿï¼Œé‚£ä¹ˆä¹Ÿåªèƒ½è¯´æ˜æ²¡æœ‰è¶³å¤Ÿç†ç”±ç›¸ä¿¡å‡è®¾æ˜¯é”™è¯¯çš„ï¼Œä½†æ˜¯ä¹Ÿå¹¶ä¸èƒ½è¯´æ˜å‡è®¾æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºæ— æ³•æ”¶é›†åˆ°æ‰€æœ‰çš„è¯æ®æ¥è¯æ˜å‡è®¾æ˜¯æ­£ç¡®çš„ã€‚</p><p>å‡è®¾æ£€éªŒçš„ç»“è®ºæ˜¯åœ¨ä¸€å®šçš„æ˜¾è‘—æ€§æ°´å¹³ä¸‹å¾—å‡ºçš„ã€‚å› æ­¤ï¼Œå½“é‡‡ç”¨æ­¤æ–¹æ³•è§‚æµ‹äº‹ä»¶å¹¶ä¸‹ç»“è®ºæ—¶ï¼Œæœ‰å¯èƒ½ä¼šçŠ¯é”™ï¼Œè¿™äº›é”™è¯¯ä¸»è¦æœ‰ä¸¤å¤§ç±»ï¼š</p><p>â‘ç¬¬â… ç±»é”™è¯¯ï¼šå½“åŸå‡è®¾ä¸ºçœŸæ—¶ï¼Œå´å¦å®šå®ƒè€ŒçŠ¯çš„é”™è¯¯ï¼Œå³æ‹’ç»æ­£ç¡®å‡è®¾çš„é”™è¯¯ï¼Œä¹Ÿå«å¼ƒçœŸé”™è¯¯ã€‚çŠ¯ç¬¬â… ç±»é”™è¯¯çš„æ¦‚ç‡è®°ä¸ºÎ±ï¼Œé€šå¸¸ä¹Ÿå«Î±é”™è¯¯ï¼ŒÎ±=1-ç½®ä¿¡åº¦ã€‚</p><p>â‘ç¬¬â…¡ç±»é”™è¯¯ï¼šå½“åŸå‡è®¾ä¸ºå‡æ—¶ï¼Œå´è‚¯å®šå®ƒè€ŒçŠ¯çš„é”™è¯¯ï¼Œå³æ¥å—é”™è¯¯å‡è®¾çš„é”™è¯¯ï¼Œä¹Ÿå«çº³ä¼ªé”™è¯¯ã€‚çŠ¯ç¬¬â…¡ç±»é”™è¯¯çš„æ¦‚ç‡è®°ä¸ºÎ²ï¼Œé€šå¸¸ä¹Ÿå«Î²é”™è¯¯ã€‚</p><p>ä¸Šè¿°è¿™ä¸¤ç±»é”™è¯¯åœ¨å…¶ä»–æ¡ä»¶ä¸å˜çš„æƒ…å†µä¸‹æ˜¯ç›¸åçš„ï¼Œå³Î±å¢å¤§æ—¶ï¼ŒÎ²å°±å‡å°ï¼›Î±å‡å°æ—¶ï¼ŒÎ²å°±å¢å¤§ã€‚Î±é”™è¯¯å®¹æ˜“å—æ•°æ®åˆ†æäººå‘˜çš„æ§åˆ¶ï¼Œå› æ­¤åœ¨å‡è®¾æ£€éªŒä¸­ï¼Œé€šå¸¸ä¼šå…ˆæ§åˆ¶ç¬¬â… ç±»é”™è¯¯å‘ç”Ÿçš„æ¦‚ç‡Î±ï¼Œå…·ä½“è¡¨ç°ä¸ºï¼šåœ¨åšå‡è®¾æ£€éªŒä¹‹å‰å…ˆæŒ‡å®šä¸€ä¸ªÎ±çš„å…·ä½“æ•°å€¼ï¼Œé€šå¸¸å–0.05ï¼Œä¹Ÿå¯ä»¥å–0.1æˆ–0.001ã€‚</p><p>åœ¨æ•°æ®åŒ–è¿è¥çš„å•†ä¸šå®è·µä¸­ï¼Œå‡è®¾æ£€éªŒæœ€å¸¸ç”¨çš„åœºæ™¯å°±æ˜¯ç”¨äºâ€œè¿è¥æ•ˆæœçš„è¯„ä¼°â€ä¸Šã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;åŸºäºæ•°æ®æŒ–æ˜çš„9å¤§ä¸»è¦æˆç†ŸæŠ€æœ¯ä»¥åŠåœ¨æ•°æ®åŒ–è¿è¥ä¸­çš„ä¸»è¦åº”ç”¨ï¼š&lt;br&gt;1ã€å†³ç­–æ ‘&lt;br&gt;2ã€ç¥ç»ç½‘ç»œ&lt;br&gt;3ã€å›å½’&lt;br&gt;4ã€å…³è”è§„åˆ™&lt;br&gt;5ã€èšç±»&lt;br&gt;6ã€è´å¶æ–¯åˆ†ç±»&lt;br&gt;7ã€æ”¯æŒå‘é‡æœº&lt;br&gt;8ã€ä¸»æˆåˆ†åˆ†æ&lt;br&gt;9ã€å‡è®¾æ£€éªŒ&lt;
      
    
    </summary>
    
      <category term="Machine learning" scheme="http://www.ihoge.cn/categories/Machine-learning/"/>
    
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://www.ihoge.cn/tags/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
  </entry>
  
  <entry>
    <title>PCAä¸»æˆåˆ†åˆ†æ+SVMäººè„¸è¯†åˆ«å‡†ç¡®ç‡97%+</title>
    <link href="http://www.ihoge.cn/2018/PCA+SVM%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB.html"/>
    <id>http://www.ihoge.cn/2018/PCA+SVMäººè„¸è¯†åˆ«.html</id>
    <published>2018-04-09T17:05:59.000Z</published>
    <updated>2018-04-10T10:01:34.819Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="åŠ è½½æ•°æ®"><a href="#åŠ è½½æ•°æ®" class="headerlink" title="åŠ è½½æ•°æ®"></a>åŠ è½½æ•°æ®</h2><p>è¿™é‡Œä½¿ç”¨çš„æµ‹è¯•æ•°æ®å…±åŒ…å«40ä½äººå‘˜ç…§ç‰‡ï¼Œæ¯ä¸ªäºº10å¼ ç…§ç‰‡ã€‚ä¹Ÿå¯ç™»é™†<a href="http://www.cl.cam.ac.uk/research/dtg/attarchive/facesataglance.html" target="_blank" rel="noopener">http://www.cl.cam.ac.uk/research/dtg/attarchive/facesataglance.html</a> æŸ¥çœ‹400å¼ ç…§ç‰‡çš„ç¼©ç•¥å›¾ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> fetch_olivetti_faces</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level = logging.INFO, format=<span class="string">"%(asctime)s %(message)s"</span>) <span class="comment"># è¿™é‡ŒINFOå¿…é¡»å¤§å†™</span></span><br><span class="line"></span><br><span class="line">data_home = <span class="string">'code/datasets/'</span></span><br><span class="line">logging.info(<span class="string">"å¼€å§‹åŠ è½½æ•°æ®"</span>)</span><br><span class="line">faces = fetch_olivetti_faces(data_home=data_home)</span><br><span class="line">logging.info(<span class="string">"åŠ è½½å®Œæˆ"</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåšä¸‹ç®€å•çš„è§£é‡Šï¼š</p><p>åŠ è½½çš„å›¾ç‰‡ä¿å­˜åœ¨faceså˜é‡é‡Œï¼Œsklaernå·²ç»æŠŠæ¯å¼ ç…§ç‰‡å¤„ç†æˆå‰ªåˆ‡æ‰å¤´å‘éƒ¨åˆ†å¹¶ä¸”64x64å¤§å°ä¸”äººè„¸å±…ä¸­æ˜¾ç¤ºã€‚åœ¨çœŸå®ç”Ÿäº§ç¯å¢ƒä¸­è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå¦åˆ™æ¨¡å‹å°†è¢«å¤§é‡çš„å™ªå£°å¹²æ‰°ï¼ˆå³ç…§ç‰‡èƒŒæ™¯ï¼Œå˜åŒ–çš„å‘å‹ç­‰ï¼Œè¿™äº›ç‰¹å¾éƒ½åº”è¯¥æ’é™¤åœ¨è¾“å…¥ç‰¹å¾ä¹‹å¤–ï¼‰ã€‚æœ€åè¦æˆåŠŸä¸‹è½½æ•°æ®é›†è¿˜éœ€è¦å®‰è£…Pythonå›¾ç‰‡å›¾é‡Œå·¥å…·Pillowå¦åˆ™æ— æ³•å¯¹å›¾ç‰‡è§£ç ã€‚ä¸‹é¢è¾“å‡ºä¸‹æ•°æ®çš„æ¦‚è¦ä¿¡æ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">X = faces.data</span><br><span class="line">y = faces.target</span><br><span class="line"></span><br><span class="line">targets = np.unique(faces.target)</span><br><span class="line">target_names = np.array([<span class="string">"p%d"</span> % t <span class="keyword">for</span> t <span class="keyword">in</span> targets]) <span class="comment">#ç»™æ¯ä¸ªäººåšæ ‡ç­¾</span></span><br><span class="line">n_targets = target_name.shape[<span class="number">0</span>]</span><br><span class="line">n_samples, h, w = faces.images.shape</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Samples count:&#123;&#125;\nTarget count:&#123;&#125;'</span>.format(n_samples, n_targets))</span><br><span class="line">print(<span class="string">'Image size:&#123;&#125;x&#123;&#125;\nData shape:&#123;&#125;'</span>.format(w, h, X.shape))</span><br></pre></td></tr></table></figure><pre><code>Samples count:400Target count:40Image size:64x64Data shape:(400, 4096)</code></pre><p>ç”±è¾“å‡ºå¯çŸ¥ï¼Œå…±æœ‰40äººï¼Œç…§ç‰‡æ€»é‡400ï¼Œè¾“å…¥ç‰¹å¾(64x64=4096)ä¸ªã€‚</p><p>ä¸ºäº†ç›´è§‚è§‚å¯Ÿæ•°æ®ï¼Œä»æ¯ä¸ªäººç‰©çš„ç…§ç‰‡é‡Œéšæœºé€‰æ‹©ä¸€å¼ æ˜¾ç¤ºï¼Œå®šä¹‰ä¸‹ç”»å›¾å·¥å…·ï¼š</p><p>å…¶ä¸­è¾“å…¥å‚æ•°imagesæ˜¯ä¸€ä¸ªäºŒç»´æ•°æ®ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªå›¾ç‰‡æ•°æ®ã€‚åœ¨åŠ è½½æ•°æ®æ—¶ï¼Œfech_ollivetti_faces()å‡½æ•°å·²ç»è‡ªåŠ¨åšäº†é¢„å¤„ç†ï¼Œå›¾ç‰‡çš„æ¯ä¸ªåƒç´ çš„RBGå€¼éƒ½è½¬æ¢æˆäº†[0,1]æµ®ç‚¹æ•°ã€‚å› æ­¤ï¼Œç”»å‡ºæ¥çš„ç…§ç‰‡ä¹Ÿæ˜¯é»‘ç™½çš„ã€‚å­å›¾ç‰‡è¯†åˆ«é¢†åŸŸä¸€èˆ¬ç”¨é»‘ç™½ç…§ç‰‡å°±å¯ä»¥äº†ï¼Œå‡å°‘è®¡ç®—é‡çš„åŒæ—¶ä¹Ÿæ›´åŠ å‡†ç¡®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_gallery</span><span class="params">(images, titles, h, w, n_row=<span class="number">2</span>, n_col=<span class="number">5</span>)</span>:</span></span><br><span class="line"><span class="comment">#     æ˜¾ç¤ºå›¾ç‰‡é˜µåˆ—ï¼š</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">2</span>*n_col, <span class="number">2.2</span>*n_row),dpi=<span class="number">140</span>)</span><br><span class="line">    plt.subplots_adjust(bottom=<span class="number">0</span>, left=<span class="number">.01</span>, right=<span class="number">.99</span>, top=<span class="number">.90</span>, hspace=<span class="number">.01</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n_row * n_col):</span><br><span class="line">        plt.subplot(n_row, n_col, i+<span class="number">1</span>)</span><br><span class="line">        plt.imshow(images[i].reshape((h,w)), cmap=plt.cm.gray)</span><br><span class="line">        plt.title(titles[i])</span><br><span class="line">        plt.axis(<span class="string">'off'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">n_row = <span class="number">2</span></span><br><span class="line">n_col = <span class="number">6</span></span><br><span class="line"></span><br><span class="line">sample_images = <span class="keyword">None</span></span><br><span class="line">sample_titles = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n_targets):</span><br><span class="line">    people_images = X[y==i]  <span class="comment"># æ³¨æ„è¿™é‡Œä¼ å…¥i</span></span><br><span class="line">    people_sample_index = np.random.randint(<span class="number">0</span>, people_images.shape[<span class="number">0</span>], <span class="number">1</span>)</span><br><span class="line">    people_sample_image = people_images[people_sample_index, :]</span><br><span class="line">    <span class="keyword">if</span> sample_images <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        sample_images = np.concatenate((sample_images, people_sample_image), axis=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sample_images =people_sample_image</span><br><span class="line">    sample_titles.append(target_names[i])   <span class="comment"># è¿™é‡Œtarget_namesæ˜¯åœ¨å‰é¢ç”Ÿæˆçš„æ ‡ç­¾</span></span><br><span class="line">    </span><br><span class="line">plot_gallery(sample_images, sample_titles, h, w, n_row, n_col)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä»£ç ä¸­X[y=i]å¯ä»¥é€‰æ‹©é™¤ç‰¹å®šçš„æ‰€æœ‰ç…§ç‰‡ï¼Œéšæœºé€‰å‡ºæ¥çš„ç…§ç‰‡æ”¾åœ¨sample.imagesæ•°ç»„å¯¹è±¡é‡Œï¼Œæœ€åè°ƒç”¨ä¹‹å‰å®šä¹‰çš„å‡½æ•°æŠŠç…§ç‰‡ç”»å‡ºæ¥ã€‚</span></span><br></pre></td></tr></table></figure><p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fq6vy8axmgj31bo0gs0xb.jpg" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="number">0.2</span>, random_state=<span class="number">4</span>)</span><br></pre></td></tr></table></figure><h2 id="æ”¯æŒå‘é‡æœºç¬¬ä¸€æ¬¡å°è¯•"><a href="#æ”¯æŒå‘é‡æœºç¬¬ä¸€æ¬¡å°è¯•" class="headerlink" title="æ”¯æŒå‘é‡æœºç¬¬ä¸€æ¬¡å°è¯•"></a>æ”¯æŒå‘é‡æœºç¬¬ä¸€æ¬¡å°è¯•</h2><p>ç›´æ¥é£Ÿç”¨æ”¯æŒå‘é‡æœºæ¥å®ç°äººè„¸è¯†åˆ«ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line"></span><br><span class="line">t = time()</span><br><span class="line">clf = SVC(class_weight=<span class="string">'balanced'</span>)</span><br><span class="line">clf.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">"è€—æ—¶ï¼š&#123;&#125;ç§’"</span>.format(time() - t))</span><br></pre></td></tr></table></figure><pre><code>è€—æ—¶ï¼š1.0220119953155518ç§’</code></pre><h3 id="1ã€æ¥ç€å¯¹äººè„¸æ•°æ®è¿›è¡Œé¢„æµ‹ï¼šä½¿ç”¨confusion-matrixæŸ¥çœ‹å‡†ç¡®æ€§ï¼š"><a href="#1ã€æ¥ç€å¯¹äººè„¸æ•°æ®è¿›è¡Œé¢„æµ‹ï¼šä½¿ç”¨confusion-matrixæŸ¥çœ‹å‡†ç¡®æ€§ï¼š" class="headerlink" title="1ã€æ¥ç€å¯¹äººè„¸æ•°æ®è¿›è¡Œé¢„æµ‹ï¼šä½¿ç”¨confusion_matrixæŸ¥çœ‹å‡†ç¡®æ€§ï¼š"></a><strong>1ã€æ¥ç€å¯¹äººè„¸æ•°æ®è¿›è¡Œé¢„æµ‹ï¼šä½¿ç”¨<code>confusion_matrix</code>æŸ¥çœ‹å‡†ç¡®æ€§ï¼š</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> confusion_matrix</span><br><span class="line"></span><br><span class="line">y_pred = clf.predict(X_test)</span><br><span class="line">cm = confusion_matrix(y_test, y_pred, labels=range(n_targets))</span><br><span class="line">print(<span class="string">"confusion_matrix:\n"</span>)</span><br><span class="line"><span class="comment"># np.set_printoptions(threshold=np.nan)</span></span><br><span class="line">print(cm[:<span class="number">10</span>])</span><br></pre></td></tr></table></figure><pre><code>confusion_matrix:[[0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0 0 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0 0 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0 0 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0 0 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]]</code></pre><p>ä¸Šé¢<code>np.set_printoptions()</code>æ˜¯ä¸ºäº†ç¡®ä¿cmå®Œæ•´è¾“å‡ºï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ªæ•°ç»„æ˜¯40x40çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå…¨éƒ¨è¾“å‡ºã€‚??</p><h3 id="2ã€ä½¿ç”¨classification-reportæŸ¥çœ‹å‡†ç¡®æ€§"><a href="#2ã€ä½¿ç”¨classification-reportæŸ¥çœ‹å‡†ç¡®æ€§" class="headerlink" title="2ã€ä½¿ç”¨classification_reportæŸ¥çœ‹å‡†ç¡®æ€§"></a><strong>2ã€ä½¿ç”¨<code>classification_report</code>æŸ¥çœ‹å‡†ç¡®æ€§</strong></h3><p>ä½†æ˜¯å¾ˆæ˜æ˜¾è¾“å‡ºç»“æœæ•ˆæœå¾ˆå·®ã€‚ å› ä¸º<code>confusion_matrix</code>ç†æƒ³çš„è¾“å‡ºæ˜¯çŸ©é˜µçš„å¯¹è§’çº¿ä¸Šæœ‰æ•°ç»„ï¼Œå…¶ä»–åœ°æ–¹éƒ½ä¸º0ï¼Œè€Œä¸”è¿™é‡Œå¾ˆå¤šå›¾ç‰‡éƒ½è¢«é¢„æµ‹æˆç´¢å¼•ä¸º12çš„ç±»åˆ«äº†ã€‚æˆ‘ä¹°å†æ¥çœ‹ä¸‹<code>classification_report</code>çš„ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report</span><br><span class="line"></span><br><span class="line">print(classification_report(y_test, y_pred, target_names = target_names)) <span class="comment">#è¿™é‡Œy_testå’Œy_predä¸è¦é¢ å€’ã€‚</span></span><br></pre></td></tr></table></figure><pre><code>             precision    recall  f1-score   support         p0       0.00      0.00      0.00         1         p1       0.00      0.00      0.00         3         p2       0.00      0.00      0.00         2         p3       0.00      0.00      0.00         1         p4       0.00      0.00      0.00         1         p5       0.00      0.00      0.00         1         p6       0.00      0.00      0.00         4         p7       0.00      0.00      0.00         2         p8       0.00      0.00      0.00         4         p9       0.00      0.00      0.00         2        p10       0.00      0.00      0.00         1        p11       0.00      0.00      0.00         0        p12       0.00      0.00      0.00         4        p13       0.00      0.00      0.00         4        p14       0.00      0.00      0.00         1        p15       0.00      0.00      0.00         1        p16       0.00      0.00      0.00         3        p17       0.00      0.00      0.00         2        p18       0.00      0.00      0.00         2        p19       0.00      0.00      0.00         2        p20       0.00      0.00      0.00         1        p21       0.00      0.00      0.00         2        p22       0.00      0.00      0.00         3        p23       0.00      0.00      0.00         2        p24       0.00      0.00      0.00         3        p25       0.00      0.00      0.00         3        p26       0.00      0.00      0.00         2        p27       0.00      0.00      0.00         2        p28       0.00      0.00      0.00         0        p29       0.00      0.00      0.00         2        p30       0.00      0.00      0.00         2        p31       0.00      0.00      0.00         3        p32       0.00      0.00      0.00         2        p33       0.00      0.00      0.00         2        p34       0.00      0.00      0.00         0        p35       0.00      0.00      0.00         2        p36       0.00      0.00      0.00         3        p37       0.00      0.00      0.00         1        p38       0.00      0.00      0.00         2        p39       0.00      0.00      0.00         2avg / total       0.00      0.00      0.00        80/Users/hadoop/anaconda3/lib/python3.6/site-packages/sklearn/metrics/classification.py:1135: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.  &apos;precision&apos;, &apos;predicted&apos;, average, warn_for)/Users/hadoop/anaconda3/lib/python3.6/site-packages/sklearn/metrics/classification.py:1137: UndefinedMetricWarning: Recall and F-score are ill-defined and being set to 0.0 in labels with no true samples.  &apos;recall&apos;, &apos;true&apos;, average, warn_for)</code></pre><p>ç»“æœä¸å‡ºé¢„æ–™ï¼Œæœç„¶å¾ˆå·®ã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼š<strong>è¿™é‡ŒæŠŠæ¯ä¸ªåƒç´ éƒ½ä½œä¸ºä¸€ä¸ªè¾“å…¥ç‰¹å¾æ¥å¤„ç†ï¼Œè¿™æ ·é‚£ä¸ªæ•°æ®å™ªå£°å¤ªä¸¥é‡äº†ï¼Œæ¨¡å‹æ ¹æœ¬æ²¡æœ‰åŠæ³•å¯¹è®­ç»ƒæ•°æ®é›†è¿›è¡Œæ‹Ÿåˆã€‚è¿™é‡Œæœ‰4096ä¸ªç‰¹å¾å‘é‡ï¼Œå¯æ˜¯æ•°æ®é›†å¤§å°æ‰400ä¸ªï¼Œæ¯”ç‰¹å¾ä¸ªæ•°å°‘äº†å¤ªå¤šï¼Œè€Œä¸”åˆ†å‡º20%ä½œä¸ºæµ‹è¯•é›†ã€‚è¿™ç§æƒ…å†µä¸‹æ ¹æœ¬æ— æ³•è¿›è¡Œå‡†ç¡®çš„è®­ç»ƒå’Œé¢„æµ‹ã€‚</strong></p><h2 id="ä½¿ç”¨PCAæ¥å¤„ç†æ•°æ®é›†"><a href="#ä½¿ç”¨PCAæ¥å¤„ç†æ•°æ®é›†" class="headerlink" title="ä½¿ç”¨PCAæ¥å¤„ç†æ•°æ®é›†"></a>ä½¿ç”¨PCAæ¥å¤„ç†æ•°æ®é›†</h2><h3 id="é€‰æ‹©-k-å€¼"><a href="#é€‰æ‹©-k-å€¼" class="headerlink" title="é€‰æ‹©$k$å€¼"></a>é€‰æ‹©$k$å€¼</h3><p>è§£å†³ä¸Šè¿°é—®é¢˜çš„åŠæ³•æœ‰ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯åŠ å¤§æ•°æ®æ ·æœ¬é‡ï¼ˆåœ¨è¿™é‡Œè¿™ä¸ªä¸å¤ªç°å®ï¼‰ï¼Œæˆ–è€…ä½¿ç”¨PCAç»™æ•°æ®é™ç»´ï¼Œå€¼é€‰æ‹©å‰kä¸ªæœ€é‡è¦çš„ç‰¹å¾ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æ ¹æ®PCAç®—æ³•æ¥è®¡ç®—å¤±çœŸç¨‹åº¦æ¥ç¡®å®škå€¼ã€‚</p><p>åœ¨sklearné‡Œï¼Œå¯ä»¥ä»PCAæ¨¡å‹çš„<code>explained_variance_ratio_</code>å˜é‡é‡Œè·å–ç»PCAå¤„ç†åçš„æ•°æ®è¿˜åŸç‡ã€‚è¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€æœ‰å…ƒç´ æ±‚å’Œå³å¯çŸ¥é“é€‰æ‹©çš„$k$å€¼çš„æ•°æ®è¿˜åŸç‡ã€‚éšç€$k$çš„å¢å¤§ï¼Œæ•°å€¼ä¼šæ— é™æ¥è¿‘äº1ã€‚</p><p>åˆ©ç”¨è¿™ä¸€ç‰¹å¾ï¼Œå¯ä»¥è®©$k$å–å€¼10ï½300ä¹‹é—´ï¼Œæ¯ä¸ª30å–ä¸€æ¬¡æ ·ã€‚é’ˆå¯¹è¿™é‡Œçš„æƒ…å†µé€‰æ‹©å¤±çœŸåº¦å°äº5%å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.decomposition <span class="keyword">import</span> PCA</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Exploring explained variance ratio for dataset ..."</span>)</span><br><span class="line">candidate_components = range(<span class="number">10</span>, <span class="number">300</span>, <span class="number">30</span>)</span><br><span class="line">explained_ratios = []</span><br><span class="line">t = time()</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> candidate_components:</span><br><span class="line">    pca = PCA(n_components=c)</span><br><span class="line">    X_pca = pca.fit_transform(X)</span><br><span class="line">    explained_ratios.append(np.sum(pca.explained_variance_ratio_))</span><br><span class="line">print(<span class="string">'Done in &#123;0:.2f&#125;s'</span>.format(time()-t))</span><br></pre></td></tr></table></figure><pre><code>Exploring explained variance ratio for dataset ...Done in 2.17s</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">8</span>, <span class="number">5</span>), dpi=<span class="number">100</span>)</span><br><span class="line">plt.grid()</span><br><span class="line">plt.plot(candidate_components, explained_ratios)</span><br><span class="line">plt.xlabel(<span class="string">'Number of PCA Components'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Explained Variance Ratio'</span>)</span><br><span class="line">plt.title(<span class="string">'Explained variance ratio for PCA'</span>)</span><br><span class="line">plt.yticks(np.arange(<span class="number">0.5</span>, <span class="number">1.05</span>, <span class="number">.05</span>))</span><br><span class="line">plt.xticks(np.arange(<span class="number">0</span>, <span class="number">300</span>, <span class="number">20</span>));</span><br></pre></td></tr></table></figure><p><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fq6vyorh25j30jj0ctdh6.jpg" alt=""></p><p>ç”±ä¸Šå›¾å¯çŸ¥ï¼Œè‹¥è¦ä¿ç•™95%çš„æ•°æ®è¿˜åŸç‡ï¼Œ$k$å€¼é€‰æ‹©120å³å¯ã€‚ä¸ºäº†æ›´ç›´è§‚çš„çœ‹ä¸åŒ$k$å€¼çš„åŒºåˆ«ï¼Œè¿™é‡Œç”»å‡ºæ¥ä½“éªŒä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">title_prefix</span><span class="params">(prefix, title)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"&#123;&#125;: &#123;&#125;"</span>.format(prefix, title)</span><br><span class="line"></span><br><span class="line">n_row = <span class="number">1</span></span><br><span class="line">n_col = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">sample_images = sample_images[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line">sample_titles = sample_titles[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">plotting_images = sample_images</span><br><span class="line">plotting_titles = [title_prefix(<span class="string">'orig'</span>, t) <span class="keyword">for</span> t <span class="keyword">in</span> sample_titles]</span><br><span class="line">candidate_components = [<span class="number">120</span>, <span class="number">75</span>, <span class="number">37</span>, <span class="number">19</span>, <span class="number">8</span>]</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> candidate_components:</span><br><span class="line">    print(<span class="string">"Fitting and projecting on PCA(n_components=&#123;&#125;) ..."</span>.format(c))</span><br><span class="line">    t = time()</span><br><span class="line">    pca = PCA(n_components=c)</span><br><span class="line">    pca.fit(X)</span><br><span class="line">    X_sample_pca = pca.transform(sample_images)</span><br><span class="line">    X_sample_inv = pca.inverse_transform(X_sample_pca)</span><br><span class="line">    plotting_images = np.concatenate((plotting_images, X_sample_inv), axis=<span class="number">0</span>)</span><br><span class="line">    sample_title_pca = [title_prefix(<span class="string">'&#123;&#125;'</span>.format(c), t) <span class="keyword">for</span> t <span class="keyword">in</span> sample_titles]</span><br><span class="line">    plotting_titles = np.concatenate((plotting_titles, sample_title_pca), axis=<span class="number">0</span>)</span><br><span class="line">    print(<span class="string">"Done in &#123;0:.2f&#125;s"</span>.format(time() - t))</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Plotting sample image with different number of PCA conpoments ..."</span>)</span><br><span class="line">plot_gallery(plotting_images, plotting_titles, h, w,</span><br><span class="line">    n_row * (len(candidate_components) + <span class="number">1</span>), n_col)</span><br></pre></td></tr></table></figure><pre><code>Fitting and projecting on PCA(n_components=120) ...Done in 0.18sFitting and projecting on PCA(n_components=75) ...Done in 0.14sFitting and projecting on PCA(n_components=37) ...Done in 0.11sFitting and projecting on PCA(n_components=19) ...Done in 0.07sFitting and projecting on PCA(n_components=8) ...Done in 0.06sPlotting sample image with different number of PCA conpoments ...</code></pre><p><img src="https://ws1.sinaimg.cn/large/006tKfTcly1fq6vzviawhj31411bntk5.jpg" alt=""></p><h3 id="åˆ©ç”¨GridSearchCVé€‰å‡ºæœ€ä¼˜å‚æ•°"><a href="#åˆ©ç”¨GridSearchCVé€‰å‡ºæœ€ä¼˜å‚æ•°" class="headerlink" title="åˆ©ç”¨GridSearchCVé€‰å‡ºæœ€ä¼˜å‚æ•°"></a>åˆ©ç”¨GridSearchCVé€‰å‡ºæœ€ä¼˜å‚æ•°</h3><p>æ¥ä¸‹æ¥é€‰æ‹©$k=120$ä½œä¸º<code>PCA</code>çš„å‚æ•°å¯¹æ•°æ®é›†å’Œæµ‹è¯•é›†è¿›è¡Œç‰¹å¾æå–ï¼Œç„¶åè°ƒç”¨<code>GridSearchCV</code>é€‰å‡ºæœ€ä¼˜å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">n_components = <span class="number">120</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"Fitting PCA by using training data ..."</span>)</span><br><span class="line">t = time()</span><br><span class="line">pca = PCA(n_components=n_components, svd_solver=<span class="string">'randomized'</span>, whiten=<span class="keyword">True</span>).fit(X_train)</span><br><span class="line">print(<span class="string">"Done in &#123;0:.2f&#125;s"</span>.format(time() - t))</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Projecting input data for PCA ..."</span>)</span><br><span class="line">t = time()</span><br><span class="line">X_train_pca = pca.transform(X_train)</span><br><span class="line">X_test_pca = pca.transform(X_test)</span><br><span class="line">print(<span class="string">"Done in &#123;0:.2f&#125;s"</span>.format(time() - t))</span><br></pre></td></tr></table></figure><pre><code>Fitting PCA by using training data ...Done in 0.16sProjecting input data for PCA ...Done in 0.01s</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Searching the best parameters for SVC ..."</span>)</span><br><span class="line">param_grid = &#123;<span class="string">'C'</span>: [<span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">50</span>],</span><br><span class="line">              <span class="string">'gamma'</span>: [<span class="number">0.0001</span>, <span class="number">0.0005</span>, <span class="number">0.001</span>, <span class="number">0.005</span>, <span class="number">0.01</span>]&#125;</span><br><span class="line">clf = GridSearchCV(SVC(kernel=<span class="string">'rbf'</span>, class_weight=<span class="string">'balanced'</span>), param_grid, verbose=<span class="number">2</span>, n_jobs=<span class="number">4</span>)<span class="comment"># å‚æ•°n_jobs=4è¡¨ç¤ºå¯åŠ¨4ä¸ªè¿›ç¨‹</span></span><br><span class="line">clf = clf.fit(X_train_pca, y_train)</span><br><span class="line">print(<span class="string">"Best parameters found by grid search:"</span>)</span><br><span class="line">print(clf.best_params_)</span><br></pre></td></tr></table></figure><pre><code>Searching the best parameters for SVC ...Fitting 3 folds for each of 20 candidates, totalling 60 fits[CV] C=1, gamma=0.0001 ...............................................[CV] C=1, gamma=0.0001 ...............................................[CV] C=1, gamma=0.0001 ...............................................[CV] C=1, gamma=0.0005 ...............................................[CV] ................................ C=1, gamma=0.0001, total=   0.1s[CV] C=1, gamma=0.0005 ...............................................[CV] ................................ C=1, gamma=0.0001, total=   0.1s[CV] C=1, gamma=0.0005 ...............................................[CV] ................................ C=1, gamma=0.0001, total=   0.1s[CV] C=1, gamma=0.001 ................................................[CV] ................................ C=1, gamma=0.0005, total=   0.1s[CV] C=1, gamma=0.001 ................................................[CV] ................................ C=1, gamma=0.0005, total=   0.1s[CV] C=1, gamma=0.001 ................................................[CV] ................................ C=1, gamma=0.0005, total=   0.1s[CV] C=1, gamma=0.01 .................................................[CV] ................................. C=1, gamma=0.001, total=   0.1s[CV] C=5, gamma=0.0001 ...............................................[CV] ................................. C=1, gamma=0.001, total=   0.1s[CV] C=5, gamma=0.0005 ...............................................[CV] ................................. C=1, gamma=0.001, total=   0.1s[CV] C=1, gamma=0.005 ................................................[CV] .................................. C=1, gamma=0.01, total=   0.1s[CV] C=1, gamma=0.01 .................................................[CV] ................................ C=5, gamma=0.0001, total=   0.1s[CV] C=5, gamma=0.0001 ...............................................[CV] ................................ C=5, gamma=0.0005, total=   0.1s[CV] C=5, gamma=0.001 ................................................[CV] ................................. C=1, gamma=0.005, total=   0.1s[CV] C=1, gamma=0.005 ................................................[CV] .................................. C=1, gamma=0.01, total=   0.1s[CV] C=1, gamma=0.01 .................................................[CV] ................................ C=5, gamma=0.0001, total=   0.1s[CV] C=5, gamma=0.0005 ...............................................[CV] ................................. C=5, gamma=0.001, total=   0.1s[CV] C=5, gamma=0.001 ................................................[CV] ................................. C=1, gamma=0.005, total=   0.1s[CV] C=1, gamma=0.005 ................................................[CV] ................................ C=5, gamma=0.0005, total=   0.1s[CV] C=5, gamma=0.0005 ...............................................[CV] .................................. C=1, gamma=0.01, total=   0.1s[CV] C=5, gamma=0.0001 ...............................................[CV] ................................. C=5, gamma=0.001, total=   0.1s[CV] C=5, gamma=0.001 ................................................[CV] ................................. C=1, gamma=0.005, total=   0.1s[CV] ................................ C=5, gamma=0.0005, total=   0.1s[CV] C=5, gamma=0.005 ................................................[CV] C=5, gamma=0.01 .................................................[CV] ................................ C=5, gamma=0.0001, total=   0.1s[CV] C=10, gamma=0.0001 ..............................................[CV] ................................. C=5, gamma=0.001, total=   0.1s[CV] C=10, gamma=0.001 ...............................................[CV] ................................. C=5, gamma=0.005, total=   0.1s[CV] C=5, gamma=0.005 ................................................[CV] .................................. C=5, gamma=0.01, total=   0.1s[CV] C=5, gamma=0.01 .................................................[CV] ............................... C=10, gamma=0.0001, total=   0.1s[CV] C=10, gamma=0.0005 ..............................................[CV] ................................ C=10, gamma=0.001, total=   0.1s[CV] C=10, gamma=0.001 ...............................................[CV] ................................. C=5, gamma=0.005, total=   0.1s[CV] C=5, gamma=0.005 ................................................[CV] ............................... C=10, gamma=0.0005, total=   0.1s[CV] C=10, gamma=0.0005 ..............................................[CV] .................................. C=5, gamma=0.01, total=   0.1s[CV] C=10, gamma=0.0001 ..............................................[CV] ................................ C=10, gamma=0.001, total=   0.1s[CV] C=10, gamma=0.001 ...............................................[CV] ................................. C=5, gamma=0.005, total=   0.1s[CV] C=5, gamma=0.01 .................................................[CV] ............................... C=10, gamma=0.0001, total=   0.1s[CV] C=10, gamma=0.0001 ..............................................[CV] ............................... C=10, gamma=0.0005, total=   0.1s[CV] C=10, gamma=0.0005 ..............................................[CV] ................................ C=10, gamma=0.001, total=   0.1s[CV] C=10, gamma=0.005 ...............................................[CV] .................................. C=5, gamma=0.01, total=   0.1s[CV] C=10, gamma=0.005 ...............................................[CV] ............................... C=10, gamma=0.0001, total=   0.1s[CV] C=10, gamma=0.01 ................................................[CV] ............................... C=10, gamma=0.0005, total=   0.1s[CV] C=50, gamma=0.0005 ..............................................[CV] ................................ C=10, gamma=0.005, total=   0.1s[CV] C=50, gamma=0.001 ...............................................[CV] ................................ C=10, gamma=0.005, total=   0.1s[CV] C=10, gamma=0.005 ...............................................[CV] ................................. C=10, gamma=0.01, total=   0.1s[CV] C=50, gamma=0.0001 ..............................................[CV] ............................... C=50, gamma=0.0005, total=   0.1s[CV] C=50, gamma=0.0005 ..............................................[CV] ................................ C=50, gamma=0.001, total=   0.1s[CV] C=50, gamma=0.001 ...............................................[CV] ............................... C=50, gamma=0.0001, total=   0.1s[CV] ................................ C=10, gamma=0.005, total=   0.1s[CV] C=10, gamma=0.01 ................................................[CV] ............................... C=50, gamma=0.0005, total=   0.1s[CV] C=50, gamma=0.0001 ..............................................[CV] C=50, gamma=0.0005 ..............................................[CV] ................................ C=50, gamma=0.001, total=   0.1s[CV] ................................. C=10, gamma=0.01, total=   0.1s[CV] C=10, gamma=0.01 ................................................[CV] C=50, gamma=0.005 ...............................................[CV] ............................... C=50, gamma=0.0001, total=   0.1s[CV] C=50, gamma=0.0001 ..............................................[CV] ............................... C=50, gamma=0.0005, total=   0.1s[CV] C=50, gamma=0.001 ...............................................[CV] ................................. C=10, gamma=0.01, total=   0.1s[CV] ................................ C=50, gamma=0.005, total=   0.1s[CV] C=50, gamma=0.005 ...............................................[CV] C=50, gamma=0.005 ...............................................[CV] ............................... C=50, gamma=0.0001, total=   0.1s[CV] ................................ C=50, gamma=0.001, total=   0.1s[CV] ................................ C=50, gamma=0.005, total=   0.1s[CV] ................................ C=50, gamma=0.005, total=   0.1s[CV] C=50, gamma=0.01 ................................................[CV] ................................. C=50, gamma=0.01, total=   0.0s[CV] C=50, gamma=0.01 ................................................[CV] ................................. C=50, gamma=0.01, total=   0.0s[CV] C=50, gamma=0.01 ................................................[CV] ................................. C=50, gamma=0.01, total=   0.0sBest parameters found by grid search:{&apos;C&apos;: 10, &apos;gamma&apos;: 0.0005}[Parallel(n_jobs=4)]: Done  60 out of  60 | elapsed:    1.9s finished</code></pre><h3 id="æµ‹è¯•æ¨¡å‹å‡†ç¡®æ€§"><a href="#æµ‹è¯•æ¨¡å‹å‡†ç¡®æ€§" class="headerlink" title="æµ‹è¯•æ¨¡å‹å‡†ç¡®æ€§"></a>æµ‹è¯•æ¨¡å‹å‡†ç¡®æ€§</h3><p>æ¥ç€ä½¿ç”¨è¿™ä¸€æ¨¡å‹å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹ï¼Œå¹¶åˆ†åˆ«ä½¿ç”¨<code>confusion_matrix</code>å’Œ<code>classification_report</code>æŸ¥çœ‹å…¶æ•ˆæœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">t = time()</span><br><span class="line">y_pred = clf.best_estimator_.predict(X_test_pca)</span><br><span class="line">cm = confusion_matrix(y_test, y_pred, labels=range(n_targets))</span><br><span class="line">print(<span class="string">"Done in &#123;0:.2f&#125;.\n"</span>.format(time()-t))</span><br><span class="line">print(<span class="string">"confusion matrix:"</span>)</span><br><span class="line">np.set_printoptions(threshold=np.nan)</span><br><span class="line">print(cm[:<span class="number">10</span>])</span><br></pre></td></tr></table></figure><pre><code>Done in 0.01.confusion matrix:[[1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 3 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report</span><br><span class="line">print(classification_report(y_test, y_pred, target_names=target_names)) <span class="comment">#è¿™é‡Œæ³¨æ„y_testå’Œy_predä½ç½®ä¸è¦é¢ å€’</span></span><br></pre></td></tr></table></figure><pre><code>             precision    recall  f1-score   support         p0       1.00      1.00      1.00         1         p1       1.00      1.00      1.00         3         p2       1.00      0.50      0.67         2         p3       1.00      1.00      1.00         1         p4       1.00      1.00      1.00         1         p5       1.00      1.00      1.00         1         p6       1.00      0.75      0.86         4         p7       1.00      1.00      1.00         2         p8       1.00      1.00      1.00         4         p9       1.00      1.00      1.00         2        p10       1.00      1.00      1.00         1        p11       1.00      1.00      1.00         4        p12       1.00      1.00      1.00         4        p13       1.00      1.00      1.00         1        p14       1.00      1.00      1.00         1        p15       0.75      1.00      0.86         3        p16       1.00      1.00      1.00         2        p17       1.00      1.00      1.00         2        p18       1.00      1.00      1.00         2        p19       1.00      1.00      1.00         1        p20       1.00      1.00      1.00         2        p21       1.00      1.00      1.00         3        p22       1.00      1.00      1.00         2        p23       1.00      1.00      1.00         3        p24       0.75      1.00      0.86         3        p25       1.00      1.00      1.00         2        p26       1.00      1.00      1.00         2        p27       1.00      1.00      1.00         2        p28       1.00      1.00      1.00         2        p29       1.00      1.00      1.00         3        p30       1.00      1.00      1.00         2        p31       1.00      1.00      1.00         2        p32       1.00      1.00      1.00         2        p33       1.00      1.00      1.00         3        p34       1.00      1.00      1.00         1        p35       1.00      1.00      1.00         2        p36       1.00      1.00      1.00         2avg / total       0.98      0.97      0.97        80/Users/hadoop/anaconda3/lib/python3.6/site-packages/sklearn/metrics/classification.py:1428: UserWarning: labels size, 37, does not match size of target_names, 40  .format(len(labels), len(target_names))</code></pre><h3 id="ç–‘é—®ï¼š"><a href="#ç–‘é—®ï¼š" class="headerlink" title="ç–‘é—®ï¼š"></a>ç–‘é—®ï¼š</h3><p>æ•ˆæœéå¸¸ä¹è§‚ï¼Œä½†æ˜¯ä»æœ‰ä¸ªé—®é¢˜ï¼š<strong><code>æ€ä¹ˆç¡®å®šp0ï½p37åˆ†åˆ«å¯¹åº”çš„æ˜¯å“ªä¸ªä¸€ä¸ªäººï¼Ÿ</code></strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;åŠ è½½æ•°æ®&quot;&gt;&lt;a href=&quot;#åŠ è½½æ•°æ®&quot; class=&quot;headerlink&quot; title=&quot;åŠ è½½æ•°æ®&quot;&gt;&lt;/a&gt;åŠ è½½æ•°æ®&lt;/h2&gt;&lt;p&gt;è¿™é‡Œä½¿ç”¨çš„æµ‹è¯•æ•°æ®å…±åŒ…å«40ä½äººå‘˜ç…§ç‰‡ï¼Œæ¯ä¸ªäºº10å¼ ç…§ç‰‡ã€‚ä¹Ÿå¯ç™»é™†&lt;a href=&quot;ht
      
    
    </summary>
    
      <category term="Machine learning" scheme="http://www.ihoge.cn/categories/Machine-learning/"/>
    
    
      <category term="scikit-learn" scheme="http://www.ihoge.cn/tags/scikit-learn/"/>
    
  </entry>
  
  <entry>
    <title>æœ´ç´ è´å¶æ–¯--æ–‡æ¡£åˆ†ç±»</title>
    <link href="http://www.ihoge.cn/2018/MultinomialNB.html"/>
    <id>http://www.ihoge.cn/2018/MultinomialNB.html</id>
    <published>2018-04-09T12:10:59.000Z</published>
    <updated>2018-04-10T10:01:37.805Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æŠŠæ–‡æ¡£è½¬æ¢æˆå‘é‡"><a href="#æŠŠæ–‡æ¡£è½¬æ¢æˆå‘é‡" class="headerlink" title="æŠŠæ–‡æ¡£è½¬æ¢æˆå‘é‡"></a>æŠŠæ–‡æ¡£è½¬æ¢æˆå‘é‡</h3><p>TF-IDFæ˜¯ä¸€ç§ç»Ÿè®¡æ–¹æ³•ï¼Œç”¨ä»¥è¯„ä¼°ä¸€ä¸ªè¯è¯­å¯¹äºä¸€ä»½æ–‡æ¡£çš„é‡è¦ç¨‹åº¦ã€‚</p><ul><li>TFè¡¨ç¤ºè¯é¢‘ï¼Œ å³ï¼šè¯è¯­åœ¨ä¸€ç‰‡æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•° Ã· è¯è¯­æ€»æ•°</li><li>IDFè¡¨ç¤ºä¸€ä¸ªè¯çš„<strong>é€†å‘æ–‡æ¡£é¢‘ç‡æŒ‡æ•°</strong>ï¼Œ å³ï¼šå¯¹ï¼ˆæ€»æ–‡æ¡£æ•°ç›®Ã·åŒ…å«è¯¥è¯è¯­çš„æ–‡æ¡£çš„æ•°ç›®ï¼‰çš„å•†å–å¯¹æ•°  $log(m / m_{i-in-m})$</li></ul><p>åŸºç¡€åŸç†ï¼šè¯è¯­çš„é‡è¦æ€§éšç€å®ƒåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°æˆæ­£æ¯”ä¾‹å¢åŠ ï¼Œä½†åŒæ—¶ä¼šéšç€å®ƒåœ¨è¯­æ–™åº“ä¸­å‡ºç°çš„é¢‘ç‡å‘ˆåæ¯”ä¸‹é™ã€‚</p><p>sklearnä¸­æœ‰åŒ…å®ç°äº†æŠŠæ–‡æ¡£è½¬æ¢æˆå‘é‡çš„è¿‡ç¨‹ï¼Œé¦–å…ˆæŠŠè®­ç»ƒç”¨é¢è¯­æ–™åº“è¯»å…¥å†…å­˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_files</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = time()</span><br><span class="line">news_train = load_files(<span class="string">'code/datasets/mlcomp/379/train'</span>)</span><br><span class="line">print(len(news_train.data), <span class="string">"\n"</span>,len(news_train.target_names))</span><br><span class="line">print(<span class="string">"done in &#123;&#125; seconds"</span>.format(time() - t))</span><br></pre></td></tr></table></figure><pre><code>13180  20done in 6.034918308258057 seconds</code></pre><p>news_train.dataæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†æ‰€æœ‰æ–‡æ¡£çš„æ–‡æœ¬ä¿¡æ¯ã€‚<br>news_train.target_namesä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†æ‰€æœ‰æ–‡æ¡£çš„å±æ€§ç±»åˆ«ï¼Œå¯¹åº”çš„æ˜¯è¯»å–trainæ–‡ä»¶å¤¹æ—¶ï¼Œtrainæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„å­æ–‡ä»¶å¤¹åç§°ã€‚</p><p>è¯¥è¯­æ–™åº“æ€»å…±æœ‰13180ä¸ªæ–‡æ¡£ï¼Œå…¶ä¸­åˆ†æˆ20ä¸ªç±»åˆ«ï¼Œæ¥ç€éœ€è¦è½¬æ¢æˆç”±TF-IDFè¡¨è¾¾çš„æƒé‡ä¿¡æ¯æ„æˆå‘é‡ã€‚</p><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fq6g2bkj9sj30hf09lta4.jpg" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"></span><br><span class="line">t = time()</span><br><span class="line">vectorizer  = TfidfVectorizer(encoding = <span class="string">'latin-1'</span>)</span><br><span class="line">X_train = vectorizer.fit_transform((d <span class="keyword">for</span>  d <span class="keyword">in</span> news_train.data))</span><br><span class="line">print(<span class="string">"æ–‡æ¡£ [&#123;0&#125;]ç‰¹å¾å€¼çš„éé›¶ä¸ªæ•°:&#123;1&#125;"</span>.format(news_train.filenames[<span class="number">0</span>] , X_train[<span class="number">0</span>].getnnz()))</span><br><span class="line">print(<span class="string">"è®­ç»ƒé›†ï¼š"</span>,X_train.shape)</span><br><span class="line">print(<span class="string">"è€—æ—¶ï¼š &#123;0&#125; s."</span>.format(time() - t))</span><br></pre></td></tr></table></figure><pre><code>æ–‡æ¡£ [code/datasets/mlcomp/379/train/talk.politics.misc/17860-178992]ç‰¹å¾å€¼çš„éé›¶ä¸ªæ•°:108è®­ç»ƒé›†ï¼š (13180, 130274)è€—æ—¶ï¼š 3.740567207336426 s.</code></pre><p><strong>TfidfVectorizer</strong>ç±»æ˜¯ç”¨æ¥æŠŠæ‰€æœ‰çš„æ–‡æ¡£è½¬æ¢æˆçŸ©é˜µï¼Œè¯¥çŸ©é˜µæ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€ä¸ªæ–‡æ¡£ï¼Œä¸€è¡Œä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªå¯¹åº”çš„è¯è¯­çš„é‡è¦æ€§ï¼Œè¯è¯­çš„é‡è¦æ€§ç”±TF-IDFæ¥è¡¨ç¤ºã€‚å…¶<code>fit_transform()</code>æ–¹æ³•æ˜¯<code>fit()</code>å’Œ<code>transform()</code>çš„ç»“åˆ,<code>fit()</code>å…ˆå®Œæˆè¯­æ–™åº“åˆ†æï¼Œæå–è¯å…¸ç­‰æ“ä½œ<code>transform()</code>æŠŠæ¯ç¯‡æ–‡æ¡£è½¬æ¢ä¸ºå‘é‡ï¼Œæœ€ç»ˆæ„æˆä¸€ä¸ªçŸ©é˜µï¼Œä¿å­˜åœ¨<code>X_train</code>é‡Œã€‚</p><p>ç¨‹åºè¾“å‡ºå¯ä»¥çœ‹åˆ°è¯¥è¯å…¸æ€»å…±æœ‰130274ä¸ªè¯è¯­ï¼Œå³æ¯ç¯‡æ–‡æ¡£éƒ½å¯ä»¥è½¬æ¢æˆä¸€ä¸ª13274ç»´çš„å‘é‡ç»„ã€‚ç¬¬ä¸€ç¯‡æ–‡æ¡£ä¸­åªæœ‰108ä¸ªéé›¶å…ƒç´ ï¼Œå³è¿™ç¯‡æ–‡æ¡£ç”±108ä¸ªä¸é‡å¤çš„å•è¯ç»„æˆï¼Œåœ¨è¿™ç¯‡æ–‡æ¡£ä¸­å‡ºç°çš„è¿™108ä¸ªå•è¯æ¬¡çš„<strong>TF-IDF</strong>ä¼šè¢«è®¡ç®—å‡ºæ¥ï¼Œä¿å­˜åœ¨å‘é‡çš„æŒ‡å®šä½ç½®ã€‚è¿™é‡Œçš„åˆ°X_trainæ˜¯ä¸€ä¸ªçº¬åº¦ä¸º12180 x 130274çš„ç³»æ•°çŸ©é˜µã€‚</p><h3 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> MultinomialNB</span><br><span class="line"></span><br><span class="line">t = time()</span><br><span class="line">y_train = news_train.target</span><br><span class="line">clf = MultinomialNB(alpha=<span class="number">0.001</span>)  <span class="comment">#alpgaè¡¨ç¤ºå¹³æ»‘å‚æ•°ï¼Œè¶Šå°è¶Šå®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆï¼›è¶Šå¤§è¶Šå®¹æ˜“æ¬ æ‹Ÿåˆã€‚</span></span><br><span class="line">clf.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"train_score:"</span>, clf.score(X_train, y_train))</span><br><span class="line">print(<span class="string">"è€—æ—¶ï¼š&#123;0&#125;s"</span>.format(time() - t))</span><br></pre></td></tr></table></figure><pre><code>train_score: 0.9974203338391502è€—æ—¶ï¼š0.23757004737854004s</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½æµ‹è¯•é›†æ£€éªŒç»“æœ</span></span><br><span class="line">news_test = load_files(<span class="string">'code/datasets/mlcomp/379/test'</span>)</span><br><span class="line">print(len(news_test.data))</span><br><span class="line">print(len(news_test.target_names))</span><br></pre></td></tr></table></figure><pre><code>564820</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠŠæµ‹è¯•é›†æ–‡æ¡£æ•°å­¦å‘é‡åŒ–</span></span><br><span class="line">t = time()</span><br><span class="line"><span class="comment"># vectorizer  = TfidfVectorizer(encoding = 'latin-1')  # è¿™é‡Œæ³¨æ„vectorizerè¿™æ¡è¯­å¥ä¸Šæ–‡å·²ç»ç”Ÿæˆæ‰§è¡Œï¼Œè¿™é‡Œä¸å¯é‡å¤æ‰§è¡Œ</span></span><br><span class="line">X_test = vectorizer.transform((d <span class="keyword">for</span>  d <span class="keyword">in</span> news_test.data))</span><br><span class="line">y_test = news_test.target</span><br><span class="line"></span><br><span class="line">print(<span class="string">"æµ‹è¯•é›†ï¼š"</span>,X_test.shape)</span><br><span class="line">print(<span class="string">"è€—æ—¶ï¼š &#123;0&#125; s."</span>.format(time() - t))</span><br></pre></td></tr></table></figure><pre><code>æµ‹è¯•é›†ï¼š (5648, 130274)è€—æ—¶ï¼š 1.64164400100708 s.</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">y_pred = clf.predict(X_test)</span><br><span class="line">print(<span class="string">"Train_score:"</span>, clf.score(X_train, y_train))</span><br><span class="line">print(<span class="string">"Test_score:"</span>, clf.score(X_test, y_test))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    r = np.random.randint(X_test.shape[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> clf.predict(X_test[r]) == y_test[r]:</span><br><span class="line">        print(<span class="string">"âˆšï¼š&#123;0&#125;"</span>.format(r))</span><br><span class="line">    <span class="keyword">else</span>:print(<span class="string">"Xï¼š&#123;0&#125;"</span>.format(r))</span><br></pre></td></tr></table></figure><pre><code>Train_score: 0.9974203338391502Test_score: 0.9123583569405099âˆšï¼š1874âˆšï¼š2214âˆšï¼š2579âˆšï¼š1247âˆšï¼š375âˆšï¼š5384âˆšï¼š5029âˆšï¼š1951âˆšï¼š4885âˆšï¼š1980</code></pre><h3 id="è¯„ä»·æ¨¡å‹ï¼š"><a href="#è¯„ä»·æ¨¡å‹ï¼š" class="headerlink" title="è¯„ä»·æ¨¡å‹ï¼š"></a>è¯„ä»·æ¨¡å‹ï¼š</h3><h4 id="classification-report-æŸ¥çœ‹æŸ¥å‡†ç‡ã€å¬å›ç‡ã€F1"><a href="#classification-report-æŸ¥çœ‹æŸ¥å‡†ç‡ã€å¬å›ç‡ã€F1" class="headerlink" title="classification_report()æŸ¥çœ‹æŸ¥å‡†ç‡ã€å¬å›ç‡ã€F1"></a><code>classification_report()</code>æŸ¥çœ‹æŸ¥å‡†ç‡ã€å¬å›ç‡ã€F1</h4><p>ä½¿ç”¨<code>classification_report()</code>å‡½æ•°æŸ¥çœ‹é’ˆå¯¹æ¯ä¸ªç±»åˆ«çš„é¢„æµ‹å‡†ç¡®æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report</span><br><span class="line"></span><br><span class="line">print(clf)</span><br><span class="line">print(<span class="string">"æŸ¥çœ‹é’ˆå¯¹æ¯ä¸ªç±»åˆ«çš„é¢„æµ‹å‡†ç¡®æ€§ï¼š"</span>)</span><br><span class="line">print(classification_report(y_test, y_pred, </span><br><span class="line">                            target_names = news_test.target_names))</span><br></pre></td></tr></table></figure><pre><code>MultinomialNB(alpha=0.001, class_prior=None, fit_prior=True)æŸ¥çœ‹é’ˆå¯¹æ¯ä¸ªç±»åˆ«çš„é¢„æµ‹å‡†ç¡®æ€§ï¼š                          precision    recall  f1-score   support             alt.atheism       0.90      0.92      0.91       245           comp.graphics       0.80      0.90      0.84       298 comp.os.ms-windows.misc       0.85      0.80      0.82       292comp.sys.ibm.pc.hardware       0.81      0.82      0.81       301   comp.sys.mac.hardware       0.90      0.92      0.91       256          comp.windows.x       0.89      0.88      0.88       297            misc.forsale       0.88      0.82      0.85       290               rec.autos       0.93      0.93      0.93       324         rec.motorcycles       0.97      0.97      0.97       294      rec.sport.baseball       0.97      0.96      0.97       315        rec.sport.hockey       0.97      0.99      0.98       302               sci.crypt       0.96      0.95      0.96       297         sci.electronics       0.91      0.85      0.88       313                 sci.med       0.96      0.96      0.96       277               sci.space       0.95      0.97      0.96       305  soc.religion.christian       0.93      0.96      0.94       293      talk.politics.guns       0.90      0.96      0.93       246   talk.politics.mideast       0.95      0.98      0.97       296      talk.politics.misc       0.91      0.89      0.90       236      talk.religion.misc       0.89      0.77      0.82       171             avg / total       0.91      0.91      0.91      5648</code></pre><h4 id="confusion-matrixæ··æ·†çŸ©é˜µ"><a href="#confusion-matrixæ··æ·†çŸ©é˜µ" class="headerlink" title="confusion_matrixæ··æ·†çŸ©é˜µ"></a><code>confusion_matrix</code>æ··æ·†çŸ©é˜µ</h4><p>é€šè¿‡<code>confusion_matrix</code>å‡½æ•°ç”Ÿæˆæ··æ·†çŸ©é˜µï¼Œè§‚å¯Ÿæ¯ç§ç±»åˆ«åˆ«é”™è¯¯åˆ†ç±»çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œè¿™äº›è¢«é”™è¯¯åˆ†ç±»çš„æ–‡æ¡£æ˜¯è¢«é”™è¯¯åˆ†ç±»åˆ°å“ªäº›ç±»åˆ«é‡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> confusion_matrix</span><br><span class="line"></span><br><span class="line">cm = confusion_matrix(y_test, y_pred)</span><br><span class="line">print(cm)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸€è¡Œè¡¨ç¤ºç±»åˆ«0çš„æ–‡æ¡£è¢«æ­£ç¡®åˆ†ç±»çš„ç”±255ä¸ªï¼Œå…¶ä¸­æœ‰2ã€5ã€13ä¸ªé”™è¯¯åˆ†ç±»è¢«åˆ†åˆ°äº†14ã€15ã€19ç±»ä¸­äº†ã€‚</span></span><br></pre></td></tr></table></figure><pre><code>[[225   0   0   0   0   0   0   0   0   0   0   0   0   0   2   5   0   0   0  13] [  1 267   6   4   2   8   1   1   0   0   0   2   3   2   1   0   0   0   0   0] [  1  12 233  26   4   9   3   0   0   0   0   0   2   1   0   0   0   0   1   0] [  0   9  16 246   7   3  10   1   0   0   1   0   8   0   0   0   0   0   0   0] [  0   2   3   5 236   2   2   1   0   0   0   3   1   0   1   0   0   0   0   0] [  0  22   6   3   0 260   0   0   0   2   0   1   0   0   1   0   2   0   0   0] [  0   2   5  11   3   1 238   9   2   3   1   0   7   0   1   0   2   2   3   0] [  0   1   0   0   1   0   7 302   4   1   0   0   1   2   3   0   2   0   0   0] [  0   0   0   0   0   2   2   3 285   0   0   0   1   0   0   0   0   0   0   1] [  0   1   0   0   1   1   1   2   0 302   6   0   0   1   0   0   0   0   0   0] [  0   0   0   0   0   0   0   0   2   1 299   0   0   0   0   0   0   0   0   0] [  0   1   2   1   1   1   2   0   0   0   0 283   1   0   0   0   2   1   2   0] [  0  11   2   6   5   2   4   5   1   1   1   3 267   1   3   0   0   0   1   0] [  1   1   0   1   1   1   0   0   0   0   0   1   1 265   2   1   0   0   2   0] [  0   3   0   0   1   0   0   0   0   0   0   1   1   1 296   0   1   0   1   0] [  3   1   0   1   0   0   0   0   0   0   1   0   0   2   0 281   0   1   2   1] [  1   0   1   0   0   0   0   0   1   0   0   0   0   0   0   0 237   1   4   1] [  1   0   0   0   0   1   0   0   0   0   0   0   0   0   0   3   0 290   1   0] [  1   1   0   0   1   1   0   1   0   0   0   0   0   0   0   1  12   7 210   1] [ 16   1   0   0   0   0   0   0   0   0   0   0   0   0   0  12   5   2   4 131]]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">6</span>, <span class="number">6</span>), dpi=<span class="number">120</span>)</span><br><span class="line">plt.title(<span class="string">'Confusion matrix of the classifier'</span>)</span><br><span class="line">ax = plt.gca()                                  </span><br><span class="line">ax.spines[<span class="string">'right'</span>].set_color(<span class="string">'none'</span>)            </span><br><span class="line">ax.spines[<span class="string">'top'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line">ax.spines[<span class="string">'bottom'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line">ax.spines[<span class="string">'left'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line">ax.xaxis.set_ticks_position(<span class="string">'none'</span>)</span><br><span class="line">ax.yaxis.set_ticks_position(<span class="string">'none'</span>)</span><br><span class="line">ax.set_xticklabels([])</span><br><span class="line">ax.set_yticklabels([])</span><br><span class="line">plt.matshow(cm, fignum=<span class="number">1</span>, cmap=<span class="string">'gray'</span>)</span><br><span class="line">plt.colorbar();</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™¤å¯¹è§’çº¿å¤–ï¼Œé¢œè‰²è¶Šæµ…è¯´æ˜é”™è¯¯è¶Šå¤š</span></span><br></pre></td></tr></table></figure><p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fq6kdjano8j30gq0hegm8.jpg" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸Šå›¾ä¸ç›´è§‚ï¼Œé‡æ–°ç”»å›¾</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> pyecharts <span class="keyword">import</span> HeatMap</span><br><span class="line"></span><br><span class="line">x_axis = np.arange(<span class="number">20</span>)</span><br><span class="line">y_axis = np.arange(<span class="number">20</span>)</span><br><span class="line">data = [[i, j, cm[i][j]] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">20</span>)]</span><br><span class="line">heatmap = HeatMap()</span><br><span class="line">heatmap.add(<span class="string">"æ··æ·†çŸ©é˜µ"</span>, x_axis, y_axis, data, is_visualmap=<span class="keyword">True</span>,</span><br><span class="line">            visual_text_color=<span class="string">"#fff"</span>, visual_orient=<span class="string">'horizontal'</span>)</span><br><span class="line"><span class="comment"># heatmap.render()</span></span><br><span class="line"><span class="comment"># heatmap</span></span><br></pre></td></tr></table></figure><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fq6kc4ryv9j30h00gu0tm.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;æŠŠæ–‡æ¡£è½¬æ¢æˆå‘é‡&quot;&gt;&lt;a href=&quot;#æŠŠæ–‡æ¡£è½¬æ¢æˆå‘é‡&quot; class=&quot;headerlink&quot; title=&quot;æŠŠæ–‡æ¡£è½¬æ¢æˆå‘é‡&quot;&gt;&lt;/a&gt;æŠŠæ–‡æ¡£è½¬æ¢æˆå‘é‡&lt;/h3&gt;&lt;p&gt;TF-IDFæ˜¯ä¸€ç§ç»Ÿè®¡æ–¹æ³•ï¼Œç”¨ä»¥è¯„ä¼°ä¸€ä¸ªè¯è¯­å¯¹äºä¸€ä»½æ–‡æ¡£çš„é‡è¦ç¨‹åº¦ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;l
      
    
    </summary>
    
      <category term="Machine learning" scheme="http://www.ihoge.cn/categories/Machine-learning/"/>
    
    
      <category term="scikit-learn" scheme="http://www.ihoge.cn/tags/scikit-learn/"/>
    
  </entry>
  
  <entry>
    <title>SVMç»˜å›¾</title>
    <link href="http://www.ihoge.cn/2018/SVM%E7%BB%98%E5%9B%BE.html"/>
    <id>http://www.ihoge.cn/2018/SVMç»˜å›¾.html</id>
    <published>2018-04-08T17:10:59.000Z</published>
    <updated>2018-04-10T10:01:40.957Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class1 = np.array([[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">3</span>], [<span class="number">2</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">2</span>]])</span><br><span class="line">class2 = np.array([[<span class="number">4</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">5</span>], [<span class="number">5</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>], [<span class="number">6</span>, <span class="number">4</span>]])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">6</span>, <span class="number">4</span>), dpi=<span class="number">120</span>)</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">'Decision Boundary'</span>)</span><br><span class="line"></span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">8</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">ax = plt.gca()                                  <span class="comment"># gca ä»£è¡¨å½“å‰åæ ‡è½´ï¼Œå³ 'get current axis'</span></span><br><span class="line">ax.spines[<span class="string">'right'</span>].set_color(<span class="string">'none'</span>)            <span class="comment"># éšè—åæ ‡è½´</span></span><br><span class="line">ax.spines[<span class="string">'top'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line"></span><br><span class="line">plt.scatter(class1[:, <span class="number">0</span>], class1[:, <span class="number">1</span>], marker=<span class="string">'o'</span>)</span><br><span class="line">plt.scatter(class2[:, <span class="number">0</span>], class2[:, <span class="number">1</span>], marker=<span class="string">'s'</span>)</span><br><span class="line">plt.plot([<span class="number">1</span>, <span class="number">5</span>], [<span class="number">5</span>, <span class="number">1</span>], <span class="string">'-r'</span>)</span><br><span class="line">plt.arrow(<span class="number">4</span>, <span class="number">4</span>, <span class="number">-1</span>, <span class="number">-1</span>, shape=<span class="string">'full'</span>, color=<span class="string">'r'</span>)</span><br><span class="line">plt.plot([<span class="number">3</span>, <span class="number">3</span>], [<span class="number">0.5</span>, <span class="number">6</span>], <span class="string">'--b'</span>)</span><br><span class="line">plt.arrow(<span class="number">4</span>, <span class="number">4</span>, <span class="number">-1</span>, <span class="number">0</span>, shape=<span class="string">'full'</span>, color=<span class="string">'b'</span>, linestyle=<span class="string">'--'</span>)</span><br><span class="line">plt.annotate(<span class="string">r'margin 1'</span>,</span><br><span class="line">             xy=(<span class="number">3.5</span>, <span class="number">4</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">3.1</span>, <span class="number">4.5</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br><span class="line">plt.annotate(<span class="string">r'margin 2'</span>,</span><br><span class="line">             xy=(<span class="number">3.5</span>, <span class="number">3.5</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">4</span>, <span class="number">3.5</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br><span class="line">plt.annotate(<span class="string">r'support vector'</span>,</span><br><span class="line">             xy=(<span class="number">4</span>, <span class="number">4</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">5</span>, <span class="number">4.5</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br><span class="line">plt.annotate(<span class="string">r'support vector'</span>,</span><br><span class="line">             xy=(<span class="number">2</span>, <span class="number">2</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">0.5</span>, <span class="number">1.5</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br></pre></td></tr></table></figure><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fq43bc7pj3j30gx0c6gm7.jpg" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">6</span>, <span class="number">4</span>), dpi=<span class="number">120</span>)</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">'Support Vector Machine'</span>)</span><br><span class="line"></span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">8</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">ax = plt.gca()                                  <span class="comment"># gca ä»£è¡¨å½“å‰åæ ‡è½´ï¼Œå³ 'get current axis'</span></span><br><span class="line">ax.spines[<span class="string">'right'</span>].set_color(<span class="string">'none'</span>)            <span class="comment"># éšè—åæ ‡è½´</span></span><br><span class="line">ax.spines[<span class="string">'top'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line"></span><br><span class="line">plt.scatter(class1[:, <span class="number">0</span>], class1[:, <span class="number">1</span>], marker=<span class="string">'o'</span>)</span><br><span class="line">plt.scatter(class2[:, <span class="number">0</span>], class2[:, <span class="number">1</span>], marker=<span class="string">'s'</span>)</span><br><span class="line">plt.plot([<span class="number">1</span>, <span class="number">5</span>], [<span class="number">5</span>, <span class="number">1</span>], <span class="string">'-r'</span>)</span><br><span class="line">plt.plot([<span class="number">0</span>, <span class="number">4</span>], [<span class="number">4</span>, <span class="number">0</span>], <span class="string">'--b'</span>, [<span class="number">2</span>, <span class="number">6</span>], [<span class="number">6</span>, <span class="number">2</span>], <span class="string">'--b'</span>)</span><br><span class="line">plt.arrow(<span class="number">4</span>, <span class="number">4</span>, <span class="number">-1</span>, <span class="number">-1</span>, shape=<span class="string">'full'</span>, color=<span class="string">'b'</span>)</span><br><span class="line">plt.annotate(<span class="string">r'$w^T x + b = 0$'</span>,</span><br><span class="line">             xy=(<span class="number">5</span>, <span class="number">1</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">6</span>, <span class="number">1</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br><span class="line">plt.annotate(<span class="string">r'$w^T x + b = 1$'</span>,</span><br><span class="line">             xy=(<span class="number">6</span>, <span class="number">2</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">7</span>, <span class="number">2</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br><span class="line">plt.annotate(<span class="string">r'$w^T x + b = -1$'</span>,</span><br><span class="line">             xy=(<span class="number">3.5</span>, <span class="number">0.5</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">4.5</span>, <span class="number">0.2</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br><span class="line">plt.annotate(<span class="string">r'd'</span>,</span><br><span class="line">             xy=(<span class="number">3.5</span>, <span class="number">3.5</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">2</span>, <span class="number">4.5</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br><span class="line">plt.annotate(<span class="string">r'A'</span>,</span><br><span class="line">             xy=(<span class="number">4</span>, <span class="number">4</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">5</span>, <span class="number">4.5</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br></pre></td></tr></table></figure><p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fq43bz1cb3j30hg0c63za.jpg" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_blobs</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">4</span>), dpi=<span class="number">140</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sub plot 1</span></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">X, y = make_blobs(n_samples=<span class="number">100</span>, </span><br><span class="line">                  n_features=<span class="number">2</span>, </span><br><span class="line">                  centers=[(<span class="number">1</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="number">2</span>)], </span><br><span class="line">                  random_state=<span class="number">4</span>, </span><br><span class="line">                  shuffle=<span class="keyword">False</span>,</span><br><span class="line">                  cluster_std=<span class="number">0.4</span>)</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">'Non-linear Separatable'</span>)</span><br><span class="line"></span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">ax = plt.gca()                                  <span class="comment"># gca ä»£è¡¨å½“å‰åæ ‡è½´ï¼Œå³ 'get current axis'</span></span><br><span class="line">ax.spines[<span class="string">'right'</span>].set_color(<span class="string">'none'</span>)            <span class="comment"># éšè—åæ ‡è½´</span></span><br><span class="line">ax.spines[<span class="string">'top'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line"></span><br><span class="line">plt.scatter(X[y==<span class="number">0</span>][:, <span class="number">0</span>], X[y==<span class="number">0</span>][:, <span class="number">1</span>], marker=<span class="string">'o'</span>)</span><br><span class="line">plt.scatter(X[y==<span class="number">1</span>][:, <span class="number">0</span>], X[y==<span class="number">1</span>][:, <span class="number">1</span>], marker=<span class="string">'s'</span>)</span><br><span class="line">plt.plot([<span class="number">0.5</span>, <span class="number">2.5</span>], [<span class="number">2.5</span>, <span class="number">0.5</span>], <span class="string">'-r'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sub plot 2</span></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">class1 = np.array([[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">3</span>], [<span class="number">2</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">1.5</span>, <span class="number">1.5</span>], [<span class="number">1.2</span>, <span class="number">1.7</span>]])</span><br><span class="line">class2 = np.array([[<span class="number">4</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">5</span>], [<span class="number">5</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>], [<span class="number">6</span>, <span class="number">4</span>], [<span class="number">5.5</span>, <span class="number">3.5</span>], [<span class="number">4.5</span>, <span class="number">4.5</span>], [<span class="number">2</span>, <span class="number">1.5</span>]])</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">'Slack Variable'</span>)</span><br><span class="line"></span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">7</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">7</span>)</span><br><span class="line">ax = plt.gca()                                  <span class="comment"># gca ä»£è¡¨å½“å‰åæ ‡è½´ï¼Œå³ 'get current axis'</span></span><br><span class="line">ax.spines[<span class="string">'right'</span>].set_color(<span class="string">'none'</span>)            <span class="comment"># éšè—åæ ‡è½´</span></span><br><span class="line">ax.spines[<span class="string">'top'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line"></span><br><span class="line">plt.scatter(class1[:, <span class="number">0</span>], class1[:, <span class="number">1</span>], marker=<span class="string">'o'</span>)</span><br><span class="line">plt.scatter(class2[:, <span class="number">0</span>], class2[:, <span class="number">1</span>], marker=<span class="string">'s'</span>)</span><br><span class="line">plt.plot([<span class="number">1</span>, <span class="number">5</span>], [<span class="number">5</span>, <span class="number">1</span>], <span class="string">'-r'</span>)</span><br><span class="line">plt.plot([<span class="number">0</span>, <span class="number">4</span>], [<span class="number">4</span>, <span class="number">0</span>], <span class="string">'--b'</span>, [<span class="number">2</span>, <span class="number">6</span>], [<span class="number">6</span>, <span class="number">2</span>], <span class="string">'--b'</span>)</span><br><span class="line">plt.arrow(<span class="number">2</span>, <span class="number">1.5</span>, <span class="number">2.25</span>, <span class="number">2.25</span>, shape=<span class="string">'full'</span>, color=<span class="string">'b'</span>)</span><br><span class="line">plt.annotate(<span class="string">r'violate margin rule.'</span>,</span><br><span class="line">             xy=(<span class="number">2</span>, <span class="number">1.5</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">0.2</span>, <span class="number">0.5</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br><span class="line">plt.annotate(<span class="string">r'normal sample. $\epsilon = 0$'</span>,</span><br><span class="line">             xy=(<span class="number">4</span>, <span class="number">5</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">4.5</span>, <span class="number">5.5</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br><span class="line">plt.annotate(<span class="string">r'$\epsilon &gt; 0$'</span>,</span><br><span class="line">             xy=(<span class="number">3</span>, <span class="number">2.5</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">3</span>, <span class="number">1.5</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br></pre></td></tr></table></figure><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fq43cif8rwj30wy0e9mz8.jpg" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">6</span>, <span class="number">4</span>), dpi=<span class="number">120</span>)</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">'Cost'</span>)</span><br><span class="line"></span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">plt.xlabel(<span class="string">'$y^&#123;(i)&#125; (w^T x^&#123;(i)&#125; + b)$'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Cost'</span>)</span><br><span class="line">ax = plt.gca()                                  <span class="comment"># gca ä»£è¡¨å½“å‰åæ ‡è½´ï¼Œå³ 'get current axis'</span></span><br><span class="line">ax.spines[<span class="string">'right'</span>].set_color(<span class="string">'none'</span>)            <span class="comment"># éšè—åæ ‡è½´</span></span><br><span class="line">ax.spines[<span class="string">'top'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line"></span><br><span class="line">plt.plot([<span class="number">0</span>, <span class="number">1</span>], [<span class="number">1.5</span>, <span class="number">0</span>], <span class="string">'-r'</span>)</span><br><span class="line">plt.plot([<span class="number">1</span>, <span class="number">3</span>], [<span class="number">0.015</span>, <span class="number">0.015</span>], <span class="string">'-r'</span>)</span><br><span class="line">plt.annotate(<span class="string">r'$J_i = R \epsilon_i$ for $y^&#123;(i)&#125; (w^T x^&#123;(i)&#125; + b) \geq 1 - \epsilon_i$'</span>,</span><br><span class="line">             xy=(<span class="number">0.7</span>, <span class="number">0.5</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">1</span>, <span class="number">1</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br><span class="line">plt.annotate(<span class="string">r'$J_i = 0$ for $y^&#123;(i)&#125; (w^T x^&#123;(i)&#125; + b) \geq 1$'</span>,</span><br><span class="line">             xy=(<span class="number">1.5</span>, <span class="number">0</span>), xycoords=<span class="string">'data'</span>,</span><br><span class="line">             xytext=(<span class="number">1.8</span>, <span class="number">0.2</span>), fontsize=<span class="number">10</span>,</span><br><span class="line">             arrowprops=dict(arrowstyle=<span class="string">"-&gt;"</span>, connectionstyle=<span class="string">"arc3,rad=.2"</span>))</span><br></pre></td></tr></table></figure><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fq43cufjjfj30ih0d1dgg.jpg" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">4</span>), dpi=<span class="number">144</span>)</span><br><span class="line"></span><br><span class="line">class1 = np.array([[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">2</span>], [<span class="number">1</span>, <span class="number">3</span>], [<span class="number">2</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">2</span>], [<span class="number">4</span>, <span class="number">1</span>], [<span class="number">5</span>, <span class="number">1</span>]])</span><br><span class="line">class2 = np.array([[<span class="number">2.2</span>, <span class="number">4</span>], [<span class="number">1.5</span>, <span class="number">5</span>], [<span class="number">1.8</span>, <span class="number">4.6</span>], [<span class="number">2.4</span>, <span class="number">5</span>], [<span class="number">3.2</span>, <span class="number">5</span>], [<span class="number">3.7</span>, <span class="number">4</span>], [<span class="number">4.5</span>, <span class="number">4.5</span>], [<span class="number">5.4</span>, <span class="number">3</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># sub plot 1</span></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">'Non-linear Separatable in Low Dimension'</span>)</span><br><span class="line"></span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">plt.yticks(())</span><br><span class="line">plt.xlabel(<span class="string">'X1'</span>)</span><br><span class="line">ax = plt.gca()                                  <span class="comment"># gca ä»£è¡¨å½“å‰åæ ‡è½´ï¼Œå³ 'get current axis'</span></span><br><span class="line">ax.spines[<span class="string">'right'</span>].set_color(<span class="string">'none'</span>)            <span class="comment"># éšè—åæ ‡è½´</span></span><br><span class="line">ax.spines[<span class="string">'top'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line">ax.spines[<span class="string">'left'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line"></span><br><span class="line">plt.scatter(class1[:, <span class="number">0</span>], np.zeros(class1[:, <span class="number">0</span>].shape[<span class="number">0</span>]) + <span class="number">0.05</span>, marker=<span class="string">'o'</span>)</span><br><span class="line">plt.scatter(class2[:, <span class="number">0</span>], np.zeros(class2[:, <span class="number">0</span>].shape[<span class="number">0</span>]) + <span class="number">0.05</span>, marker=<span class="string">'s'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sub plot 2</span></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">'Linear Separatable in High Dimension'</span>)</span><br><span class="line"></span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">plt.xlabel(<span class="string">'X1'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'X2'</span>)</span><br><span class="line">ax = plt.gca()                                  <span class="comment"># gca ä»£è¡¨å½“å‰åæ ‡è½´ï¼Œå³ 'get current axis'</span></span><br><span class="line">ax.spines[<span class="string">'right'</span>].set_color(<span class="string">'none'</span>)            <span class="comment"># éšè—åæ ‡è½´</span></span><br><span class="line">ax.spines[<span class="string">'top'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line"></span><br><span class="line">plt.scatter(class1[:, <span class="number">0</span>], class1[:, <span class="number">1</span>], marker=<span class="string">'o'</span>)</span><br><span class="line">plt.scatter(class2[:, <span class="number">0</span>], class2[:, <span class="number">1</span>], marker=<span class="string">'s'</span>)</span><br><span class="line">plt.plot([<span class="number">1</span>, <span class="number">5</span>], [<span class="number">3.8</span>, <span class="number">2</span>], <span class="string">'-r'</span>)</span><br></pre></td></tr></table></figure><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fq43d6r1acj30w50feab6.jpg" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gaussian_kernel</span><span class="params">(x, mean, sigma)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> np.exp(- (x - mean)**<span class="number">2</span> / (<span class="number">2</span> * sigma**<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">6</span>, <span class="number">500</span>)</span><br><span class="line">mean = <span class="number">1</span></span><br><span class="line">sigma1 = <span class="number">0.1</span></span><br><span class="line">sigma2 = <span class="number">0.3</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">3</span>), dpi=<span class="number">144</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sub plot 1</span></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">'Gaussian for $\sigma=&#123;0&#125;$'</span>.format(sigma1))</span><br><span class="line"></span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">1.1</span>)</span><br><span class="line">ax = plt.gca()                                  <span class="comment"># gca ä»£è¡¨å½“å‰åæ ‡è½´ï¼Œå³ 'get current axis'</span></span><br><span class="line">ax.spines[<span class="string">'right'</span>].set_color(<span class="string">'none'</span>)            <span class="comment"># éšè—åæ ‡è½´</span></span><br><span class="line">ax.spines[<span class="string">'top'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(x, gaussian_kernel(x, mean, sigma1), <span class="string">'r-'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sub plot 2</span></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">plt.title(<span class="string">'Gaussian for $\sigma=&#123;0&#125;$'</span>.format(sigma2))</span><br><span class="line"></span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">1.1</span>)</span><br><span class="line">ax = plt.gca()                                  <span class="comment"># gca ä»£è¡¨å½“å‰åæ ‡è½´ï¼Œå³ 'get current axis'</span></span><br><span class="line">ax.spines[<span class="string">'right'</span>].set_color(<span class="string">'none'</span>)            <span class="comment"># éšè—åæ ‡è½´</span></span><br><span class="line">ax.spines[<span class="string">'top'</span>].set_color(<span class="string">'none'</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(x, gaussian_kernel(x, mean, sigma2), <span class="string">'r-'</span>)</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fq43dh16lcj30xp0bmq48.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span clas
      
    
    </summary>
    
      <category term="Machine learning" scheme="http://www.ihoge.cn/categories/Machine-learning/"/>
    
    
      <category term="scikit-learn" scheme="http://www.ihoge.cn/tags/scikit-learn/"/>
    
  </entry>
  
  <entry>
    <title>SVMæ”¯æŒå‘é‡æœºSVCå®ç°</title>
    <link href="http://www.ihoge.cn/2018/%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BASVC.html"/>
    <id>http://www.ihoge.cn/2018/æ”¯æŒå‘é‡æœºSVC.html</id>
    <published>2018-04-08T17:05:59.000Z</published>
    <updated>2018-04-10T10:01:23.892Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>æ”¯æŒå‘é‡æœº(support vector machine)æ˜¯ä¸€ç§åˆ†ç±»ç®—æ³•ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥åšå›å½’ï¼Œæ ¹æ®è¾“å…¥çš„æ•°æ®ä¸åŒå¯åšä¸åŒçš„æ¨¡å‹ï¼ˆè‹¥è¾“å…¥æ ‡ç­¾ä¸ºè¿ç»­å€¼åˆ™åšå›å½’ï¼Œè‹¥è¾“å…¥æ ‡ç­¾ä¸ºåˆ†ç±»å€¼åˆ™ç”¨SVC()åšåˆ†ç±»ï¼‰ã€‚é€šè¿‡å¯»æ±‚ç»“æ„åŒ–é£é™©æœ€å°æ¥æé«˜å­¦ä¹ æœºæ³›åŒ–èƒ½åŠ›ï¼Œå®ç°ç»éªŒé£é™©å’Œç½®ä¿¡èŒƒå›´çš„æœ€å°åŒ–ï¼Œä»è€Œè¾¾åˆ°åœ¨ç»Ÿè®¡æ ·æœ¬é‡è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œäº¦èƒ½è·å¾—è‰¯å¥½ç»Ÿè®¡è§„å¾‹çš„ç›®çš„ã€‚é€šä¿—æ¥è®²ï¼Œå®ƒæ˜¯ä¸€ç§äºŒç±»åˆ†ç±»æ¨¡å‹ï¼Œå…¶åŸºæœ¬æ¨¡å‹å®šä¹‰ä¸ºç‰¹å¾ç©ºé—´ä¸Šçš„é—´éš”æœ€å¤§çš„çº¿æ€§åˆ†ç±»å™¨ï¼Œå³æ”¯æŒå‘é‡æœºçš„å­¦ä¹ ç­–ç•¥ä¾¿æ˜¯é—´éš”æœ€å¤§åŒ–ï¼Œæœ€ç»ˆå¯è½¬åŒ–ä¸ºä¸€ä¸ªå‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜çš„æ±‚è§£ã€‚<br><code>sklearn</code>é‡Œå¯¹SVMçš„ç®—æ³•å®ç°åœ¨åŒ…<code>sklearn.svm</code>é‡Œã€‚</p><h3 id="svm-SVCåˆ†ç±»å™¨ç®€ä»‹ï¼š"><a href="#svm-SVCåˆ†ç±»å™¨ç®€ä»‹ï¼š" class="headerlink" title="svm.SVCåˆ†ç±»å™¨ç®€ä»‹ï¼š"></a><code>svm.SVC</code>åˆ†ç±»å™¨ç®€ä»‹ï¼š</h3><ul><li><p><strong>C</strong>ï¼šC-SVCçš„æƒ©ç½šå‚æ•°C?é»˜è®¤å€¼æ˜¯1.0</p><p>  Cè¶Šå¤§ï¼Œç›¸å½“äºæƒ©ç½šæ¾å¼›å˜é‡ï¼Œå¸Œæœ›æ¾å¼›å˜é‡æ¥è¿‘0ï¼Œå³å¯¹è¯¯åˆ†ç±»çš„æƒ©ç½šå¢å¤§ï¼Œè¶‹å‘äºå¯¹è®­ç»ƒé›†å…¨åˆ†å¯¹çš„æƒ…å†µï¼Œè¿™æ ·å¯¹è®­ç»ƒé›†æµ‹è¯•æ—¶å‡†ç¡®ç‡å¾ˆé«˜ï¼Œä½†æ³›åŒ–èƒ½åŠ›å¼±ã€‚Cå€¼å°ï¼Œå¯¹è¯¯åˆ†ç±»çš„æƒ©ç½šå‡å°ï¼Œå…è®¸å®¹é”™ï¼Œå°†ä»–ä»¬å½“æˆå™ªå£°ç‚¹ï¼Œæ³›åŒ–èƒ½åŠ›è¾ƒå¼ºã€‚</p></li><li><p><strong>kernel</strong> ï¼šæ ¸å‡½æ•°ï¼Œé»˜è®¤æ˜¯rbfï¼Œå¯ä»¥æ˜¯â€˜linearâ€™,â€˜polyâ€™, â€˜rbfâ€™</p><pre><code>liner â€“ çº¿æ€§æ ¸å‡½æ•°ï¼šu&apos;vpoly â€“ å¤šé¡¹å¼æ ¸å‡½æ•°ï¼š(gamma*u&apos;*v + coef0)^degreerbf â€“ RBFé«˜æ–¯æ ¸å‡½æ•°ï¼šexp(-gamma|u-v|^2)</code></pre></li></ul><ul><li><p><strong>degree</strong> ï¼šå¤šé¡¹å¼polyå‡½æ•°çš„ç»´åº¦ï¼Œé»˜è®¤æ˜¯3ï¼Œé€‰æ‹©å…¶ä»–æ ¸å‡½æ•°æ—¶ä¼šè¢«å¿½ç•¥ã€‚</p></li><li><p><strong>gamma</strong> ï¼š â€˜rbfâ€™,â€˜polyâ€™ å’Œâ€˜sigmoidâ€™çš„æ ¸å‡½æ•°å‚æ•°ã€‚é»˜è®¤æ˜¯â€™autoâ€™ï¼Œåˆ™ä¼šé€‰æ‹©1/n_features</p></li><li><p><strong>coef0</strong> ï¼šæ ¸å‡½æ•°çš„å¸¸æ•°é¡¹ã€‚å¯¹äºâ€˜polyâ€™å’Œ â€˜sigmoidâ€™æœ‰ç”¨ã€‚</p></li><li><p><strong>probability</strong> ï¼šæ˜¯å¦é‡‡ç”¨æ¦‚ç‡ä¼°è®¡ï¼Ÿ.é»˜è®¤ä¸ºFalse</p></li><li><p><strong>shrinking</strong> ï¼šæ˜¯å¦é‡‡ç”¨shrinking heuristicæ–¹æ³•ï¼Œé»˜è®¤ä¸ºtrue</p></li><li><p><strong>tol</strong> ï¼šåœæ­¢è®­ç»ƒçš„è¯¯å·®å€¼å¤§å°ï¼Œé»˜è®¤ä¸º1e-3</p></li><li><p><strong>cache_size</strong> ï¼šæ ¸å‡½æ•°cacheç¼“å­˜å¤§å°ï¼Œé»˜è®¤ä¸º200</p></li><li><p><strong>class_weight</strong> ï¼šç±»åˆ«çš„æƒé‡ï¼Œå­—å…¸å½¢å¼ä¼ é€’ã€‚è®¾ç½®ç¬¬å‡ ç±»çš„å‚æ•°Cä¸ºweight * C(C-SVCä¸­çš„C)</p></li><li><p><strong>verbose</strong> ï¼šå…è®¸å†—ä½™è¾“å‡ºï¼Ÿ</p></li><li><p><strong>max_iter</strong> ï¼šæœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚-1ä¸ºæ— é™åˆ¶ã€‚</p></li><li><p><strong>decision_function_shape</strong> ï¼šâ€˜ovoâ€™, â€˜ovrâ€™ or None, default=None3</p></li><li><p><strong>random_state</strong> ï¼šæ•°æ®æ´—ç‰Œæ—¶çš„ç§å­å€¼ï¼Œintå€¼</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨np.meshgrid()ç”Ÿæˆä¸€ä¸ªåæ ‡çŸ©é˜µï¼Œç„¶é¢„æµ‹åæ ‡çŸ©é˜µä¸­æ¯ä¸ªç‚¹æ‰€å±çš„ç±»åˆ«ï¼Œæœ€åç”¨contourf()å‡½æ•°</span></span><br><span class="line"><span class="comment"># ä¸ºæœ€è¡¨çŸ©é˜µä¸­ä¸åŒç±»åˆ«å¡«å……ä¸åŒé¢œè‰²</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_hyperplane</span><span class="params">(clf, X, y, </span></span></span><br><span class="line"><span class="function"><span class="params">                    h=<span class="number">0.02</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">                    draw_sv=True, </span></span></span><br><span class="line"><span class="function"><span class="params">                    title=<span class="string">'hyperplan'</span>)</span>:</span></span><br><span class="line">    <span class="comment"># create a mesh to plot in</span></span><br><span class="line">    x_min, x_max = X[:, <span class="number">0</span>].min() - <span class="number">1</span>, X[:, <span class="number">0</span>].max() + <span class="number">1</span></span><br><span class="line">    y_min, y_max = X[:, <span class="number">1</span>].min() - <span class="number">1</span>, X[:, <span class="number">1</span>].max() + <span class="number">1</span></span><br><span class="line">    xx, yy = np.meshgrid(np.arange(x_min, x_max, h),</span><br><span class="line">                         np.arange(y_min, y_max, h))</span><br><span class="line"></span><br><span class="line">    plt.title(title)</span><br><span class="line">    plt.xlim(xx.min(), xx.max())</span><br><span class="line">    plt.ylim(yy.min(), yy.max())</span><br><span class="line">    plt.xticks(())</span><br><span class="line">    plt.yticks(())</span><br><span class="line">    </span><br><span class="line">    Z = clf.predict(np.c_[xx.ravel(), yy.ravel()])</span><br><span class="line">    <span class="comment"># Put the result into a color plot</span></span><br><span class="line">    Z = Z.reshape(xx.shape)</span><br><span class="line">    plt.contourf(xx, yy, Z, cmap=<span class="string">'hot'</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    markers = [<span class="string">'o'</span>, <span class="string">'s'</span>, <span class="string">'^'</span>]</span><br><span class="line">    colors = [<span class="string">'b'</span>, <span class="string">'r'</span>, <span class="string">'c'</span>]</span><br><span class="line">    labels = np.unique(y)</span><br><span class="line">    <span class="keyword">for</span> label <span class="keyword">in</span> labels:</span><br><span class="line">        plt.scatter(X[y==label][:, <span class="number">0</span>], </span><br><span class="line">                    X[y==label][:, <span class="number">1</span>], </span><br><span class="line">                    c=colors[label], </span><br><span class="line">                    marker=markers[label], s=<span class="number">20</span>)</span><br><span class="line">    <span class="keyword">if</span> draw_sv:</span><br><span class="line">        sv = clf.support_vectors_</span><br><span class="line">        plt.scatter(sv[:, <span class="number">0</span>], sv[:, <span class="number">1</span>], c=<span class="string">'black'</span>, marker=<span class="string">'x'</span>, s=<span class="number">15</span>)</span><br></pre></td></tr></table></figure><h3 id="1ã€ç¬¬ä¸€ä¸ªä¾‹å­ï¼š"><a href="#1ã€ç¬¬ä¸€ä¸ªä¾‹å­ï¼š" class="headerlink" title="1ã€ç¬¬ä¸€ä¸ªä¾‹å­ï¼š"></a><strong>1ã€ç¬¬ä¸€ä¸ªä¾‹å­ï¼š</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> svm</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_blobs</span><br><span class="line"></span><br><span class="line">X, y = make_blobs(n_samples=<span class="number">100</span>, centers=<span class="number">2</span>, random_state=<span class="number">0</span>, cluster_std=<span class="number">0.3</span>)</span><br><span class="line"></span><br><span class="line">clf = svm.SVC(C = <span class="number">1.0</span>, kernel=<span class="string">'linear'</span>)</span><br><span class="line">clf.fit(X,y)</span><br><span class="line"></span><br><span class="line">print(clf.score(X,y))</span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">3</span>), dpi=<span class="number">100</span>)</span><br><span class="line">plot_hyperplane(clf, X, y, h=<span class="number">0.01</span>, title=<span class="string">'Maximiin Margin Hyperplan'</span>)</span><br></pre></td></tr></table></figure><p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fq5iil2vlrj30ma07iwex.jpg" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸Šå›¾å¸¦æœ‰Xæ ‡è®°ç‚¹çš„æ˜¯æ”¯æŒå‘é‡ï¼Œå®ƒä¿å­˜åœ¨æ¨¡å‹çš„support_vectors_é‡Œã€‚</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clf.support_vectors_</span><br></pre></td></tr></table></figure><pre><code>array([[0.70993435, 3.70954839],       [1.65719647, 3.86747763],       [1.7033305 , 1.48075002]])</code></pre><h3 id="2ã€ç¬¬äºŒä¸ªä¾‹å­"><a href="#2ã€ç¬¬äºŒä¸ªä¾‹å­" class="headerlink" title="2ã€ç¬¬äºŒä¸ªä¾‹å­"></a><strong>2ã€ç¬¬äºŒä¸ªä¾‹å­</strong></h3><p>ç”Ÿæˆä¸€ä¸ªæœ‰ä¸¤ä¸ªç‰¹å¾ã€ä¸‰çºµç±»åˆ«çš„æ•°æ®é›†ï¼Œç„¶ååˆ†åˆ«æ„é€ 4ä¸ªSVMç®—æ³•æ¥æ‹Ÿåˆæ•°æ®é›†ï¼Œåˆ†åˆ«æ˜¯çº¿æ€§å’Œå‡½æ•°ã€ä¸‰å§å¤šé¡¹å¼æ ¸å‡½æ•°ã€gamma=0.5çš„é«˜æ–¯æ ¸RBFæ ¸å‡½æ•°å’Œgamma=1çš„é«˜æ–¯æ ¸å‡½æ•°ã€‚æœ€åæŠŠå››ä¸ªç®—æ³•æ‹Ÿåˆå‡ºæ¥çš„åˆ†å‰²è¶…å¹³é¢ç”»å‡ºæ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> svm</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_blobs</span><br><span class="line"></span><br><span class="line">X, y = make_blobs(n_samples=<span class="number">100</span>, centers=<span class="number">3</span>, random_state=<span class="number">0</span>, cluster_std=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">clf_linear = svm.SVC(C=<span class="number">1.0</span>, kernel=<span class="string">'linear'</span>)</span><br><span class="line">clf_poly = svm.SVC(C=<span class="number">1.0</span>, kernel=<span class="string">'poly'</span>, degree=<span class="number">3</span>)</span><br><span class="line">clf_rbf = svm.SVC(C=<span class="number">1.0</span>, kernel=<span class="string">'rbf'</span>, gamma=<span class="number">0.5</span>)</span><br><span class="line">clf_rbf1 = svm.SVC(C=<span class="number">1.0</span>, kernel=<span class="string">'rbf'</span>, gamma=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">10</span>),dpi=<span class="number">140</span>)</span><br><span class="line"></span><br><span class="line">clfs = [clf_linear, clf_poly, clf_rbf, clf_rbf1]</span><br><span class="line">titles = [<span class="string">'linearSVC'</span>,<span class="string">'polySVC_d3'</span>,<span class="string">'rbfSVC_0.5'</span>,<span class="string">'rbfSVC_1'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> clf, i <span class="keyword">in</span> zip(clfs, range(len(clfs))):</span><br><span class="line">    clf.fit(X, y)</span><br><span class="line">    plt.subplot(<span class="number">2</span>, <span class="number">2</span>, i+<span class="number">1</span>)</span><br><span class="line">    plot_hyperplane(clf, X, y, title=titles[i])</span><br></pre></td></tr></table></figure><p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fq5iizji9fj31140v2q7c.jpg" alt=""></p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯åä¸‹å’Œå³ä¸‹é«˜æ–¯å‡½æ•°çš„å›¾ã€‚æ—¢ç„¶æ”¯æŒå‘é‡æ˜¯ç¦»è¶…å¹³é¢æœ€è¿‘çš„ç‚¹ï¼Œé‚£ä¸ºä»€ä¹ˆé«˜æ–¯å‡½æ•°çš„å›¾ä¸­ç¦»åˆ†å‰²è¶…å¹³é¢å¾ˆè¿œçš„ç‚¹ä¹Ÿæ˜¯æ”¯æŒå‘é‡å‘¢ï¼Ÿ</p><p>åŸå› æ˜¯é«˜æ–¯æ ¸å‡½æ•°æŠŠè¾“å…¥ç‰¹å¾å‘é‡æ˜ å°„åˆ°äº†æ— é™ç»´çš„å‘é‡ç©ºé—´é‡Œï¼Œåœ¨é«˜ç»´ç©ºé—´é‡Œè¿™äº›ç‚¹å…¶å®å°±æ˜¯æœ€è¿‘çš„ç‚¹ã€‚</p><h3 id="3ã€ä¾‹ä¸‰ï¼šä¹³è…ºç™Œæ£€æµ‹"><a href="#3ã€ä¾‹ä¸‰ï¼šä¹³è…ºç™Œæ£€æµ‹" class="headerlink" title="3ã€ä¾‹ä¸‰ï¼šä¹³è…ºç™Œæ£€æµ‹"></a><strong>3ã€ä¾‹ä¸‰ï¼šä¹³è…ºç™Œæ£€æµ‹</strong></h3><ul><li><strong>ä½¿ç”¨RBFé«˜æ–¯æ ¸å‡½æ•°</strong></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_breast_cancer</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">cancer = load_breast_cancer()</span><br><span class="line">X = cancer.data</span><br><span class="line">y = cancer.target</span><br><span class="line">print(<span class="string">'data shape:&#123;0&#125;; no. positive:&#123;1&#125;; no. negative:&#123;2&#125;'</span>.format(X.shape, y[y==<span class="number">1</span>].shape[<span class="number">0</span>], y[y==<span class="number">0</span>].shape[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="number">.2</span>)</span><br></pre></td></tr></table></figure><pre><code>data shape:(569, 30); no. positive:357; no. negative:212</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line"></span><br><span class="line">clf = SVC(C=<span class="number">1</span>, kernel=<span class="string">'rbf'</span>, gamma=<span class="number">.1</span>)</span><br><span class="line">clf.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">"Train_score:&#123;0&#125;\nTest_score:&#123;1&#125;"</span>.format(clf.score(X_train, y_train), clf.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><pre><code>Train_score:1.0Test_score:0.6754385964912281</code></pre><p>ä¸Šä¾‹å…¸å‹è¿‡æ‹Ÿåˆã€‚ä»£ç gammaå‚æ•°ä¸º0.1ï¼Œè¿™ä¸ªå‚æ•°è¯´æ˜ä½œç”¨å‘¢ï¼Ÿ</p><p>å›å¿†ä¸‹RBF æ ¸å‡½æ•°$$K\left( x^{\left( i \right)},x^{\left( j \right)} \right)=\exp \left( -\frac{\left( x^{\left( i \right)}-x^{\left( j \right)} \right)^{2}}{2\sigma ^{2}} \right)$$<br>$Î³$ï¼ˆæŒ‡æœ¬å¼ä¸­çš„$\sigma$ï¼‰ä¸»è¦å®šä¹‰äº†å•ä¸ªæ ·æœ¬å¯¹æ•´ä¸ªåˆ†ç±»è¶…å¹³é¢çš„å½±å“ï¼Œå½“$Î³$<br>æ¯”è¾ƒå°æ—¶ï¼Œå•ä¸ªæ ·æœ¬å¯¹æ•´ä¸ªåˆ†ç±»è¶…å¹³é¢çš„å½±å“æ¯”è¾ƒå°ï¼Œä¸å®¹æ˜“è¢«é€‰æ‹©ä¸ºæ”¯æŒå‘é‡ï¼Œåä¹‹ï¼Œå½“$Î³$æ¯”è¾ƒå¤§æ—¶ï¼Œå•ä¸ªæ ·æœ¬å¯¹æ•´ä¸ªåˆ†ç±»è¶…å¹³é¢çš„å½±å“æ¯”è¾ƒå¤§ï¼Œæ›´å®¹æ˜“è¢«é€‰æ‹©ä¸ºæ”¯æŒå‘é‡ï¼Œæˆ–è€…è¯´æ•´ä¸ªæ¨¡å‹çš„æ”¯æŒå‘é‡ä¹Ÿä¼šå¤šã€‚scikit-learnä¸­é»˜è®¤å€¼æ˜¯1/n_featuresï¼ˆ1/æ ·æœ¬é‡ï¼‰ã€‚</p><p>å› æ­¤åˆ¤æ–­é€ æˆè¿‡æ‹Ÿåˆçš„åŸå› æ˜¯$Î³$å¤ªå¤§ã€‚ä¸‹é¢ç”¨<code>GridSearchCV</code>æ¥è‡ªåŠ¨é€‰æ‹©$Î³$çš„æœ€ä¼˜å‚æ•°ä»¥åŠå¯¹åº”çš„äº¤å‰éªŒè¯è¯„åˆ†åŠå¬å›ç‡å’ŒF1å¾—åˆ†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics </span><br><span class="line"></span><br><span class="line">thresholds = np.linspace(<span class="number">0</span>, <span class="number">0.001</span>, <span class="number">100</span>)</span><br><span class="line"><span class="comment"># Set the parameters by cross-validation</span></span><br><span class="line">param_grid = &#123;<span class="string">'gamma'</span>: thresholds&#125;</span><br><span class="line"></span><br><span class="line">clf = GridSearchCV(SVC(kernel=<span class="string">'rbf'</span>), param_grid, cv=<span class="number">5</span>)</span><br><span class="line">clf.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">"best param: &#123;0&#125;\nbest score: &#123;1&#125;"</span>.format(clf.best_params_, </span><br><span class="line">                                                clf.best_score_))</span><br><span class="line">y_pred = clf.predict(X_test)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"æŸ¥å‡†ç‡ï¼š"</span>,metrics.precision_score(y_pred, y_test))</span><br><span class="line">print(<span class="string">"å¬å›ç‡ï¼š"</span>,metrics.recall_score(y_pred, y_test))</span><br><span class="line">print(<span class="string">"F1ï¼š"</span>,metrics.f1_score(y_pred, y_test))</span><br></pre></td></tr></table></figure><pre><code>best param: {&apos;gamma&apos;: 9.090909090909092e-05}best score: 0.945054945054945æŸ¥å‡†ç‡ï¼š 0.961038961038961å¬å›ç‡ï¼š 0.925F1ï¼š 0.9426751592356688</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> learning_curve</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_learn_curve</span><span class="params">(estimator, title, X, y, ylim = None, cv=None, n_jobs=<span class="number">1</span>, train_sizes=np.linspace<span class="params">(<span class="number">.1</span>, <span class="number">1.</span>, <span class="number">5</span>)</span>)</span>:</span></span><br><span class="line">    plt.title(title)</span><br><span class="line">    <span class="keyword">if</span> ylim <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        plt.ylim(*ylim)</span><br><span class="line">    plt.xlabel(<span class="string">"train exs"</span>)</span><br><span class="line">    plt.ylabel(<span class="string">"Score"</span>)</span><br><span class="line">    train_sizes, train_scores, test_scores = learning_curve(</span><br><span class="line">        estimator, X, y, cv=cv, n_jobs=n_jobs, train_sizes=train_sizes)</span><br><span class="line">    train_score_mean = np.mean(train_scores, axis=<span class="number">1</span>)</span><br><span class="line">    train_score_std = np.std(train_scores, axis=<span class="number">1</span>)</span><br><span class="line">    test_score_mean = np.mean(test_scores, axis=<span class="number">1</span>)</span><br><span class="line">    test_score_std = np.std(test_scores, axis=<span class="number">1</span>)</span><br><span class="line">    plt.grid()</span><br><span class="line">    </span><br><span class="line">    plt.fill_between(train_sizes, train_score_mean - train_score_std, </span><br><span class="line">                     train_score_mean + train_score_std, alpha=<span class="number">0.1</span>, color=<span class="string">'r'</span>)</span><br><span class="line">    plt.fill_between(train_sizes, test_score_mean - test_score_std, </span><br><span class="line">                     test_score_mean + test_score_std, alpha=<span class="number">0.1</span>, color=<span class="string">'g'</span>)</span><br><span class="line">    plt.plot(train_sizes, train_score_mean, <span class="string">'o-'</span>, color=<span class="string">'r'</span>, label=<span class="string">'train scoreè®­ç»ƒå¾—åˆ†'</span>)</span><br><span class="line">    plt.plot(train_sizes, test_score_mean, <span class="string">'o-'</span>, color=<span class="string">'g'</span>, label=<span class="string">'cross-validation scoreäº¤å‰éªŒè¯å¾—åˆ†'</span>)</span><br><span class="line">    </span><br><span class="line">    plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">    <span class="keyword">return</span> plt</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> ShuffleSplit</span><br><span class="line"></span><br><span class="line">cv = ShuffleSplit(n_splits=<span class="number">10</span>, test_size=<span class="number">.2</span>, random_state=<span class="number">0</span>)</span><br><span class="line">title = <span class="string">'Learing Curve for SVC-RBF'</span></span><br><span class="line"></span><br><span class="line">gammas=[<span class="number">0.001</span>, <span class="number">0.0005</span>, <span class="number">0.0003</span>, <span class="number">0.0001</span>]</span><br><span class="line">start = time.clock()</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">14</span>,<span class="number">10</span>), dpi=<span class="number">140</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(gammas)):</span><br><span class="line">    plt.subplot(<span class="number">2</span>, <span class="number">2</span>, i+<span class="number">1</span>)</span><br><span class="line">    plot_learn_curve(SVC(C=<span class="number">1.</span>, gamma=gammas[i]), gammas[i], X, y, cv=cv)</span><br><span class="line"></span><br><span class="line"><span class="comment"># plt.figure(figsize=(8,6), dpi=120)</span></span><br><span class="line"><span class="comment"># plot_learn_curve(SVC(C=1., gamma=gammas[0]), title, X, y, cv=cv)</span></span><br><span class="line">print(<span class="string">"è€—æ—¶ï¼š"</span>, time.clock() - start)</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006tKfTcly1fq5kp9xbugj319e0wmn3e.jpg" alt=""></p><ul><li><strong>ä½¿ç”¨å¤šé¡¹å¼æ ¸å‡½æ•°</strong></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">clf = SVC(C=<span class="number">1.</span>, kernel=<span class="string">'poly'</span>, degree=<span class="number">2</span>)</span><br><span class="line">start = time.clock()</span><br><span class="line">clf.fit(X_train, y_train)</span><br><span class="line">y_pred = clf.predict(X_test)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"è€—æ—¶ï¼š"</span>,time.clock()-start)</span><br><span class="line">print(<span class="string">"Train_score:&#123;0&#125;\nTest_score:&#123;1&#125;"</span>.format(clf.score(X_train, y_train), clf.score(X_test, y_test)))</span><br><span class="line">print(<span class="string">"æŸ¥å‡†ç‡ï¼š"</span>,metrics.precision_score(y_pred, y_test))</span><br><span class="line">print(<span class="string">"å¬å›ç‡ï¼š"</span>,metrics.recall_score(y_pred, y_test))</span><br><span class="line">print(<span class="string">"F1ï¼š"</span>,metrics.f1_score(y_pred, y_test))</span><br></pre></td></tr></table></figure><pre><code>è€—æ—¶ï¼š 13.866157000000015Train_score:0.978021978021978Test_score:0.9736842105263158æŸ¥å‡†ç‡ï¼š 0.9866666666666667å¬å›ç‡ï¼š 0.9736842105263158F1ï¼š 0.9801324503311258</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> ShuffleSplit</span><br><span class="line"></span><br><span class="line">cv = ShuffleSplit(n_splits=<span class="number">10</span>, test_size=<span class="number">.2</span>, random_state=<span class="number">0</span>)</span><br><span class="line">titles = [<span class="string">'poly_SVC_D=1'</span>,<span class="string">'ploy_SVC_D=2'</span>]</span><br><span class="line">degrees = [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">start = time.clock()</span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>), dpi=<span class="number">130</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(degrees)):</span><br><span class="line">    plt.subplot(<span class="number">1</span>, len(degrees), i+<span class="number">1</span>)</span><br><span class="line">    plot_learn_curve(SVC(kernel=<span class="string">'poly'</span>, degree=degrees[i]), titles[i], X, y, cv=cv)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"è€—æ—¶ï¼š"</span>, time.clock()-start)</span><br></pre></td></tr></table></figure><p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fq5njno5cbj310k0dxacq.jpg" alt=""></p><p>å¯ä»¥çœ‹å‡ºï¼Œä¸€é˜¶å¤šé¡¹å¼æ ¸å‡½æ•°çš„æ‹Ÿåˆæ•ˆæœæ›´å¥½ã€‚å¹³å‡äº¤å‰éªŒè¯æ•°æ®é›†è¯„åˆ†0.94ï¼Œæœ€é«˜æ—¶å¯è¾¾0.975ã€‚å½“ç„¶æ¶ˆè€—çš„æ—¶é—´ä¹Ÿæ›´ä¹…ï¼Œä¸€é˜¶å¤šé¡¹å¼è®¡ç®—ä»£ä»·æ¯”é«˜æ–¯æ ¸å‡½æ•°çš„SVCè¿ç®—äº‹ä»¶å¤šå‡ºäº†å¥½å¤šå€ã€‚ ä¹‹å‰ç¬”è€…ä½¿ç”¨é€»è¾‘å›å½’ç®—æ³•æ£€æµ‹ä¹³è…ºç™Œæ£€æµ‹é—®é¢˜æ—¶ï¼Œä½¿ç”¨äºŒé¡¹å¤šé¡¹å¼é€»è¾‘å›å½’å¢åŠ ç‰¹å¾åŒæ—¶ä½¿ç”¨L1èŒƒæ•°ä½œä¸ºæ­£åˆ™é¡¹çš„æ‹Ÿåˆæ•ˆæœæ¯”è¿™é‡Œçš„æ”¯æŒå‘é‡æœºæ•ˆæœå¥½ï¼Œæ›´é‡è¦çš„æ˜¯é€»è¾‘å›å½’ç®—æ³•çš„è¿ç®—æ•ˆç‡è¿œè¿œé«˜äºäºŒé˜¶å¤šé¡¹å¼æ ¸å‡½æ•°çš„æ”¯æŒå‘é‡æœºç®—æ³•ã€‚å½“ç„¶ï¼Œè¿™é‡Œçš„æ”¯æŒå‘é‡æœºç®—æ³•çš„æ•ˆæœè¿˜æ˜¯æ¯”ä½¿ç”¨L2èŒƒæ•°ä½œä¸ºæ­£åˆ™é¡¹çš„é€»è¾‘å›å½’å‡†ç¡®ç‡é«˜ï¼Œç”±æ­¤å¯è§æœ¨æ˜Ÿé€‰æ‹©å’Œå‚æ•°è°ƒä¼˜å¯¹æœºå™¨å­¦ä¹ çš„é‡è¦æ€§ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;æ”¯æŒå‘é‡æœº(support vector machine)æ˜¯ä¸€ç§åˆ†ç±»ç®—æ³•ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥åšå›å½’ï¼Œæ ¹æ®è¾“å…¥çš„æ•°æ®ä¸åŒå¯åšä¸åŒçš„æ¨¡å‹ï¼ˆè‹¥è¾“å…¥æ ‡ç­¾ä¸ºè¿ç»­å€¼åˆ™åšå›å½’ï¼Œè‹¥è¾“å…¥æ ‡ç­¾ä¸ºåˆ†ç±»å€¼åˆ™ç”¨SVC()åšåˆ†ç±»ï¼‰ã€‚é€šè¿‡å¯»æ±‚ç»“æ„åŒ–é£é™©æœ€å°æ¥æé«˜å­¦ä¹ æœºæ³›åŒ–èƒ½åŠ›
      
    
    </summary>
    
      <category term="Machine learning" scheme="http://www.ihoge.cn/categories/Machine-learning/"/>
    
    
      <category term="scikit-learn" scheme="http://www.ihoge.cn/tags/scikit-learn/"/>
    
  </entry>
  
  <entry>
    <title>sklearnèšåˆç®—æ³•æ•´ç†</title>
    <link href="http://www.ihoge.cn/2018/sklearn-ensemble.html"/>
    <id>http://www.ihoge.cn/2018/sklearn-ensemble.html</id>
    <published>2018-04-08T16:19:59.000Z</published>
    <updated>2018-04-10T10:01:44.986Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éšæœºæ£®æ—åˆ†ç±»é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…"><a href="#éšæœºæ£®æ—åˆ†ç±»é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…" class="headerlink" title="éšæœºæ£®æ—åˆ†ç±»é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…"></a>éšæœºæ£®æ—åˆ†ç±»é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_dataset</span><span class="params">(fname)</span>:</span></span><br><span class="line">    data = pd.read_csv(fname, index_col=<span class="number">0</span>)</span><br><span class="line">    data.drop([<span class="string">'Name'</span>, <span class="string">'Ticket'</span>, <span class="string">'Cabin'</span>], axis=<span class="number">1</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">    lables = data[<span class="string">'Sex'</span>].unique().tolist()</span><br><span class="line">    data[<span class="string">'Sex'</span>] = [*map(<span class="keyword">lambda</span> x: lables.index(x) , data[<span class="string">'Sex'</span>])]</span><br><span class="line">    lables = data[<span class="string">'Embarked'</span>].unique().tolist()</span><br><span class="line">    data[<span class="string">'Embarked'</span>] = data[<span class="string">'Embarked'</span>].apply(<span class="keyword">lambda</span> n: lables.index(n))</span><br><span class="line">    data = data.fillna(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">train = read_dataset(<span class="string">'code/datasets/titanic/train.csv'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">y = train[<span class="string">'Survived'</span>].values</span><br><span class="line">X = train.drop([<span class="string">'Survived'</span>], axis=<span class="number">1</span>).values</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="number">0.2</span>)</span><br><span class="line">print(<span class="string">"X_train_shape:"</span>, X_train.shape, <span class="string">" y_train_shape:"</span>, y_train.shape)</span><br><span class="line">print(<span class="string">"X_test_shape:"</span>, X_test.shape,<span class="string">"  y_test_shape:"</span>, y_test.shape)</span><br></pre></td></tr></table></figure><pre><code>X_train_shape: (712, 7)  y_train_shape: (712,)X_test_shape: (179, 7)   y_test_shape: (179,)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">****</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start = time.clock()</span><br><span class="line">entropy_thresholds = np.linspace(<span class="number">0</span>, <span class="number">1</span>, <span class="number">50</span>)</span><br><span class="line">gini_thresholds = np.linspace(<span class="number">0</span>, <span class="number">0.1</span>, <span class="number">50</span>)</span><br><span class="line"><span class="comment">#è®¾ç½®å‚æ•°çŸ©é˜µï¼š</span></span><br><span class="line">param_grid = [&#123;<span class="string">'criterion'</span>: [<span class="string">'entropy'</span>], <span class="string">'min_impurity_decrease'</span>: entropy_thresholds&#125;,</span><br><span class="line">              &#123;<span class="string">'criterion'</span>: [<span class="string">'gini'</span>], <span class="string">'min_impurity_decrease'</span>: gini_thresholds&#125;,</span><br><span class="line">              &#123;<span class="string">'max_depth'</span>: np.arange(<span class="number">2</span>,<span class="number">10</span>)&#125;,</span><br><span class="line">              &#123;<span class="string">'min_samples_split'</span>: np.arange(<span class="number">2</span>,<span class="number">20</span>)&#125;,</span><br><span class="line">              &#123;<span class="string">'n_estimators'</span>:np.arange(<span class="number">2</span>,<span class="number">20</span>)&#125;]</span><br><span class="line">clf = GridSearchCV(RandomForestClassifier(), param_grid, cv=<span class="number">5</span>)</span><br><span class="line">clf.fit(X, y)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"è€—æ—¶ï¼š"</span>,time.clock() - start)</span><br><span class="line">print(<span class="string">"best param:&#123;0&#125;\nbest score:&#123;1&#125;"</span>.format(clf.best_params_, clf.best_score_))</span><br></pre></td></tr></table></figure><pre><code>è€—æ—¶ï¼š 13.397480000000002best param:{&apos;min_samples_split&apos;: 10}best score:0.8406285072951739</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">clf = RandomForestClassifier(min_samples_split=<span class="number">10</span>)</span><br><span class="line">clf.fit(X_train, y_train)</span><br><span class="line">y_pred = clf.predict(X_test)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"è®­ç»ƒé›†å¾—åˆ†:"</span>, clf.score(X_train, y_train))</span><br><span class="line">print(<span class="string">"æµ‹è¯•é›†å¾—åˆ†:"</span>, clf.score(X_test, y_test))</span><br><span class="line">print(<span class="string">"æŸ¥å‡†ç‡:"</span>, metrics.precision_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"å¬å›ç‡:"</span>, metrics.recall_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"F1_score:"</span>, metrics.f1_score(y_test, y_pred))</span><br></pre></td></tr></table></figure><pre><code>è®­ç»ƒé›†å¾—åˆ†: 0.8974719101123596æµ‹è¯•é›†å¾—åˆ†: 0.7988826815642458æŸ¥å‡†ç‡: 0.8082191780821918å¬å›ç‡: 0.7283950617283951F1_score: 0.7662337662337663</code></pre><p>è¿™æ¬¡åˆ†åˆ«å¯¹æ¨¡å‹çš„<code>criterion</code>,<code>max_depth</code>,<code>min_samples_split</code>,<code>n_estimators</code>å››ä¸ªå‚æ•°è¿›è¡Œäº†æ¯”è¾ƒã€‚</p><p>ç»è¿‡å¤šæ¬¡æ‰§è¡Œå‘ç°ç»“æœä»ä¸æ˜¯å¾ˆç¨³å®šï¼Œæœ€ä¼˜å‚æ•°é›†ä¸­åœ¨<code>min_samples_split</code>åˆ†åˆ«ä¸º8ï¼Œ10ï¼Œ12ä¸Š</p><h2 id="è‡ªåŠ©èšåˆç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…"><a href="#è‡ªåŠ©èšåˆç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…" class="headerlink" title="è‡ªåŠ©èšåˆç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…"></a>è‡ªåŠ©èšåˆç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> BaggingClassifier</span><br><span class="line"></span><br><span class="line">clf = BaggingClassifier(n_estimators=<span class="number">50</span>)</span><br><span class="line">clf.fit(X_train, y_train)</span><br><span class="line">y_pred = clf.predict(X_test)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"è®­ç»ƒé›†å¾—åˆ†:"</span>, clf.score(X_train, y_train))</span><br><span class="line">print(<span class="string">"æµ‹è¯•é›†å¾—åˆ†:"</span>, clf.score(X_test, y_test))</span><br><span class="line">print(<span class="string">"æŸ¥å‡†ç‡:"</span>, metrics.precision_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"å¬å›ç‡:"</span>, metrics.recall_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"F1_score:"</span>, metrics.f1_score(y_test, y_pred))</span><br></pre></td></tr></table></figure><pre><code>è®­ç»ƒé›†å¾—åˆ†: 0.9817415730337079æµ‹è¯•é›†å¾—åˆ†: 0.7877094972067039æŸ¥å‡†ç‡: 0.7792207792207793å¬å›ç‡: 0.7407407407407407F1_score: 0.7594936708860759</code></pre><h2 id="Boostingæ­£å‘æ¿€åŠ±ç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…"><a href="#Boostingæ­£å‘æ¿€åŠ±ç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…" class="headerlink" title="Boostingæ­£å‘æ¿€åŠ±ç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…"></a>Boostingæ­£å‘æ¿€åŠ±ç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> AdaBoostClassifier</span><br><span class="line"></span><br><span class="line">clf = AdaBoostClassifier()</span><br><span class="line">clf.fit(X_train, y_train)</span><br><span class="line">y_pred = clf.predict(X_test)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"è®­ç»ƒé›†å¾—åˆ†:"</span>, clf.score(X_train, y_train))</span><br><span class="line">print(<span class="string">"æµ‹è¯•é›†å¾—åˆ†:"</span>, clf.score(X_test, y_test))</span><br><span class="line">print(<span class="string">"æŸ¥å‡†ç‡:"</span>, metrics.precision_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"å¬å›ç‡:"</span>, metrics.recall_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"F1_score:"</span>, metrics.f1_score(y_test, y_pred))</span><br></pre></td></tr></table></figure><pre><code>è®­ç»ƒé›†å¾—åˆ†: 0.8300561797752809æµ‹è¯•é›†å¾—åˆ†: 0.8156424581005587æŸ¥å‡†ç‡: 0.8076923076923077å¬å›ç‡: 0.7777777777777778F1_score: 0.7924528301886792</code></pre><h2 id="Extra-Treesç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…"><a href="#Extra-Treesç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…" class="headerlink" title="Extra Treesç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…"></a>Extra Treesç®—æ³•é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start = time.clock()</span><br><span class="line">entropy_thresholds = np.linspace(<span class="number">0</span>, <span class="number">1</span>, <span class="number">50</span>)</span><br><span class="line">gini_thresholds = np.linspace(<span class="number">0</span>, <span class="number">0.1</span>, <span class="number">50</span>)</span><br><span class="line"><span class="comment">#è®¾ç½®å‚æ•°çŸ©é˜µï¼š</span></span><br><span class="line">param_grid = [&#123;<span class="string">'criterion'</span>: [<span class="string">'entropy'</span>], <span class="string">'min_impurity_decrease'</span>: entropy_thresholds&#125;,</span><br><span class="line">              &#123;<span class="string">'criterion'</span>: [<span class="string">'gini'</span>], <span class="string">'min_impurity_decrease'</span>: gini_thresholds&#125;,</span><br><span class="line">              &#123;<span class="string">'max_depth'</span>: np.arange(<span class="number">2</span>,<span class="number">10</span>)&#125;,</span><br><span class="line">              &#123;<span class="string">'min_samples_split'</span>: np.arange(<span class="number">2</span>,<span class="number">20</span>)&#125;,</span><br><span class="line">              &#123;<span class="string">'n_estimators'</span>:np.arange(<span class="number">2</span>,<span class="number">20</span>)&#125;]</span><br><span class="line">clf = GridSearchCV(ExtraTreesClassifier(), param_grid, cv=<span class="number">5</span>)</span><br><span class="line">clf.fit(X, y)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"è€—æ—¶ï¼š"</span>,time.clock() - start)</span><br><span class="line">print(<span class="string">"best param:&#123;0&#125;\nbest score:&#123;1&#125;"</span>.format(clf.best_params_, clf.best_score_))</span><br></pre></td></tr></table></figure><pre><code>è€—æ—¶ï¼š 16.29516799999999best param:{&apos;min_samples_split&apos;: 12}best score:0.8226711560044894</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> ExtraTreesClassifier</span><br><span class="line"></span><br><span class="line">clf = ExtraTreesClassifier(min_samples_split=<span class="number">12</span><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start = time.clock()</span><br><span class="line">entropy_thresholds = np.linspace(<span class="number">0</span>, <span class="number">1</span>, <span class="number">50</span>)</span><br><span class="line">gini_thresholds = np.linspace(<span class="number">0</span>, <span class="number">0.1</span>, <span class="number">50</span>)</span><br><span class="line"><span class="comment">#è®¾ç½®å‚æ•°çŸ©é˜µï¼š</span></span><br><span class="line">param_grid = [&#123;<span class="string">'criterion'</span>: [<span class="string">'entropy'</span>], <span class="string">'min_impurity_decrease'</span>: entropy_thresholds&#125;,</span><br><span class="line">              &#123;<span class="string">'criterion'</span>: [<span class="string">'gini'</span>], <span class="string">'min_impurity_decrease'</span>: gini_thresholds&#125;,</span><br><span class="line">              &#123;<span class="string">'max_depth'</span>: np.arange(<span class="number">2</span>,<span class="number">10</span>)&#125;,</span><br><span class="line">              &#123;<span class="string">'min_samples_split'</span>: np.arange(<span class="number">2</span>,<span class="number">20</span>)&#125;,</span><br><span class="line">              &#123;<span class="string">'n_estimators'</span>:np.arange(<span class="number">2</span>,<span class="number">20</span>)&#125;]</span><br><span class="line">clf = GridSearchCV(ExtraTreesClassifier(), param_grid, cv=<span class="number">5</span>)</span><br><span class="line">clf.fit(X, y)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"è€—æ—¶ï¼š"</span>,time.clock() - start)</span><br><span class="line">print(<span class="string">"best param:&#123;0&#125;\nbest score:&#123;1&#125;"</span>.format(clf.best_params_, clf.best_score_)))</span><br><span class="line">clf.fit(X_train, y_train)</span><br><span class="line">y_pred = clf.predict(X_test)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"è®­ç»ƒé›†å¾—åˆ†:"</span>, clf.score(X_train, y_train))</span><br><span class="line">print(<span class="string">"æµ‹è¯•é›†å¾—åˆ†:"</span>, clf.score(X_test, y_test))</span><br><span class="line">print(<span class="string">"æŸ¥å‡†ç‡:"</span>, metrics.precision_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"å¬å›ç‡:"</span>, metrics.recall_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"F1_score:"</span>, metrics.f1_score(y_test, y_pred))</span><br></pre></td></tr></table></figure><pre><code>è®­ç»ƒé›†å¾—åˆ†: 0.8932584269662921æµ‹è¯•é›†å¾—åˆ†: 0.8100558659217877æŸ¥å‡†ç‡: 0.8405797101449275å¬å›ç‡: 0.7160493827160493F1_score: 0.7733333333333333</code></pre><h2 id="ç»“è®ºï¼š"><a href="#ç»“è®ºï¼š" class="headerlink" title="ç»“è®ºï¼š"></a>ç»“è®ºï¼š</h2><p>é’ˆå¯¹æ­¤æ•°æ®é›†é¢„æµ‹æ³°å¦å°¼å…‹å·çš„ç»“æœå¯¹æ¯”ä¸­ï¼ŒBoostingæ­£å‘æ¿€åŠ±ç®—æ³•æ€§èƒ½æœ€ä½³æœ€ç¨³å®šï¼Œå…¶æ¬¡æ˜¯å‚æ•°ä¼˜åŒ–åçš„Extra Treesç®—æ³•ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;éšæœºæ£®æ—åˆ†ç±»é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…&quot;&gt;&lt;a href=&quot;#éšæœºæ£®æ—åˆ†ç±»é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…&quot; class=&quot;headerlink&quot; title=&quot;éšæœºæ£®æ—åˆ†ç±»é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…&quot;&gt;&lt;/a&gt;éšæœºæ£®æ—åˆ†ç±»é¢„æµ‹æ³°å¦å°¼å°¼å…‹å·å¹¸å­˜è€…&lt;/h2&gt;&lt;figure class
      
    
    </summary>
    
      <category term="Machine learning" scheme="http://www.ihoge.cn/categories/Machine-learning/"/>
    
    
      <category term="scikit-learn" scheme="http://www.ihoge.cn/tags/scikit-learn/"/>
    
  </entry>
  
  <entry>
    <title>SVMæ”¯æŒå‘é‡æœºåŸç†åŠæ ¸å‡½æ•°</title>
    <link href="http://www.ihoge.cn/2018/SVM.html"/>
    <id>http://www.ihoge.cn/2018/SVM.html</id>
    <published>2018-04-07T12:05:59.000Z</published>
    <updated>2018-04-07T12:05:29.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="æ”¯æŒå‘é‡æœºåŸç†"><a href="#æ”¯æŒå‘é‡æœºåŸç†" class="headerlink" title="æ”¯æŒå‘é‡æœºåŸç†"></a>æ”¯æŒå‘é‡æœºåŸç†</h2><h3 id="å¤§è·ç¦»åˆ†ç±»ç®—æ³•"><a href="#å¤§è·ç¦»åˆ†ç±»ç®—æ³•" class="headerlink" title="å¤§è·ç¦»åˆ†ç±»ç®—æ³•"></a>å¤§è·ç¦»åˆ†ç±»ç®—æ³•</h3><p>1ã€åè¯è§£é‡Šï¼š</p><ul><li><p><strong>åˆ†å‰²è¶…å¹³é¢</strong>ï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ„é€ ä¸€ä¸ªåˆ†å‰²çº¿æŠŠåœ†å½¢çš„ç‚¹å’Œæ–¹å½¢çš„ç‚¹åˆ†å¼€ï¼Œè¿™ä¸ªçº¿ç§°ä¸º<strong>åˆ†å‰²è¶…å¹³é¢</strong>ã€‚</p></li><li><p><strong>æ”¯æŒå‘é‡</strong>ï¼šç¦»åˆ†å‰²è¶…å¹³é¢æœ€è¿‘çš„ç‚¹</p></li><li><p><strong>é—´è·</strong>ï¼šæ”¯æŒå‘é‡åˆ°åˆ†å‰²è¶…å¹³é¢è·ç¦»çš„ä¸¤å€</p></li></ul><p><strong>SVMç®—æ³•çš„åŸç†å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªåˆ†å‰²è¶…å¹³é¢ï¼Œå®ƒèƒ½æŠŠæ•°æ®æ­£ç¡®çš„åˆ†ç±»ï¼Œå¹¶ä¸”é—´è·æœ€å¤§ï¼</strong></p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fq43bc7pj3j30gx0c6gm7.jpg" alt=""></p><p>2ã€è®¡ç®—é—´è·</p><p>åœ¨è€Œä¸ºç©ºé—´é‡Œï¼Œå¯ä»¥ä½¿ç”¨æ–¹ç¨‹$w_1x_1+w_2x_2+b=0$æ¥è¡¨ç¤ºåˆ†å‰²è¶…å¹³é¢ã€‚é’ˆå¯¹é«˜çº¬åº¦ç©ºé—´ï¼Œå¯ä»¥å†™æˆä¸€èˆ¬åŒ–çš„å‘é‡å½¢å¼ï¼Œå³$w^Tx+b=0$ã€‚è¿™é‡Œç”»å‡ºä¸åˆ†å‰²çº¿è¶…å¹³é¢å¹³è¡Œçš„ä¸¤æ¡ç›´çº¿ï¼Œåˆ†åˆ«ç©¿è¿‡ä¸¤ä¸ªç±»åˆ«çš„æ”¯æŒå‘é‡ã€‚è¿™ä¸¤æ¡ç›´çº¿çš„æ–¹ç¨‹åˆ†åˆ«ä¸º$w^Tx+b=-1$å’Œ$w^Tx+b=1$ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fq43bz1cb3j30hg0c63za.jpg" alt=""></p><p>æ ¹æ®ç‚¹åˆ°ç›´çº¿çš„è·ç¦»å…¬å¼ï¼Œå¯ä»¥ç®—å‡ºæ”¯æŒå‘é‡Aåˆ°åˆ†å‰²è¶…å¹³é¢çš„è·ç¦»ä¸ºï¼š$$d=\frac{\left| w^{T}A+b \right|}{\left| \left| w \right| \right|}$$</p><p>ç”±äºç‚¹$A$åœ¨ç›´çº¿$w^Tx+b=-1$å’Œ$w^Tx+b=1$åœ¨ï¼Œä»£å…¥å¯çš„æ”¯æŒå‘é‡$A$åˆ°åˆ†å‰²è¶…å¹³é¢çš„è·ç¦»ä¸º$d=\frac{1}{\left| \left| w \right| \right|}$ã€‚ä¸ºäº†ä½¿é—´è·æœ€å¤§ï¼Œåªéœ€æ‰¾åˆ°åˆé€‚çš„å‚æ•°$w$å’Œ$b$ï¼Œä½¿$\frac{1}{\left| \left| w \right| \right|}$æœ€å¤§å³å¯ã€‚$||w||$ä½¿å‘é‡$w$çš„<strong>L2èŒƒæ•°</strong>ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼š<br>$$\left| \left| w \right| \right|=\sqrt{\sum_{i=1}^{n}{w_{i}^{2}}}$$<br>æ±‚$\frac{1}{\left| \left| w \right| \right|}$çš„æœ€å¤§å€¼å³ä½¿æ±‚$||w||^2$çš„æœ€å°å€¼ï¼š<br>$$\left| \left| w \right| \right|^{2}=\sum_{i=1}^{n}{w_{i}^{2}}$$</p><p>å…¶ä¸­$n$ä¸ºé™é‡$w$çš„çº¬åº¦ã€‚é™¤äº†é—´è·æœ€å¤§ï¼Œåˆ†å‰²è¶…å¹³é¢æ›´èƒ½ç”¨æ¥è§£å†³åˆ†ç±»é—®é¢˜ï¼å›åˆ°ä¸Šå›¾ï¼Œé’ˆå¯¹æ–¹å½¢ç‚¹$x$ï¼Œå¿…é¡»æ»¡è¶³$w^Tx+bâ‰¥1$çš„çº¦æŸæ¡ä»¶ã€‚é’ˆå¯¹åœ†å½¢çš„ç‚¹å¿…é¡»æ»¡è¶³$w^Tx+b&lt;=-1$çš„çº¦æŸæ¡ä»¶ã€‚<br>ç±»åˆ«æ˜¯ç¦»æ•£çš„å€¼ï¼Œåˆ†åˆ«ä½¿ç”¨-1è¡¨ç¤ºåœ†ç‚¹ç±»åˆ«ï¼Œ1è¡¨ç¤ºæ–¹ç‚¹ç±»åˆ«ï¼Œå³$y\in \left(-1,1 \right)$ã€‚é’ˆå¯¹æ•°æ®é›†ä¸­çš„æ‰€æœ‰æ ·æœ¬$x^{(i)},y^{(i)}$ï¼Œåªè¦æ»¡è¶³ä»¥ä¸‹çº¦æŸæ¡ä»¶ï¼Œåˆ™ç”±ä»¥ä¸‹å‚æ•°$w$å’Œå‚æ•°$b$å®šä¹‰çš„åˆ†å‰²è¶…å¹³é¢è¿›è¡Œåˆ†ç±»ï¼š$$y^{(i)}(w^Tx^{(i)}+b)â‰¥1$$</p><p><strong>ä¸€å¥è¯æ¦‚æ‹¬ï¼šæ±‚è§£SVMç®—æ³•ï¼Œå°±æ˜¯åœ¨æ»¡è¶³çº¦æŸæ¡ä»¶$y^{(i)}(w^Tx^{(i)}+b)â‰¥1$çš„å‰æä¸‹ï¼Œæ±‚è§£$||w||^2$çš„æœ€å°å€¼ã€‚</strong></p><h3 id="æ¾å¼›ç³»æ•°"><a href="#æ¾å¼›ç³»æ•°" class="headerlink" title="æ¾å¼›ç³»æ•°"></a>æ¾å¼›ç³»æ•°</h3><p>é’ˆå¯¹ç°è¡Œä¸å¯åˆ†çš„æ•°æ®é›†ï¼Œä¸Šé¢çš„æ–¹æ³•å°±ä¸èƒ½ç”¨äº†ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å°±æ˜¯å¼•å…¥ä¸€ä¸ªå‚æ•°$\epsilon$ï¼Œç§°ä¸º<strong>æ¾å¼›ç³»æ•°</strong>ã€‚ç„¶åæŠŠä¼˜åŒ–çš„ç›®æ ‡å‡½æ•°å˜ä¸ºï¼š<br>$$\mbox{argmin}\left| \left| w^{2} \right| \right|+R\sum_{i=1}^{m}{\epsilon_{i}}$$</p><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fq43cif8rwj30wy0e9mz8.jpg" alt=""></p><p>å…¶ä¸­$m$ä¸ºæ•°æ®é›†çš„ä¸ªæ•°ï¼Œ$R$ä¸ºç®—æ³•å‚æ•°ï¼Œå…¶çº¦æŸæ¡ä»¶å˜ä¸ºï¼š$$y^{\left( i \right)}\left( w^T{x^{\left( i \right)}}+b \right)\geq 1-\epsilon_{i}$$</p><p>ç†è§£æ¾å¼›ç³»æ•°ï¼š</p><p>å¯ä»¥æŠŠ$Îµ_{i}$ç†è§£ä¸ºæ ·æœ¬$x^{(i)}$è¿åä¸€å¤§é—´è·è§„åˆ™çš„ç¨‹åº¦ã€‚é’ˆå¯¹å¤§å¤šæ•°æ»¡è¶³çº¦æŸæ¡ä»¶çš„æ ·æœ¬$Îµ=0$ã€‚è€Œå¯¹éƒ¨åˆ†è¿åæœ€å¤§é—´è·è§„åˆ™çš„æ ·æœ¬$Îµ&gt;0$ã€‚å‚æ•°$R$åˆ™è¡¨ç¤ºå¯¹è¿åçº¦æŸçš„æ ·æœ¬çš„â€æƒ©ç½šâ€ã€‚$R$è¶Šå¤§å¯¹è¿åçº¦æŸçš„ç‚¹â€œæƒ©ç½šåŠ›åº¦â€è¶Šå¤§åä¹‹è¶Šå° ã€‚è¿™æ ·æ¨¡å‹å°±ä¼šå€¾å‘äº<strong>å…è®¸éƒ¨åˆ†ç‚¹è¿åæœ€å¤§é—´è·è§„åˆ™</strong>ã€‚</p><p>æŠŠ$y^{\left( i \right)}\left( w^{T}x^{\left( i \right)}+b \right)$ä½œä¸ºæ¨ªåæ ‡ï¼Œè¿åçº¦æŸæ¡ä»¶çš„ä»£ä»·$J_i$ä½œä¸ºçºµåæ ‡ç”»å›¾ï¼š</p><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fq43cufjjfj30ih0d1dgg.jpg" alt=""></p><p>ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œé’ˆå¯¹å“ªäº›æ²¡æœ‰è¿åçº¦æŸæ¡ä»¶çš„æ ·æœ¬ï¼Œå…¶æˆæœ¬ä¸º0ã€‚è¿åäº†çº¦æŸæ¡ä»¶çš„æ ·æœ¬å…¶æˆæœ¬ä¸$Îµ$æˆæ­£æ¯”ï¼Œæ–œçº¿çš„æ–œç‡ä¸º$R$ã€‚</p><p>å› æ­¤ï¼Œå¼•å…¥æ¾å¼›ç³»æ•°ç±»ä¼¼äºé€»è¾‘å›å½’çš„æˆæœ¬å‡½æ•°å¼•å…¥æ­£åˆ™é¡¹ï¼Œç›®çš„æ˜¯ä¸ºäº†çº æ­£è¿‡æ‹Ÿåˆé—®é¢˜ï¼Œè®©SVMå¯¹å™ªå£°æ•°æ®ç”±æ›´å¼ºçš„å¿è€æ€§ã€‚å¦‚ä¸Šä¸Šå›¾æ‰€ç¤ºï¼Œå½“å‡ºç°è¿åå¤§é—´è·è§„åˆ™çš„å™ªå£°æ ·æœ¬å‡ºç°æ—¶ï¼Œä»èƒ½è®©åˆ†å‰²è¶…å¹³é¢æ˜¯åŸæ¥çš„æ ·å­ï¼Œè¿™å°±æ˜¯æ¾å¼›ç³»æ•°çš„ä½œç”¨ã€‚</p><h2 id="æ ¸å‡½æ•°"><a href="#æ ¸å‡½æ•°" class="headerlink" title="æ ¸å‡½æ•°"></a>æ ¸å‡½æ•°</h2><p>æ ¸å‡½æ•°æ˜¯<strong>ç‰¹å¾è½¬æ¢</strong>å‡½æ•°ã€‚</p><h3 id="æœ€ç®€å•çš„æ ¸å‡½æ•°"><a href="#æœ€ç®€å•çš„æ ¸å‡½æ•°" class="headerlink" title="æœ€ç®€å•çš„æ ¸å‡½æ•°"></a>æœ€ç®€å•çš„æ ¸å‡½æ•°</h3><p>å›é¡¾ä¸Šé¢å†…å®¹ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯æ‰¾å‡ºåˆé€‚çš„å‚æ•°$w,b$ï¼Œä½¿å¾—åˆ†å‰²è¶…å¹³é¢é—´è·æœ€å¤§ï¼Œä¸”èƒ½æ­£ç¡®å¯¹æ•°æ®è¿›è¡Œåˆ†ç±»ã€‚<strong>é—´è·æœ€å¤§æ˜¯æˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡</strong>ã€‚çœŸç¡®åœ°å¯¹æ•°æ®åˆ†ç±»æ˜¯çº¦æŸæ¡ä»¶ã€‚å³<strong>åœ¨æ»¡è¶³çº¦æŸæ¡ä»¶$y^{(i)}(w^Tx^{(i)}+b)â‰¥1$çš„å‰æä¸‹ï¼Œæ±‚è§£$||w||^2$çš„æœ€å°å€¼ã€‚</strong></p><p><strong>æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•</strong>æ˜¯è§£å†³çº¦æŸæ¡ä»¶ä¸‹æ±‚å‡½æ•°æå€¼çš„ç†æƒ³æ–¹æ³•ã€‚å…¶æ–¹æ³•æ˜¯å¼•å…¥éè´Ÿç³»æ•°$Î±$æ¥ä½œä¸ºçº¦æŸæ¡ä»¶çš„æƒé‡ï¼š$$L=\frac{1}{2}\left| \left| w \right| \right|^{2}-\sum_{i=1}^{m}{\alpha _{i}\left( y^{\left( i \right)}\left( w^{T}x^{\left( i \right)}+b \right)-1 \right)}$$</p><p>ç”±äºæå€¼çš„åå¯¼æ•°ä¸º0ï¼Œå› æ­¤è¿™éœ€è¦è®©$L$å¯¹$w$æ±‚å¯¼ä½¿ä¹‹ä¸º0å¾—åˆ°$w$å’Œ$Î±$å¯¹å…³ç³»ï¼š$$w=\sum_{i=1}^{m}{a_{i}y^{\left( i \right)}x^{\left( i \right)}}$$<br>æ¥ç€ç»§ç»­æ±‚$L$å¯¹$b$å¯¹åå¯¼æ•°å¾—å‡º:$$\sum_{i=1}^{m}{y^{\left( i \right)}\alpha_{i}=0}$$<br>æŠŠè¿™ä¸¤ä¸ªå¼å­ä»£å…¥$L$é€šè¿‡æ•°å­¦è¿ç®—å¾—å‡ºï¼š$$L=\sum_{i=1}^{m}{a_{i}-}\frac{1}{2}\sum_{i=1}^{m}{\sum_{j=1}^{m}{a_{i}}a_{j}y^{\left( i \right)}y^{\left( j \right)}x^{\left( i \right)T}x^{\left( j \right)}}$$<br>è¿™ä¸ªå…¬å¼ä¸­$m$æ˜¯æ•°æ®é›†ä¸ªæ•°ï¼Œ$a$æ˜¯æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•å¼•å…¥çš„ä¸€ä¸ªç³»æ•°ï¼Œé’ˆå¯¹æ•°æ®é›†ä¸­çš„æ¯ä¸ªæ ·æœ¬$x^{(i)}$,éƒ½æœ‰å¯¹åº”çš„$a_i$ã€‚$x^{(i)}$æ˜¯æ•°æ®é›†ä¸­åœ°$i$ä¸ªæ ·æœ¬çš„è¾“å…¥ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‘é‡ï¼Œ$y^{(i)}$æ˜¯å¯¹åº”çš„è¾“å‡ºæ ‡ç­¾ï¼Œå€¼ä¸º$y\in \left( -1,1 \right)$ã€‚</p><p>è¿™ä¸ªå…¬å¼çš„æœ€å°å€¼æ±‚è§£è¿™é‡Œå°±ä¸è¯´æ˜äº†ã€‚æœ€åæ±‚å‡ºçš„$a$æœ‰ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹ã€‚å³å¤§éƒ¨åˆ†$a_i=0$ã€‚å› ä¸ºåªæœ‰é‚£äº›æ”¯æŒå‘é‡æ‰€å¯¹åº”çš„æ ·æœ¬ç›´æ¥å†³å®šäº†é—´éš™çš„å¤§å°ã€‚å®é™…ä¸Šä»¥ä¸Šæ¨å¯¼å‡ºè¿™ä¸ªå…¬å¼å°±æ˜¯ä¸ºäº†å¼•å…¥æ”¯æŒå‘é‡æœºçš„å¦å¤–ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š<strong>æ ¸å‡½æ•°</strong>:$$K({x^{({i})},x^{({j})}})=x^{({i})T}x^{({j})}$$</p><p>$L$é‡Œçš„$x^{(i)T}x^{(j)}$éƒ¨åˆ†ï¼Œå…¶ä¸­$x^{(i)}$æ˜¯ä¸€ä¸ªç‰¹å¾å‘é‡ï¼Œæ‰€ä»¥$x^{(i)T}x^{(j)}$æ˜¯ä¸€ä¸ªæ•°å€¼ï¼Œå°±æ˜¯ä¸¤ä¸ªè¾“å…¥ç‰¹å¾å‘é‡çš„å†…ç§¯ã€‚é¢„æµ‹å‡½æ•°ä¸ºï¼š$$w^{T}x+b=\sum_{i=1}^{m}{a_{i}y^{\left( i \right)}x^{\left( i \right)T}x+b}$$</p><p>å½“$w^{T}x+b&gt;0$ï¼Œé¢„æµ‹å‡½æ•°ä¸ºç±»åˆ«1ï¼Œå½“$w^{T}x+b&lt;0$ï¼Œé¢„æµ‹ç±»åˆ«ä¸º-1ã€‚æ³¨æ„åˆ°é¢„æµ‹å‡½æ•°é‡Œä¹ŸåŒ…å«å¼å­$x^{({i})T}x$ã€‚æˆ‘ä»¬æŠŠ$K({x^{({i})},x^{({j})}})=x^{({i})T}x^{({j})}$ç§°ä¸ºæ ¸å‡½æ•°ã€‚ $x^{(i)T}x^{(j)}$æ˜¯ä¸¤ä¸ªå‘é‡å†…ç§¯ï¼Œå®ƒçš„ç‰©ç†å«ä¹‰æ˜¯è¡¡é‡ä¸¤ä¸ªå‘é‡çš„<strong>ç›¸ä¼¼æ€§</strong>ã€‚å…¸å‹åœ°ï¼Œå½“ä¸¤ä¸ªå‘é‡ç›¸äº’å‚ç›´æ˜¯ï¼Œå³å®Œå…¨çº¿æ€§æ— å…³ï¼Œæ­¤æ—¶$x^{(i)T}x^{(j)}=0$ã€‚å¼•å…¥æ ¸å‡½æ•°åé¢„æµ‹å‡½æ•°ä¸ºï¼š<br>$$w^{T}x+b=\sum_{i=1}^{m}{a_{i}y^{\left( i \right)}K\left( x^{\left( i \right)},x \right)+b}$$</p><h3 id="ç›¸ä¼¼æ€§å‡½æ•°"><a href="#ç›¸ä¼¼æ€§å‡½æ•°" class="headerlink" title="ç›¸ä¼¼æ€§å‡½æ•°"></a>ç›¸ä¼¼æ€§å‡½æ•°</h3><p>å‡è®¾æ•°æ®é›†å·²æœ‰ä¸€ä¸ªæ•°å›¾ç‰¹å¾ï¼Œå¦‚ä¸‹å›¾ï¼Œå¦‚ä½•è¿›è¡Œåˆ†ç±»ã€‚</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fq43d6r1acj30w50feab6.jpg" alt=""></p><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹å¼æ˜¯ï¼š<strong>ç”¨ä¸€å®šè§„åˆ™æŠŠè¿™äº›æ— æ³•è¿›è¡Œçº¿æ€§åˆ†å‰²çš„æ ·æœ¬æ˜ å°„åˆ°æ›´é«˜çº¬åº¦çš„ç©ºé—´é‡Œï¼Œç„¶åæ‰¾å‡ºè¶…å¹³é¢</strong>ã€‚</p><p>SVMçš„æ ¸å‡½æ•°å°±æ˜¯ä¸ºäº†å®ç°è¿™ç§ç›¸ä¼¼æ€§æ˜ å°„ã€‚æœ€ç®€å•çš„æ ¸å‡½æ•°æ˜¯$K({x^{({i})},x^{({j})}})=x^{({i})T}x^{({j})}$ï¼Œå®ƒè¡¡é‡çš„æ˜¯ä¸¤ä¸ªè¾“å…¥ç‰¹å¾å‘é‡çš„ç›¸ä¼¼æ€§ã€‚å¯ä»¥é€šè¿‡å®šä¹‰å’Œå‡½æ•°$K({x^{({i})},x^{({j})}})$æ¥é‡æ–°å®šä¹‰ç›¸ä¼¼æ€§ï¼Œä»è€Œå¾—åˆ°æƒ³è¦çš„æ˜ å°„ã€‚ä¾‹å¦‚åœ¨åŸºå› æµ‹è¯•é¢†åŸŸï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®DNAåˆ†å­çš„ç‰¹å¾æ¥å®šä¹‰ç›¸ä¼¼æ€§å‡½æ•°ï¼Œå³å’Œå‡½æ•°ã€‚åœ¨æ–‡æœ¬å¤„ç†é¢†åŸŸï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰å’Œå‡½æ•°æ¥è¡¡é‡ä¸¤ä¸ªè¯ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚</p><p>æ€ä¹ˆæŠŠä½ç»´åº¦çš„ç©ºé—´æ˜ å°„åˆ°é«˜çº¬åº¦çš„ç©ºé—´å‘¢ï¼Ÿ</p><p>ä¸¾ä¸ªä¾‹å­ï¼šè”æƒ³ä¸‹åˆ©ç”¨å¤šé¡¹å¼è§£å†³çº¿æ€§å›å½’æ¬ æ‹Ÿåˆé—®é¢˜çš„æ–¹æ³•ã€‚å¦‚æœè¾“å…¥ç‰¹å¾æ˜¯ä¸€ç»´çš„$[x_1]$å˜é‡ï¼Œæˆ‘ä»¬æŠŠå®ƒå˜æˆäºŒç»´çš„ä¸€ä¸ªæ–¹æ³•æ˜¯æŠŠè¾“å…¥ç‰¹å¾è½¬åŒ–ä¸º$[x_1,2x_1^2]$ï¼Œå®šä¹‰è¿™ç§ç‰¹å¾æ˜ å°„çš„å‡½æ•°å°±ç§°ä¹‹ä¸º<strong>ç›¸ä¼¼æ€§å‡½æ•°$Î¦({x})$</strong>ã€‚è¿™æ ·åœ¨åŸæ¥ä½ç»´åº¦è®¡ç®—ç›¸ä¼¼æ€§çš„è¿ç®—$x^{({i})T}x^{({j})}$ï¼Œå°±å¯ä»¥è½¬æ¢ä¸ºé«˜çº¬åº¦ç©ºé—´é‡Œè¿›è¡Œç›¸ä¼¼æ€§è¿ç®—$Î¦({x^{({i})}})^{T}Î¦({x^{({i})}})$ã€‚</p><p><strong>æ ¸å‡½æ•°$K({x^{({i})},x^{({j})}})$å’Œç›¸ä¼¼æ€§å‡½æ•°$Î¦({x})$çš„å…³ç³»ï¼š</strong></p><p>ç›¸ä¼¼æ€§å‡½æ•°æ˜¯ç‰¹å¾çš„<strong>æ˜ å°„å‡½æ•°</strong>ï¼Œèµ·åˆ°è½¬æ¢çš„ä½œç”¨ã€‚è€Œæ ¸å‡½æ•°æ˜¯<strong>ç‰¹å¾å‘é‡çš„å†…ç§¯</strong>ã€‚ç»è¿‡ç›¸ä¼¼æ€§å‡½æ•°è½¬æ¢åï¼Œæ ¸å‡½æ•°å˜æˆ$K\left( x^{\left( i \right)},x^{\left( j \right)} \right)=\Phi \left( x^{\left( i \right)} \right)^{T}\Phi \left( x^{\left( i \right)} \right)$ã€‚</p><h3 id="å¸¸ç”¨æ ¸å‡½æ•°"><a href="#å¸¸ç”¨æ ¸å‡½æ•°" class="headerlink" title="å¸¸ç”¨æ ¸å‡½æ•°"></a>å¸¸ç”¨æ ¸å‡½æ•°</h3><p>æ ¸å‡½æ•°ä¸€èˆ¬å’Œåº”ç”¨åœºæ™¯ç›¸å…³ï¼Œåœ¨ä¸åŒé¢†åŸŸæ‰€åº”ç”¨çš„æ ¸å‡½æ•°å¯èƒ½ä¹Ÿä¸ç›¸åŒã€‚ä½†æ˜¯å®é™…ä¸Šä¹Ÿæœ‰ä¸€äº›é€šç”¨æ ¸å‡½æ•°â€œä¸‡é‡‘æ²¹â€ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§ï¼š<strong>å¤šé¡¹å¼æ ¸å‡½æ•°</strong>å’Œ<strong>é«˜æ–¯æ ¸å‡½æ•°</strong>ã€‚</p><p>1ã€å¤šé¡¹å¼æ ¸å‡½æ•°ï¼š</p><p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fq4aza9jwoj306q01p3yh.jpg" alt=""></p><p>2ã€é«˜æ–¯æ ¸å‡½æ•°ï¼š$$K\left( x^{\left( i \right)},x^{\left( j \right)} \right)=\exp \left( -\frac{\left( x^{\left( i \right)}-x^{\left( j \right)} \right)^{2}}{2\sigma ^{2}} \right)$$</p><p>å¦‚æœè¾“å…¥çš„ç‰¹å¾æ˜¯ä¸€ç»´çš„æ ‡é‡ï¼Œé‚£ä¹ˆé«˜æ–¯æ ¸å‡½æ•°å¯¹åº”çš„å½¢çŠ¶å°±æ˜¯ä¸€ä¸ªåé’Ÿå½¢çš„æ›²çº¿ï¼Œå…¶å‚æ•°$Ïƒ$æ§åˆ¶åé’Ÿå½¢çš„å®½åº¦ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fq43dh16lcj30xp0bmq48.jpg" alt=""></p><p>ç”±äº$K\left( x^{\left( i \right)},x^{\left( j \right)} \right)=\Phi \left( x^{\left( i \right)} \right)^{T}\Phi \left( x^{\left( i \right)} \right)$ï¼Œç»è¿‡åˆé€‚çš„æ•°å­¦å˜æ¢ï¼Œå¯å¾—é«˜æ–¯æ ¸å‡½æ•°å¯¹åº”çš„ç‰¹å¾è½¬æ¢å‡½æ•°ä¸ºï¼š<br>$$\Phi \left( x \right)=\sum_{i=0}^{\infty }{\exp \left( -x^{2} \right)\sqrt{\frac{2^{i}}{i!}}}x^{i}$$<br>å‰é¢æ— é™å¤šé¡¹çš„ç´¯åŠ å™¨ï¼Œå…¶ç‰©ç†æ„ä¹‰å°±æ˜¯æŠŠç‰¹å¾å‘é‡è½¬æ¢åˆ°æ— é™å¤šç»´å‘é‡ç©ºé—´é‡Œï¼Œå³<strong>é«˜æ–¯å‡½æ•°å¯ä»¥å§è¾“å…¥ç‰¹å¾æ‰©å±•åˆ°æ— é™å¤šç»´ç©ºé—´é‡Œ</strong>ã€‚å…¬å¼çš„æ¨å¯¼å…¬å¼ä¼šç”¨åˆ°<strong>æ³°å‹’å…¬å¼</strong>ã€‚</p><p>$$é«˜æ–¯é¢„æµ‹å‡½æ•°=\sum_{i=1}^{m}{a_{i}y^{\left( i \right)}K\left( x^{\left( i \right)},x \right)+b}$$<br>å…¶ä¸­$K\left( x^{\left( i \right)},x^{\left( j \right)} \right)$æ˜¯é«˜æ–¯æ ¸å‡½æ•°ï¼Œ$a_i$åªåœ¨æ”¯æŒå‘é‡å¯¹åº”çš„æ ·æœ¬å‡ºä¸ä¸º0.ç”±æ­¤å¯çŸ¥ï¼Œ<strong>é¢„æµ‹å‡½æ•°æ—¶ä¸­å¿ƒç‚¹åœ¨æ”¯æŒå‘é‡æœºå¤„çš„é«˜æ–¯å‡½æ•°çš„çº¿æ€§ç»„åˆ</strong>ï¼Œå…¶çº¿æ€§ç»„åˆçš„ç³»æ•°ä¸º$a_iy^{(i)}$ã€‚å› æ­¤ï¼Œé«˜æ–¯æ ¸å‡½æ•°ä¹Ÿç§°ä¸º<strong>RBFæ ¸å‡½æ•°</strong>ï¼Œå³åé’Ÿå½¢å‡½æ•°çš„çº¿æ€§ç»„åˆã€‚</p><h3 id="æ ¸å‡½æ•°çš„å¯¹æ¯”"><a href="#æ ¸å‡½æ•°çš„å¯¹æ¯”" class="headerlink" title="æ ¸å‡½æ•°çš„å¯¹æ¯”"></a>æ ¸å‡½æ•°çš„å¯¹æ¯”</h3><p>$$ç®€å•çº¿æ€§æ ¸å‡½æ•°K\left( x^{\left( i \right)},x^{\left( j \right)} \right)=x^{\left( i \right)T}x^{\left( j \right)}$$</p><p>$$å¤šé¡¹å¼æ ¸å‡½æ•°ï¼š$$<img src="https://ws4.sinaimg.cn/large/006tNc79ly1fq4aza9jwoj306q01p3yh.jpg" alt=""><br>$$é«˜æ–¯æ ¸å‡½æ•°K\left( x^{\left( i \right)},x^{\left( j \right)} \right)=\exp \left( -\frac{\left( x^{\left( i \right)}-x^{\left( j \right)} \right)^{2}}{2\sigma ^{2}} \right)$$<br>1ã€<strong>çº¿æ€§æ ¸å‡½æ•°ï¼š</strong>è¿™æ˜¯æœ€ç®€å•çš„æ ¸å‡½æ•°ï¼Œå®ƒç›´æ¥è®¡ç®—ä¸¤ä¸ªè¾“å…¥ç‰¹å¾å‘é‡çš„å†…ç§¯ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šç®€å•é«˜æ•ˆï¼Œç»“æœæ˜“è§£é‡Šï¼Œæ€»èƒ½ç”Ÿæˆä¸€ä¸ªæœ€ç®€æ´çš„çº¿æ€§åˆ†å‰²è¶…å¹³é¢</li><li>ç¼ºç‚¹ï¼šåªé€‚ç”¨çº¿æ€§å¯åˆ†çš„æ•°æ®é›†</li></ul><p>2ã€<strong>å¤šé¡¹å¼æ ¸å‡½æ•°ï¼š</strong>é€šè¿‡å¤šé¡¹å¼æ¥ä½œä¸ºç‰¹å¾æ˜ å°„å‡½æ•°</p><ul><li>ä¼˜ç‚¹ï¼šå¯ä»¥æ‹Ÿåˆå‡ºå¤æ‚çš„åˆ†å‰²è¶…å¹³é¢ã€‚</li><li>ç¼ºç‚¹ï¼šå‚æ•°å¤ªå¤šã€‚æœ‰$Î³,c,n$ä¸‰ä¸ªå‚æ•°è¦é€‰æ‹©ï¼Œé€‰æ‹©èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼›å¦å¤–å¤šé¡¹å¼çš„é˜¶æ•°ä¸å®œå¤ªé«˜å¦åˆ™ä¼šç»™æ¨¡å‹æ±‚è§£å¸¦æ¥å›°éš¾ã€‚</li></ul><p>3ã€<strong>é«˜æ–¯æ ¸å‡½æ•°ï¼š</strong></p><ul><li>ä¼˜ç‚¹ï¼šå¯ä»¥æŠŠç‰¹å¾æ˜ å°„åˆ°æ— é™å¤šç»´ï¼Œå¹¶ä¸”æ²¡æœ‰å¤šé¡¹å¼è®¡ç®—é‚£ä¹ˆå›°éš¾ï¼Œå‚æ•°ä¹Ÿæ¯”è¾ƒå¥½é€‰æ‹©ã€‚</li><li>ç¼ºç‚¹ï¼šä¸å®¹æ˜“è§£é‡Šï¼Œè®¡ç®—é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå®¹æ˜“è¿‡æ‹Ÿåˆã€‚</li></ul><h3 id="æ ¸å‡½æ•°çš„é€‰æ‹©"><a href="#æ ¸å‡½æ•°çš„é€‰æ‹©" class="headerlink" title="æ ¸å‡½æ•°çš„é€‰æ‹©"></a>æ ¸å‡½æ•°çš„é€‰æ‹©</h3><p>1ã€æœ€ä¸€èˆ¬çš„é€‰æ‹©åŸåˆ™æ˜¯é’ˆå¯¹æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©å¤æ‚ä¸€ç‚¹çš„æ¨¡å‹ã€‚è™½ç„¶å¤æ‚æ¨¡å‹å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œä½†ç”±äºæ•°æ®é‡å¾ˆå¤§ï¼Œå¯ä»¥æœ‰æ•ˆå¼¥è¡¥è¿‡æ‹Ÿåˆé—®é¢˜ã€‚å¦‚æœæ•°æ®é›†è¾ƒå°é€‰æ‹©ç®€å•ç‚¹çš„æ¨¡å‹ï¼Œå¦åˆ™å¾ˆå®¹æ˜“è¿‡æ‹Ÿåˆï¼Œæ­¤æ—¶ç‰¹åˆ«è¦æ³¨æ„æ¨¡å‹æ˜¯å¦æ¬ æ‹Ÿåˆï¼Œå¦‚æœæ¬ æ‹Ÿåˆå¯ä»¥å¢åŠ å¤šé¡¹å¼çº æ­£æ¬ æ‹Ÿåˆã€‚</p><p>2ã€æ ¹æ®æ ·æœ¬é‡$m$å’Œç‰¹å¾é‡$n$è¿›è¡Œé€‰æ‹©ï¼š</p><ul><li>ç‰¹å¾ç›¸æ¯”æ ·æœ¬è¾ƒå¤§ï¼ˆå¦‚m=10ï½1000ï¼Œn=10000ï¼‰ï¼šé€‰é€»è¾‘å›å½’æˆ–è€…çº¿æ€§å‡½æ•°SVM</li><li>ç‰¹å¾è¾ƒå°‘ï¼Œæ ·æœ¬é‡ä¸­ï¼ˆå¦‚m=10ï½10000ï¼Œn=1ï½1000ï¼‰ï¼šé€‰æ‹©é«˜æ–¯SVM</li><li>ç‰¹å¾é‡å°‘ï¼Œæ ·æœ¬å¤šï¼ˆå¦‚m=50000+ï¼Œn=1~1000)ï¼šé€‰å¤šé¡¹å¼æˆ–é«˜æ–¯SVM</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;æ”¯æŒå‘é‡æœºåŸç†&quot;&gt;&lt;a href=&quot;#æ”¯æŒå‘é‡æœºåŸç†&quot; class=&quot;headerlink&quot; title=&quot;æ”¯æŒå‘é‡æœºåŸç†&quot;&gt;&lt;/a&gt;æ”¯æŒå‘é‡æœºåŸç†&lt;/h2&gt;&lt;h3 id=&quot;å¤§è·ç¦»åˆ†ç±»ç®—æ³•&quot;&gt;&lt;a href=&quot;#å¤§è·ç¦»åˆ†ç±»ç®—æ³•&quot;
      
    
    </summary>
    
      <category term="Machine learning" scheme="http://www.ihoge.cn/categories/Machine-learning/"/>
    
    
      <category term="scikit-learn" scheme="http://www.ihoge.cn/tags/scikit-learn/"/>
    
  </entry>
  
  <entry>
    <title>DecisionTreeå†³ç­–æ ‘å¤§å…¨</title>
    <link href="http://www.ihoge.cn/2018/DecisionTree.html"/>
    <id>http://www.ihoge.cn/2018/DecisionTree.html</id>
    <published>2018-04-06T17:05:59.000Z</published>
    <updated>2018-04-07T12:52:14.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="åˆ©ç”¨ä¿¡æ¯å¢’åˆ¤å®šå…ˆå¯¹é‚£ä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚"><a href="#åˆ©ç”¨ä¿¡æ¯å¢’åˆ¤å®šå…ˆå¯¹é‚£ä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚" class="headerlink" title="åˆ©ç”¨ä¿¡æ¯å¢’åˆ¤å®šå…ˆå¯¹é‚£ä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚"></a>åˆ©ç”¨ä¿¡æ¯å¢’åˆ¤å®šå…ˆå¯¹é‚£ä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚</h2><p>ä¿¡æ¯å¢’æ˜¯è¡¡é‡ä¿¡æ¯ä¸ç¡®å®šæ€§çš„æŒ‡æ ‡ï¼Œä¿¡æ¯å¢’å…¬å¼ï¼š<br>$$H\left( X \right)=-\sum_{x\in X}^{}{P\left( x \right)\log_{2}P\left( x \right)}$$<br>å…¶ä¸­$P(x)$è¡¨ç¤ºäº‹ä»¶$x$å‡ºç°çš„æ¦‚ç‡ã€‚å›åˆ°å†³ç­–æ ‘çš„æ„å»ºé—®é¢˜ä¸Šï¼Œæˆ‘ä»¬éå†æ‰€æœ‰ç‰¹å¾ï¼Œåˆ†åˆ«è®¡ç®—ï¼Œä½¿ç”¨è¿™ä¸ªå…¬å¼åˆ’åˆ†æ•°æ®é›†å‰åä¿¡æ¯å¢’çš„å˜åŒ–å€¼ï¼Œç„¶åé€‰æ‹©ä¿¡æ¯å¢’å˜åŒ–å¹…åº¦æœ€å¤§çš„é‚£ä¸ªç‰¹å¾æ¥ä½œä¸ºæ•°æ®é›†åˆ’åˆ†ä¾æ®ã€‚å³ï¼šé€‰æ‹©<strong>ä¿¡æ¯å¢ç›Š</strong>æœ€å¤§çš„ç‰¹å¾ä½œä¸ºåˆ†è£‚èŠ‚ç‚¹ã€‚</p><p>è¿™é‡Œä»¥æ¦‚ç‡$P(X)$ä¸ºæ¨ªåæ ‡ï¼Œä»¥ä¿¡æ¯å¢’$Entropy$ä¸ºçºµåæ ‡æŠŠä¿¡æ¯å¢’å’Œæ¦‚ç‡çš„å‡½æ•°å…³ç³»$\mbox{E}ntropy=-P\left( x \right)\log_{2}P\left( x \right)$åœ¨äºŒç»´åæ ‡ä¸Šç”»å‡ºæ¥ï¼Œå¯ä»¥çœ‹å‡ºï¼Œå½“æ¦‚ç‡$P(X)$è¶Šæ¥è¿‘0æˆ–è¶Šæ¥è¿‘1æ—¶ï¼Œä¿¡æ¯å¢’çš„å€¼è¶Šå°ã€‚å½“æ¦‚ç‡å€¼ä¸º1æ—¶ä¿¡æ¯å¢’ä¸º0ï¼Œæ­¤æ—¶æ•°æ®æ˜¯æœ€â€œçº¯å‡€â€çš„ã€‚æˆ‘ä»¬åœ¨é€‰æ‹©ç‰¹å¾æ—¶ï¼Œé€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§çš„ç‰¹å¾ï¼Œç‰©ç†ä¸Šå³è®©æ•°æ®å°½é‡å¾€æ›´çº¯å‡€çš„æ–¹å‘ä¸Šå˜æ¢ã€‚å› æ­¤<strong>ä¿¡æ¯å¢ç›Š</strong>æ˜¯ç”¨æ¥è¡¡é‡æ•°æ®å˜å¾—æ›´æœ‰åºæ›´çº¯å‡€çš„ç¨‹åº¦çš„æŒ‡æ ‡ã€‚</p><p><em>å»¶ä¼¸ä¸€ä¸‹ï¼šå¦‚å†™åšå®¢æˆ–è€…çœ‹ä¹¦çš„è¿‡ç¨‹ï¼Œæ˜¯å‡ç†µçš„è¿‡ç¨‹ã€‚é€šè¿‡é˜…è¯»å’Œå†™ä½œå‡å°‘äº†ä¸ç¡®å®šçš„ä¿¡æ¯ï¼Œä»è€Œå®ç°å‡ç†µã€‚äººç”Ÿä»·å€¼çš„å®ç°ï¼Œåœ¨äºæ¶ˆè´¹èµ„æºï¼ˆå¢ç†µè¿‡ç¨‹ï¼‰æ¥è·å–èƒ½é‡ï¼Œç»è¿‡è‡ªå·±çš„åŠ³åŠ¨ä»˜å‡ºï¼ˆå‡ç†µè¿‡ç¨‹ï¼‰ï¼Œè®©ä¸–ç•Œå˜å¾—æ›´åŠ çº¯å‡€æœ‰åºï¼Œ<code>ä¿¡æ¯å¢ç›Š = å‡ç†µé‡ - å¢ç†µé‡</code>å³æ˜¯è¡¡é‡äººç”Ÿä»·å€¼çš„å°ºåº¦</em>ã€‚</p><h2 id="å†³ç­–æ ‘çš„åˆ›å»º"><a href="#å†³ç­–æ ‘çš„åˆ›å»º" class="headerlink" title="å†³ç­–æ ‘çš„åˆ›å»º"></a>å†³ç­–æ ‘çš„åˆ›å»º</h2><p>å†³ç­–æ ‘çš„æ„å»ºè¿‡ç¨‹ï¼Œå°±æ˜¯ä»è®­ç»ƒé›†ä¸­å½’çº³å‡ºä¸€ç»„åˆ†ç±»è§„åˆ™ï¼Œä½¿å®ƒä¸ç†Ÿç»ƒæ•°æ®çŸ›ç›¾è¾ƒå°çš„åŒæ—¶å…·æœ‰è¾ƒå¼ºçš„æ³›åŒ–èƒ½åŠ›ã€‚åŸºæœ¬åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ul><li>è®¡ç®—æ•°æ®é›†åˆ’åˆ†é’±çš„ä¿¡æ¯å¢’</li><li>éå†æ‰€æœ‰ä¸ºä½œä¸ºåˆ’åˆ†æ¡ä»¶çš„ç‰¹å¾ï¼Œåˆ†åˆ«è®¡ç®—æ ¹æ®æ¯ä¸ªç‰¹å¾åˆ’åˆ†æ•°æ®é›†åçš„ä¿¡æ¯å¢’ã€‚</li><li>é€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§çš„ç‰¹å¾ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªç‰¹é•‡ä½œä¸ºæ•°æ®åˆ’åˆ†èŠ‚ç‚¹æ¥åˆ’åˆ†æ•°æ®ã€‚</li><li>é€’å½’åœ°å¤„ç†è¢«åˆ’åˆ†åçš„æ‰€å­æ•°æ®é›†ï¼Œä»æœªè¢«é€‰æ‹©çš„ç‰¹å¾é‡Œç»§ç»­é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œé€‰æ‹©å‡ºæœ€ä¼˜æ•°æ®åˆ’åˆ†ç‰¹å¾æ¥åˆ’åˆ†å­æ•°æ®é›†â€¦</li></ul><p>è¿™é‡Œé€’å½’ç»“æŸçš„æ¡ä»¶ä¸€èˆ¬æœ‰ä¸¤ä¸ªï¼š<strong>ä¸€æ˜¯æ‰€æœ‰ç‰¹å¾éƒ½ç”¨å®Œäº†ï¼ŒäºŒæ˜¯åˆ’åˆ†åçš„ä¿¡æ¯å¢’å¢ç›Šè¶³å¤Ÿå°äº†</strong>ã€‚é’ˆå¯¹è¿™ä¸ªåœæ­¢æ¡ä»¶ï¼Œéœ€è¦å®ç°é€‰æ‹©ä¿¡æ¯å¢ç›Šçš„é—¨é™å€¼æ¥ä½œä¸ºé€’å½’ç»“æŸæ¡ä»¶ã€‚</p><p>ä½¿ç”¨ä¿¡æ¯å¢ç›Šä½œä¸ºç‰¹å¾é€‰æ‹©æŒ‡æ ‡çš„å†³ç­–æ ‘æ„å»ºç®—æ³•ï¼Œç§°ä¸º<strong>ID3ç®—æ³•</strong></p><p>1ã€ç¦»æ•£åŒ–</p><p>å½“ç‰¹å¾æ•°æ®æ˜¯è¿ç»­å€¼æ—¶ï¼Œå°±éœ€è¦å…ˆå¯¹æ•°æ®è¿›è¡Œç¦»æ•£åŒ–å¤„ç†ã€‚ï¼ˆå¦‚è€ƒè¯•å¾—åˆ†0ï½100ï¼Œ1ï½59ä¸ºä¸åŠæ ¼ï¼Œ60ï½80ä¸ºè¾¾æ ‡ï¼Œ80ï½100ä¸ºä¼˜ç§€ï¼‰è¿™æ ·ç¦»æ•£å¤„ç†åçš„æ•°æ®å°±å¯ä»¥ç”¨æ¥æ„å»ºå†³ç­–æ ‘äº†ã€‚</p><p>2ã€<strong>æ­£åˆ™é¡¹ï¼ˆé‡è¦ï¼‰</strong></p><p>æœ€å¤§åŒ–ä¿¡æ¯å¢ç›Šæ¥é€‰æ‹©ç‰¹å¾ï¼Œåœ¨å†³ç­–æ ‘çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå®¹æ˜“é€ æˆä¼˜å…ˆé€‰æ‹©ç±»åˆ«æœ€å¤šçš„ç‰¹å¾è¿›è¡Œåˆ†è£‚ï¼Œå› ä¸ºè¿™æ ·åˆ’åˆ†åçš„å­æ•°æ®é›†æœ€â€œçº¯å‡€â€ï¼Œå…¶ä¿¡æ¯å¢ç›Šæœ€å¤§ã€‚ä½†è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³çœ‹åˆ°çš„ç»“æœã€‚è§£å†³åŠæ³•å¦‚ä¸‹ï¼š</p><ul><li><p><strong>è®¡ç®—åˆ’åˆ†åçš„å­æ•°æ®é›†çš„ä¿¡æ¯å¢’æ—¶ï¼ŒåŠ ä¸Šä¸€ä¸ªä¸ç±»åˆ«ä¸ªæ•°æˆæ­£æ¯”çš„æ­£åˆ™é¡¹æ¥ä½œä¸ºæœ€åçš„ä¿¡æ¯å¢’</strong>ï¼šè¿™æ ·å½“ç®—æ³•é€‰æ‹©çš„æŸä¸ªç±»åˆ«è¾ƒå¤šçš„ç‰¹å¾ï¼Œä½¿ä¿¡æ¯å¢’è¾ƒå°æ—¶ï¼Œç”±äºå—åˆ°æ­£åˆ™é¡¹çš„â€œæƒ©ç½šâ€ï¼Œå¯¼è‡´æœ€ç»ˆçš„ä¿¡æ¯å¢’ä¹Ÿè¾ƒå¤§ã€‚è¿™æ ·é€šè¿‡åˆé€‚çš„å‚æ•°å¯ä»¥ä½¿ç®—æ³•è®­ç»ƒå¾—åˆ°æŸç§ç¨‹åº¦çš„å¹³è¡¡ã€‚</p></li><li><p><strong>ä½¿ç”¨ä¿¡æ¯å¢ç›Šæ¯”</strong>æ¥ä½œä¸ºç‰¹å¾é€‰æ‹©çš„æ ‡å‡†ã€‚</p></li></ul><p>3ã€åŸºå°¼ä¸çº¯åº¦</p><p>ä¿¡æ¯å¢’æ˜¯æ¨ªé‡ä¿¡æ¯ä¸ç¡®å®šæ€§çš„æŒ‡æ ‡ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯è¡¡é‡ä¿¡æ¯â€œçº¯åº¦â€çš„æŒ‡æ ‡ã€‚</p><p>åŸºå°¼ä¸çº¯åº¦<code>(Gini impurity)</code>ä¹Ÿæ˜¯è¡¡é‡ä¿¡æ¯ä¸çº¯åº¦çš„æŒ‡æ ‡ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><p>$$Gini\left( D \right)=\sum_{x\in X}^{_ {_ {\;}}}{P\left( x \right)\left( 1-P\left( x \right) \right)=1-}\sum_{x\in X}^{_ {_ {\; }}}{P\left( x \right)^{2}}$$<br>åŒæ ·ï¼Œè¿™é‡Œä»¥æ¦‚ç‡$P(X)$ä¸ºæ¨ªåæ ‡ï¼Œä»¥ä¿¡æ¯å¢’$Gini(x)$ä¸ºçºµåæ ‡æŠŠä¿¡æ¯å¢’å’Œæ¦‚ç‡çš„å‡½æ•°å…³ç³»åœ¨äºŒç»´åæ ‡ä¸Šç”»å‡ºæ¥ï¼Œå¯ä»¥çœ‹å‡ºå…¶å½¢çŠ¶å‡ ä¹å’Œä¿¡æ¯å¢’çš„å½¢çŠ¶ä¸€æ ·ã€‚<code>CART</code>ç®—æ³•ä½¿ç”¨åŸºå°¼ä¸çº¯åº¦æ¥ä½œä¸ºç‰¹å¾é€‰æ‹©æ ‡å‡†ï¼Œ<code>GART</code>ä¹Ÿæ˜¯ä¸€ç§å†³ç­–æ ‘æ„å»ºç®—æ³•ã€‚</p><h2 id="å‰ªæç®—æ³•"><a href="#å‰ªæç®—æ³•" class="headerlink" title="å‰ªæç®—æ³•"></a>å‰ªæç®—æ³•</h2><p>ä½¿ç”¨å†³ç­–æ ‘æ¨¡å‹æ‹Ÿåˆæ•°æ®æ—¶ï¼Œå®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆã€‚è§£å†³åŠæ³•æ˜¯å¯¹å†³ç­–æ ‘è¿›è¡Œå‰ªæå¤„ç†ã€‚å†³ç­–æ ‘å‰ªææœ‰ä¸¤ç§æ€è·¯ï¼š</p><p>1ã€<strong>å‰å‰ªæ</strong><code>ï¼ˆPre-Pruningï¼‰</code></p><p>åœ¨æ„é€ å†³ç­–æ ‘çš„åŒæ—¶è¿›è¡Œå‰ªæã€‚åœ¨å†³ç­–æ ‘æ„å»ºä¸­ï¼Œå¦‚æœæ— æ³•è¿›ä¸€æ­¥é™ä½ä¿¡æ¯å¢’çš„æƒ…å†µä¸‹å°±ä¼šåœæ­¢åˆ›å»ºåˆ†æ”¯ã€‚ä¸ºäº†é¿å…è¿‡æ‹Ÿåˆï¼Œå¯ä»¥è®¾å®šä¸€ä¸ªé˜€å€¼ï¼Œä¿¡æ¯å¢’è§æ•ˆçš„æ•°é‡å°äºè¿™ä¸ªé˜€å€¼ï¼Œå³æ˜¯è¿˜å¯ä»¥ç»§ç»­é™ä½ç†µä¹Ÿåœæ­¢ç»§ç»­åˆ›å»ºåˆ†æ”¯ã€‚è¿™ç§æ–¹æ³•å°±æ˜¯å‰å‰ªæã€‚</p><p>2ã€<strong>åå‰ªæ</strong><code>ï¼ˆPost-Pruningï¼‰</code></p><p>åå‰ªææ˜¯æŒ‡å†³ç­–æ ‘æ„é€ å®Œæˆåè¿›è¡Œå‰ªæã€‚å‰ªæçš„è¿‡ç¨‹æ˜¯å¯¹æ‹¥æœ‰åŒæ ·ç¬¦èŠ‚ç‚¹çš„ä¸€ç»„èŠ‚ç‚¹è¿›è¡Œæ£€æŸ¥ï¼Œåˆ¤æ–­å¦‚æœå°†å…¶åˆå¹¶ï¼Œä¿¡æ¯å¢’çš„å¢åŠ é‡æ˜¯å¦å°äºæŸä¸€é˜€å€¼ã€‚å¦‚æœå°äºé˜€å€¼å³å¯åˆå¹¶åˆ†æ”¯ã€‚</p><p>åå‰ªææ˜¯ç›®å‰æ¯”è¾ƒæ™®éçš„åšæ³•ã€‚åå‰ªæçš„è¿‡ç¨‹å°±æ˜¯åˆ é™¤ä¸€äº›å­æ ‘ï¼Œç„¶åç”¨å­æ ‘çš„æ ¹èŠ‚ç‚¹ä»£æ›¿ä½œä¸ºæ–°çš„å¶å­èŠ‚ç‚¹ã€‚è¿™ä¸ªæ–°å¶å­æ‰€æ ‡ç¤ºçš„ç±»åˆ«é€šè¿‡å¤§å¤šæ•°åŸåˆ™æ¥ç¡®å®šã€‚å³æŠŠè¿™ä¸ªå¶å­èŠ‚ç‚¹é‡Œæ ·æœ¬æœ€å¤šçš„ç±»åˆ«ï¼Œä½œä¸ºè¿™ä¸ªå¶å­èŠ‚ç‚¹çš„ç±»åˆ«ã€‚</p><p>åå‰ªæçš„ç®—æ³•æœ‰å¾ˆå¤šç§ï¼Œå…¶ä¸­å¸¸è§çš„ä¸€ç§ç§°ä¸º<strong>å‡ä½é”™è¯¯ç‡å‰ªææ³•ï¼ˆReduced-Errorpruningï¼‰</strong>ã€‚å…¶æ€è·¯æ˜¯è‡ªåº•å‘ä¸Šï¼Œä»å·²ç»æ„å»ºå¥½çš„å®Œå…¨å†³ç­–æ ‘ä¸­æ‰¾å‡ºä¸€ä¸ªå­æ ‘ï¼Œç„¶åç”¨å­æ ‘çš„æ ¹èŠ‚ç‚¹ä»£æ›¿è¿™é¢—å­æ ‘ï¼Œä½œä¸ºæ–°çš„å¶å­èŠ‚ç‚¹ã€‚å¶å­èŠ‚ç‚¹æ‰€è¡¨ç¤ºçš„ç±»åˆ«é€šè¿‡å¤§å¤šæ•°åŸåˆ™ç¡®å®šï¼Œè¿™æ ·å°±æ„å»ºå‡ºä¸€ä¸ªç®€åŒ–ç‰ˆå†³ç­–æ ‘ã€‚ç„¶åä½¿ç”¨äº¤å‰éªŒè¯æ•°æ®é›†æ¥æµ‹è¯•ç®€åŒ–ç‰ˆæœ¬çš„å†³ç­–æ ‘ï¼Œçœ‹çœ‹å…¶é”™è¯¯ç‡æ˜¯ä¸æ˜¯é™ä½äº†ã€‚å¦‚æœé”™è¯¯ç‡é™ä½äº†ï¼Œåˆ™å¯ä»¥ç”¨è¿™ä¸ªç®€åŒ–ç‰ˆçš„å†³ç­–æ ‘æ¥ä»£æ›¿å®Œå…¨å†³ç­–æ ‘ï¼Œå¦åˆ™è¿˜é‡‡ç”¨åŸæ¥çš„å†³ç­–æ ‘ã€‚é€šè¿‡éå†æ‰€æœ‰çš„å­æ ‘ï¼Œç›´åˆ°é’ˆå¯¹äº¤å‰éªŒè¯æ•°æ®é›†æ— æ³•è¿›ä¸€æ­¥é™ä½é”™è¯¯ç‡ä¸ºæ­¢ã€‚</p><h2 id="sklearnç§å†³ç­–æ ‘çš„ç®—æ³•å‚æ•°"><a href="#sklearnç§å†³ç­–æ ‘çš„ç®—æ³•å‚æ•°" class="headerlink" title="sklearnç§å†³ç­–æ ‘çš„ç®—æ³•å‚æ•°"></a>sklearnç§å†³ç­–æ ‘çš„ç®—æ³•å‚æ•°</h2><h3 id="1ã€æ¨¡å‹å‚æ•°"><a href="#1ã€æ¨¡å‹å‚æ•°" class="headerlink" title="1ã€æ¨¡å‹å‚æ•°"></a>1ã€æ¨¡å‹å‚æ•°</h3><p>sklernä¸­ä½¿ç”¨<code>sklearn.tree.DecisionTreeClassifier</code>ç±»æ¥å®ç°å†³ç­–æ ‘åˆ†ç±»ç®—æ³•ã€‚å…¶å®å‡ ä¸ªå…¸å‹çš„å‚æ•°è§£é‡Šå¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left">åç§°</th><th style="text-align:center">åŠŸèƒ½</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">criterion</td><td style="text-align:center">ç‰¹å¾é€‰æ‹©æ ‡å‡†</td><td style="text-align:left">â€˜giniâ€™ or â€˜entropyâ€™ (default=â€giniâ€)ï¼Œå‰è€…æ˜¯åŸºå°¼ç³»æ•°ï¼Œåè€…æ˜¯ä¿¡æ¯ç†µã€‚ä¸¤ç§ç®—æ³•å·®å¼‚ä¸å¤§å¯¹å‡†ç¡®ç‡æ— å½±å“ï¼Œä¿¡æ¯å¢’äº‘å­™æ•ˆç‡ä½ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒæœ‰å¯¹æ•°è¿ç®—.ä¸€èˆ¬è¯´ä½¿ç”¨é»˜è®¤çš„åŸºå°¼ç³»æ•°â€giniâ€å°±å¯ä»¥äº†ï¼Œå³CARTç®—æ³•ã€‚é™¤éä½ æ›´å–œæ¬¢ç±»ä¼¼ID3, C4.5çš„æœ€ä¼˜ç‰¹å¾é€‰æ‹©æ–¹æ³•ã€‚</td></tr><tr><td style="text-align:left">splitter</td><td style="text-align:center">ç‰¹å¾åˆ’åˆ†æ ‡å‡†</td><td style="text-align:left">â€˜bestâ€™ or â€˜randomâ€™ (default=â€bestâ€) å‰è€…åœ¨ç‰¹å¾çš„æ‰€æœ‰åˆ’åˆ†ç‚¹ä¸­æ‰¾å‡ºæœ€ä¼˜çš„åˆ’åˆ†ç‚¹ã€‚åè€…æ˜¯éšæœºçš„åœ¨éƒ¨åˆ†åˆ’åˆ†ç‚¹ä¸­æ‰¾å±€éƒ¨æœ€ä¼˜çš„åˆ’åˆ†ç‚¹ã€‚ é»˜è®¤çš„â€bestâ€é€‚åˆæ ·æœ¬é‡ä¸å¤§çš„æ—¶å€™ï¼Œè€Œå¦‚æœæ ·æœ¬æ•°æ®é‡éå¸¸å¤§ï¼Œæ­¤æ—¶å†³ç­–æ ‘æ„å»ºæ¨èâ€randomâ€ ã€‚</td></tr><tr><td style="text-align:left">max_depth</td><td style="text-align:center">å†³ç­–æ ‘æœ€å¤§æ·±åº¦</td><td style="text-align:left">int or None, optional (default=None) ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®å°‘æˆ–è€…ç‰¹å¾å°‘çš„æ—¶å€™å¯ä»¥ä¸ç®¡è¿™ä¸ªå€¼ã€‚å¦‚æœæ¨¡å‹æ ·æœ¬é‡å¤šï¼Œç‰¹å¾ä¹Ÿå¤šçš„æƒ…å†µä¸‹ï¼Œæ¨èé™åˆ¶è¿™ä¸ªæœ€å¤§æ·±åº¦ï¼Œå…·ä½“çš„å–å€¼å–å†³äºæ•°æ®çš„åˆ†å¸ƒã€‚å¸¸ç”¨çš„å¯ä»¥å–å€¼10-100ä¹‹é—´ã€‚å¸¸ç”¨æ¥è§£å†³è¿‡æ‹Ÿåˆ</td></tr><tr><td style="text-align:left">min_impurity_decrease</td><td style="text-align:center">èŠ‚ç‚¹åˆ’åˆ†æœ€å°ä¸çº¯åº¦</td><td style="text-align:left">float, optional (default=0.) è¿™ä¸ªå€¼é™åˆ¶äº†å†³ç­–æ ‘çš„å¢é•¿ï¼Œå¦‚æœæŸèŠ‚ç‚¹çš„ä¸çº¯åº¦(åŸºå°¼ç³»æ•°ï¼Œä¿¡æ¯å¢ç›Šï¼Œå‡æ–¹å·®ï¼Œç»å¯¹å·®)å°äºè¿™ä¸ªé˜ˆå€¼ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸å†ç”Ÿæˆå­èŠ‚ç‚¹ã€‚ sklearn 0.19.1ç‰ˆæœ¬ä¹‹å‰å« min_impurity_split</td></tr><tr><td style="text-align:left">min_samples_split</td><td style="text-align:center">å†…éƒ¨èŠ‚ç‚¹å†åˆ’åˆ†æ‰€éœ€æœ€å°æ ·æœ¬æ•°</td><td style="text-align:left">int, float, optional (default=2) å¦‚æœæ˜¯ intï¼Œåˆ™å–ä¼ å…¥å€¼æœ¬èº«ä½œä¸ºæœ€å°æ ·æœ¬æ•°ï¼› å¦‚æœæ˜¯ floatï¼Œåˆ™å» ceil(min_samples_split * æ ·æœ¬æ•°é‡) çš„å€¼ä½œä¸ºæœ€å°æ ·æœ¬æ•°ï¼Œå³å‘ä¸Šå–æ•´ã€‚</td></tr><tr><td style="text-align:left">min_samples_leaf</td><td style="text-align:center">å¶å­èŠ‚ç‚¹æœ€å°‘æ ·æœ¬æ•°</td><td style="text-align:left">å¦‚æœæ˜¯ intï¼Œåˆ™å–ä¼ å…¥å€¼æœ¬èº«ä½œä¸ºæœ€å°æ ·æœ¬æ•°ï¼› å¦‚æœæ˜¯ floatï¼Œåˆ™å» ceil(min_samples_leaf * æ ·æœ¬æ•°é‡) çš„å€¼ä½œä¸ºæœ€å°æ ·æœ¬æ•°ï¼Œå³å‘ä¸Šå–æ•´ã€‚ è¿™ä¸ªå€¼é™åˆ¶äº†å¶å­èŠ‚ç‚¹æœ€å°‘çš„æ ·æœ¬æ•°ï¼Œå¦‚æœæŸå¶å­èŠ‚ç‚¹æ•°ç›®å°äºæ ·æœ¬æ•°ï¼Œåˆ™ä¼šå’Œå…„å¼ŸèŠ‚ç‚¹ä¸€èµ·è¢«å‰ªæã€‚</td></tr><tr><td style="text-align:left">max_leaf_nodes</td><td style="text-align:center">æœ€å¤§å¶å­èŠ‚ç‚¹æ•°</td><td style="text-align:left">int or None, optional (default=None) é€šè¿‡é™åˆ¶æœ€å¤§å¶å­èŠ‚ç‚¹æ•°ï¼Œå¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œé»˜è®¤æ˜¯â€Noneâ€ï¼Œå³ä¸é™åˆ¶æœ€å¤§çš„å¶å­èŠ‚ç‚¹æ•°ã€‚å¦‚æœåŠ äº†é™åˆ¶ï¼Œç®—æ³•ä¼šå»ºç«‹åœ¨æœ€å¤§å¶å­èŠ‚ç‚¹æ•°å†…æœ€ä¼˜çš„å†³ç­–æ ‘ã€‚å¦‚æœç‰¹å¾ä¸å¤šï¼Œå¯ä»¥ä¸è€ƒè™‘è¿™ä¸ªå€¼ï¼Œä½†æ˜¯å¦‚æœç‰¹å¾åˆ†æˆå¤šçš„è¯ï¼Œå¯ä»¥åŠ ä»¥é™åˆ¶ï¼Œå…·ä½“çš„å€¼å¯ä»¥é€šè¿‡äº¤å‰éªŒè¯å¾—åˆ°ã€‚</td></tr><tr><td style="text-align:left">min_impurity_split</td><td style="text-align:center">ä¿¡æ¯å¢ç›Šçš„é˜€å€¼</td><td style="text-align:left">å†³ç­–æ ‘åœ¨åˆ›å»ºåˆ†æ”¯æ—¶ï¼Œä¿¡æ¯å¢ç›Šå¿…é¡»å¤§äºè¿™ä¸ªé˜€å€¼ï¼Œå¦åˆ™ä¸åˆ†è£‚</td></tr><tr><td style="text-align:left">min_weight_fraction_leaf</td><td style="text-align:center">å¶å­èŠ‚ç‚¹æœ€å°çš„æ ·æœ¬æƒé‡å’Œ</td><td style="text-align:left">float, optional (default=0.) è¿™ä¸ªå€¼é™åˆ¶äº†å¶å­èŠ‚ç‚¹æ‰€æœ‰æ ·æœ¬æƒé‡å’Œçš„æœ€å°å€¼ï¼Œå¦‚æœå°äºè¿™ä¸ªå€¼ï¼Œåˆ™ä¼šå’Œå…„å¼ŸèŠ‚ç‚¹ä¸€èµ·è¢«å‰ªæã€‚ é»˜è®¤æ˜¯0ï¼Œå°±æ˜¯ä¸è€ƒè™‘æƒé‡é—®é¢˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è¾ƒå¤šæ ·æœ¬æœ‰ç¼ºå¤±å€¼ï¼Œæˆ–è€…åˆ†ç±»æ ‘æ ·æœ¬çš„åˆ†å¸ƒç±»åˆ«åå·®å¾ˆå¤§ï¼Œå°±ä¼šå¼•å…¥æ ·æœ¬æƒé‡ï¼Œè¿™æ—¶æˆ‘ä»¬å°±è¦æ³¨æ„è¿™ä¸ªå€¼äº†ã€‚</td></tr><tr><td style="text-align:left">class_weight</td><td style="text-align:center">ç±»åˆ«æƒé‡</td><td style="text-align:left">dict, list of dicts, â€œbalancedâ€ or None, default=None æŒ‡å®šæ ·æœ¬å„ç±»åˆ«çš„çš„æƒé‡ï¼Œä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢è®­ç»ƒé›†æŸäº›ç±»åˆ«çš„æ ·æœ¬è¿‡å¤šï¼Œå¯¼è‡´è®­ç»ƒçš„å†³ç­–æ ‘è¿‡äºåå‘è¿™äº›ç±»åˆ«ã€‚è¿™é‡Œå¯ä»¥è‡ªå·±æŒ‡å®šå„ä¸ªæ ·æœ¬çš„æƒé‡ï¼Œæˆ–è€…ç”¨â€œbalancedâ€ï¼Œå¦‚æœä½¿ç”¨â€œbalancedâ€ï¼Œåˆ™ç®—æ³•ä¼šè‡ªå·±è®¡ç®—æƒé‡ï¼Œæ ·æœ¬é‡å°‘çš„ç±»åˆ«æ‰€å¯¹åº”çš„æ ·æœ¬æƒé‡ä¼šé«˜ã€‚å½“ç„¶ï¼Œå¦‚æœä½ çš„æ ·æœ¬ç±»åˆ«åˆ†å¸ƒæ²¡æœ‰æ˜æ˜¾çš„åå€šï¼Œåˆ™å¯ä»¥ä¸ç®¡è¿™ä¸ªå‚æ•°ï¼Œé€‰æ‹©é»˜è®¤çš„â€Noneâ€ ä¸é€‚ç”¨äºå›å½’æ ‘ sklearn.tree.DecisionTreeRegressor</td></tr></tbody></table><h3 id="æ¨¡å‹è°ƒå‚æ³¨æ„äº‹é¡¹ï¼š"><a href="#æ¨¡å‹è°ƒå‚æ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="æ¨¡å‹è°ƒå‚æ³¨æ„äº‹é¡¹ï¼š"></a>æ¨¡å‹è°ƒå‚æ³¨æ„äº‹é¡¹ï¼š</h3><ul><li>å½“æ ·æœ¬å°‘æ•°é‡ä½†æ˜¯æ ·æœ¬ç‰¹å¾éå¸¸å¤šçš„æ—¶å€™ï¼Œå†³ç­–æ ‘å¾ˆå®¹æ˜“è¿‡æ‹Ÿåˆï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ ·æœ¬æ•°æ¯”ç‰¹å¾æ•°å¤šä¸€äº›ä¼šæ¯”è¾ƒå®¹æ˜“å»ºç«‹å¥å£®çš„æ¨¡å‹</li><li>å¦‚æœæ ·æœ¬æ•°é‡å°‘ä½†æ˜¯æ ·æœ¬ç‰¹å¾éå¸¸å¤šï¼Œåœ¨æ‹Ÿåˆå†³ç­–æ ‘æ¨¡å‹å‰ï¼Œæ¨èå…ˆåšç»´åº¦è§„çº¦ï¼Œæ¯”å¦‚ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ï¼Œç‰¹å¾é€‰æ‹©ï¼ˆLossoï¼‰æˆ–è€…ç‹¬ç«‹æˆåˆ†åˆ†æï¼ˆICAï¼‰ã€‚è¿™æ ·ç‰¹å¾çš„ç»´åº¦ä¼šå¤§å¤§å‡å°ã€‚å†æ¥æ‹Ÿåˆå†³ç­–æ ‘æ¨¡å‹æ•ˆæœä¼šå¥½ã€‚</li><li>æ¨èå¤šç”¨å†³ç­–æ ‘çš„å¯è§†åŒ–ï¼ŒåŒæ—¶å…ˆé™åˆ¶å†³ç­–æ ‘çš„æ·±åº¦ï¼ˆæ¯”å¦‚æœ€å¤š3å±‚ï¼‰ï¼Œè¿™æ ·å¯ä»¥å…ˆè§‚å¯Ÿä¸‹ç”Ÿæˆçš„å†³ç­–æ ‘é‡Œæ•°æ®çš„åˆæ­¥æ‹Ÿåˆæƒ…å†µï¼Œç„¶åå†å†³å®šæ˜¯å¦è¦å¢åŠ æ·±åº¦ã€‚</li><li>åœ¨è®­ç»ƒæ¨¡å‹å…ˆï¼Œæ³¨æ„è§‚å¯Ÿæ ·æœ¬çš„ç±»åˆ«æƒ…å†µï¼ˆä¸»è¦æŒ‡åˆ†ç±»æ ‘ï¼‰ï¼Œå¦‚æœç±»åˆ«åˆ†å¸ƒéå¸¸ä¸å‡åŒ€ï¼Œå°±è¦è€ƒè™‘ç”¨class_weightæ¥é™åˆ¶æ¨¡å‹è¿‡äºåå‘æ ·æœ¬å¤šçš„ç±»åˆ«ã€‚</li><li>å†³ç­–æ ‘çš„æ•°ç»„ä½¿ç”¨çš„æ˜¯numpyçš„float32ç±»å‹ï¼Œå¦‚æœè®­ç»ƒæ•°æ®ä¸æ˜¯è¿™æ ·çš„æ ¼å¼ï¼Œç®—æ³•ä¼šå…ˆåšcopyå†è¿è¡Œã€‚</li><li>å¦‚æœè¾“å…¥çš„æ ·æœ¬çŸ©é˜µæ˜¯ç¨€ç–çš„ï¼Œæ¨èåœ¨æ‹Ÿåˆå‰è°ƒç”¨csc_matrixç¨€ç–åŒ–ï¼Œåœ¨é¢„æµ‹å‰è°ƒç”¨csr_matrixç¨€ç–åŒ–ã€‚</li></ul><h2 id="å®ä¾‹ï¼šé¢„æµ‹æ³°å¦å°¼å…‹å·å¹¸å­˜è€…"><a href="#å®ä¾‹ï¼šé¢„æµ‹æ³°å¦å°¼å…‹å·å¹¸å­˜è€…" class="headerlink" title="å®ä¾‹ï¼šé¢„æµ‹æ³°å¦å°¼å…‹å·å¹¸å­˜è€…"></a>å®ä¾‹ï¼šé¢„æµ‹æ³°å¦å°¼å…‹å·å¹¸å­˜è€…</h2><p>æ•°æ®é¢„å¤„ç†å‰æœŸå·¥ä½œï¼š</p><ul><li>ç­›é€‰ç‰¹å¾å€¼ï¼Œä¸¢æ‰ä¸éœ€è¦çš„ç‰¹å¾æ•°æ®</li><li>å¯¹æ€§åˆ«è¿›è¡ŒäºŒå€¼åŒ–å¤„ç†ï¼ˆè½¬æ¢ä¸º0å’Œ1ï¼‰</li><li>æ¸¯å£è½¬æ¢æˆæ•°å€¼å‹æ•°æ®</li><li>å¤„ç†ç¼ºå¤±å€¼ï¼ˆå¦‚å¹´é¾„ï¼Œæœ‰å¾ˆå¤šç¼ºå¤±å€¼ï¼‰</li></ul><p>1ã€é¦–å…ˆè¯»å–æ•°æ®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_dataset</span><span class="params">(fname)</span>:</span></span><br><span class="line"><span class="comment">#     æŒ‡å®šç¬¬ä¸€åˆ—ä½œä¸ºè¡Œç´¢å¼•</span></span><br><span class="line">    data = pd.read_csv(fname, index_col=<span class="number">0</span>)</span><br><span class="line"><span class="comment">#     ä¸¢å¼ƒæ— ç”¨æ•°æ®</span></span><br><span class="line">    data.drop([<span class="string">'Name'</span>, <span class="string">'Ticket'</span>, <span class="string">'Cabin'</span>], axis=<span class="number">1</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line"><span class="comment">#     å¤„ç†æ€§åˆ«æ•°æ®</span></span><br><span class="line">    lables = data[<span class="string">'Sex'</span>].unique().tolist()</span><br><span class="line">    data[<span class="string">'Sex'</span>] = [*map(<span class="keyword">lambda</span> x: lables.index(x) , data[<span class="string">'Sex'</span>])]</span><br><span class="line"><span class="comment">#     å¤„ç†ç™»èˆ¹æ¸¯å£æ•°æ®</span></span><br><span class="line">    lables = data[<span class="string">'Embarked'</span>].unique().tolist()</span><br><span class="line">    data[<span class="string">'Embarked'</span>] = data[<span class="string">'Embarked'</span>].apply(<span class="keyword">lambda</span> n: lables.index(n))</span><br><span class="line"><span class="comment">#     å¤„ç†ç¼ºå¤±æ•°æ®å¡«å……0</span></span><br><span class="line">    data = data.fillna(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">train = read_dataset(<span class="string">'code/datasets/titanic/train.csv'</span>)</span><br></pre></td></tr></table></figure><p>2ã€æ‹†åˆ†æ•°æ®é›†</p><p>æŠŠ<code>Survived</code>åˆ—æå–å‡ºæ¥ä½œä¸ºæ ‡ç­¾ï¼Œç„¶ååœ¨å…ƒæ•°æ®é›†ä¸­å°†å…¶ä¸¢å¼ƒã€‚åŒæ—¶æ‹†åˆ†æ•°æ®é›†å’Œäº¤å‰éªŒè¯æ•°æ®é›†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">y = train[<span class="string">'Survived'</span>].values</span><br><span class="line">X = train.drop([<span class="string">'Survived'</span>], axis=<span class="number">1</span>).values</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="number">0.2</span>)</span><br><span class="line">print(<span class="string">"X_train_shape:"</span>, X_train.shape, <span class="string">" y_train_shape:"</span>, y_train.shape)</span><br><span class="line">print(<span class="string">"X_test_shape:"</span>, X_test.shape,<span class="string">"  y_test_shape:"</span>, y_test.shape)</span><br></pre></td></tr></table></figure><pre><code>X_train_shape: (712, 7)  y_train_shape: (712,)X_test_shape: (179, 7)   y_test_shape: (179,)</code></pre><p>3ã€æ‹Ÿåˆæ•°æ®é›†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier</span><br><span class="line"></span><br><span class="line">clf = DecisionTreeClassifier()</span><br><span class="line">clf.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">"train score:"</span>, clf.score(X_train, y_train))</span><br><span class="line">print(<span class="string">"test score:"</span>, clf.score(X_test, y_test))</span><br></pre></td></tr></table></figure><pre><code>train score: 0.9845505617977528test score: 0.7597765363128491</code></pre><h2 id="ä¼˜åŒ–æ¨¡å‹å‚æ•°"><a href="#ä¼˜åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="ä¼˜åŒ–æ¨¡å‹å‚æ•°"></a>ä¼˜åŒ–æ¨¡å‹å‚æ•°</h2><h3 id="1ã€é€šè¿‡max-depthå‚æ•°æ¥ä¼˜åŒ–æ¨¡å‹"><a href="#1ã€é€šè¿‡max-depthå‚æ•°æ¥ä¼˜åŒ–æ¨¡å‹" class="headerlink" title="1ã€é€šè¿‡max_depthå‚æ•°æ¥ä¼˜åŒ–æ¨¡å‹"></a>1ã€é€šè¿‡<code>max_depth</code>å‚æ•°æ¥ä¼˜åŒ–æ¨¡å‹</h3><p>ä»ä»¥ä¸Šè¾“å‡ºæ•°æ®å¯ä»¥çœ‹å‡ºï¼Œé’ˆå¯¹è®­ç»ƒæ ·æœ¬è¯„åˆ†å¾ˆé«˜ï¼Œä½†é’ˆå¯¹æµ‹è¯•æ•°æ®é›†è¯„åˆ†è¾ƒä½ã€‚å¾ˆæ˜æ˜¾è¿™æ˜¯è¿‡æ‹Ÿåˆçš„ç‰¹å¾ã€‚è§£å†³å†³ç­–æ ‘è¿‡æ‹Ÿåˆçš„æ–¹æ³•æ˜¯å‰ªæï¼ŒåŒ…æ‹¬å‰å‰ªæå’Œåå‰ªæã€‚ä½†æ˜¯<code>sklearn</code>ä¸æ”¯æŒåå‰ªæï¼Œè¿™é‡Œé€šè¿‡<code>max_depth</code>å‚æ•°é™å®šå†³ç­–æ ‘æ·±åº¦ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…è¿‡æ‹Ÿåˆã€‚</p><p>è¿™é‡Œå…ˆåˆ›å»ºä¸€ä¸ªå‡½æ•°ä½¿ç”¨ä¸åŒçš„æ¨¡å‹æ·±åº¦è®­ç»ƒæ¨¡å‹ï¼Œå¹¶è®¡ç®—è¯„åˆ†æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cv_score</span><span class="params">(d)</span>:</span></span><br><span class="line">    clf = DecisionTreeClassifier(max_depth=d)</span><br><span class="line">    clf.fit(X_train, y_train)</span><br><span class="line">    <span class="keyword">return</span>(clf.score(X_train, y_train), clf.score(X_test, y_test))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="number">0.2</span>)</span><br><span class="line">depths = np.arange(<span class="number">1</span>,<span class="number">10</span>)</span><br><span class="line">scores = [cv_score(d) <span class="keyword">for</span> d <span class="keyword">in</span> depths]</span><br><span class="line">tr_scores = [s[<span class="number">0</span>] <span class="keyword">for</span> s <span class="keyword">in</span> scores]</span><br><span class="line">te_scores = [s[<span class="number">1</span>] <span class="keyword">for</span> s <span class="keyword">in</span> scores]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾å‡ºäº¤å‰éªŒè¯æ•°æ®é›†è¯„åˆ†æœ€é«˜çš„ç´¢å¼•</span></span><br><span class="line">tr_best_index = np.argmax(tr_scores)</span><br><span class="line">te_best_index = np.argmax(te_scores)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"bestdepth:"</span>, te_best_index+<span class="number">1</span>, <span class="string">" bestdepth_score:"</span>, te_scores[te_best_index], <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure><pre><code>bestdepth: 5  bestdepth_score: 0.8603351955307262 </code></pre><p><strong>è¿™é‡Œç”±äºä»¥ä¸Š<code>train_test_split</code>æ–¹æ³•å¯¹æ•°æ®åˆ‡åˆ†æ˜¯éšæœºæ‰“æ•£çš„ï¼Œé€ æˆæ¯æ¬¡ç”¨ä¸åŒçš„æ•°æ®é›†è®­ç»ƒæ¨¡å‹æ€»å¾—åˆ°ä¸åŒçš„æœ€ä½³æ·±åº¦ã€‚</strong>è¿™é‡Œå†™ä¸ªå¾ªç¯åå¤æµ‹è¯•ï¼Œæœ€ç»ˆéªŒè¯è¿™é‡Œçœ‹åˆ°æœ€ä½³çš„åˆ†æ”¯æ·±åº¦ä¸º5å‡ºç°çš„é¢‘ç‡æœ€é«˜ï¼Œåˆæ­¥ç¡®å®š5ä¸ºæ·±åº¦æ¨¡å‹æœ€ä½³ã€‚</p><p>æŠŠæ¨¡å‹å‚æ•°å’Œå¯¹åº”çš„è¯„åˆ†ç”»å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">depths = np.arange(<span class="number">1</span>,<span class="number">10</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">6</span>,<span class="number">4</span>), dpi=<span class="number">120</span>)</span><br><span class="line">plt.grid()</span><br><span class="line">plt.xlabel(<span class="string">'max depth of decison tree'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Scores'</span>)</span><br><span class="line">plt.plot(depths, te_scores, label=<span class="string">'test_scores'</span>)</span><br><span class="line">plt.plot(depths, tr_scores, label=<span class="string">'train_scores'</span>)</span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure><p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fq3frlhc9vj30ii0c6jsa.jpg" alt=""></p><h3 id="2ã€é€šè¿‡min-impurity-decreaseæ¥ä¼˜åŒ–æ¨¡å‹"><a href="#2ã€é€šè¿‡min-impurity-decreaseæ¥ä¼˜åŒ–æ¨¡å‹" class="headerlink" title="2ã€é€šè¿‡min_impurity_decreaseæ¥ä¼˜åŒ–æ¨¡å‹"></a>2ã€é€šè¿‡<code>min_impurity_decrease</code>æ¥ä¼˜åŒ–æ¨¡å‹</h3><p>è¿™ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šä¿¡æ¯å¢’æˆ–è€…åŸºå°¼ä¸çº¯åº¦çš„é˜€å€¼ï¼Œå½“å†³ç­–æ ‘åˆ†è£‚åï¼Œå…¶ä¿¡æ¯å¢ç›Šä½äºè¿™ä¸ªé˜€å€¼æ—¶åˆ™ä¸å†åˆ†è£‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">minsplit_score</span><span class="params">(val)</span>:</span></span><br><span class="line">    clf = DecisionTreeClassifier(criterion=<span class="string">'gini'</span>, min_impurity_decrease=val)</span><br><span class="line">    clf.fit(X_train, y_train)</span><br><span class="line">    <span class="keyword">return</span> (clf.score(X_train, y_train), clf.score(X_test, y_test), )</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šå‚æ•°èŒƒå›´ï¼Œåˆ†åˆ«è®­ç»ƒæ¨¡å‹å¹¶è®¡ç®—å¾—åˆ†</span></span><br><span class="line"></span><br><span class="line">vals = np.linspace(<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">100</span>)</span><br><span class="line">scores = [minsplit_score(v) <span class="keyword">for</span> v <span class="keyword">in</span> vals]</span><br><span class="line">tr_scores = [s[<span class="number">0</span>] <span class="keyword">for</span> s <span class="keyword">in</span> scores]</span><br><span class="line">te_scores = [s[<span class="number">1</span>] <span class="keyword">for</span> s <span class="keyword">in</span> scores]</span><br><span class="line"></span><br><span class="line">bestmin_index = np.argmax(te_scores)</span><br><span class="line">bestscore = te_scores[bestmin_index]</span><br><span class="line">print(<span class="string">"bestmin:"</span>, vals[bestmin_index])</span><br><span class="line">print(<span class="string">"bestscore:"</span>, bestscore)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">6</span>,<span class="number">4</span>), dpi=<span class="number">120</span>)</span><br><span class="line">plt.grid()</span><br><span class="line">plt.xlabel(<span class="string">"min_impurity_decrease"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Scores"</span>)</span><br><span class="line">plt.plot(vals, te_scores, label=<span class="string">'test_scores'</span>)</span><br><span class="line">plt.plot(vals, tr_scores, label=<span class="string">'train_scores'</span>)</span><br><span class="line"></span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure><pre><code>bestmin: 0.00202020202020202bestscore: 0.7988826815642458</code></pre><p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fq3frwqn2fj30hx0c7aac.jpg" alt=""></p><p><strong>é—®é¢˜ï¼šæ¯æ¬¡ä½¿ç”¨ä¸åŒéšæœºåˆ‡å‰²çš„æ•°æ®é›†å¾—å‡ºæœ€ä½³å‚æ•°ä¸º0.002å¾ˆæ¥è¿‘0ï¼Œè¯¥æ€ä¹ˆè§£è¯»ï¼Ÿ</strong></p><p>å€¼æ­¤ä¸ºæˆ‘ä»¬æ‰¾åˆ°äº†ä¸¤ä¸ªå‚æ•°,æœ€ä½³æ·±åº¦depth=5 å’Œæœ€ä½³min_impurity_decrease=0.002ï¼Œä¸‹é¢æˆ‘æ¥ç”¨ä¸¤ä¸ªå‚æ•°ç®€å†æ¨¡å‹è¿›è¡Œæµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics </span><br><span class="line"></span><br><span class="line">model = DecisionTreeClassifier(max_depth=<span class="number">5</span>, min_impurity_decrease=<span class="number">0.002</span>)</span><br><span class="line">model.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"tees_score:"</span>, model.score(X_test, y_test))</span><br><span class="line"></span><br><span class="line">y_pred = model.predict(X_test)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"æŸ¥å‡†ç‡:"</span>,metrics.precision_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"å¬å›ç‡:"</span>,metrics.recall_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"F1_score:"</span>,metrics.f1_score(y_test, y_pred))</span><br></pre></td></tr></table></figure><pre><code>tees_score: 0.7821229050279329æŸ¥å‡†ç‡: 0.8461538461538461å¬å›ç‡: 0.5866666666666667F1_score: 0.6929133858267718</code></pre><h2 id="æ¨¡å‹å‚æ•°é€‰æ‹©å·¥å…·åŒ…"><a href="#æ¨¡å‹å‚æ•°é€‰æ‹©å·¥å…·åŒ…" class="headerlink" title="æ¨¡å‹å‚æ•°é€‰æ‹©å·¥å…·åŒ…"></a>æ¨¡å‹å‚æ•°é€‰æ‹©å·¥å…·åŒ…</h2><p>è‡³æ­¤å‘ç°ä»¥ä¸Šä¸¤ç§æ¨¡å‹ä¼˜åŒ–æ–¹æ³•æœ‰ä¸¤é—®é¢˜ï¼š</p><ul><li><p>1ã€æ•°æ®ä¸ç¨³å®šï¼šâ€“&gt; æ¯æ¬¡é‡æ–°åˆ†é…è®­ç»ƒé›†æµ‹è¯•é›†ï¼ŒåŸå‚æ•°å°±ä¸æ˜¯æœ€ä¼˜äº†ã€‚ è§£å†³åŠæ³•æ˜¯å¤šæ¬¡è®¡ç®—æ±‚å¹³å‡å€¼ã€‚</p></li><li><p>2ã€ä¸èƒ½ä¸€æ¬¡é€‰æ‹©å¤šä¸ªå‚æ•°ï¼šâ€“&gt; æƒ³è€ƒå¯Ÿmax_depthå’Œmin_impurity_decreaseä¸¤è€…ç»“åˆèµ·æ¥çš„æœ€ä¼˜å‚æ•°å°±æ²¡æ³•å®ç°ã€‚</p></li></ul><p>æ‰€å¹¸<code>scikit-learn</code>åœ¨<code>sklearn.model_selection</code>åŒ…æä¾›äº†å¤§é‡çš„æ¨¡å‹é€‰æ‹©å’Œè¯„ä¼°çš„å·¥å…·ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚é’ˆå¯¹è¯¥é—®é¢˜å¯ä»¥ä½¿ç”¨<code>GridSearchCV</code>ç±»æ¥è§£å†³ã€‚</p><h3 id="åˆ©ç”¨GridSearchCVæ±‚æœ€ä¼˜å‚æ•°"><a href="#åˆ©ç”¨GridSearchCVæ±‚æœ€ä¼˜å‚æ•°" class="headerlink" title="åˆ©ç”¨GridSearchCVæ±‚æœ€ä¼˜å‚æ•°"></a>åˆ©ç”¨<code>GridSearchCV</code>æ±‚æœ€ä¼˜å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"></span><br><span class="line">thresholds = np.linspace(<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">50</span>)</span><br><span class="line">param_grid = &#123;<span class="string">'min_impurity_decrease'</span>:thresholds&#125;</span><br><span class="line"></span><br><span class="line">clf = GridSearchCV(DecisionTreeClassifier(), param_grid, cv=<span class="number">5</span>)</span><br><span class="line">clf.fit(X,y)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"best_parms:&#123;0&#125;\nbest_score:&#123;1&#125;"</span>.format(clf.best_params_, clf.best_score_))</span><br></pre></td></tr></table></figure><pre><code>best_parms:{&apos;min_impurity_decrease&apos;: 0.00816326530612245}best_score:0.8114478114478114</code></pre><p>æ¨¡å‹è§£è¯»ï¼š<br>1ã€å…³é”®å­—å‚æ•°<code>param_grid</code>æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸çš„å…³é”®å­—å¯¹åº”çš„å€¼æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚<code>GridSearchCV</code>ä¼šæšä¸¾åˆ—è¡¨é‡Œæ‰€æœ‰å€¼æ¥æ„å»ºæ¨¡å‹å¤šæ¬¡è®¡ç®—è®­ç»ƒæ¨¡å‹ï¼Œå¹¶è®¡ç®—æ¨¡å‹è¯„åˆ†ï¼Œæœ€ç»ˆå¾—å‡ºæŒ‡å®šå‚æ•°å€¼çš„å¹³å‡è¯„åˆ†åŠæ ‡å‡†å·®ã€‚</p><p>2ã€å…³é”®å‚æ•°<code>sv</code>ï¼Œç”¨æ¥æŒ‡å®šäº¤å‰éªŒè¯æ•°æ®é›†çš„ç”Ÿæˆè§„åˆ™ã€‚è¿™é‡Œsv=5è¡¨ç¤ºæ¯æ¬¡è®¡ç®—éƒ½æŠŠæ•°æ®é›†åˆ†æˆ5ä»½ï¼Œæ‹¿å…¶ä¸­ä¸€ä»½ä½œä¸ºäº¤å‰éªŒè¯æ•°æ®é›†ï¼Œå…¶ä»–ä½œä¸ºè®­ç»ƒé›†ã€‚æœ€ç»ˆå¾—å‡ºæœ€ä¼˜å‚æ•°åŠæœ€ä¼˜è¯„åˆ†ä¿å­˜åœ¨<code>clf.best_params_</code>å’Œ<code>clf.best_score_</code>é‡Œã€‚</p><p>3ã€æ­¤å¤–<code>clf.cv_results_</code>é‡Œä¿å­˜äº†è®¡ç®—è¿‡ç¨‹çš„æ‰€æœ‰ä¸­é—´ç»“æœã€‚</p><h3 id="ç”»å‡ºå­¦ä¹ æ›²çº¿ï¼š"><a href="#ç”»å‡ºå­¦ä¹ æ›²çº¿ï¼š" class="headerlink" title="ç”»å‡ºå­¦ä¹ æ›²çº¿ï¼š"></a>ç”»å‡ºå­¦ä¹ æ›²çº¿ï¼š</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_curve</span><span class="params">(train_sizes, cv_results, xlabel)</span>:</span></span><br><span class="line">    train_scores_mean = cv_results[<span class="string">'mean_train_score'</span>]</span><br><span class="line">    train_scores_std = cv_results[<span class="string">'std_train_score'</span>]</span><br><span class="line">    test_scores_mean = cv_results[<span class="string">'mean_test_score'</span>]</span><br><span class="line">    test_scores_std = cv_results[<span class="string">'std_test_score'</span>]</span><br><span class="line">    plt.figure(figsize=(<span class="number">6</span>, <span class="number">4</span>), dpi=<span class="number">120</span>)</span><br><span class="line">    plt.title(<span class="string">'parameters turning'</span>)</span><br><span class="line">    plt.grid()</span><br><span class="line">    plt.xlabel(xlabel)</span><br><span class="line">    plt.ylabel(<span class="string">'score'</span>)</span><br><span class="line">    plt.fill_between(train_sizes, </span><br><span class="line">                     train_scores_mean - train_scores_std,</span><br><span class="line">                     train_scores_mean + train_scores_std, </span><br><span class="line">                     alpha=<span class="number">0.1</span>, color=<span class="string">"r"</span>)</span><br><span class="line">    plt.fill_between(train_sizes, </span><br><span class="line">                     test_scores_mean - test_scores_std,</span><br><span class="line">                     test_scores_mean + test_scores_std, </span><br><span class="line">                     alpha=<span class="number">0.1</span>, color=<span class="string">"g"</span>)</span><br><span class="line">    plt.plot(train_sizes, train_scores_mean, <span class="string">'.--'</span>, color=<span class="string">"r"</span>,</span><br><span class="line">             label=<span class="string">"Training score"</span>)</span><br><span class="line">    plt.plot(train_sizes, test_scores_mean, <span class="string">'.-'</span>, color=<span class="string">"g"</span>,</span><br><span class="line">             label=<span class="string">"Cross-validation score"</span>)</span><br><span class="line"></span><br><span class="line">    plt.legend(loc=<span class="string">"best"</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"></span><br><span class="line">thresholds = np.linspace(<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">50</span>)</span><br><span class="line"><span class="comment"># Set the parameters by cross-validation</span></span><br><span class="line">param_grid = &#123;<span class="string">'min_impurity_decrease'</span>: thresholds&#125;</span><br><span class="line"></span><br><span class="line">clf = GridSearchCV(DecisionTreeClassifier(), param_grid, cv=<span class="number">5</span>)</span><br><span class="line">clf.fit(X, y)</span><br><span class="line">print(<span class="string">"best param: &#123;0&#125;\nbest score: &#123;1&#125;"</span>.format(clf.best_params_, </span><br><span class="line">                                                clf.best_score_))</span><br><span class="line"></span><br><span class="line"><span class="comment"># plot_curve(thresholds, clf.cv_results_, xlabel='gini thresholds')</span></span><br></pre></td></tr></table></figure><pre><code>best param: {&apos;min_impurity_decrease&apos;: 0.00816326530612245}best score: 0.8114478114478114</code></pre><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fq3fs68mvsj30i70cr3zb.jpg" alt=""></p><h3 id="å¤šç»„å‚æ•°ä¹‹é—´é€‰æ‹©æœ€ä¼˜å‚æ•°ï¼š"><a href="#å¤šç»„å‚æ•°ä¹‹é—´é€‰æ‹©æœ€ä¼˜å‚æ•°ï¼š" class="headerlink" title="å¤šç»„å‚æ•°ä¹‹é—´é€‰æ‹©æœ€ä¼˜å‚æ•°ï¼š"></a>å¤šç»„å‚æ•°ä¹‹é—´é€‰æ‹©æœ€ä¼˜å‚æ•°ï¼š</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"></span><br><span class="line">entropy_thresholds = np.linspace(<span class="number">0</span>, <span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">gini_thresholds = np.linspace(<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">100</span>)</span><br><span class="line"><span class="comment">#è®¾ç½®å‚æ•°çŸ©é˜µï¼š</span></span><br><span class="line">param_grid = [&#123;<span class="string">'criterion'</span>: [<span class="string">'entropy'</span>], <span class="string">'min_impurity_decrease'</span>: entropy_thresholds&#125;,</span><br><span class="line">              &#123;<span class="string">'criterion'</span>: [<span class="string">'gini'</span>], <span class="string">'min_impurity_decrease'</span>: gini_thresholds&#125;,</span><br><span class="line">              &#123;<span class="string">'max_depth'</span>: np.arange(<span class="number">2</span>,<span class="number">10</span>)&#125;,</span><br><span class="line">              &#123;<span class="string">'min_samples_split'</span>: np.arange(<span class="number">2</span>,<span class="number">30</span>,<span class="number">2</span>)&#125;]</span><br><span class="line">clf = GridSearchCV(DecisionTreeClassifier(), param_grid, cv=<span class="number">5</span>)</span><br><span class="line">clf.fit(X, y)</span><br><span class="line">print(<span class="string">"best param:&#123;0&#125;\nbest score:&#123;1&#125;"</span>.format(clf.best_params_, clf.best_score_))</span><br></pre></td></tr></table></figure><pre><code>best param:{&apos;min_impurity_decrease&apos;: 0.00816326530612245}best score:0.8114478114478114</code></pre><p><code>ç»“æœ1ã€{&#39;criterion&#39;: &#39;gini&#39;, &#39;min_impurity_decrease&#39;: 0.00816326530612245} -&gt;6</code></p><p><code>ç»“æœ2ã€{&#39;min_samples_split&#39;: 22} -&gt;10</code></p><p><code>ç»“æœ3ã€{&#39;min_samples_split&#39;: 20} -&gt;4</code></p><p><strong>ç»“æœæ³¢åŠ¨å¾ˆå¤§ï¼Œè¿™é‡Œåšäº†20æ¬¡æµ‹è¯•ï¼Œå¯¹åº”ç»“æœ1å‡ºç°6æ¬¡ï¼Œç»“æœ2å‡ºç°10æ¬¡ï¼Œç»“æœ3å‡ºç°4æ¬¡ã€‚</strong></p><p><strong>ä»£ç è§£è¯»</strong>ï¼š<br>å…³é”®éƒ¨åˆ†è¿˜æ˜¯<code>param_grid</code>å‚æ•°ï¼Œä»–æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚å¾ˆå¯¹åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå­—å…¸ï¼Œé€‰æ‹©ä¿¡æ¯å¢’<code>ï¼ˆentropyï¼‰</code>ä½œä¸ºåˆ¤æ–­æ ‡å‡†ï¼Œå–å€¼0ï½1èŒƒå›´50ç­‰åˆ†ï¼›</p><p>ç¬¬äºŒä¸ªå­—å…¸é€‰æ‹©åŸºå°¼ç³»æ•°ï¼Œ<code>min_impurity_decrease</code>å–å€¼0ï½0.2èŒƒå›´50ç­‰åˆ†ã€‚</p><p><code>GridSearchCV</code>ä¼šé’ˆå¯¹åˆ—è¡¨ä¸­çš„æ¯ä¸ªå­—å…¸è¿›è¡Œè¿­ä»£ï¼Œæœ€ç»ˆæ¯”è¾ƒåˆ—è¡¨ä¸­æ¯ä¸ªå­—å…¸æ‰€å¯¹åº”çš„å‚æ•°ç»„åˆï¼Œé€‰æ‹©å‡ºæœ€ä¼˜çš„å‚æ•°ã€‚</p><h3 id="ç”Ÿæˆå†³ç­–æ ‘å›¾å½¢"><a href="#ç”Ÿæˆå†³ç­–æ ‘å›¾å½¢" class="headerlink" title="ç”Ÿæˆå†³ç­–æ ‘å›¾å½¢"></a>ç”Ÿæˆå†³ç­–æ ‘å›¾å½¢</h3><p>ä¸‹é¢ä»£ç å¯ä»¥ç”Ÿæˆ.dotæ–‡ä»¶ï¼Œéœ€è¦ç”µè„‘ä¸Šå®‰è£…<code>graphviz</code>æ‰èƒ½æŠŠæ–‡ä»¶è½¬æ¢æˆå›¾ç‰‡æ ¼å¼ã€‚</p><p><code>Mac</code>ä¸Šå¯ä»¥ä½¿ç”¨<code>brew install graphviz</code>å‘½ä»¤æ¥å®‰è£…ï¼Œå®ƒä¼šåŒæ—¶å®‰è£…8ä¸ªä¾èµ–åŒ…ã€‚è¿™é‡Œä¸€å®šæ³¨æ„<code>Mac</code>ç¯å¢ƒä¸‹çš„æƒé™é—®é¢˜ï¼šç”±äº<code>Homebrew</code>é»˜è®¤æ˜¯å®‰è£…åœ¨<code>/usr/local</code>ä¸‹ï¼Œè€Œ<code>Mac</code>æœ‰å¼ºåˆ¶ä¿æŠ¤ä¸æ”¯æŒ<code>sudo chown -R uname local</code>å¯¹<code>local</code>æ–‡ä»¶å¤¹è¿›è¡Œæƒé™ä¿®æ”¹ã€‚ </p><p>è¿™é‡Œçš„è§£å†³æ–¹å¼æ˜¯æŠŠ<code>local</code>ä¸‹<code>bin</code>,<code>lib</code>,<code>Cellar</code>ç­‰æ‰€éœ€å•ä¸ªæ–‡ä»¶å¤¹ä¸‹è¿›è¡Œèµ‹æƒï¼Œå³å¯æˆåŠŸå®‰è£…ã€‚</p><ol><li>åœ¨ç”µè„‘ä¸Šå®‰è£… graphviz</li><li>è¿è¡Œ <code>dot -Tpng tree.dot -o filename.png</code></li><li>åœ¨å½“å‰ç›®å½•æŸ¥çœ‹ç”Ÿæˆçš„å†³ç­–æ ‘ filename.png</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier </span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> tree</span><br><span class="line"></span><br><span class="line">clf = DecisionTreeClassifier(min_samples_split=<span class="number">22</span>)</span><br><span class="line">clf = clf.fit(X_train, y_train)</span><br><span class="line">train_score = clf.score(X_train, y_train)</span><br><span class="line">test_score = clf.score(X_test, y_test)</span><br><span class="line">print(<span class="string">'train score: &#123;0&#125;; test score: &#123;1&#125;'</span>.format(train_score, test_score))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡º titanic.dot æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"tree.dot"</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f = tree.export_graphviz(clf, out_file=f)</span><br></pre></td></tr></table></figure><pre><code>train score: 0.8834269662921348; test score: 0.8268156424581006</code></pre><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fq3fe05mm1j31kw0zfgqd.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;åˆ©ç”¨ä¿¡æ¯å¢’åˆ¤å®šå…ˆå¯¹é‚£ä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚&quot;&gt;&lt;a href=&quot;#åˆ©ç”¨ä¿¡æ¯å¢’åˆ¤å®šå…ˆå¯¹é‚£ä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚&quot; class=&quot;headerlink&quot; title=&quot;åˆ©ç”¨ä¿¡æ¯å¢’åˆ¤å®šå…ˆå¯¹é‚£ä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚&quot;&gt;&lt;/a&gt;åˆ©ç”¨ä¿¡æ¯å¢’åˆ¤å®šå…ˆå¯¹é‚£ä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚
      
    
    </summary>
    
      <category term="Machine learning" scheme="http://www.ihoge.cn/categories/Machine-learning/"/>
    
    
      <category term="scikit-learn" scheme="http://www.ihoge.cn/tags/scikit-learn/"/>
    
  </entry>
  
  <entry>
    <title>scikit-learné€»è¾‘å›å½’</title>
    <link href="http://www.ihoge.cn/2018/Logistic-regression.html"/>
    <id>http://www.ihoge.cn/2018/Logistic-regression.html</id>
    <published>2018-04-05T13:05:59.000Z</published>
    <updated>2018-04-06T17:31:08.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®—æ³•åŸç†"><a href="#ç®—æ³•åŸç†" class="headerlink" title="ç®—æ³•åŸç†"></a>ç®—æ³•åŸç†</h2><h3 id="é€»è¾‘å›å½’ç®—æ³•çš„é¢„æµ‹å‡½æ•°"><a href="#é€»è¾‘å›å½’ç®—æ³•çš„é¢„æµ‹å‡½æ•°" class="headerlink" title="é€»è¾‘å›å½’ç®—æ³•çš„é¢„æµ‹å‡½æ•°"></a>é€»è¾‘å›å½’ç®—æ³•çš„é¢„æµ‹å‡½æ•°</h3><p>å‚è€ƒï¼š<a href="http://blog.kamidox.com/logistic-regression.html" target="_blank" rel="noopener">é€»è¾‘å›å½’æ¢¯åº¦ä¸‹é™ç®—æ³•æ¨å¯¼</a></p><p>è¿™æ˜¯ä¸€ä¸ªéé»‘å³ç™½çš„ä¸–ç•Œï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡ºä¸€ä¸ªå‡½æ•°æ¨¡å‹ä½¿å…¶è¾“å‡ºå€¼åœ¨[0,1]ä¹‹é—´ï¼Œç„¶åé€‰æ‹©0.5ä½åŸºå‡†å€¼å¤§äº0.5å°±è®¤ä¸ºé¢„æµ‹å€¼ä¸º1åä¹‹ä¸º0ã€‚</p><p>è¯¥å‡½æ•°å°±æ˜¯<br><code>Sigmoidå‡½æ•°ï¼Œä¹Ÿå«åšLogisticå‡½æ•°ï¼š</code><br>$g\left( x \right)\; =\; \frac{1}{1+e^{-z}}$</p><p>å®ƒç»“åˆçº¿æ€§å›å½’å‡½æ•°$h_{\theta }\left( x \right)\; =\; \theta ^{T}x$ï¼Œç”Ÿæˆé€»è¾‘å›å½’ç®—æ³•çš„é¢„æµ‹å‡½æ•°ï¼š<br>$h_{\theta }\left( x \right)\; =\; g\left( z \right)=g\left( \theta ^{T}x \right)=\frac{1}{1+e^{-\theta ^{^{T}x}}}$</p><h3 id="æˆæœ¬å‡½æ•°"><a href="#æˆæœ¬å‡½æ•°" class="headerlink" title="æˆæœ¬å‡½æ•°"></a>æˆæœ¬å‡½æ•°</h3><p>æˆ‘ä»¬ä¸èƒ½ç”¨çº¿æ€§å›å½’æ¨¡å‹çš„æˆæœ¬å‡½æ•°æ¥æ¨å¯¼é€»è¾‘å›å½’çš„æˆæœ¬å‡½æ•°é‚£æ ·æ€å¤æ‚ã€‚ä¸ºäº†æ–¹ä¾¿æ±‚å‡ºæˆæœ¬å‡½æ•°æˆ‘ä»¬åˆ†åˆ«åˆ†æˆy=1å’Œy=0ä¸¤ç§æƒ…å†µåˆ†åˆ«è€ƒè™‘å…¶é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„è¯¯å·®ï¼š<br>$$\;\mbox{C}ost\left(h_{\theta }\left(x\right),y\right)\; =\;\left[\begin{array}{c}-\log\left(h_{\theta}\left(x\right)\right),\;\;\;\;\; y\;=1 \ -\log\left(1-h_{\theta }\left( x \right) \right),\; \; \; y\; =0 \end{array} \right]$$</p><p>æˆæœ¬å‡½æ•°ç»Ÿä¸€å†™æ³•ï¼š<br>$$\; \mbox{C}ost\left( h_{\theta }\left( x \right),y \right)\; =\; -y\log \left( h_{\theta }\left( x \right) \right)\; -\; \left( 1-y \right)\log \left( 1-h_{\theta }\left( x \right) \right)$$</p><p>ç”±äºyæ˜¯{0,1}åŒºé—´å†…çš„ç¦»æ•£å€¼ï¼Œå½“y=1æ—¶ï¼Œ 1-y=0ï¼Œä¸ŠåŠå¼çš„ååŠéƒ¨åˆ†ä¸º0ï¼›åä¹‹äº¦ç„¶ã€‚å› æ­¤ä¸Šå¸‚ä¸åˆ†è¡¨è¾¾çš„æˆæœ¬è®¡ç®—å…¬å¼æ˜¯ç­‰ä»·çš„ã€‚è‡³æ­¤æ ¹æ®ä¸€ä¸ªæ ·æœ¬çš„è®¡ç®—å…¬å¼ï¼Œå¾ˆå®¹æ˜“å¸é™¤æ‰€æœ‰æ ·æœ¬çš„æˆæœ¬å¹³å‡å€¼ï¼Œå¯ä»¥å¾—å‡ºï¼š<br>$$J\left( \theta  \right)\; =\; -\frac{1}{m}\left[ \sum_{i=1}^{m}{y^{\left( i \right)}\log \left( h_{\theta }\left( x^{\left( i \right)} \right) \right)\; +\; \left( 1-y^{\left( i \right)} \right)\log \left( 1-h_{\theta }\left( x^{\left( i \right)} \right) \right)} \right]$$</p><h3 id="æ¢¯åº¦ä¸‹é™ç®—æ³•"><a href="#æ¢¯åº¦ä¸‹é™ç®—æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™ç®—æ³•"></a>æ¢¯åº¦ä¸‹é™ç®—æ³•</h3><p>æ ¹æ®æ¢¯åº¦ä¸‹é™ç®—æ³•çš„å®šä¹‰å¯ä»¥å¾—å‡ºï¼š</p><p>$$\theta_{j\; =\; }\theta_{j\; }-\; \alpha \frac{\partial }{\partial \theta_{j}}J\left( \theta\right)$$<br>è¿™é‡Œçš„å…³é”®æ˜¯æ±‚è§£æˆæœ¬å‡½æ•°çš„åå¯¼æ•°ï¼Œæœ€ç»ˆé«˜æ¨å¯¼å‡ºæ¥çš„æ¢¯åº¦ä¸‹é™ç®—æ³•å…¬å¼ä¸ºï¼š</p><p>$$\theta_{j\;=\;}\theta_{j\;}-\;\alpha\frac{1}{m}\sum_{i=1}^{m}{\left(h_{\theta }\left(x^{\left(i\right)\;}\right)\;-\;y^{\left(i\right)}\right)x_{j}^{\left(i\right)}}$$</p><h2 id="å¤šå…ƒåˆ†ç±»"><a href="#å¤šå…ƒåˆ†ç±»" class="headerlink" title="å¤šå…ƒåˆ†ç±»"></a>å¤šå…ƒåˆ†ç±»</h2><p>é€»è¾‘å›å½’è§£å†³å¤šå…ƒåˆ†ç±»é—®é¢˜çš„æ€è·¯æ˜¯ï¼šy={0,1,2,â€¦n}ï¼Œæ€»å…±æœ‰n+1ä¸ªç±»åˆ«ï¼Œé¦–å…ˆæŠŠé—®é¢˜è½¬åŒ–ä¸ºäºŒå…ƒåˆ†ç±»é—®é¢˜ï¼Œåˆ†åˆ«æŠŠy=0ä½œä¸ºä¸€ä¸ªç±»åˆ«åŒæ—¶y={1,2,3â€¦n}ä½œä¸ºå¦ä¸€ä¸ªç±»åˆ«ï¼›æ¥ç€æŠŠy=1ä½œä¸ºä¸€ä¸ªç±»åˆ«ï¼Œä»¥æ­¤ç±»æ¨ï¼Œåœ¨è®¡ç®—ä»–ä»¬çš„æ¦‚ç‡ã€‚è¿™é‡Œæ€»å…±éœ€è¦n+1ä¸ªé¢„æµ‹å‡½æ•°ï¼š<br>$$$$<br>é¢„æµ‹å‡ºæ¥çš„æ¦‚ç‡æœ€é«˜çš„ç±»åˆ«ï¼Œå°±æ˜¯æ ·æœ¬æ‰€å±çš„ç±»åˆ«ã€‚ï¼ˆå› ä¸ºæ¦‚ç‡è¶Šæ¥è¿‘1æˆæœ¬å‡½æ•°å€¼è¶Šä½ï¼Œè¶Šæ¥è¿‘çœŸå®å€¼ï¼‰</p><h2 id="æ­£åˆ™åŒ–"><a href="#æ­£åˆ™åŒ–" class="headerlink" title="æ­£åˆ™åŒ–"></a>æ­£åˆ™åŒ–</h2><p>è¿‡æ‹Ÿåˆæ˜¯æŒ‡å¢¨èŠ¯å¾ˆå¥½çš„æ‹Ÿåˆäº†é©¯è‰¯æ ·æœ¬ï¼Œä½†å¯¹æ–°æ•°æ®é¢„æµ‹çš„å‡†ç¡®æ€§å¾ˆå·®ï¼Œè¿™æ˜¯å› ä¸ºæ¨¡å‹å¤ªå¤æ‚äº†ã€‚è§£å†³åŠæ³•æ˜¯å‡å°‘è¾“å…¥ç‰¹å¾çš„ä¸ªæ•°ï¼Œæˆ–è€…è·å–æ›´å¤šçš„é©¯è‰¯æ ·æœ¬ã€‚è¿™é‡Œä»‹ç»æ­£åˆ™åŒ–ä¹Ÿæ˜¯ç”¨æ¥è§£å†³æ¨¡å‹è¿‡æ‹Ÿåˆé—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><ul><li>ä¿ç•™æ‰€æœ‰ç‰¹å¾ï¼Œå‡å°ç‰¹å¾çš„æƒé‡$\theta_j$çš„å€¼ï¼Œç¡®ä¿æ‰€æœ‰çš„ç‰¹å¾å¯¹é¢„æµ‹å€¼éƒ½æœ‰å¾ˆå°‘é‡å¤§è´¡çŒ®ã€‚</li><li>å½“æ¯ä¸ªç‰¹å¾xå¯¹é¢„æµ‹å€¼éƒ½æœ‰å°‘é‡çš„è´¡çŒ®æ—¶ï¼Œæ¨¡å‹å°±å¯ä»¥å¾ˆå¥½çš„å·¥ä½œï¼Œä¹Ÿå°±æ˜¯æ­£åˆ™åŒ–çš„ç›®çš„ï¼Œå¯ä»¥ç”¨æ¥è§£å†³ç‰¹å¾è¿‡å¤šæ—¶çš„è¿‡æ‹Ÿåˆé—®é¢˜</li></ul><h3 id="çº¿æ€§å›å½’æ¨¡å‹çš„æ­£åˆ™åŒ–"><a href="#çº¿æ€§å›å½’æ¨¡å‹çš„æ­£åˆ™åŒ–" class="headerlink" title="çº¿æ€§å›å½’æ¨¡å‹çš„æ­£åˆ™åŒ–"></a>çº¿æ€§å›å½’æ¨¡å‹çš„æ­£åˆ™åŒ–</h3><p>$$J\left(\theta\right)\;=\;\frac{1}{2m}\left[\sum_{i=1}^{m}{\left(h_{\theta}\left(x^{\left(i\right)}\right)\;-\;y^{\left(i\right)}\right)^{2}}\right]\;+\;\lambda\sum_{j=1}^{n}{\theta_{j}^{2}}$$</p><p>å…¬å¼çš„å‰åŠéƒ¨åˆ†å±€åŠ¿çº¿æ€§å›å½’çš„æˆæœ¬å‡½æ•°ï¼ŒååŠéƒ¨åˆ†åŠ å…¥<strong>æ­£åˆ™é¡¹</strong>ã€‚å…¶ä¸­$Î»$çš„å€¼æœ‰ä¸¤ä¸ªç›®çš„ï¼Œæ—¢è¦ç»´æŒå¯¹è®­ç»ƒæ ·æœ¬çš„æ‹Ÿåˆï¼Œåˆè¦é¿å…å¯¹è®­ç»ƒæ ·æœ¬çš„è¿‡æ‹Ÿåˆã€‚å¦‚æœÎ»å¤ªå¤§ï¼Œåˆ™èƒ½ç¡®ä¿ä¸å‡ºç°è¿‡æ‹Ÿåˆï¼Œä½†å¯èƒ½å¯¹ç°æœ‰è®­ç»ƒæ ·æœ¬å‡ºç°æ¬ æ‹Ÿåˆã€‚<br>ä»æ•°å­¦çš„è§’åº¦æ¥çœ‹ï¼Œæˆæœ¬å‡½æ•°å¢åŠ äº†ä¸€ä¸ªæ­£åˆ™é¡¹ $\lambda\sum_{j=1}^{n}{\theta_{j}^{2}}$åï¼Œæˆæœ¬å‡½æ•°ä¸å†å”¯ä¸€çš„ç”±é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„è¯¯å·®æ‰€å†³å®šï¼Œè¿˜å’Œå‚æ•°$\theta$çš„å¤§å°æœ‰å…³ã€‚æœ‰äº†è¿™ä¸ªé™åˆ¶åè¦å®ç°æˆæœ¬å‡½æ•°æœ€å°çš„ç›®çš„ï¼Œ$\theta$å°±ä¸èƒ½éšä¾¿å–å€¼ã€‚æ¯”å¦‚æŸä¸ªè¾ƒå¤§çš„$\theta$å€¼å¯èƒ½ä¼šè®©é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„è¯¯å·®$\left( h_{\theta }\left( x^{\left( i \right)} \right)-y^{\left( i \right)} \right)^{2}$å€¼å¾ˆå°ï¼Œä½†æ˜¯ä¼šå¯¼è‡´$\theta_{j}^{2}$å¾ˆå¤§ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯æˆæœ¬å‡½æ•°å¤ªå¤§ã€‚è¿™æ ·é€šè¿‡è°ƒèŠ‚å‚æ•°Î»å°±å¯ä»¥æ§åˆ¶æ­£åˆ™é¡¹çš„æƒé‡ï¼Œä»è€Œé¿å…çº¿æ€§å›å½’ç®—æ³•è¿‡æ‹Ÿåˆã€‚<br>åˆ©ç”¨æ­£åˆ™åŒ–çš„æˆæœ¬å‡½æ•°ï¼Œå¯ä»¥æ¨å¯¼å‡ºæ­£åˆ™åŒ–åçš„å‚æ•°è¿­ä»£å‡½æ•°ï¼š</p><p>$$\theta_{j}\;=\;\theta_{j}\; -\; \alpha \frac{1}{m}\sum_{i=1}^{m}{\left[ \left( \left( h\left( x^{\left( i \right)} \right)\; -\; y^{\left( i \right)} \right)x_{j}^{\left( i \right)} \right)\; +\; \frac{\lambda }{m}\theta_{j} \right]}\; $$</p><p>$$\theta_{j}\;=\;\theta_{j}\; \left( 1\; -\; \alpha \frac{\lambda }{m} \right)\; -\; \alpha \frac{1}{m}\sum_{i=1}^{m}{}\left( \left( h\left( x^{\left( i \right)} \right)\; -\; y^{\left( i \right)} \right)x_{j}^{\left( i \right)} \right)\;$$</p><p>$\left( 1\; -\; \alpha \frac{\lambda }{m} \right)$å› å­åœ¨æ¯æ¬¡è¿­ä»£æ—¶éƒ½å°†æŠŠ$Î¸<em>{j}$ æ”¶ç¼©ä¸€ç‚¹ç‚¹ã€‚å› ä¸ºÎ±å’ŒÎ»æ˜¯æ­£æ•°ï¼Œè€Œ $m$ æ˜¯è®­ç»ƒé˜³å†çš„ä¸ªæ•°ï¼Œæ˜¯ä¸ªæ¯”è¾ƒå¤§çš„æ­£æ•´æ•°ã€‚ä¸ºä»€ä¹ˆè¦å¯¹ $Î¸</em>{j }$ è¿›è¡Œæ”¶ç¼©å‘¢ï¼Ÿå› ä¸ºåŠ å…¥æ­£åˆ™é¡¹çš„æˆæœ¬å‡½æ•°å’Œ $Î¸<em>{j}^{2}$ æˆæ­£æ¯”ï¼Œæ‰€ä»¥è¿­ä»£æ˜¯éœ€è¦ä¸æ–­è¯•å›¾å‡å° $Î¸</em>{j }$ çš„å€¼ã€‚</p><h3 id="é€»è¾‘å›å½’æ¨¡å‹æ­£åˆ™åŒ–"><a href="#é€»è¾‘å›å½’æ¨¡å‹æ­£åˆ™åŒ–" class="headerlink" title="é€»è¾‘å›å½’æ¨¡å‹æ­£åˆ™åŒ–"></a>é€»è¾‘å›å½’æ¨¡å‹æ­£åˆ™åŒ–</h3><p>ä½¿ç”¨ç›¸åŒçš„æ€è·¯ï¼Œä¹Ÿå¯ä»¥å¯¹é€»è¾‘å›å½’æ¨¡å‹çš„æˆæœ¬å‡½æ•°è¿›è¡Œæ­£åˆ™åŒ–ï¼Œå…¶æ–¹æ³•ä¹Ÿæ˜¯åœ¨åŸæ¥çš„æˆæœ¬å‡½æ•°ä¸ŠåŠ ä¸Šæ­£åˆ™é¡¹ï¼š<br>$$J\left( \theta  \right)\; =\; -\frac{1}{m}\left[ \sum_{i=1}^{m}{y^{\left( i \right)}\log \left( h_{\theta }\left( x^{\left( i \right)} \right) \right)\; +\; \left( 1-y^{\left( i \right)} \right)\log \left( 1-h_{\theta }\left( x^{\left( i \right)} \right) \right)} \right]\; +\; \frac{\lambda }{2m}\sum_{j=1}^{n}{\theta_{j}^{2}\;}$$<br>ç›¸åº”çš„ï¼Œæ­£åˆ™åŒ–åå‚æ•°è¿­ä»£å…¬å¼ä¸ºï¼š</p><p>$$\theta_{j}\; \; =\; \theta_{j}\; -\; \alpha \frac{\partial }{\partial \theta_{j}}J\left( \theta  \right)$$<br>$$\theta_{j}\; =\; \theta_{j}\; -\; \alpha \left[ \frac{1}{m}\sum_{i=1}^{m}{}\left( h_{\theta }\left( x^{\left( i \right)} \right)\; -\; y^{\left( i \right)} \right)x_{j}^{\left( i \right)}\; +\; \frac{\lambda }{m}\theta_{j} \right]\;$$<br>$$\theta_{j}\; =\; \theta_{j}\; \left( 1\; -\; \alpha \frac{\lambda }{m} \right)\; -\; \alpha \frac{1}{m}\sum_{i=1}^{m}{}\left( \left( h\left( x^{\left( i \right)} \right)\; -\; y^{\left( i \right)} \right)x_{j}^{\left( i \right)} \right)\;$$</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šå¼ä¸­$j&gt;=1$ï¼Œå› æ­¤$\theta_{0}$æ²¡æœ‰å‚ä¸æ­£åˆ™åŒ–ã€‚å¦å¤–éœ€è¦æ³¨æ„é€»è¾‘å›å½’å’Œçº¿æ€§å›å½’çš„å‚æ•°è¿­ä»£ç®—æ³•çœ‹èµ·æ¥å½¢å¼æ˜¯ä¸€æ ·çš„ï¼Œä½†å…¶å®ä»–ä»¬çš„ç®—æ³•ä¸ä¸€æ ·ï¼Œå› ä¸ºä¸¤ä¸ªå¼å­çš„é¢„æµ‹å‡½æ•°$h_{Î¸}({x})$ä¸ä¸€æ ·ã€‚é’ˆå¯¹çº¿æ€§å›å½’ï¼š$h_{Î¸}({x}) = Î¸^{T}x$ï¼Œè€Œé’ˆå¯¹é€»è¾‘å›å½’çš„æ˜¯ï¼š$h_{\theta }\left( x \right)\; =\; g\left( z \right)=g\left( \theta ^{T}x \right)=\frac{1}{1+e^{-\theta ^{^{T}x}}}$</p><h2 id="ç®—æ³•å‚æ•°"><a href="#ç®—æ³•å‚æ•°" class="headerlink" title="ç®—æ³•å‚æ•°"></a>ç®—æ³•å‚æ•°</h2><h3 id="æ­£åˆ™é¡¹æƒé‡"><a href="#æ­£åˆ™é¡¹æƒé‡" class="headerlink" title="æ­£åˆ™é¡¹æƒé‡"></a>æ­£åˆ™é¡¹æƒé‡</h3><p>ä¸Šé¢ä»‹ç»çš„æ­£åˆ™é¡¹æƒé‡ Î» ï¼Œåœ¨<code>LogisiticRegression</code>é‡Œæœ‰ä¸ªå‚æ•° C ä¸ä¹‹å¯¹åº”ä½†æˆåæ¯”ï¼š</p><ul><li>C è¶Šå¤§æ­£åˆ™é¡¹æƒé‡è¶Šå°ï¼Œæ¨¡å‹å®¹æ˜“å‡ºç°è¿‡æ‹Ÿåˆ</li><li>C è¶Šå°æ­£åˆ™é¡¹æƒé‡è¶Šå¤§ï¼Œæ¨¡å‹å®¹æ˜“å‡ºç°æ¬ æ‹Ÿåˆ</li></ul><h3 id="L1-L2èŒƒæ•°"><a href="#L1-L2èŒƒæ•°" class="headerlink" title="L1\L2èŒƒæ•°"></a>L1\L2èŒƒæ•°</h3><p>åˆ›å»ºé€»è¾‘å›å½’æ¨¡å‹æ—¶ï¼Œæœ‰ä¸ªå‚æ•° penalty ï¼Œå…¶å–å€¼æœ‰â€˜l1â€™æˆ–â€˜l2â€™ï¼Œå®é™…ä¸Šå°±æ˜¯æŒ‡å®šå‰é¢ä»‹ç»çš„æ­£åˆ™é¡¹çš„å½¢å¼ã€‚ åœ¨æˆæœ¬å‡½æ•°é‡Œæ·»åŠ çš„æ­£åˆ™é¡¹ $\sum_{j=1}^{n}{\theta_{j}^{2}}$ï¼Œ è¿™æ—¶å®é™…ä¸Šå°±æ˜¯ä¸ªL2æ­£åˆ™é¡¹ã€‚<br>L1:</p><p>$\left|\left|\theta\right|\right|_ {1}\; =\; \left|\theta_{1}\right|\;+\; \left| \theta_{2} \right|$<br>L2:</p><p>$\left| \left| \theta  \right| \right|_ {2}\; =\; \sqrt{\theta_{1}^{2}\; +\; \theta_{2}^{2}}$</p><p>L1 L1èŒƒæ•°ï¼ˆL1 normï¼‰æ˜¯æŒ‡å‘é‡ä¸­å„ä¸ªå…ƒç´ ç»å¯¹å€¼ä¹‹å’Œï¼Œä¹Ÿæœ‰ä¸ªç¾ç§°å«â€œç¨€ç–è§„åˆ™ç®—å­â€ï¼ˆLasso regularizationï¼‰ã€‚èŒƒæ•°ä½œä¸ºæ­£åˆ™é¡¹ï¼Œä¼šè®©æ¨¡å‹å‚æ•°$\theta$ç¨€ç–åŒ–ï¼Œ æ—¢è®©æ¨¡å‹å‚æ•°å‘é‡é‡Œä¸º0çš„å…ƒç´ å°½é‡å¤šã€‚åœ¨æ”¯æŒå‘é‡æœºï¼ˆsupport vector machineï¼‰å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå®é™…æ˜¯ä¸€ç§å¯¹äºæˆæœ¬å‡½æ•°(cost function)æ±‚è§£æœ€ä¼˜ï¼Œå¾—å‡ºç¨€ç–è§£ã€‚<br>L2 èŒƒæ•°ä½œä¸ºæ­£åˆ™é¡¹å¼è®©æ¨¡å‹å‚æ•°å°½é‡å°ï¼Œä½†ä¸ä¼šä¸º0ï¼Œå°½é‡è®©æ¯ä¸ªç‰¹å¾å¯¹é¢„æµ‹å€¼éƒ½æœ‰ä¸€äº›å°çš„è´¡çŒ®ï¼Œå¾—å‡ºç¨ å¯†è§£ã€‚<br>åœ¨æ¢¯åº¦ä¸‹é™ç®—æ³•çš„è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šæ˜¯åœ¨æˆæœ¬å‡½æ•°çš„ç­‰é«˜çº¿ä¸Šè·³è·ƒï¼Œå¹¶æœ€ç»ˆæ”¶æ•›åœ¨è¯¯å·®æœ€å°çš„ç‚¹ä¸Šï¼ˆæ­¤å¤„ä¸ºæœªåŠ æ­£åˆ™é¡¹ä¹‹å‰çš„æˆæœ¬è¯¯å·®ï¼‰ã€‚è€Œæ­£åˆ™é¡¹çš„æœ¬è´¨å°±æ˜¯<strong>æƒ©ç½š</strong>ã€‚ æ¨¡å‹åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰éµå®ˆæ­£åˆ™é¡¹æ‰€è¡¨è¾¾çš„è§„åˆ™ï¼Œé‚£ä¹ˆæˆæœ¬ä¼šå˜å¤§ï¼Œå³å—åˆ°äº†æƒ©ç½šï¼Œä»è€Œå¾€æ­£åˆ™é¡¹æ‰€è¡¨è¾¾çš„è§„åˆ™å¤„æ”¶æ•›ã€‚ æˆæœ¬å‡½æ•°å“è¿™ä¸¤é¡¹è§„åˆ™çš„ç»¼åˆä½œç”¨ä¸‹ï¼Œæ­£åˆ™åŒ–åçš„æ¨¡å‹å‚æ•°åº”è¯¥æ”¶æ•›åœ¨è¯¯å·®ç­‰å€¼çº¿ä¸æ­£åˆ™é¡¹ç­‰å€¼çº¿ç›¸åˆ‡çš„ç‚¹ä¸Šã€‚<br>ä½œä¸ºæ¨è®ºï¼Œ L1 èŒƒæ•°ä½œä¸ºæ­£åˆ™é¡¹ç”±ä»¥ä¸‹å‡ ä¸ªç”¨é€”ï¼š</p><ul><li>ç‰¹å¾é€‰æ‹©ï¼š å®ƒä¼šè®©æ¨¡å‹å‚æ•°å‘é‡é‡Œçš„å…ƒç´ ä¸º0çš„ç‚¹å°½é‡å¤šã€‚ å› æ­¤å¯ä»¥æ’é™¤æ‰é‚£äº›å¯¹é¢„æµ‹å€¼æ²¡æœ‰ä»€ä¹ˆå½±å“çš„ç‰¹å¾ï¼Œä»è€Œç®€åŒ–é—®é¢˜ã€‚æ‰€ä»¥ L1 èŒƒæ•°è§£å†³è¿‡æ‹Ÿåˆæªæ–½å®é™…ä¸Šæ˜¯å‡å°‘ç‰¹å¾æ•°é‡ã€‚</li><li>å¯è§£é‡Šæ€§ï¼š æ¨¡å‹å‚æ•°å‘é‡ç¨€ç–åŒ–åï¼Œåªä¼šç•™ä¸‹é‚£äº›å¯¹é¢„æµ‹å€¼æœ‰é‡è¦å½±å“çš„ç‰¹å¾ã€‚ è¿™æ ·æˆ‘ä»¬å°±å®¹æ˜“è§£é‡Šæ¨¡å‹çš„å› æœå…³ç³»ã€‚ æ¯”å¦‚é’ˆå¯¹æŸä¸ªç™Œç—‡çš„ç­›æŸ¥ï¼Œå¦‚æœæœ‰100ä¸ªç‰¹å¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ— ä»è§£é‡Šåˆ°åº•å“ªäº›ç‰¹å¾å¯¹é˜³æ€§æˆå…³é”®ä½œç”¨ã€‚ ç¨€ç–åŒ–åï¼Œåªç•™ä¸‹å‡ ä¸ªå…³é”®ç‰¹å¾ï¼Œå°±æ›´å®¹æ˜“çœ‹åˆ°å› æœå…³ç³»</li></ul><p>ç”±æ­¤å¯è§ï¼Œ L1 èŒƒæ•°ä½œä¸ºæ­£åˆ™é¡¹ï¼Œæ›´å¤šçš„æ˜¯ä¸€ä¸ªåˆ†æå·¥å…·ï¼Œè€Œé€‚åˆç”¨æ¥å¯¹æ¨¡å‹æ±‚è§£ã€‚å› ä¸ºå®ƒä¼šæŠŠä¸é‡è¦çš„ç‰¹å¾ç›´æ¥å»é™¤ã€‚ å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è§£å†³è¿‡æ‹Ÿåˆé—®é¢˜ï¼Œè¿˜æ˜¯é€‰æ‹© L2 å•æ•°ä½œä¸ºæ­£åˆ™é¡¹ï¼Œ è¿™ä¹Ÿæ˜¯ sklearn é‡Œçš„é»˜è®¤å€¼ã€‚</p><h2 id="å®ä¾‹ï¼šä¹³è…ºç™Œæ£€æµ‹"><a href="#å®ä¾‹ï¼šä¹³è…ºç™Œæ£€æµ‹" class="headerlink" title="å®ä¾‹ï¼šä¹³è…ºç™Œæ£€æµ‹"></a>å®ä¾‹ï¼šä¹³è…ºç™Œæ£€æµ‹</h2><p>ä½¿ç”¨é€»è¾‘å›å½’ç®—æ³•è§£å†³ä¹³è…ºç™Œæ£€æµ‹é—®é¢˜ã€‚ æˆ‘ä»¬éœ€è¦å…ˆé‡‡é›†è‚¿ç˜¤ç—…ç¶é€ å½±å›¾ç‰‡ï¼Œ ç„¶åå¯¹å›¾ç‰‡è¿›è¡Œåˆ†æï¼Œ ä»å›¾ç‰‡ä¸­æå–ç‰¹å¾ï¼Œ åœ¨æ ¹æ®ç‰¹å¾æ¥è®­ç»ƒæ¨¡å‹ã€‚ æœ€ç»ˆä½¿ç”¨æ¨¡å‹æ¥æ£€æµ‹æ–°é‡‡é›†åˆ°çš„è‚¿ç˜¤ç—…ç¶é€ å½±ï¼Œ åˆ¤æ–­æ˜¯è‰¯æ€§è¿˜æ˜¯æ¶æ€§ã€‚ è¿™ä¸ªæ˜¯å…¸å‹çš„äºŒå…ƒåˆ†ç±»é—®é¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_breast_cancer</span><br><span class="line"></span><br><span class="line">cancer = load_breast_cancer()</span><br><span class="line">X = cancer.data</span><br><span class="line">y = cancer.target</span><br><span class="line"></span><br><span class="line">print(X.shape, y.shape,<span class="string">'\n'</span>, X[<span class="number">0</span>], <span class="string">'\n'</span>, y[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><pre><code>(569, 30) (569,)  [1.799e+01 1.038e+01 1.228e+02 1.001e+03 1.184e-01 2.776e-01 3.001e-01 1.471e-01 2.419e-01 7.871e-02 1.095e+00 9.053e-01 8.589e+00 1.534e+02 6.399e-03 4.904e-02 5.373e-02 1.587e-02 3.003e-02 6.193e-03 2.538e+01 1.733e+01 1.846e+02 2.019e+03 1.622e-01 6.656e-01 7.119e-01 2.654e-01 4.601e-01 1.189e-01]  0</code></pre><p>å®é™…ä¸Šå®ƒåªå…³æ³¨äº† 10 ä¸ªç‰¹å¾ï¼Œç„¶ååˆæ„é€ å‡ºæ¥æ¯ä¸ªç‰¹å¾çš„æ ‡å‡†å·®åŠæœ€å¤§å€¼ï¼Œè¿™æ ·æ¯ä¸ªç‰¹å¾åˆè¡ç”Ÿå‡ºäº†ä¸¤ä¸ªç‰¹å¾ï¼Œæ‰€ä»¥å…±æœ‰30ä¸ªç‰¹å¾ã€‚</p><p>è¿™é‡Œè¯¥æ¡ˆä¾‹ä½¿ç”¨äº†ç‰¹å¾æå–æ‰‹æ®µï¼Œè¿™ä¸€æ–¹æ³•åœ¨å®é™…å·¥ç¨‹åº”ç”¨ä¸­æ˜¯å¾ˆå¸¸ç”¨çš„ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š<br>æˆ‘ä»¬éœ€è¦ç›‘æ§æ•°æ®ä¸­å¿ƒæ¯ä¸ªç‰©ç†ä¸»æœºçš„è¿è¡Œæƒ…å†µï¼Œå…¶ä¸­ CPU å ç”¨ç‡ã€å†…å­˜å ç”¨ç‡ã€ç½‘ç»œååé‡æ˜¯å‡ ä¸ªé‡è¦çš„æŒ‡æ ‡ã€‚ é—®ï¼šæœ‰å°ä¸»æœº CPU å ç”¨ç‡80%ï¼Œ è¿™ä¸ªä¸»æœºçŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Ÿ è¦ä¸è¦å‘è­¦å‘Šï¼Ÿ è¿™ä¸ªè¦çœ‹æƒ…å†µï¼ä»…ä» CPU å ç”¨ç‡æ¥çœ‹è¿˜ä¸èƒ½åˆ¤æ–­ä¸»æœºæ˜¯å¦æ­£å¸¸ï¼Œè¿˜è¦çœ‹å†…å­˜å ç”¨æƒ…å†µå’Œç½‘ç»œååé‡æƒ…å†µã€‚ å¦‚æœæ­¤æ—¶å†…å­˜å ç”¨ä¹Ÿæˆæ¯”ä¾‹ä¸Šå‡ï¼Œ ä¸”ç½‘ç»œååé‡ä¹Ÿåœ¨åˆç†çš„æ°´å¹³ï¼Œé‚£ä¹ˆé€ æˆè¿™ä¸€çŠ¶æ€çš„å¯èƒ½æ˜¯ç”¨æˆ·è®¿é—®é‡è¿‡å¤§ï¼Œ å¯¼è‡´ä¸»æœºè´Ÿè´£å¢åŠ ï¼Œ ä¸éœ€è¦è­¦å‘Šã€‚ ä½†å¦‚æœå†…å­˜å ç”¨ã€ ç½‘ç»œååé‡å’Œ CPU å ç”¨ä¸åœ¨åŒä¸€é‡çº§é‚£ä¹ˆä¸»æœºå°±å¯ä»¥å¤„äºä¸æ­£å¸¸çš„çŠ¶æ€ã€‚ æ‰€ä»¥è¿™é‡Œéœ€è¦æ„å»ºä¸€ä¸ªå¤åˆç‰¹å¾ï¼Œ å¦‚ CPU å ç”¨ç‡å’Œå†…å­˜å ç”¨ç‡çš„æ¯”å€¼ï¼Œ ä»¥åŠ CPU å ç”¨ç‡å’Œç½‘ç»œååé‡çš„å€¼ï¼Œ è¿™æ ·æ„é€ å‡ºæ¥çš„ç‰¹å¾æ›´çœŸå®åœ°ä½“ç°äº†ç°å®é—®é¢˜ä¸­çš„å†…åœ¨è§„åˆ™ã€‚ </p><p>æ‰€ä»¥ï¼š <strong>æå–ç‰¹å¾æ—¶ï¼Œä¸å¦¨ä»äº‹ç‰©å†…åœ¨é€»è¾‘å…³ç³»å…¥æ‰‹ï¼Œåˆ†æå·²æœ‰ç‰¹å¾ä¹‹é—´çš„å…³ç³»ï¼Œ ä»äºŒæ„é€ å‡ºæ–°çš„ç‰¹å¾</strong></p><p>ç–‘é—®ï¼š è¯¥æ–¹å¼æ˜¯å¦ç›´æ¥ä¼šå¯¼è‡´å¤šé‡å…±çº¿æ€§çš„å‡ºç°ï¼Ÿ</p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"></span><br><span class="line">model = LogisticRegression()</span><br><span class="line">model.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">train_score = model.score(X_train, y_train)</span><br><span class="line">test_score = model.score(X_test, y_test)</span><br><span class="line">y_pred = model.predict(X_test)</span><br><span class="line">print(<span class="string">"train_score:"</span>, train_score)</span><br><span class="line">print(<span class="string">"test_score:"</span>, test_score)</span><br></pre></td></tr></table></figure><pre><code>train_score: 0.9626373626373627test_score: 0.9473684210526315</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> precision_score, recall_score, f1_score</span><br><span class="line">print(<span class="string">"æŸ¥å‡†ç‡ï¼š"</span>, precision_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"å¬å›ç‡ï¼š"</span>, recall_score(y_test, y_pred))</span><br><span class="line">print(<span class="string">"F1Scoreï¼š"</span>, f1_score(y_test, y_pred))</span><br><span class="line"></span><br><span class="line">print(np.equal(y_pred, y_test).shape[<span class="number">0</span>], y_test.shape[<span class="number">0</span>]) <span class="comment"># è¾“å‡ºé¢„æµ‹åŒ¹é…æˆåŠŸæ•°é‡å’Œæµ‹è¯•æ ·æœ¬çš„æ•°é‡</span></span><br></pre></td></tr></table></figure><pre><code>æŸ¥å‡†ç‡ï¼š 0.9358974358974359å¬å›ç‡ï¼š 0.9733333333333334F1Scoreï¼š 0.954248366013072114 114</code></pre><p>è¿™é‡Œæ•°é‡ä¸Šæ˜¾ç¤ºå…¨éƒ¨éƒ½é¢„æµ‹æ­£ç¡®ï¼Œè€Œtest_scoreå´ä¸æ˜¯1ï¼Œæ˜¯å› ä¸ºsklearnä¸æ˜¯ä½¿ç”¨è¿™ä¸ªæ•°æ®æ¥è®¡ç®—å¾—åˆ†ï¼Œå› ä¸ºè¿™ä¸ªæ•°æ®ä¸èƒ½å®Œå…¨åæ˜ è¯¯å·®æƒ…å†µï¼Œè€Œæ˜¯ä½¿ç”¨é¢„æµ‹æ¦‚ç‡æ¥è®¡ç®—æ¨¡å‹å¾—åˆ†ã€‚</p><p><em>é‚£ä¹ˆæŸ¥å‡†ç‡å’Œå¬å›ç‡æ˜¯å¦åŒç†ï¼Ÿ</em></p><h3 id="æŸ¥çœ‹é¢„æµ‹è‡ªä¿¡åº¦"><a href="#æŸ¥çœ‹é¢„æµ‹è‡ªä¿¡åº¦" class="headerlink" title="æŸ¥çœ‹é¢„æµ‹è‡ªä¿¡åº¦"></a>æŸ¥çœ‹é¢„æµ‹è‡ªä¿¡åº¦</h3><p>äºŒå…ƒåˆ†ç±»æ¨¡å‹ä¼šé’ˆå¯¹æ¯ä¸ªæ ·æœ¬è¾“å‡ºçš„ä¸¤ä¸ªæ¦‚ç‡ï¼Œå³0å’Œ1çš„æ¦‚ç‡ï¼Œå“ªä¸ªæ¦‚ç‡é«˜å°±é¢„æµ‹å™¨å“ªä¸ªç±»åˆ«ã€‚æˆ‘ä»¬å¯ä»¥æ‰¾å‡ºé’ˆå¯¹æµ‹è¯•æ•°æ®é›†ï¼Œæ¨¡å‹é¢„æµ‹çš„â€œè‡ªä¿¡åº¦â€ä½äº90%çš„æ ·æœ¬ã€‚æˆ‘ä»¬å…ˆè®¡ç®—å‡ºæµ‹è¯•æ•°æ®é›†é‡Œæ¯ä¸ªæ ·æœ¬çš„é¢„æµ‹æ¦‚ç‡æ•°æ®ï¼Œé’ˆå¯¹æ¯ä¸ªæ ·æœ¬ä¼šæœ‰ä¸¤ä¸ªæ•°æ®ï¼šä¸€ä¸ªé¢„æµ‹ä¸º0ï¼Œä¸€ä¸ªé¢„æµ‹ä¸º1ã€‚ç»“åˆæ‰¾å‡ºé¢„æµ‹ä¸ºé˜´æ€§å’Œé˜³æ€§çš„æ¦‚ç‡å¤§äº0.1çš„æ ·æœ¬ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹æ¦‚ç‡æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—æ¯ä¸ªæµ‹è¯•æ ·æœ¬çš„é¢„æµ‹æ¦‚ç‡ï¼š</span></span><br><span class="line">y_pred_proba = model.predict_proba(X_test)</span><br><span class="line">print(<span class="string">"è‡ªä¿¡åº¦ç¤ºä¾‹ï¼š"</span>,y_pred_proba[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><pre><code>è‡ªä¿¡åº¦ç¤ºä¾‹ï¼š [0.00452578 0.99547422]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">y_pred_proba_0 = y_pred_proba[:, <span class="number">0</span>] &gt; <span class="number">0.1</span></span><br><span class="line">result = y_pred_proba[y_pred_proba_0]</span><br><span class="line"></span><br><span class="line">y_pred_proba_1 = result[:, <span class="number">1</span>] &gt; <span class="number">0.1</span></span><br><span class="line">print(result[y_pred_proba_1])</span><br></pre></td></tr></table></figure><pre><code>[[0.11338788 0.88661212] [0.18245824 0.81754176] [0.13110396 0.86889604] [0.35245276 0.64754724] [0.30664405 0.69335595] [0.24931118 0.75068882] [0.8350464  0.1649536 ] [0.44807883 0.55192117] [0.74071324 0.25928676] [0.43085792 0.56914208] [0.13388416 0.86611584] [0.33507985 0.66492015] [0.53672412 0.46327588] [0.11422612 0.88577388] [0.42946531 0.57053469] [0.69759146 0.30240854] [0.25982004 0.74017996] [0.12179042 0.87820958] [0.88546887 0.11453113]]</code></pre><h3 id="æ¨¡å‹ä¼˜åŒ–"><a href="#æ¨¡å‹ä¼˜åŒ–" class="headerlink" title="æ¨¡å‹ä¼˜åŒ–"></a>æ¨¡å‹ä¼˜åŒ–</h3><p>è¿™é‡Œä½¿ç”¨Pipelineæ¥å¢åŠ å¤šé¡¹å¼ç‰¹å¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> PolynomialFeatures</span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poly_model</span><span class="params">(degree=<span class="number">2</span>, penalty=penalty)</span>:</span></span><br><span class="line">    poly_features = PolynomialFeatures(degree=degree, include_bias=<span class="keyword">False</span>)</span><br><span class="line">    log_regr = LogisticRegression(penalty=penalty) <span class="comment"># æ³¨æ„è¿™é‡Œæ˜¯L1è€Œä¸æ˜¯11ï¼ŒæŒ‡çš„æ˜¯ä½¿ç”¨L1èŒƒå¼ä½œä¸ºå…¶æ­£åˆ™é¡¹</span></span><br><span class="line">    pipeline = Pipeline([(<span class="string">"poly_features"</span>,poly_features),(<span class="string">"log_regr"</span>,log_regr)])</span><br><span class="line">    <span class="keyword">return</span> pipeline</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¥ç€å¢åŠ äºŒé˜¶å¤šé¡¹å¼ç‰¹å¾ï¼Œåˆ›å»ºå¹¶è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">model = poly_model(degree=<span class="number">2</span>, penalty=<span class="string">'l1'</span>)</span><br><span class="line"></span><br><span class="line">start = time.clock()</span><br><span class="line">model.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"train_score:"</span>,model.score(X_train, y_train))</span><br><span class="line">print(<span class="string">"test_score:"</span>,model.score(X_test, y_test))</span><br></pre></td></tr></table></figure><pre><code>train_score: 0.9934065934065934test_score: 0.9649122807017544</code></pre><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ä½¿ç”¨L1èŒƒå¼ä½œä¸ºå…¶æ­£åˆ™é¡¹ï¼Œå‚æ•°ä¸º<code>penalty=l1</code>ã€‚L1èŒƒæ•°ä½œä¸ºå…¶æ­£åˆ™é¡¹ï¼Œå¯ä»¥å®ç°å‚æ•°çš„ç¨€ç–åŒ–ï¼Œå³è‡ªåŠ¨å¸®æˆ‘ä¹°é€‰æ‹©å‡ºå“ªäº›å¯¹æ¨¡å‹æœ‰å…³è”çš„ç‰¹å¾ã€‚æˆ‘ä¹°å¯ä»¥è§‚å¯Ÿä¸‹æœ‰å¤šå°‘ä¸ªç‰¹å¾æ²¡æœ‰è¢«ä¸¢å¼ƒå³å¯¹åº”çš„æ¨¡å‹å‚æ•°$\theta_j$é0ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">log_regr = model.named_steps[<span class="string">'log_regr'</span>]</span><br><span class="line">print(<span class="string">"ç‰¹å¾æ€»é‡ï¼š"</span>,log_regr.coef_.shape[<span class="number">1</span>])</span><br><span class="line">print(<span class="string">"ç‰¹å¾ä¿ç•™é‡ï¼š"</span>, np.count_nonzero(log_regr.coef_))</span><br></pre></td></tr></table></figure><pre><code>ç‰¹å¾æ€»é‡ï¼š 495ç‰¹å¾ä¿ç•™é‡ï¼š 114</code></pre><p>é€»è¾‘å›å½’æ¨¡å‹çš„<code>coef_</code>å±æ€§é‡Œä¿å­˜çš„å°±æ˜¯æ¨¡å‹å‚æ•°ã€‚ ä»è¾“å‡ºç»“æœçœ‹ï¼Œå¢åŠ äºŒé˜¶å¤šé¡¹å¼ç‰¹å¾åï¼Œè¾“å…¥ç‰¹å¾ç”±åŸæ¥çš„30ä¸ªå¢åŠ åˆ°äº†595ä¸ªï¼Œåœ¨L1èŒƒæ•°çš„â€œæƒ©ç½šâ€ä¸‹æœ€ç»ˆåªä¿ç•™äº†92ä¸ªæœ‰æ•ˆç‰¹å¾</p><h3 id="å®éªŒï¼šåˆ©ç”¨å†³ç­–æ ‘ç”»å‡ºåŸå§‹æ•°æ®å¯¹é¢„æµ‹ç›¸å…³æ€§é0å¯¹ç‰¹å¾"><a href="#å®éªŒï¼šåˆ©ç”¨å†³ç­–æ ‘ç”»å‡ºåŸå§‹æ•°æ®å¯¹é¢„æµ‹ç›¸å…³æ€§é0å¯¹ç‰¹å¾" class="headerlink" title="å®éªŒï¼šåˆ©ç”¨å†³ç­–æ ‘ç”»å‡ºåŸå§‹æ•°æ®å¯¹é¢„æµ‹ç›¸å…³æ€§é0å¯¹ç‰¹å¾"></a>å®éªŒï¼šåˆ©ç”¨å†³ç­–æ ‘ç”»å‡ºåŸå§‹æ•°æ®å¯¹é¢„æµ‹ç›¸å…³æ€§é0å¯¹ç‰¹å¾</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeRegressor</span><br><span class="line">dtmodel = DecisionTreeRegressor(max_depth=<span class="number">5</span>)</span><br><span class="line">dtmodel.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">"train_score"</span>, dtmodel.score(X_train, y_train))</span><br><span class="line">print(<span class="string">"test_score"</span>, dtmodel.score(X_test, y_test))</span><br><span class="line"><span class="keyword">from</span> pyecharts <span class="keyword">import</span> Bar</span><br><span class="line">index = np.nonzero(dtmodel.feature_importances_)</span><br><span class="line">bar = Bar()</span><br><span class="line">bar.add(<span class="string">""</span>, cancer.feature_names[index],dtmodel.feature_importances_[index])</span><br><span class="line">bar</span><br></pre></td></tr></table></figure><pre><code>train_score 0.9910875596851206test_score 0.6296416546416548</code></pre><p><img src="/images/sklearn/10.png" alt="png"></p><h3 id="è¯„ä¼°æ¨¡å‹ï¼šç”»å‡ºå­¦ä¹ æ›²çº¿"><a href="#è¯„ä¼°æ¨¡å‹ï¼šç”»å‡ºå­¦ä¹ æ›²çº¿" class="headerlink" title="è¯„ä¼°æ¨¡å‹ï¼šç”»å‡ºå­¦ä¹ æ›²çº¿"></a>è¯„ä¼°æ¨¡å‹ï¼šç”»å‡ºå­¦ä¹ æ›²çº¿</h3><p>é¦–å…ˆç”»å‡ºL1èŒƒæ•°ä½œä¸ºæ­£åˆ™é¡¹æ‰€å¯¹åº”çš„ä¸€é˜¶å’ŒäºŒé˜¶å¤šé¡¹å¼çš„å­¦ä¹ æ›²çº¿ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> learning_curve</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> ShuffleSplit</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_learn_curve</span><span class="params">(estimator, title, X, y, ylim = None, cv=None, n_jobs=<span class="number">1</span>, train_sizes=np.linspace<span class="params">(<span class="number">.1</span>, <span class="number">1.</span>, <span class="number">5</span>)</span>)</span>:</span></span><br><span class="line">    plt.title(title)</span><br><span class="line">    <span class="keyword">if</span> ylim <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        plt.ylim(*ylim)</span><br><span class="line">    plt.xlabel(<span class="string">"train exs"</span>)</span><br><span class="line">    plt.ylabel(<span class="string">"Score"</span>)</span><br><span class="line">    train_sizes, train_scores, test_scores = learning_curve(</span><br><span class="line">        estimator, X, y, cv=cv, n_jobs=n_jobs, train_sizes=train_sizes)</span><br><span class="line">    train_score_mean = np.mean(train_scores, axis=<span class="number">1</span>)</span><br><span class="line">    train_score_std = np.std(train_scores, axis=<span class="number">1</span>)</span><br><span class="line">    test_score_mean = np.mean(test_scores, axis=<span class="number">1</span>)</span><br><span class="line">    test_score_std = np.std(test_scores, axis=<span class="number">1</span>)</span><br><span class="line">    plt.grid()</span><br><span class="line">    </span><br><span class="line">    plt.fill_between(train_sizes, train_score_mean - train_score_std, </span><br><span class="line">                     train_score_mean + train_score_std, alpha=<span class="number">0.1</span>, color=<span class="string">'r'</span>)</span><br><span class="line">    plt.fill_between(train_sizes, test_score_mean - test_score_std, </span><br><span class="line">                     test_score_mean + test_score_std, alpha=<span class="number">0.1</span>, color=<span class="string">'g'</span>)</span><br><span class="line">    plt.plot(train_sizes, train_score_mean, <span class="string">'o-'</span>, color=<span class="string">'r'</span>, label=<span class="string">'train scoreè®­ç»ƒå¾—åˆ†'</span>)</span><br><span class="line">    plt.plot(train_sizes, test_score_mean, <span class="string">'o-'</span>, color=<span class="string">'g'</span>, label=<span class="string">'cross-validation scoreäº¤å‰éªŒè¯å¾—åˆ†'</span>)</span><br><span class="line">    </span><br><span class="line">    plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">    <span class="keyword">return</span> plt</span><br></pre></td></tr></table></figure></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cv = ShuffleSplit(n_splits=<span class="number">10</span>, test_size=<span class="number">0.2</span>, random_state=<span class="number">0</span>)</span><br><span class="line">titles = [<span class="string">"degree:1 penalty=L1"</span>,<span class="string">"degree:2 penalty=L1"</span>]</span><br><span class="line">degrees = [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">penalty = <span class="string">'l1'</span></span><br><span class="line"></span><br><span class="line">start = time.clock()</span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>), dpi=<span class="number">120</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(degrees)):</span><br><span class="line">    plt.subplot(<span class="number">1</span>, len(degrees), i + <span class="number">1</span>)</span><br><span class="line">    plot_learn_curve(poly_model(degree=degrees[i], penalty=penalty), titles[i],</span><br><span class="line">                    X, y, ylim = (<span class="number">0.8</span>, <span class="number">1.01</span>), cv = cv)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'è€—æ—¶ï¼š'</span>, time.clock() - start)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="/images/sklearn/11.png" alt="png"></p><p>L2èŒƒæ•°ä½œä¸ºæ­£åˆ™é¡¹ç”»å‡ºå¯¹åº”ä¸€é˜¶å’ŒäºŒé˜¶å¤šé¡¹å¼å­¦ä¹ æ›²çº¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">cv = ShuffleSplit(n_splits=<span class="number">10</span>, test_size=<span class="number">0.2</span>, random_state=<span class="number">0</span>)</span><br><span class="line">titles = [<span class="string">"degree:1 penalty=L2"</span>,<span class="string">"degree:2 penalty=L2"</span>]</span><br><span class="line">degrees = [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">penalty = <span class="string">'l2'</span></span><br><span class="line"></span><br><span class="line">start = time.clock()</span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>), dpi=<span class="number">120</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(degrees)):</span><br><span class="line">    plt.subplot(<span class="number">1</span>, len(degrees), i + <span class="number">1</span>)</span><br><span class="line">    plot_learn_curve(poly_model(degree=degrees[i],penalty=penalty), titles[i],</span><br><span class="line">                    X, y, ylim = (<span class="number">0.8</span>, <span class="number">1.01</span>), cv = cv)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'è€—æ—¶ï¼š'</span>, time.clock() - start)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="/images/sklearn/12.png" alt="png"></p><p>ä»ä¸Šé¢ä¸¤ä¸ªå›¾å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨äºŒé˜¶å¤šé¡¹å¼å¹¶ä½¿ç”¨L1èŒƒæ•°ä½œä¸ºæ­£åˆ™é¡¹çš„æ¨¡å‹æœ€ä¼˜ï¼Œè®­ç»ƒæ ·æœ¬è¯„åˆ†æœ€é«˜ï¼Œäº¤å‰éªŒè¯æ ·æœ¬è¯„åˆ†æœ€é«˜ã€‚<br>è®­ç»ƒæ ·æœ¬è¯„åˆ†å’Œäº¤å‰éªŒè¯æ ·æœ¬è¯„åˆ†ä¹‹é—´çš„é—´éš™è¿˜æ¯”è¾ƒå¤§ï¼Œè¿™è¯´æ˜å¯ä»¥é€šè¿‡é‡‡é›†æ›´å¤šæ•°æ®æ¥è®­ç»ƒæ¨¡å‹ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥ä¼˜åŒ–æ¨¡å‹.</p><p>é€šè¿‡æ—¶é—´æ¶ˆè€—å¯¹æ¯”ä¸Šå¯ä»¥çœ‹å‡ºåˆ©ç”¨L1èŒƒå¼ä½œä¸ºæ­£åˆ™é¡¹éœ€è¦èŠ±è´¹çš„æ—¶é—´æ›´å¤šï¼Œæ˜¯å› ä¸º<code>sklearn</code>çš„<code>learning_curve()</code>å‡½æ•°åœ¨ç”»å­¦ä¹ æ›²çº¿çš„è¿‡ç¨‹ä¸­è¦å¯¹æ¨¡å‹è¿›è¡Œå¤šæ¬¡è®­ç»ƒï¼Œå¹¶è®¡ç®—äº¤å‰éªŒè¯æ ·æœ¬è¯„åˆ†ã€‚åŒæ—¶ä¸ºäº†è®©æ›²çº¿æ›´å¹³æ»‘ï¼Œé’ˆå¯¹æ¯ä¸ªç‚¹è¿˜ä¼šè¿›è¡Œå¤šæ¬¡è®¡ç®—çƒå¹³å‡å€¼ã€‚è¿™ä¸ªå°±æ˜¯<code>ShufferSplit</code>ç±»çš„ä½œç”¨ã€‚åœ¨è¿™ä¸ªå®ä¾‹é‡Œåªæœ‰569ä¸ªæ ·æœ¬æ˜¯å¾ˆå°çš„æ•°æ®é›†ã€‚å¦‚æœæ•°æ®é›†å¢åŠ 100å€ï¼Œæ‹¿å‡ºæ¥ç”»å­¦ä¹ æ›²çº¿å°†æ˜¯åœºç¾éš¾ã€‚</p><p>é—®é¢˜æ˜¯é’ˆå¯¹å¤§æ•°æ®é›†ï¼Œæ€ä¹ˆç”»å­¦ä¹ æ›²çº¿ï¼Ÿ</p><p>æ€è·¯ä¸€ï¼šå¯ä»¥è€ƒè™‘ä»å¤§æ•°æ®é›†é€‰å–ä¸€å°éƒ¨åˆ†æ•°æ®æ¥ç”»å­¦ä¹ æ›²çº¿ï¼Œå¾…é€‰æ‹©å¥½æœ€ä¼˜çš„æ¨¡å‹ä¹‹åï¼Œåœ¨ä½¿ç”¨å…¨éƒ¨çš„æ•°æ®æ¥è®­ç»ƒæ¨¡å‹ã€‚è¿™æ—¶éœ€è¦è­¦æƒ•çš„æ˜¯ï¼Œå°½é‡ä¿è¯é€‰æ‹©å‡ºæ¥çš„è¿™éƒ¨åˆ†æ•°æ®çš„<strong>æ ‡ç­¾åˆ†å¸ƒä¸å¤§æ•°æ®é›†çš„æ ‡ç­¾åˆ†å¸ƒç›¸åŒ</strong>ï¼Œå¦‚é’ˆå¯¹äºŒå…ƒåˆ†ç±»ï¼Œ<strong>é˜³æ€§å’Œé˜´æ€§æ¯”ä¾‹è¦ä¸€è‡´ï¼</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç®—æ³•åŸç†&quot;&gt;&lt;a href=&quot;#ç®—æ³•åŸç†&quot; class=&quot;headerlink&quot; title=&quot;ç®—æ³•åŸç†&quot;&gt;&lt;/a&gt;ç®—æ³•åŸç†&lt;/h2&gt;&lt;h3 id=&quot;é€»è¾‘å›å½’ç®—æ³•çš„é¢„æµ‹å‡½æ•°&quot;&gt;&lt;a href=&quot;#é€»è¾‘å›å½’ç®—æ³•çš„é¢„æµ‹å‡½æ•°&quot; class=&quot;headerlink&quot; ti
      
    
    </summary>
    
      <category term="Machine learning" scheme="http://www.ihoge.cn/categories/Machine-learning/"/>
    
    
      <category term="scikit-learn" scheme="http://www.ihoge.cn/tags/scikit-learn/"/>
    
  </entry>
  
  <entry>
    <title>github åˆ›å»ºåˆ†æ”¯ä½ä½œä¸ºäº‘ç«¯å¤‡ä»½è§£å†³hexoåšå®¢å¤šPCé—´åŒæ­¥çš„é—®é¢˜</title>
    <link href="http://www.ihoge.cn/2018/githubhexos.html"/>
    <id>http://www.ihoge.cn/2018/githubhexos.html</id>
    <published>2018-04-05T09:05:59.000Z</published>
    <updated>2018-04-06T17:31:08.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h2><p>1ã€è¿™é‡Œéœ€è¦åˆ é™¤nextç›®å½•åŠæ ¹ç›®å½•ä¸‹çš„<code>.git</code>,ï¼ˆæˆ–è€…ä¿®æ”¹æ·»åŠ ä½ ä¸éœ€è¦ä¸Šä¼ åˆ°è¿œç¨‹çš„éƒ¨åˆ†ï¼‰åŒæ—¶åˆ é™¤bolgæ ¹ç›®å½•ä¸‹çš„<code>.gitignore</code>ã€‚è¿™é‡Œæˆ‘é€‰æ‹©åœ¨ä¸»ç›®å½•åšäº†å¤‡ä»½ã€‚</p><p>2ã€ç°åœ¨å›åˆ°bolgæ ¹ç›®å½•åˆ†åˆ«æ‰§è¡Œï¼š</p><ul><li><code>git init</code>  åˆå§‹åŒ–æœ¬åœ°ä»“åº“</li><li><code>git checkout -b hexo</code> åˆ›å»ºå¹¶åˆ‡æ¢hexoåˆ†æ”¯</li><li><code>git remote add origin https://github.com/hooog/hooog.github.io.git</code>ç»™hexoåˆ†æ”¯å…³è”è¿œç¨‹æ˜ å°„</li><li><code>git add .</code>  æ·»åŠ blogç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œæ³¨æ„æœ‰ä¸ª<code>.</code>ï¼ˆ<code>.gitignore</code>å£°æ˜è¿‡çš„æ–‡ä»¶ä¸åŒ…å«åœ¨å†…)</li><li><code>git commit -m &#39;æ·»åŠ æè¿°&#39;</code></li><li><code>git push origin hexo</code> å°†hexoåˆ†æ”¯ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“ </li><li>å¦‚æœåŠ é”™äº†çš„è¯æ‰§è¡Œ<code>git rm -r --cached .</code><br>åˆ°è¿™é‡Œï¼Œäº‘ç«¯å¤‡ä»½å°±å®Œæˆäº†ã€‚<br>åŒç†ä¹Ÿå¯ä»¥æŠŠåˆ†æ”¯å¤‡ä»½åˆ°<code>Coding</code>çš„ç§å¯†ä»“åº“ä¸Šã€‚ï¼ˆå¦‚æœæºä»£ç æ¶‰åŠä¿å¯†ä¿¡æ¯çš„è¯ï¼‰</li></ul><p>3ã€å°†è¿œç¨‹ä»“åº“çš„å†…å®¹æ‹·è´åˆ°æ–°<code>PC</code>ç«¯ç«¯æœ¬åœ°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin https://github.com/hooog/hooog.github.io.git</span><br><span class="line">git fetch --all</span><br><span class="line">git reset --hard origin/master</span><br></pre></td></tr></table></figure></p><p><code>fetch</code>æ˜¯å°†äº‘ç«¯æ‰€æœ‰å†…å®¹æ‹‰å–ä¸‹æ¥ã€‚<code>reset</code>åˆ™æ˜¯ä¸åšä»»ä½•åˆå¹¶å¤„ç†ï¼Œå¼ºåˆ¶å°†æœ¬åœ°å†…å®¹æŒ‡å‘åˆšåˆšåŒæ­¥ä¸‹æ¥çš„äº‘ç«¯å†…å®¹ï¼ˆæ­£å¸¸pullçš„è¯éœ€è¦è€ƒè™‘ä¸å°‘å†²çªçš„é—®é¢˜ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚ï¼‰</p><p>4ã€æ›´æ–°æ–‡ç« åçš„åŒæ­¥æ“ä½œï¼š<br>å‡è®¾åœ¨Bç”µè„‘å†™å®Œäº†æ–‡ç« ï¼Œä¹Ÿ<code>hexo d -g</code>å‘å¸ƒæˆåŠŸï¼Œè¿™æ—¶å€™éœ€è¦å°†æ–°æ–‡ç« çš„mdæ–‡ä»¶æ›´æ–°ä¸Šå»ã€‚</p><p><code>git add .</code></p><p>è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>git status</code>æŸ¥çœ‹ä¸‹çŠ¶æ€ï¼Œä¸€èˆ¬åªæ˜¾ç¤ºåˆšåˆšæ›´æ”¹è¿‡çš„æ–‡ä»¶çŠ¶æ€ã€‚</p><p>ç„¶åæ‰§è¡Œï¼š<br><code>git commit -m &quot;æ›´æ–°ä¿¡æ¯&quot;</code><br><code>git push origin hexo</code></p><p>åœ¨å›åˆ°Aç”µè„‘ä¸Šçš„æ—¶å€™ï¼Œåªéœ€è¦<br><code>git pull</code><br>å³å¯åŒæ­¥æ›´æ–°</p><p>5ã€æ—¥å¸¸æ”¹åŠ¨<br>å¹³æ—¶æˆ‘ä»¬å¯¹æºæ–‡ä»¶æœ‰ä¿®æ”¹çš„æ—¶å€™è®°å¾—å…ˆpullä¸€éä»£ç ï¼Œå†å°†ä»£ç pushåˆ°Hexoåˆ†æ”¯ï¼Œå°±å’Œæ—¥å¸¸çš„ä½¿ç”¨gitä¸€æ ·~<br>ä¾æ¬¡æ‰§è¡Œï¼š<br><code>git add .</code><br><code>git commit -m â€œâ€¦â€</code><br><code>git push origin hexo</code>æŒ‡ä»¤å°†æ”¹åŠ¨æ¨é€åˆ°GitHubï¼ˆæ­¤æ—¶å½“å‰åˆ†æ”¯åº”ä¸ºhexoï¼‰ï¼›ç„¶åæ‰§è¡Œï¼š<br><code>hexo g -d</code>å‘å¸ƒç½‘ç«™åˆ°masteråˆ†æ”¯ä¸Šã€‚</p><h2 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h2><p>æŠŠHexoçš„æºç å¤‡ä»½åˆ°Githubåˆ†æ”¯é‡Œé¢ï¼Œæ€è·¯å°±æ˜¯ä¸Šä¼ åˆ°åˆ†æ”¯é‡Œå­˜å‚¨ï¼Œä¿®æ”¹æœ¬åœ°çš„æ—¶å€™å…ˆä¸Šä¼ å­˜å‚¨ï¼Œå†å‘å¸ƒã€‚æ›´æ¢ç”µè„‘çš„æ—¶å€™å†ä¸‹è½½ä¸‹æ¥æºæ–‡ä»¶</p><p>æ‰“å¼€git-bash<br><code>git init</code><br><code>git remote add origin git@github.com:username/username.github.io.git</code><br><code>git add .</code><br><code>git commit -m &quot;blog&quot;</code><br><code>git push origin master:hexo</code></p><p>ç°åœ¨ä½ ä¼šå‘ç°githubä½ çš„åšå®¢ä»“åº“å·²ç»æœ‰äº†ä¸€ä¸ªæ–°åˆ†æ”¯<code>hexo</code>ï¼Œæˆ‘ä»¬çš„å¤‡ä»½å·¥ä½œå®Œæˆã€‚åç»­ä»¥åï¼Œæœ¬åœ°å†™å¥½åšæ–‡ä¹‹åï¼Œå¯ä»¥å…ˆæ‰§è¡Œ<br><code>git add .</code><br><code>git commit -m &quot;blog&quot;</code><br><code>git push origin master:hexo</code>è¿›è¡Œå¤‡ä»½ï¼Œç„¶å<br><code>hexo d -g</code>è¿›è¡Œæ›´æ–°é™æ€æ–‡ä»¶ã€‚è¿™é‡Œæ¨èå…ˆè¿›è¡Œå¤‡ä»½ï¼Œå› ä¸ºä¸‡ä¸€æ›´æ–°ç½‘ç«™ä¹‹åä¸å°å¿ƒä¸¢å¤±äº†æºæ–‡ä»¶ï¼Œå°±åˆå¾—é‡æ–°å†æ¥äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;æ–¹å¼ä¸€&quot;&gt;&lt;a href=&quot;#æ–¹å¼ä¸€&quot; class=&quot;headerlink&quot; title=&quot;æ–¹å¼ä¸€&quot;&gt;&lt;/a&gt;æ–¹å¼ä¸€&lt;/h2&gt;&lt;p&gt;1ã€è¿™é‡Œéœ€è¦åˆ é™¤nextç›®å½•åŠæ ¹ç›®å½•ä¸‹çš„&lt;code&gt;.git&lt;/code&gt;,ï¼ˆæˆ–è€…ä¿®æ”¹æ·»åŠ ä½ ä¸éœ€
      
    
    </summary>
    
      <category term="Hexo" scheme="http://www.ihoge.cn/categories/Hexo/"/>
    
    
      <category term="Github" scheme="http://www.ihoge.cn/tags/Github/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Githubå’ŒCodingå…±åŒæ‰˜ç®¡hexoåšå®¢è§£å†³æ— æ³•è¢«ç™¾åº¦æ”¶å½•çš„é—®é¢˜</title>
    <link href="http://www.ihoge.cn/2018/githubhexocodingbaidu.html"/>
    <id>http://www.ihoge.cn/2018/githubhexocodingbaidu.html</id>
    <published>2018-04-05T05:05:59.000Z</published>
    <updated>2018-04-06T17:31:08.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>1ã€ä¹‹å‰åœ¨é˜¿é‡Œäº‘æ³¨å†Œçš„<code>.top</code>åŸŸåä¸€ç›´ä¸å—ç™¾åº¦å¾…è§ï¼Œé‚é‡æ–°ç”³è¯·äº†<code>.cn</code>åŸŸåã€‚æ›´æ¢åŸŸåå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>åœ¨æ–°ç”³è¯·çš„åŸŸåä¸‹æ·»åŠ åŸŸåè§£æï¼šä¸»æœºè®°å½•æ·»åŠ <code>@</code>å’Œ<code>www</code>ä¸¤ç§<br><img src="/images/hexo/1.png" alt="png"></li><li>ä¿®æ”¹<code>CNAME</code>æ–‡ä»¶å†™å…¥æ–°åŸŸå<code>www.ihoge.cn</code></li><li>åœ¨<code>Github Pages</code>ä¸­æ›´æ–°æ–°åŸŸåå¹¶<code>save</code></li></ul><p>2ã€æ›´æ¢åŸŸåå‘ç°ä»ä¸èƒ½è¢«æ”¶å½•ï¼ŒåŸå› æ˜¯<code>Github</code>å«Œå¼ƒç™¾åº¦èœ˜è››çˆ¬å–å¤ªé¢‘ç¹ï¼Œå±è”½äº†ç™¾åº¦ã€‚ä½œä¸ºå›½å†…çš„å°ä¼™ä¼´æ— éæ˜¯ä¸€ç§å¾ˆéº»çƒ¦çš„äº‹ã€‚è¿™é‡Œæˆ‘é€‰æ‹©ç”¨<code>Coding</code>å’Œ<code>Github</code>åŒçº¿æ‰˜ç®¡ï¼Œé»˜è®¤è§£æåˆ°<code>Github</code>,å¹¶ç»™ç™¾åº¦è®¾ç½®ä¸“çº¿è§£æåˆ°<code>Coding</code></p><p>3ã€ä½¿ç”¨<code>Coding</code>ä½œä¸º<code>hexo</code>åšå®¢çš„ç¬¬äºŒæ‰˜ç®¡å¹³å°ã€‚</p><ul><li>ç™»é™†<a href="https://coding.netå¹¶æ³¨å†Œè´¦æˆ·ï¼Œè¿™é‡Œéœ€è¦ç®€å•çš„æ“ä½œå…è´¹å‡çº§ä¸‹è´¦æˆ·æ‰èƒ½ä½¿ç”¨`Coding`çš„`Pages`æœåŠ¡ã€‚" target="_blank" rel="noopener">https://coding.netå¹¶æ³¨å†Œè´¦æˆ·ï¼Œè¿™é‡Œéœ€è¦ç®€å•çš„æ“ä½œå…è´¹å‡çº§ä¸‹è´¦æˆ·æ‰èƒ½ä½¿ç”¨`Coding`çš„`Pages`æœåŠ¡ã€‚</a></li><li>åœ¨<code>Coding</code>ä¸Šæ–°å»ºé¡¹ç›®<code>bolg</code></li><li>å°†<code>hexo</code>åšå®¢åŒæ­¥åˆ°æ–°åˆ›å»ºçš„ä»“åº“ä¸­<ul><li>ç¬¬ä¸€æ¬¡ä½¿ç”¨<code>Coding</code>éœ€è¦ä½¿ç”¨<code>ssh</code>ï¼Œæ–¹æ³•å’Œ<code>Github</code>ä¸Šä¸€æ ·</li><li>æŒ‰ç…§å®˜æ–¹æ ¼å¼ä¿®æ”¹æœ¬åœ°<code>hexo</code>æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶<br><img src="/images/hexo/2.png" alt="png"></li></ul></li><li>å®Œæˆä¹‹ååœ¨<code>hexo</code>çš„æ ¹ç›®å½•è¾“å…¥ï¼š<br><code>ssh -T git@git.coding.net</code></li><li>ä¸Šä¸€æ­¥æ‰§è¡Œæ²¡æœ‰æŠ¥é”™å°±è¯´æ˜æˆåŠŸäº†ã€‚ç„¶åé‡æ–°éƒ¨ç½²å°±å¯ä»¥å°†ä»£ç åŒæ—¶ä¸Šä¼ åˆ°<code>Github</code>å’Œ<code>Coding</code>ä¸Šäº†ã€‚</li></ul><p>4ã€è®¾ç½®<code>Coding</code>çš„<code>Pages</code>æœåŠ¡</p><ul><li>éƒ¨ç½²æ¥æºé€‰æ‹©masteråˆ†æ”¯</li><li>ç»‘å®šè´­ä¹°çš„åŸŸå</li><li><p>æ”¾ç½®<code>Hosted by Coding Pages</code>æ–‡å­—ç‰ˆåˆ°é¦–é¡µæäº¤å®¡æ ¸ï¼ˆæ–¹ä¾¿åé¢çš„seoä¼˜åŒ–ï¼‰æ–¹æ³•æ˜¯æ‰¾åˆ°<code>themes\next\layout\_partials\footer.swig</code>æ·»åŠ ä»£ç å¦‚ä¸‹ï¼š<br><img src="/images/hexo/5.png" alt="png"></p></li><li><p>è¿™é‡Œè¦æ³¨æ„ä¸Šä¼ çš„<code>CNAME</code>æ–‡ä»¶ï¼Œä¸Šé¢å¡«å…¥è´­ä¹°çš„åŸŸå</p></li></ul><p>5ã€ç»‘å®šåŸŸåå¹¶æŒ‡å®šç™¾åº¦ä¸“çº¿ï¼š<br><img src="/images/hexo/3.png" alt="png"></p><p>6ã€ç”±äºä¹‹å‰ç”¨<code>Github</code>æ‰˜ç®¡é€ æˆç™¾åº¦ç«™é•¿æŠ“å–ç½‘ç«™ä¸€ç›´å¤±è´¥ï¼Œæ˜¾ç¤ºæœåŠ¡å™¨è¢«æ‹’ç»ã€‚åæ¥åˆ©ç”¨ç»™ç™¾åº¦æŒ‡å®š<code>Coding</code>ä¸“çº¿çš„æ–¹å¼æ‰è§£å†³è¯¥é—®é¢˜ã€‚<br><img src="/images/hexo/4.png" alt="png"></p><p>7ã€å°†ç½‘ç«™é“¾æ¥æäº¤åˆ°ç™¾åº¦<br>ç™¾åº¦æä¾›ä¸‰ç§éªŒè¯æ–¹å¼ï¼Œä»¥Htmlæ ‡ç­¾ä¸ºä¾‹ï¼Œåœ¨themes\next\layout_partials\head.swingä¸­æ·»åŠ éªŒè¯ä»£ç ï¼š<br><figure class="highlight plain"><figcaption><span>name</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åŒç†å°†é“¾æ¥æäº¤åˆ°Googleå’Œæœç‹—</span><br><span class="line"></span><br><span class="line">8ã€ç»™ç«™ç‚¹æ·»åŠ sitemap</span><br><span class="line"></span><br><span class="line">- hexoå®‰è£…sitemap</span><br></pre></td></tr></table></figure></p><p>npm install hexo-generator-sitemap â€“save #sitemap.xmlé€‚åˆæäº¤ç»™è°·æ­Œæœç´ å¼•æ“<br>npm install hexo-generator-baidu-sitemap â€“save #baidusitemap.xmlé€‚åˆæäº¤ç™¾åº¦æœç´¢å¼•æ“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶`_config.yml`ä¸­æ‰¾åˆ°`sitemap`æ·»åŠ ä»¥ä¸‹ä»£ç </span><br></pre></td></tr></table></figure></p><h1 id="è‡ªåŠ¨ç”Ÿæˆsitemap"><a href="#è‡ªåŠ¨ç”Ÿæˆsitemap" class="headerlink" title="è‡ªåŠ¨ç”Ÿæˆsitemap"></a>è‡ªåŠ¨ç”Ÿæˆsitemap</h1><p>sitemap:<br>    path: sitemap.xml<br>baidusitemap:<br>    path: baidusitemap.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ä¿®æ”¹ç«™ç‚¹`_config`</span><br></pre></td></tr></table></figure></p><h1 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h1><h2 id="If-your-site-is-put-in-a-subdirectory-set-url-as-â€˜http-yoursite-com-child-39-and-root-as-â€˜-child-â€˜"><a href="#If-your-site-is-put-in-a-subdirectory-set-url-as-â€˜http-yoursite-com-child-39-and-root-as-â€˜-child-â€˜" class="headerlink" title="If your site is put in a subdirectory, set url as â€˜http://yoursite.com/child&#39; and root as â€˜/child/â€˜"></a>If your site is put in a subdirectory, set url as â€˜<a href="http://yoursite.com/child&#39;" target="_blank" rel="noopener">http://yoursite.com/child&#39;</a> and root as â€˜/child/â€˜</h2><p>url: <a href="http://www.ihoge.cn">http://www.ihoge.cn</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">9ã€æ·»åŠ èœ˜è››åè®®robots.txt</span><br><span class="line">æ–°å»ºrobots.txtæ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹æ–‡ä»¶å†…å®¹ï¼ŒæŠŠrobots.txtæ”¾åœ¨hexoç«™ç‚¹çš„sourceæ–‡ä»¶ä¸‹ã€‚</span><br></pre></td></tr></table></figure></p><p>User-agent: *<br>Allow: /</p><p>Sitemap: <a href="http://www.ihoge.cn/sitemap.xml">http://www.ihoge.cn/sitemap.xml</a><br>Sitemap: <a href="http://www.ihoge.cn/baidusitemap.xml">http://www.ihoge.cn/baidusitemap.xml</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">hexo d -g æäº¤ååˆ°ç™¾åº¦ç«™é•¿å¹³å°æ‰¾åˆ°Robotsæ£€æµ‹å¹¶æ›´æ–°æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆã€‚</span><br><span class="line"></span><br><span class="line">10ã€keywords å’Œ description</span><br><span class="line">åœ¨\scaffolds\post.mdä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œç”¨äºç”Ÿæˆçš„æ–‡ç« ä¸­æ·»åŠ å…³é”®å­—å’Œæè¿°ã€‚</span><br></pre></td></tr></table></figure></p><p>keywords:<br>description:<br><code>`</code><br>ï¼ˆè¿™é‡Œæœªæ“ä½œï¼‰</p><p>11ã€ä¿®æ”¹æ–‡ç« é“¾æ¥<br>HEXOé»˜è®¤çš„æ–‡ç« é“¾æ¥å½¢å¼ä¸º<code>domain/year/month/day/postname</code>ï¼Œé»˜è®¤å°±æ˜¯ä¸€ä¸ªå››çº§urlï¼Œå¹¶ä¸”å¯èƒ½é€ æˆurlè¿‡é•¿ï¼Œå¯¹æœç´¢å¼•æ“æ˜¯ååˆ†ä¸å‹å¥½çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹æˆ domain/postname çš„å½¢å¼ã€‚ç¼–è¾‘ç«™ç‚¹<code>_config.yml</code>æ–‡ä»¶ï¼Œä¿®æ”¹å…¶ä¸­çš„<code>permalink</code>å­—æ®µæ”¹ä¸º<code>permalink: :year/:title/</code>å³å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;1ã€ä¹‹å‰åœ¨é˜¿é‡Œäº‘æ³¨å†Œçš„&lt;code&gt;.top&lt;/code&gt;åŸŸåä¸€ç›´ä¸å—ç™¾åº¦å¾…è§ï¼Œé‚é‡æ–°ç”³è¯·äº†&lt;code&gt;.cn&lt;/code&gt;åŸŸåã€‚æ›´æ¢åŸŸåå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ–°ç”³è¯·çš„åŸŸåä¸‹æ·»åŠ åŸŸåè§£æï¼šä¸»æœºè®°å½•æ·»åŠ &lt;code&gt;@&lt;/
      
    
    </summary>
    
      <category term="Hexo" scheme="http://www.ihoge.cn/categories/Hexo/"/>
    
    
      <category term="Coding" scheme="http://www.ihoge.cn/tags/Coding/"/>
    
      <category term="Github" scheme="http://www.ihoge.cn/tags/Github/"/>
    
  </entry>
  
  <entry>
    <title>é€’å½’ã€å°¾é€’å½’ã€å¾ªç¯çš„æ¯”è¾ƒåŠPythonå°¾é€’å½’çš„ä¼˜åŒ–</title>
    <link href="http://www.ihoge.cn/2018/Recursive.html"/>
    <id>http://www.ihoge.cn/2018/Recursive.html</id>
    <published>2018-04-02T19:05:59.000Z</published>
    <updated>2018-04-06T17:31:08.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>æœ€è¿‘åœ¨è¯»é­è€å¸ˆæ¨èçš„ç®—æ³•å›¾è§£è¿™æœ¬ä¹¦ã€‚è¯¥ä¹¦å†…å®¹å¾ˆæœ‰è¶£ï¼ŒæŠŠæ¯ç‡¥æ— å‘³çš„ç®—æ³•ç”¨ä¸€ä¸ªä¸ªæ—¥å¸¸ç”Ÿæ´»çš„å°æ¡ˆä¾‹è¯ é‡Šçš„æ¸…æ™°æ˜“æ‡‚ï¼Œå¾ˆé€‚åˆä½œä¸ºä¸šä½™è¯»ç‰©ã€‚<br>åœ¨è¯»åˆ°å…³äºé€’å½’ç®—æ³•çš„æ—¶å€™ï¼Œæœ¬ç€æ‰“ç ´ç ‚é”…é—®åˆ°åº•çš„ç²¾ç¥å¤§è‡´ç ”ç©¶äº†ä¸‹é€’å½’ç®—æ³•å’Œé€’å½’è¿›é˜¶ â€”&gt; <strong>å°¾é€’å½’</strong>ã€‚<br>åæ¥å‘ç°Pythonçš„è§£é‡Šå™¨ä¸æ”¯æŒå°¾é€’å½’ç®—æ³•ä¼˜åŒ–ï¼Œè€Œä¸”<strong>Pythonä¹‹çˆ¶æ›¾ç»æ˜ç¡®è¡¨ç¤ºPythonå°†ä¸ä¼šæ”¯æŒå°¾é€’å½’ä¼˜åŒ–ï¼T Tâ€¦</strong><br>ä¸è¿‡çœ‹æˆ‘åå¤æ³±æ³±å¤§å›½ï¼Œäººæ‰æµæµï¼Œè¿˜æ˜¯æœ‰å“¥ä»¬å†™å‡ºäº†Pythonä¸Šå¯¹å°¾é€’å½’çˆ†æ ˆé—®é¢˜çš„è§£å†³åŠæ³•ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯é€’å½’"><a href="#ä»€ä¹ˆæ˜¯é€’å½’" class="headerlink" title="ä»€ä¹ˆæ˜¯é€’å½’"></a>ä»€ä¹ˆæ˜¯é€’å½’</h2><p>ä¸€è¨€æ¦‚ä¹‹ï¼š <strong>é€’å½’æ˜¯ä¸€ç§ä¼˜é›…çš„é—®é¢˜è§£å†³åŠæ³•ã€‚</strong> å®ƒå°†ç¨‹åºå‘˜åˆ†ä¸ºäº†ä¸‰ä¸ªæˆªç„¶ä¸åŒçš„é˜µè¥ï¼šæ¨å®ƒçš„ã€çˆ±å®ƒçš„ã€çˆ±äº†å‡ å¹´ä»¥åŠæ¨äº†å‡ å¹´ååˆçˆ±ä¸Šå®ƒçš„ã€‚åˆæ¥è§¦æ—¶æˆ‘å¯¹è¿™å¥è¯æ˜¯æ€€ç–‘çš„ï¼Œä¸ºä»€ä¹ˆæˆ‘æ„Ÿè§‰é€’å½’è®©è§£å†³æ–¹æ¡ˆå˜å¾—æ›´ç»•äº†å‘¢ï¼Ÿ ç›´åˆ°è®¤çœŸå»çœ‹äº†å‡ ä¸ªç”¨é€’å½’æ€æƒ³è§£å†³é—®é¢˜çš„ä¾‹å­ä¹‹åæ–¹æ‰å‘ç°æ­¤è¯æ‰€è¨€éè™šã€‚<br>ç²—ç•¥çš„è¯´ï¼Œé€’å½’å°±æ˜¯è®©å‡½æ•°è°ƒç”¨è‡ªå·±ã€‚å®ƒè®©è§£å†³æ–¹æ¡ˆæ›´æ¸…æ™°ï¼Œä½†å¹¶æ²¡æœ‰æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ã€‚æ­£å¦‚Leigh Caldwellåœ¨Stack Overflowä¸Šè¯´è¿‡ä¸€å¥è¯ï¼šâ€œå¦‚æœä½¿ç”¨å¾ªç¯ï¼Œç¨‹åºçš„æ€§èƒ½å¯èƒ½æ›´é«˜ï¼Œå¦‚æœä½¿ç”¨é€’å½’ï¼Œç¨‹åºå¯èƒ½æ›´å®¹æ˜“ç†è§£ã€‚å¦‚ä½•é€‰æ‹©è¦çœ‹ä»€ä¹ˆå¯¹ä½ æ¥è¯´æ›´é‡è¦â€ï¼ˆè¿™ä¸€ç‚¹ä¸‹é¢ä¼šè¯¦ç»†è¯´æ˜ï¼‰ã€‚ç”±äºé€’å½’å‡½æ•°è°ƒç”¨è‡ªå·±ï¼Œå› æ­¤ç¼–å†™é€’å½’å‡½æ•°æ—¶ï¼Œå¿…é¡»å‘Šè¯‰å®ƒä½•æ—¶åœæ­¢é€’å½’å¦åˆ™ä¼šé™·å…¥æ— é™å¾ªç¯ã€‚æ‰€ä»¥æ¯ä¸ªé€’å½’å‡½æ•°éƒ½å¿…é¡»æœ‰ä¸¤éƒ¨åˆ†ï¼š<strong>åŸºå‡†æ¡ä»¶å’Œé€’å½’æ¡ä»¶</strong></p><p>ä½¿ç”¨é€’å½’å¿…é¡»è¦ç†è§£ <strong>è°ƒç”¨æ ˆ</strong> è¿™ä¸ªæ¦‚å¿µã€‚æ ˆæ˜¯ä¸€ç§ç®€å•çš„æ•°æ®ç»“æ„ï¼Œéµå¾ªå…ˆè¿›åå‡ºçš„åŸåˆ™ã€‚è®¡ç®—æœºåœ¨å†…éƒ¨ä½¿ç”¨è¢«ç§°ä¸º è°ƒç”¨æ ˆ çš„æ ˆã€‚</p><p>åœ¨é€’å½’çš„è¿‡ç¨‹ä¸­ï¼Œå½“è®¡ç®—æœºè°ƒç”¨ä¸€ä¸ªé€’å½’å‡½æ•° A çš„æ—¶å€™é¦–å…ˆä¸ºè¯¥å‡½æ•°åˆ†é…ä¸€å—å†…å­˜ï¼Œå¹¶å°†å‡½æ•°è°ƒç”¨æ¶‰åŠåˆ°çš„æ–¹æ³•å’Œæ‰€æœ‰å˜é‡çš„å€¼å­˜å‚¨åˆ°å†…å­˜ a ä¸­ã€‚é€’å½’å‡½æ•° A è°ƒç”¨è‡ªå·±äº§ç”Ÿå‡½æ•° B ï¼ŒåŒæ ·è®¡ç®—æœºä¼šç»™å‡½æ•° B åˆ†é…ä¸€å—æ–°çš„å†…å­˜ b ç”¨äºå­˜å‚¨ B æ‰€æ¶‰åŠåˆ°çš„æ‰€æœ‰å˜é‡åŠæ–¹æ³•ï¼Œå¹¶å‹åœ¨ a ä¸Šã€‚ç„¶åé€’å½’å‡½æ•° B ç»§ç»­è°ƒç”¨è‡ªèº«ç”Ÿæˆå‡½æ•° C å¹¶åˆ†é…å†…å­˜å— c å‹åœ¨ å†…å­˜å— bä¸Šã€‚åªè¦é€’å½’å‡½æ•°æœªè§¦å‘åŸºå‡†æ¡ä»¶å‡½æ•°å°†ä¸€ç›´å¾ªç¯è°ƒç”¨å¹¶ç”Ÿæˆä¸€ä¸ªä¸ªæ–°çš„å†…å­˜å—å‹åœ¨ä¸Šä¸€ä¸ªå†…å­˜å—ä¸Šé¢ã€‚è¿™ä¸ªæ“ä½œå« <strong>pushï¼ˆå‹æ ˆï¼‰</strong>ã€‚</p><p>è®¡ç®—æœºä½¿ç”¨ä¸€ä¸ª <strong>ï¼ˆæ ˆï¼‰</strong> æ¥è¡¨ç¤ºè¿™äº›å†…å­˜å—ï¼Œå…¶ä¸­å†…å­˜å— b ä½äº a å†…å­˜å—ä¸Šé¢ c åœ¨  b ä¸Šé¢ï¼ˆæ ˆé¡¶çš„å†…å­˜å—å°±æ˜¯å‡½æ•°çš„å½“å‰æ´»è·ƒéƒ¨åˆ†ï¼‰ã€‚å‡è®¾å‡½æ•° C è§¦å‘äº†é€’å½’å‡½æ•°çš„åŸºå‡†æ¡ä»¶ï¼Œåœ¨æ‰§è¡Œå®Œå‡½æ•° C åï¼Œæ ˆé¡¶çš„å†…å­˜å— c è¢«å¼¹å‡ºï¼Œè¿™ä¸ªæ“ä½œè¢«ç§°ä½œ <strong>popï¼ˆå¼¹æ ˆï¼‰</strong></p><p>è¿™é‡Œåœ¨æ‰§è¡Œå‡½æ•° B å’Œ C æ—¶ï¼Œå‡½æ•° A åªæ‰§è¡Œäº†ä¸€éƒ¨åˆ†ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼š <strong>è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå½“å‰å‡½æ•°æš‚åœå¹¶å¤„äºæœªå®ŒæˆçŠ¶æ€</strong>ã€‚ è¯¥å˜é‡çš„æ‰€æœ‰å˜é‡å€¼éƒ½è¿˜åœ¨å†…å­˜ä¸­ã€‚ æ‰§è¡Œå®Œå‡½æ•° C åï¼Œä¼šåˆå›åˆ°å‡½æ•° B ï¼ŒB æ‰§è¡Œå®Œæ¯•åˆè¿”å› A å¹¶ä»ç¦»å¼€çš„åœ°æ–¹æ¥ç€å¾€ä¸‹æ‰§è¡Œã€‚ è¿™ä¸ª <strong>æ ˆ</strong> ç”¨äºå­˜æ”¾å¯¹å¤šä¸ªå‡½æ•°çš„å˜é‡ï¼Œ è¢«ç§°ä¸º <strong>è°ƒç”¨æ ˆ</strong>ã€‚</p><p>ä½¿ç”¨ <strong>æ ˆ</strong> å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿè¦ä»˜å‡ºä»£ä»·ï¼šå­˜å‚¨å…ˆè¿›çš„ä¿¡æ¯ä¼šå ç”¨å¤§é‡çš„å†…å­˜ã€‚æ¯ä¸ªå‡½æ•°è°ƒç”¨éƒ½è¦å ç”¨ä¸€å®šçš„å†…å­˜ï¼Œå¦‚æœæ ˆå¾ˆé«˜ï¼Œå°±æ„å‘³ç€è®¡ç®—æœºå­˜å‚¨äº†å¤§é‡å‡½æ•°è°ƒç”¨çš„ä¿¡æ¯ã€‚ è€Œä¸” <strong>è°ƒç”¨æ ˆ</strong> çš„é«˜åº¦æ˜¯æœ‰é™åˆ¶çš„ï¼ˆå¦‚Pythonä¸­é»˜è®¤çš„æœ€é«˜å±‚æ•°æ—¶1000ï¼‰ã€‚è‹¥é€’å½’å±‚æ•°è¶…è¿‡ä¸€å®šé˜€å€¼åˆ™ä¼šé€ æˆ <strong>æ ˆæº¢å‡º</strong> ä¹Ÿå« <strong>çˆ†æ ˆ</strong> åœ¨è¿™ç§æƒ…å†µä¸‹æœ‰ä¸‰ç§é€‰æ‹©ï¼š</p><ul><li>å¢å¤§é˜€å€¼</li><li>é‡æ–°ç¼–å†™ä»£ç </li><li>ä½¿ç”¨ <strong>å°¾é€’å½’</strong></li></ul><h2 id="ä»€ä¹ˆæ˜¯å°¾é€’å½’"><a href="#ä»€ä¹ˆæ˜¯å°¾é€’å½’" class="headerlink" title="ä»€ä¹ˆæ˜¯å°¾é€’å½’"></a>ä»€ä¹ˆæ˜¯å°¾é€’å½’</h2><p>å…³äºå°¾é€’å½’ï¼Œç™¾åº¦ç™¾ç§‘è§£é‡Šçš„ç®—æ˜¯å¾ˆæ¸…æ™°æ˜äº†äº†ï¼š</p><p>å½“ç¼–è¯‘å™¨æ£€æµ‹åˆ°ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ˜¯å°¾é€’å½’çš„æ—¶å€™ï¼Œå®ƒå°±è¦†ç›–å½“å‰çš„æ´»åŠ¨è®°å½•è€Œä¸æ˜¯åœ¨æ ˆä¸­å»åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚ç¼–è¯‘å™¨å¯ä»¥åšåˆ°è¿™ç‚¹ï¼Œå› ä¸ºé€’å½’è°ƒç”¨æ˜¯å½“å‰æ´»è·ƒæœŸå†…æœ€åä¸€æ¡å¾…æ‰§è¡Œçš„è¯­å¥ï¼Œäºæ˜¯å½“è¿™ä¸ªè°ƒç”¨è¿”å›æ—¶æ ˆå¸§ä¸­å¹¶æ²¡æœ‰å…¶ä»–äº‹æƒ…å¯åšï¼Œå› æ­¤ä¹Ÿå°±æ²¡æœ‰ä¿å­˜æ ˆå¸§çš„å¿…è¦äº†ã€‚é€šè¿‡è¦†ç›–å½“å‰çš„æ ˆå¸§è€Œä¸æ˜¯åœ¨å…¶ä¹‹ä¸Šé‡æ–°æ·»åŠ ä¸€ä¸ªï¼Œè¿™æ ·æ‰€ä½¿ç”¨çš„æ ˆç©ºé—´å°±å¤§å¤§ç¼©å‡äº†ï¼Œè¿™ä½¿å¾—å®é™…çš„è¿è¡Œæ•ˆç‡ä¼šå˜å¾—æ›´é«˜ã€‚</p><ul><li><p><strong>å°¾é€’å½’å°±æ˜¯æŠŠå½“å‰çš„è¿ç®—ç»“æœï¼ˆæˆ–è·¯å¾„ï¼‰æ”¾åœ¨å‚æ•°é‡Œä¼ ç»™ä¸‹å±‚å‡½æ•°</strong></p></li><li><p><strong>å¦‚æœåœ¨é€’å½’å‡½æ•°ä¸­ï¼Œé€’å½’è°ƒç”¨è¿”å›çš„ç»“æœæ€»è¢«ç›´æ¥è¿”å›ï¼Œåˆ™ç§°ä¸ºå°¾éƒ¨é€’å½’ã€‚</strong> </p></li></ul><h2 id="é€’å½’ã€å°¾é€’å½’ã€å¾ªç¯çš„æ¯”è¾ƒ"><a href="#é€’å½’ã€å°¾é€’å½’ã€å¾ªç¯çš„æ¯”è¾ƒ" class="headerlink" title="é€’å½’ã€å°¾é€’å½’ã€å¾ªç¯çš„æ¯”è¾ƒ"></a>é€’å½’ã€å°¾é€’å½’ã€å¾ªç¯çš„æ¯”è¾ƒ</h2><p>ä¸‹é¢æ˜¯æˆ‘åˆ†åˆ«ç”¨æ™®é€šé€’å½’ã€å°¾é€’å½’ã€å¾ªç¯å®ç°é˜¶ä¹˜çš„å°ç¨‹åºï¼Œè¿™ä¸ªæ˜¯æˆ‘èƒ½æƒ³åˆ°æœ€ç®€æ´ç›´è§‚çš„ä¾‹å­äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®å…è®¸é€’å½’çš„æ·±åº¦</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.setrecursionlimit(<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ™®é€šé€’å½’é˜¶ä¹˜</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> n * fun(n<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°¾é€’å½’é˜¶ä¹˜</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact_iter</span><span class="params">(n, num)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> num</span><br><span class="line">    <span class="keyword">return</span> fact_iter(n - <span class="number">1</span>, n * num)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾ªç¯é˜¶ä¹˜</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact_loop</span><span class="params">(n)</span>:</span></span><br><span class="line">    num = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,n):</span><br><span class="line">        num = num * i</span><br><span class="line">    <span class="keyword">return</span> num</span><br></pre></td></tr></table></figure><h2 id="å°¾é€’å½’çš„Pythonä¼˜åŒ–"><a href="#å°¾é€’å½’çš„Pythonä¼˜åŒ–" class="headerlink" title="å°¾é€’å½’çš„Pythonä¼˜åŒ–"></a>å°¾é€’å½’çš„Pythonä¼˜åŒ–</h2><p>Pythonçš„çˆ¸çˆ¸å·²ç»æ˜ç¡®è¡¨ç¤ºPythonå°†ä¸ä¼šæ”¯æŒå°¾é€’å½’ä¼˜åŒ–äº†ã€‚ä½†æ˜¯æˆ‘å…ˆæ˜¯åœ¨ç½‘ä¸ŠæŸ¥ç›¸å…³èµ„æ–™çš„æ—¶å€™å‘ç°äº†ä¸¤ç§æ–¹æ³•å¯¹å°¾é€’å½’çš„ä¼˜åŒ–ï¼š</p><h3 id="æ–¹å¼ä¸€ï¼šå®ç°ä¸€ä¸ª-tail-call-optimized-è£…é¥°å™¨"><a href="#æ–¹å¼ä¸€ï¼šå®ç°ä¸€ä¸ª-tail-call-optimized-è£…é¥°å™¨" class="headerlink" title="æ–¹å¼ä¸€ï¼šå®ç°ä¸€ä¸ª tail_call_optimized è£…é¥°å™¨"></a>æ–¹å¼ä¸€ï¼šå®ç°ä¸€ä¸ª tail_call_optimized è£…é¥°å™¨</h3><p><a href="http://code.activestate.com/recipes/474088/" target="_blank" rel="noopener">æºç ï¼šç‚¹è¿™é‡Œ</a></p><p>ä¸ºäº†æ›´æ¸…æ™°çš„å±•ç¤ºå¼€å¯å°¾é€’å½’ä¼˜åŒ–å‰ã€åè°ƒç”¨æ ˆçš„å˜åŒ–å’Œtail_call_optimizedè£…é¥°å™¨æŠ›å¼‚å¸¸é€€å‡ºé€’å½’è°ƒç”¨æ ˆçš„ä½œç”¨, ä¸€ä¸ªç‰›äººåˆ©ç”¨pudbè°ƒè¯•å·¥å…·åšäº†åŠ¨å›¾ã€‚<br><a href="http://python.jobbole.com/86937/" target="_blank" rel="noopener">åŠ¨å›¾ï¼šç‚¹è¿™é‡Œ</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TailRecurseException</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, args, kwargs)</span>:</span></span><br><span class="line">        self.args = args</span><br><span class="line">        self.kwargs = kwargs</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tail_call_optimized</span><span class="params">(g)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    This function decorates a function with tail call</span></span><br><span class="line"><span class="string">    optimization. It does this by throwing an exception</span></span><br><span class="line"><span class="string">    if it is it's own grandparent, and catching such</span></span><br><span class="line"><span class="string">    exceptions to fake the tail call optimization.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    This function fails if the decorated</span></span><br><span class="line"><span class="string">    function recurses in a non-tail context.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        f = sys._getframe()</span><br><span class="line">        <span class="comment"># ä¸ºä»€ä¹ˆæ˜¯grandparent, å‡½æ•°é»˜è®¤çš„ç¬¬ä¸€å±‚é€’å½’æ˜¯çˆ¶è°ƒç”¨,</span></span><br><span class="line">        <span class="comment"># å¯¹äºå°¾é€’å½’, ä¸å¸Œæœ›äº§ç”Ÿæ–°çš„å‡½æ•°è°ƒç”¨(å³:ç¥–çˆ¶è°ƒç”¨),</span></span><br><span class="line">        <span class="comment"># æ‰€ä»¥è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸, æ‹¿åˆ°å‚æ•°, é€€å‡ºè¢«ä¿®é¥°å‡½æ•°çš„é€’å½’è°ƒç”¨æ ˆ!</span></span><br><span class="line">        <span class="keyword">if</span> f.f_back <span class="keyword">and</span> f.f_back.f_back \</span><br><span class="line">            <span class="keyword">and</span> f.f_back.f_back.f_code == f.f_code:</span><br><span class="line">            <span class="comment"># æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">raise</span> TailRecurseException(args, kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">return</span> g(*args, **kwargs)</span><br><span class="line">                <span class="keyword">except</span> (TailRecurseException, e):</span><br><span class="line">                    <span class="comment"># æ•è·å¼‚å¸¸, æ‹¿åˆ°å‚æ•°, é€€å‡ºè¢«ä¿®é¥°å‡½æ•°çš„é€’å½’è°ƒç”¨æ ˆ</span></span><br><span class="line">                    args = e.args</span><br><span class="line">                    kwargs = e.kwargs</span><br><span class="line">    func.__doc__ = g.__doc__</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"> </span><br><span class="line"><span class="meta">@tail_call_optimized</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n, acc=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="string">"calculate a factorial"</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> acc</span><br><span class="line">    <span class="keyword">return</span> factorial(n<span class="number">-1</span>, n*acc)</span><br><span class="line"> </span><br><span class="line">print(factorial(<span class="number">100</span>))</span><br></pre></td></tr></table></figure><p>å› ä¸ºå°¾é€’å½’æ²¡æœ‰è°ƒç”¨æ ˆçš„åµŒå¥—, æ‰€ä»¥Pythonä¹Ÿä¸ä¼šæŠ¥RuntimeError: maximum recursion depth exceededé”™è¯¯äº†!</p><p>ä½†æ˜¯å¯¹äºè¿™ç§å‘å‘æ˜¯å¦çœŸæ­£æ„ä¹‰ä¸Šå®ç°äº†å®Œç¾çš„ä¼˜åŒ–å‘¢ï¼Ÿ é’ˆå¯¹è¿™ä¸ªæ–¹æ³•æœ‰ä¸ªçŸ¥ä¹å¤§ç¥å‘è¯äº†ï¼š</p><p>TCOï¼Œtail-call optimizationï¼Œå…¶å®æœ‰å¤šç§è§£è¯»æ–¹å¼</p><p>æœ€å¸¸è§çš„è§£è¯»æ–¹å¼æ˜¯ï¼šå¯¹äºå°¾è°ƒç”¨çš„å‡½æ•°è°ƒç”¨ï¼Œä¸è¦æµªè´¹æ ˆç©ºé—´ï¼Œè€Œè¦å¤ç”¨è°ƒç”¨è€…çš„æ ˆç©ºé—´ã€‚è¿™æ ·çš„ç»“æœå°±æ˜¯ä¸€é•¿ä¸²å°¾è°ƒç”¨ä¸ä¼šçˆ†æ ˆï¼Œè€Œæ²¡æœ‰TCOçš„è¯åŒæ ·çš„è°ƒç”¨å°±ä¼šçˆ†æ ˆã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œå¦‚ä¸Šæ–¹æ³•çš„é‚£ä¸ªrecipeç¡®å®è¾¾åˆ°äº†TCOçš„éƒ¨åˆ†ç›®çš„ï¼š</p><ul><li>é€šè¿‡stack introspectionæŸ¥çœ‹è°ƒç”¨é“¾ä¸Šçš„è°ƒç”¨è€…ä¹‹ä¸­æœ‰æ²¡æœ‰è‡ªå·±</li><li>æœ‰çš„è¯ï¼Œé€šè¿‡æŠ›å¼‚å¸¸æ¥è¿«ä½¿æ ˆå›é€€ï¼ˆstack unwindï¼‰åˆ°ä¹‹å‰çš„ä¸€ä¸ªè‡ªå·±çš„frame</li><li>åœ¨å›é€€åˆ°çš„frameæ¥ä½å¼‚å¸¸ï¼Œæ‹¿å‡ºåæ¥è°ƒç”¨çš„å‚æ•°ï¼Œç”¨æ–°å‚æ•°å†æ¬¡è°ƒç”¨è‡ªå·±</li></ul><p>è¿™æ ·å°±å¯ä»¥è®©å°¾é€’å½’ä¸çˆ†æ ˆã€‚ä½†è¿™æ ·åšæ€§èƒ½æ˜¯æ²¡ä¿è¯çš„â€¦è€Œä¸”å¯¹äºå®Œå…¨æ²¡é€’å½’è¿‡çš„ä¸€èˆ¬å°¾è°ƒç”¨ä¹Ÿä¸èµ·ä½œç”¨ã€‚ä¸€ç§å¯¹TCOçš„å¸¸è§è¯¯è§£æ˜¯ï¼šç”±ç¼–è¯‘å™¨æˆ–è¿è¡Œæ—¶ç³»ç»ŸæŠŠå°¾è°ƒç”¨/å°¾é€’å½’å®ç°å¾—å¾ˆå¿«ã€‚è¿™ä¸æ˜¯TCOçœŸæ­£è¦å¼ºè°ƒçš„äº‹æƒ…â€”â€”ä¸çˆ†æ ˆæ‰æ˜¯æœ€é‡è¦çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å…¶å®é‡ç‚¹ä¸åœ¨â€œä¼˜åŒ–â€ï¼Œè€Œåœ¨äºâ€œå°¾è°ƒç”¨ä¸çˆ†æ ˆâ€è¿™ä¸ªè¯­ä¹‰ä¿è¯ã€‚â€œproper tail-callâ€çš„å«æ³•è¿œæ¯”â€œtail-call optimizationâ€æ¥å¾—åˆé€‚ã€‚å› è€Œåƒè¿™ç§ç§åšæ³•ï¼Œå¯ä»¥ç®—éƒ¨åˆ†TCOï¼Œä½†ç®—ä¸ä¸Šâ€œæ€§èƒ½ä¼˜åŒ–â€æ„ä¹‰ä¸Šçš„ä¼˜åŒ–ã€‚</p><h3 id="æ–¹å¼äºŒï¼špattern-matching"><a href="#æ–¹å¼äºŒï¼špattern-matching" class="headerlink" title="æ–¹å¼äºŒï¼špattern-matching"></a>æ–¹å¼äºŒï¼špattern-matching</h3><p>å…³äºå°¾é€’å½’å®ç°ï¼š</p><p> å¾ˆç®€å•ï¼Œæ°¸è¿œä¸è¦åœ¨å‡½æ•°å†…éƒ¨å»è°ƒç”¨è‡ªå·±ï¼Œç”šè‡³ä¸è¦è°ƒç”¨ä»»ä½•ä¸œè¥¿ã€‚æ¯ä¸€æ¬¡è°ƒç”¨ï¼Œéƒ½è®©å¤–å±‚ä¸€ä¸ªagentæ¥åšã€‚ä¿è¯å‡½æ•°æ ˆæ·±æ°¸è¿œä¸è¶…è¿‡2æˆ–3å³å¯ã€‚</p><p>è¿™å“¥ä»¬æ›´ç‰›é€¼äº†ï¼Œç›´æ¥åšäº†ä¸ªPythonçš„æ¨¡å¼åŒ¹é…åº“ï¼ŒåŒ…å«äº†å°¾é€’å½’çš„ä¼˜åŒ–ï¼Œå®ç°äº†coroutineã€‚</p><p>æŠŠéœ€è¦ä¼˜åŒ–çš„å‡½æ•°çš„returnæ”¹æˆyieldï¼Œå¤–é¢å¥—ä¸ªè£…é¥°å™¨ï¼Œå°±å«tail_call_opmã€‚è£…é¥°å™¨æœ€å†…å±‚çš„é€»è¾‘æ˜¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">while True:</span><br><span class="line">    try:</span><br><span class="line">        ret=next(ret) </span><br><span class="line">    except:</span><br><span class="line">        return ret</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªåº”è¯¥æ²¡æœ‰å¤ç”¨é‡Šæ”¾çš„ç©ºé—´â€¦ä½†åˆ·é¢˜æ—¶æ¢äº†è¿™ä¸ªå°±ä¸çˆ†æ ˆäº†ã€‚è¿”å›é—­åŒ…çš„è¯æƒ…å†µåº”è¯¥ä¼šæ›´å¤æ‚ä¸€äº›ã€‚<br><a href="https://github.com/Xython/pattern-matching" target="_blank" rel="noopener">pattern-matchingå‚è€ƒGitHubåœ°å€</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;æœ€è¿‘åœ¨è¯»é­è€å¸ˆæ¨èçš„ç®—æ³•å›¾è§£è¿™æœ¬ä¹¦ã€‚è¯¥ä¹¦å†…å®¹å¾ˆæœ‰è¶£ï¼ŒæŠŠæ¯ç‡¥æ— å‘³çš„ç®—æ³•ç”¨ä¸€ä¸ªä¸ªæ—¥å¸¸ç”Ÿæ´»çš„å°æ¡ˆä¾‹è¯ é‡Šçš„æ¸…æ™°æ˜“æ‡‚ï¼Œå¾ˆé€‚åˆä½œä¸ºä¸šä½™è¯»ç‰©ã€‚&lt;br&gt;åœ¨è¯»åˆ°å…³äºé€’å½’ç®—æ³•çš„æ—¶å€™ï¼Œæœ¬ç€æ‰“ç ´ç ‚é”…é—®åˆ°åº•çš„ç²¾ç¥å¤§è‡´ç ”ç©¶äº†ä¸‹é€’å½’ç®—æ³•å’Œé€’å½’è¿›é˜¶ â€”&amp;gt; &lt;str
      
    
    </summary>
    
      <category term="Python" scheme="http://www.ihoge.cn/categories/Python/"/>
    
    
      <category term="é€’å½’" scheme="http://www.ihoge.cn/tags/%E9%80%92%E5%BD%92/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªè‡ªç¼–è¯‘çº¿æ€§å›å½’çš„æ¡ˆä¾‹</title>
    <link href="http://www.ihoge.cn/2018/sklearnLiner.html"/>
    <id>http://www.ihoge.cn/2018/sklearnLiner.html</id>
    <published>2018-04-02T09:05:59.000Z</published>
    <updated>2018-04-07T13:02:06.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>åœ¨çº¿æ€§å›å½’ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦å»ºç«‹ä¸€ä¸ªæ¨¡å‹ï¼Œæ¥æ‹Ÿåˆä¸€ä¸ªå› å˜é‡ y ä¸ä¸€ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹è‡ªå˜é‡(é¢„æµ‹å˜é‡) x ä¹‹é—´çš„å…³ç³»ã€‚</p><p>ç»™å®šï¼š</p><p>æ•°æ®é›†<br>$$\left{ \left( x^{\left( 1 \right)},y^{\left( 1 \right)} \right),\; â€¦,\; \left(x^{\left( m \right)},y^{\left( m \right)} \right) \right}$$</p><p>$x_{i}$æ˜¯d-ç»´å‘é‡$X^{i}\; =\; \left( x_{1}^{\left( i \right)},\; â€¦,\; x_{d}^{\left( i \right)} \right)$</p><p>$y^{(i)}$æ˜¯ä¸€ä¸ªç›®æ ‡å˜é‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ ‡é‡</p><p>çº¿æ€§å›å½’æ¨¡å‹å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªéå¸¸ç®€å•çš„ç¥ç»ç½‘ç»œï¼š</p><p>å®ƒæœ‰ä¸€ä¸ªå®å€¼åŠ æƒå‘é‡$w\; =\; \left( w^{\left( i \right)},\; â€¦,\; w^{\left( d \right)} \right)$<br>å®ƒæœ‰ä¸€ä¸ªå®å€¼åç½®é‡ b<br>å®ƒä½¿ç”¨æ’ç­‰å‡½æ•°ä½œä¸ºå…¶æ¿€æ´»å‡½æ•°</p><p>çº¿æ€§å›å½’æ¨¡å‹å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è¿›è¡Œè®­ç»ƒ</p><p>a) <strong>æ¢¯åº¦ä¸‹é™æ³•</strong></p><p>b) <strong>æ­£æ€æ–¹ç¨‹(å°é—­å½¢å¼è§£)</strong>ï¼š $w\; =\; \left( X^{T}X \right)^{-1}X^{T}y$</p><p>å…¶ä¸­ X æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œå…¶å½¢å¼ä¸º$\left( m,\; n_{featu\mbox{re}s} \right)$ï¼ŒåŒ…å«æ‰€æœ‰è®­ç»ƒæ ·æœ¬çš„ç»´åº¦ä¿¡æ¯ã€‚</p><p>è€Œæ­£æ€æ–¹ç¨‹éœ€è¦è®¡ç®—$\left( X^{T}X \right)$çš„è½¬ç½®ã€‚è¿™ä¸ªæ“ä½œçš„è®¡ç®—å¤æ‚åº¦ä»‹äº$O\left( n_{featu\mbox{re}s}^{2.4} \right)$å’Œ$O\left( n_{featu\mbox{re}s}^{3} \right)$ä¹‹é—´ï¼Œè€Œè¿™å–å†³äºæ‰€é€‰æ‹©çš„å®ç°æ–¹æ³•ã€‚å› æ­¤ï¼Œå¦‚æœè®­ç»ƒé›†ä¸­æ•°æ®çš„ç‰¹å¾æ•°é‡å¾ˆå¤§ï¼Œé‚£ä¹ˆä½¿ç”¨æ­£æ€æ–¹ç¨‹è®­ç»ƒçš„è¿‡ç¨‹å°†å˜å¾—éå¸¸ç¼“æ…¢ã€‚</p><p>çº¿æ€§å›å½’æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹æœ‰ä¸åŒçš„æ­¥éª¤ã€‚é¦–å…ˆ(åœ¨æ­¥éª¤ 0 ä¸­)ï¼Œæ¨¡å‹çš„å‚æ•°å°†è¢«åˆå§‹åŒ–ã€‚åœ¨è¾¾åˆ°æŒ‡å®šè®­ç»ƒæ¬¡æ•°æˆ–å‚æ•°æ”¶æ•›å‰ï¼Œé‡å¤ä»¥ä¸‹å…¶ä»–æ­¥éª¤ã€‚</p><h3 id="ç¬¬-0-æ­¥ï¼š"><a href="#ç¬¬-0-æ­¥ï¼š" class="headerlink" title="ç¬¬ 0 æ­¥ï¼š"></a>ç¬¬ 0 æ­¥ï¼š</h3><p>ç”¨0 (æˆ–å°çš„éšæœºå€¼)æ¥åˆå§‹åŒ–æƒé‡å‘é‡å’Œåç½®é‡ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨æ­£æ€æ–¹ç¨‹è®¡ç®—æ¨¡å‹å‚æ•°</p><h3 id="ç¬¬-1-æ­¥-åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦-ï¼š"><a href="#ç¬¬-1-æ­¥-åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦-ï¼š" class="headerlink" title="ç¬¬ 1 æ­¥(åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦)ï¼š"></a>ç¬¬ 1 æ­¥(åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦)ï¼š</h3><p>è®¡ç®—è¾“å…¥çš„ç‰¹å¾ä¸æƒé‡å€¼çš„çº¿æ€§ç»„åˆï¼Œè¿™å¯ä»¥é€šè¿‡çŸ¢é‡åŒ–å’ŒçŸ¢é‡ä¼ æ’­æ¥å¯¹æ‰€æœ‰è®­ç»ƒæ ·æœ¬è¿›è¡Œå¤„ç†ï¼š<br>$\dot{y}\; =\; X\; \cdot \; w\; +b$</p><p>å…¶ä¸­ X æ˜¯æ‰€æœ‰è®­ç»ƒæ ·æœ¬çš„ç»´åº¦çŸ©é˜µï¼Œå…¶å½¢å¼ä¸º$\left( m,\; n_{featu\mbox{re}s} \right)$ï¼›è¿™é‡Œæˆ‘ç”¨Â· è¡¨ç¤º$\wedge$ ã€‚</p><h3 id="ç¬¬-2-æ­¥-åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦-ï¼š"><a href="#ç¬¬-2-æ­¥-åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦-ï¼š" class="headerlink" title="ç¬¬ 2 æ­¥(åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦)ï¼š"></a>ç¬¬ 2 æ­¥(åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦)ï¼š</h3><p>ç”¨å‡æ–¹è¯¯å·®è®¡ç®—è®­ç»ƒé›†ä¸Šçš„æŸå¤±ï¼š$J\left( w,b \right)\; =\; \frac{1}{m}\sum_{i=1}^{m}{\left( \dot{y}^{\left( i \right)}\; -\; y^{\left( i \right)} \right)^{2}}$</p><h3 id="ç¬¬-3-æ­¥-åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦"><a href="#ç¬¬-3-æ­¥-åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦" class="headerlink" title="ç¬¬ 3 æ­¥(åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦):"></a>ç¬¬ 3 æ­¥(åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦):</h3><p>å¯¹æ¯ä¸ªå‚æ•°ï¼Œè®¡ç®—å…¶å¯¹æŸå¤±å‡½æ•°çš„åå¯¼æ•°ï¼š</p><p>$\frac{\partial J}{\partial w_{j}}\; =\; \frac{2}{m}\sum_{i=1}^{m}{\left( \dot{y}^{\left( i \right)}\; -\; y^{\left( i \right)} \right)}x_{j}^{\left( i \right)}$</p><p>$\frac{\partial J}{\partial b}\; =\; \frac{2}{m}\sum_{i=1}^{m}{\left( \dot{y}^{\left( i \right)}\; -\; y^{\left( i \right)} \right)}$</p><p>æ‰€æœ‰åå¯¼æ•°çš„æ¢¯åº¦è®¡ç®—å¦‚ä¸‹ï¼š</p><p>$\Delta _{w}J\; =\; \frac{2}{m}X^{T}\; \left( \dot{y}\; -\; y \right)$</p><p>$\Delta _{b}J\; =\; \frac{2}{m}\left( \dot{y}\; -\; y \right)$</p><h3 id="ç¬¬-4-æ­¥-åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦ï¼‰"><a href="#ç¬¬-4-æ­¥-åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦ï¼‰" class="headerlink" title="ç¬¬ 4 æ­¥(åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦ï¼‰:"></a>ç¬¬ 4 æ­¥(åªæœ‰åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒæ—¶éœ€è¦ï¼‰:</h3><p>æ›´æ–°æƒé‡å‘é‡å’Œåç½®é‡ï¼š</p><p>$w\; =\; w\; -\; \eta \Delta _{w}J$</p><p>$\Delta _{b}J\; =\; \frac{2}{m}\left( \dot{y}\; -\; y \right)$</p><p>å…¶ä¸­Î·è¡¨ç¤ºå­¦ä¹ ç‡</p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h4 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line">np.random.seed(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line">X = <span class="number">2</span> * np.random.rand(<span class="number">500</span>, <span class="number">1</span>)</span><br><span class="line">y = <span class="number">5</span> + <span class="number">3</span> * X + np.random.randn(<span class="number">500</span>, <span class="number">1</span>)</span><br><span class="line">fig = plt.figure(figsize=(<span class="number">8</span>,<span class="number">6</span>))</span><br><span class="line">plt.scatter(X, y)</span><br><span class="line">plt.title(<span class="string">"Dataset"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"First feature"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Second feature"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="/images/sklearn/7.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y)</span><br><span class="line">print(<span class="string">f'Shape X_train: <span class="subst">&#123;X_train.shape&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'Shape y_train: <span class="subst">&#123;y_train.shape&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'Shape X_test: <span class="subst">&#123;X_test.shape&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'Shape y_test: <span class="subst">&#123;y_test.shape&#125;</span>'</span>)</span><br></pre></td></tr></table></figure><pre><code>Shape X_train: (375, 1)Shape y_train: (375, 1)Shape X_test: (125, 1)Shape y_test: (125, 1)</code></pre><h4 id="çº¿æ€§å›å½’åˆ†ç±»-æºç ç¼–è¯‘"><a href="#çº¿æ€§å›å½’åˆ†ç±»-æºç ç¼–è¯‘" class="headerlink" title="çº¿æ€§å›å½’åˆ†ç±» æºç ç¼–è¯‘"></a>çº¿æ€§å›å½’åˆ†ç±» æºç ç¼–è¯‘</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearRegression</span>:</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">       <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">train_gradient_descent</span><span class="params">(self, X, y, learning_rate=<span class="number">0.01</span>, n_iters=<span class="number">100</span>)</span>:</span></span><br><span class="line">       <span class="string">"""</span></span><br><span class="line"><span class="string">       Trains a linear regression model using gradient descent</span></span><br><span class="line"><span class="string">       """</span></span><br><span class="line">       <span class="comment"># Step 0: Initialize the parameters</span></span><br><span class="line">       n_samples, n_features = X.shape</span><br><span class="line">       self.weights = np.zeros(shape=(n_features,<span class="number">1</span>))</span><br><span class="line">       self.bias = <span class="number">0</span></span><br><span class="line">       costs = []</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> i <span class="keyword">in</span> range(n_iters):</span><br><span class="line">           <span class="comment"># Step 1: Compute a linear combination of the input features and weights</span></span><br><span class="line">           y_predict = np.dot(X, self.weights) + self.bias</span><br><span class="line"></span><br><span class="line">           <span class="comment"># Step 2: Compute cost over training set</span></span><br><span class="line">           cost = (<span class="number">1</span> / n_samples) * np.sum((y_predict - y)**<span class="number">2</span>)</span><br><span class="line">           costs.append(cost)</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> i % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">               print(<span class="string">f"Cost at iteration <span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;cost&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">           <span class="comment"># Step 3: Compute the gradients</span></span><br><span class="line">           dJ_dw = (<span class="number">2</span> / n_samples) * np.dot(X.T, (y_predict - y))</span><br><span class="line">           dJ_db = (<span class="number">2</span> / n_samples) * np.sum((y_predict - y)) </span><br><span class="line"></span><br><span class="line">           <span class="comment"># Step 4: Update the parameters</span></span><br><span class="line">           self.weights = self.weights - learning_rate * dJ_dw</span><br><span class="line">           self.bias = self.bias - learning_rate * dJ_db</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> self.weights, self.bias, costs</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">train_normal_equation</span><span class="params">(self, X, y)</span>:</span></span><br><span class="line">       <span class="string">"""</span></span><br><span class="line"><span class="string">       Trains a linear regression model using the normal equation</span></span><br><span class="line"><span class="string">       """</span></span><br><span class="line">       self.weights = np.dot(np.dot(np.linalg.inv(np.dot(X.T, X)), X.T), y)</span><br><span class="line">       self.bias = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> self.weights, self.bias</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, X)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> np.dot(X, self.weights) + self.bias</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ¢¯åº¦ä¸‹é™è¿›è¡Œè®­ç»ƒ"><a href="#ä½¿ç”¨æ¢¯åº¦ä¸‹é™è¿›è¡Œè®­ç»ƒ" class="headerlink" title="ä½¿ç”¨æ¢¯åº¦ä¸‹é™è¿›è¡Œè®­ç»ƒ"></a>ä½¿ç”¨æ¢¯åº¦ä¸‹é™è¿›è¡Œè®­ç»ƒ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">regressor = LinearRegression()</span><br><span class="line">w_trained, b_trained, costs = regressor.train_gradient_descent(X_train, y_train, learning_rate=<span class="number">0.005</span>, n_iters=<span class="number">600</span>)</span><br><span class="line">fig = plt.figure(figsize=(<span class="number">8</span>,<span class="number">6</span>))</span><br><span class="line">plt.plot(np.arange(<span class="number">600</span>), costs)</span><br><span class="line">plt.title(<span class="string">"Development of cost during training"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Number of iterations"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Cost"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><pre><code>Cost at iteration 0: 66.45256981003433Cost at iteration 100: 2.208434614609594Cost at iteration 200: 1.2797812854182806Cost at iteration 300: 1.2042189195356685Cost at iteration 400: 1.1564867816573Cost at iteration 500: 1.121391041394467Text(0,0.5,&apos;Cost&apos;)</code></pre><p><img src="/images/sklearn/8.png" alt="png"></p><h4 id="æµ‹è¯•ï¼ˆæ¢¯åº¦ä¸‹é™æ¨¡å‹ï¼‰"><a href="#æµ‹è¯•ï¼ˆæ¢¯åº¦ä¸‹é™æ¨¡å‹ï¼‰" class="headerlink" title="æµ‹è¯•ï¼ˆæ¢¯åº¦ä¸‹é™æ¨¡å‹ï¼‰"></a>æµ‹è¯•ï¼ˆæ¢¯åº¦ä¸‹é™æ¨¡å‹ï¼‰</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">n_samples, _ = X_train.shape</span><br><span class="line">n_samples_test, _ = X_test.shape</span><br><span class="line"></span><br><span class="line">y_p_train = regressor.predict(X_train)</span><br><span class="line">y_p_test = regressor.predict(X_test)</span><br><span class="line"></span><br><span class="line">error_train =  (<span class="number">1</span> / n_samples) * np.sum((y_p_train - y_train) ** <span class="number">2</span>)</span><br><span class="line">error_test =  (<span class="number">1</span> / n_samples_test) * np.sum((y_p_test - y_test) ** <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f"Error on training set: <span class="subst">&#123;np.round(error_train, <span class="number">4</span>)&#125;</span>"</span>)</span><br><span class="line">print(<span class="string">f"Error on test set: <span class="subst">&#123;np.round(error_test)&#125;</span>"</span>)</span><br></pre></td></tr></table></figure><pre><code>Error on training set: 1.0955Error on test set: 1.0</code></pre><h4 id="ä½¿ç”¨æ­£è§„æ–¹ç¨‹ï¼ˆnormal-equationï¼‰è®­ç»ƒ"><a href="#ä½¿ç”¨æ­£è§„æ–¹ç¨‹ï¼ˆnormal-equationï¼‰è®­ç»ƒ" class="headerlink" title="ä½¿ç”¨æ­£è§„æ–¹ç¨‹ï¼ˆnormal equationï¼‰è®­ç»ƒ"></a>ä½¿ç”¨æ­£è§„æ–¹ç¨‹ï¼ˆnormal equationï¼‰è®­ç»ƒ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X_b_train = np.c_[np.ones((n_samples)), X_train]</span><br><span class="line">X_b_test = np.c_[np.ones((n_samples_test)), X_test]</span><br><span class="line"></span><br><span class="line">reg_normal = LinearRegression()</span><br><span class="line">w_trained = reg_normal.train_normal_equation(X_b_train, y_train)</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•ï¼ˆæ­£è§„æ–¹ç¨‹æ¨¡å‹ï¼‰"><a href="#æµ‹è¯•ï¼ˆæ­£è§„æ–¹ç¨‹æ¨¡å‹ï¼‰" class="headerlink" title="æµ‹è¯•ï¼ˆæ­£è§„æ–¹ç¨‹æ¨¡å‹ï¼‰"></a>æµ‹è¯•ï¼ˆæ­£è§„æ–¹ç¨‹æ¨¡å‹ï¼‰</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">y_p_train = reg_normal.predict(X_b_train)</span><br><span class="line">y_p_test = reg_normal.predict(X_b_test)</span><br><span class="line"></span><br><span class="line">error_train =  (<span class="number">1</span> / n_samples) * np.sum((y_p_train - y_train) ** <span class="number">2</span>)</span><br><span class="line">error_test =  (<span class="number">1</span> / n_samples_test) * np.sum((y_p_test - y_test) ** <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f"Error on training set: <span class="subst">&#123;np.round(error_train, <span class="number">4</span>)&#125;</span>"</span>)</span><br><span class="line">print(<span class="string">f"Error on test set: <span class="subst">&#123;np.round(error_test, <span class="number">4</span>)&#125;</span>"</span>)</span><br></pre></td></tr></table></figure><pre><code>Error on training set: 1.0228Error on test set: 1.0432</code></pre><h4 id="å¯è§†åŒ–æµ‹è¯•é¢„æµ‹"><a href="#å¯è§†åŒ–æµ‹è¯•é¢„æµ‹" class="headerlink" title="å¯è§†åŒ–æµ‹è¯•é¢„æµ‹"></a>å¯è§†åŒ–æµ‹è¯•é¢„æµ‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure(figsize=(<span class="number">8</span>,<span class="number">6</span>))</span><br><span class="line">plt.scatter(X_train, y_train)</span><br><span class="line">plt.scatter(X_test, y_p_test)</span><br><span class="line">plt.xlabel(<span class="string">"First feature"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Second feature"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><pre><code>Text(0,0.5,&apos;Second feature&apos;)</code></pre><p><img src="/images/sklearn/9.png" alt="png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;åœ¨çº¿æ€§å›å½’ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦å»ºç«‹ä¸€ä¸ªæ¨¡å‹ï¼Œæ¥æ‹Ÿåˆä¸€ä¸ªå› å˜é‡ y ä¸ä¸€ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹è‡ªå˜é‡(é¢„æµ‹å˜é‡) x ä¹‹é—´çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;ç»™å®šï¼š&lt;/p&gt;
&lt;p&gt;æ•°æ®é›†&lt;br&gt;$$\left{ \left( x^{\left( 1 \right)},y
      
    
    </summary>
    
      <category term="Machine learning" scheme="http://www.ihoge.cn/categories/Machine-learning/"/>
    
    
      <category term="scikit-learn" scheme="http://www.ihoge.cn/tags/scikit-learn/"/>
    
  </entry>
  
  <entry>
    <title>Scalaæ•°æ®ç±»å‹åŠåŸºç¡€è¯­æ³•</title>
    <link href="http://www.ihoge.cn/2018/scala1.html"/>
    <id>http://www.ihoge.cn/2018/scala1.html</id>
    <published>2018-03-31T16:28:59.000Z</published>
    <updated>2018-04-06T17:31:08.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="scalaç®€ä»‹"><a href="#scalaç®€ä»‹" class="headerlink" title="scalaç®€ä»‹"></a>scalaç®€ä»‹</h2><pre><code>2004å¹´ï¼Œmartin orderskyå‘æ˜ï¼Œjavacçš„ç¼–è¯‘å™¨ï¼Œåæ¥spark,kafkaåº”ç”¨å¹¿æ³›ï¼Œtwitteråº”ç”¨æ¨å¹¿ã€‚å®ƒå…·å¤‡é¢å‘å¯¹è±¡å’Œå‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹ç‚¹ã€‚[å®˜ç½‘ï¼šwww.scala-lang.org](www.scala-lang.org)</code></pre><h2 id="Windowsç¯å¢ƒå®‰è£…"><a href="#Windowsç¯å¢ƒå®‰è£…" class="headerlink" title="Windowsç¯å¢ƒå®‰è£…"></a>Windowsç¯å¢ƒå®‰è£…</h2><pre><code>a) å®‰è£…jdk-7u55-windows-x64.exeb) å®‰è£…scala-2.10.4.msiå®‰è£…å®Œä»¥ä¸Šä¸¤æ­¥ï¼Œä¸ç”¨åšä»»ä½•ä¿®æ”¹ã€‚æµ‹è¯•ï¼šåœ¨æ§åˆ¶å°ä¸‹c:/&gt;scalac) å®‰è£…eclipse-java-juno-SR2-win32-x86_64.zip è§£å‹ç¼©å³å¯d) å®‰è£…eclipseçš„scalaæ’ä»¶update-site.zip    è§£å‹ä¼šæœ‰ä¸¤ä¸ªç›®å½•ï¼Œfeatureså’Œpluginsï¼Œåˆ†åˆ«æŠŠå†…å®¹æ”¾åˆ°eclispeå¯¹åº”çš„ç›®å½•ä¸‹ã€‚    e) é‡å¯eclipse    æç¤º&quot;Upgrade of scala...&quot;ï¼Œç‚¹yes    æç¤ºæ¡†&quot;setup Diagnostic&quot;ï¼ŒæŠŠEnable JDT weaving...é€‰ä¸Š    æ ¹æ®æç¤ºé‡å¯</code></pre><h2 id="ç¬¬ä¸€ä¸ªç¨‹åº"><a href="#ç¬¬ä¸€ä¸ªç¨‹åº" class="headerlink" title="ç¬¬ä¸€ä¸ªç¨‹åº"></a>ç¬¬ä¸€ä¸ªç¨‹åº</h2><h3 id="äº¤äº’å¼ç¼–ç¨‹"><a href="#äº¤äº’å¼ç¼–ç¨‹" class="headerlink" title="äº¤äº’å¼ç¼–ç¨‹"></a>äº¤äº’å¼ç¼–ç¨‹</h3><pre><code>C:\Users\Administrator&gt;scalaWelcome to Scala version 2.10.4 (Java HotSpot(TM) 64-Bit Server VM, Java 1.7.0_5Type in expressions to have them evaluated.Type :help for more information.scala&gt; 1+1res0: Int = 2</code></pre><h3 id="è„šæœ¬å½¢å¼-é€šè¿‡åˆ›å»ºæ–‡ä»¶æ¥åœ¨eclipse-ideaä¸­æ‰§è¡Œä»£ç "><a href="#è„šæœ¬å½¢å¼-é€šè¿‡åˆ›å»ºæ–‡ä»¶æ¥åœ¨eclipse-ideaä¸­æ‰§è¡Œä»£ç " class="headerlink" title="è„šæœ¬å½¢å¼:é€šè¿‡åˆ›å»ºæ–‡ä»¶æ¥åœ¨eclipse/ideaä¸­æ‰§è¡Œä»£ç "></a>è„šæœ¬å½¢å¼:é€šè¿‡åˆ›å»ºæ–‡ä»¶æ¥åœ¨eclipse/ideaä¸­æ‰§è¡Œä»£ç </h3><pre><code>object Test {    def main(args: Array[String] ) {        println(&quot;Hello world&quot;)    }}</code></pre><ul><li>æ³¨1ï¼šä¸Šé¢è¿™ä¸ªæ˜¯å•ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªé‡Œé¢åªèƒ½å­˜æ”¾é™æ€çš„ä¸œè¥¿</li><li>æ³¨2ï¼šè‡ªåŠ¨å¯¼å…¥3ä¸ªåŒ…<pre><code>java.lang._scala._Predef._    </code></pre></li><li>æ³¨3ï¼šè¯­å¥æœ€åä¸€è¡Œçš„åˆ†å·ä¸æ¨èå†™</li></ul><h2 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h2><h3 id="å˜é‡å’Œå¸¸é‡"><a href="#å˜é‡å’Œå¸¸é‡" class="headerlink" title="å˜é‡å’Œå¸¸é‡"></a>å˜é‡å’Œå¸¸é‡</h3><ul><li>a) å˜é‡var<pre><code>æ ¼å¼ï¼š    var å˜é‡å [:æ•°æ®ç±»å‹] = å€¼ä¾‹ï¼švar b :Int = 1    var c = 2    //ç±»å‹è‡ªåŠ¨æ¨æ–­</code></pre></li><li><p>b) å¸¸é‡val</p><pre><code>æ ¼å¼ï¼š    val å¸¸é‡å [:æ•°æ®ç±»å‹] = å€¼ä¾‹ï¼š    val b :Int = 1    val b = 1    b = 2    //æŠ¥é”™ï¼Œå¸¸é‡ä¸èƒ½ä¿®æ”¹</code></pre></li><li><p>c) å¸¸é‡å¯ä»¥ç”¨lazyä¿®é¥°(äº†è§£)</p><pre><code>lazy val b :Int = 1    //bç”¨åˆ°çš„æ—¶å€™å†èµ‹å€¼</code></pre></li></ul><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><h4 id="åŸºæœ¬ç±»å‹"><a href="#åŸºæœ¬ç±»å‹" class="headerlink" title="åŸºæœ¬ç±»å‹"></a>åŸºæœ¬ç±»å‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Byte8ä½æœ‰ç¬¦å·å€¼ï¼ŒèŒƒå›´ä»-128è‡³127</span><br><span class="line">Short16ä½æœ‰ç¬¦å·å€¼ï¼ŒèŒƒå›´ä»-32768è‡³32767</span><br><span class="line">Int32ä½æœ‰ç¬¦å·å€¼ï¼ŒèŒƒå›´ä»-2147483648è‡³2147483647</span><br><span class="line">Long64ä½æœ‰ç¬¦å·å€¼ï¼ŒèŒƒå›´ä»-9223372036854775808è‡³9223372036854775807</span><br><span class="line">Float32ä½IEEE 754å•ç²¾åº¦æµ®ç‚¹å€¼</span><br><span class="line">Double64ä½IEEE 754åŒç²¾åº¦æµ®ç‚¹å€¼</span><br><span class="line">Char16ä½æ— ç¬¦å·Unicodeå­—ç¬¦ã€‚èŒƒå›´ä»U+0000åˆ°U+FFFF</span><br><span class="line">Stringä¸€ä¸ªCharç±»å‹åºåˆ—</span><br><span class="line">Booleanæ–‡å­—å€¼trueæˆ–æ–‡å­—å€¼false</span><br><span class="line">Unitå¯¹åº”äºæ— å€¼ï¼Œç­‰ä»·äºvoidç±»å‹ï¼Œåªæœ‰ä¸€ä¸ªå¯¹è±¡å«()</span><br><span class="line">Nullåªæœ‰ä¸€ä¸ªå¯¹è±¡å«null</span><br><span class="line">Nothingåœ¨Scalaä¸­å¤„äºæœ€åº•å±‚ï¼Œæ¯”å¦‚åˆ›å»ºæ•°ç»„æ—¶ä¸æŒ‡å®šç±»å‹ï¼Œå°±æ˜¯Notingã€‚æŠ½è±¡æ¦‚å¿µ</span><br><span class="line">Anyä»»ä½•ç±»å‹çš„è¶…ç±»å‹; ä»»ä½•å¯¹è±¡çš„ç±»å‹ä¸ºAny</span><br><span class="line">AnyRefä»»ä½•å¼•ç”¨ç±»å‹çš„è¶…ç±»å‹</span><br></pre></td></tr></table></figure><h4 id="å±‚æ¬¡ç»“æ„"><a href="#å±‚æ¬¡ç»“æ„" class="headerlink" title="å±‚æ¬¡ç»“æ„"></a>å±‚æ¬¡ç»“æ„</h4><p>Scala.Any ä»»ä½•ç±»å‹çš„è¶…ç±»å‹</p><ul><li>AnyVal(å€¼) ä»»ä½•æ•°å€¼ç±»å‹çš„è¶…ç±»å‹<br>  Int,Doubleç­‰ï¼ŒUnitã€‚</li><li>AnyRefï¼ˆå¼•ç”¨ï¼‰ä»»ä½•å¼•ç”¨ç±»å‹çš„è¶…ç±»å‹<br>  List,Set,Map,Seq,Iterable<br>  java.lang.String<br>  Null</li></ul><h4 id="é‡ç‚¹ç±»å‹ï¼šå…ƒç»„"><a href="#é‡ç‚¹ç±»å‹ï¼šå…ƒç»„" class="headerlink" title="é‡ç‚¹ç±»å‹ï¼šå…ƒç»„"></a>é‡ç‚¹ç±»å‹ï¼šå…ƒç»„</h4><pre><code>æ ¼å¼ï¼š(å…ƒç´ 1, å…ƒç´ 2, ....)è®¿é—®ï¼šå˜é‡._N å…¶ä¸­Næ˜¯å…ƒç»„å…ƒç´ çš„ç´¢å¼•ï¼Œä»1å¼€å§‹    ä¾‹ï¼švar t = (&quot;a&quot;, false, 1)        //tçš„ç±»å‹æ˜¯scala.Tuple3        var value = t._1    //&quot;a&quot;        var m,n,(x,y,z) =  (&quot;a&quot;, false, 1)         m    :(&quot;a&quot;, false, 1)         n    :(&quot;a&quot;, false, 1)         x    : &quot;a&quot;        y    : false        z    : 1</code></pre><h4 id="é‡ç‚¹ç±»å‹ï¼šå­—ç¬¦ä¸²"><a href="#é‡ç‚¹ç±»å‹ï¼šå­—ç¬¦ä¸²" class="headerlink" title="é‡ç‚¹ç±»å‹ï¼šå­—ç¬¦ä¸²"></a>é‡ç‚¹ç±»å‹ï¼šå­—ç¬¦ä¸²</h4><pre><code>i) ç”¨çš„æ˜¯java.lang.Stringï¼Œä½†æ˜¯æœ‰æ—¶å€™æ ¹æ®éœ€è¦ï¼Œä¼šéšå¼è½¬æ¢åˆ°å…¶å®ƒç±»å‹ï¼Œæ¯”å¦‚è°ƒç”¨reverse/sorted/sortWith/drop/sliceç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å®šä¹‰åœ¨IndexedSeqOptimizedä¸­ii)å¤šè¡Œå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¼€å§‹å’Œç»“æŸç”¨&quot;&quot;&quot;</code></pre><h4 id="äº†è§£ï¼šç¬¦å·ç±»å‹"><a href="#äº†è§£ï¼šç¬¦å·ç±»å‹" class="headerlink" title="äº†è§£ï¼šç¬¦å·ç±»å‹"></a>äº†è§£ï¼šç¬¦å·ç±»å‹</h4><pre><code>ç¬¦å·å­—é¢é‡ï¼š &apos;æ ‡è¯†ç¬¦,æ˜¯scala.Symbolçš„å®ä¾‹,åƒæ¨¡å¼åŒ¹é…ï¼Œç±»å‹åˆ¤æ–­ä¼šæ¯”è¾ƒå¸¸ç”¨ã€‚var flag = &apos;startif (flag == &apos;start) println(1) else println(2)</code></pre><h3 id="è¿ç®—ç¬¦-scalaæ²¡æœ‰è¿ç®—ç¬¦ï¼Œå®ƒè¿ç®—ç¬¦å…¨éƒ¨å°è£…æˆäº†æ–¹æ³•ã€‚"><a href="#è¿ç®—ç¬¦-scalaæ²¡æœ‰è¿ç®—ç¬¦ï¼Œå®ƒè¿ç®—ç¬¦å…¨éƒ¨å°è£…æˆäº†æ–¹æ³•ã€‚" class="headerlink" title="è¿ç®—ç¬¦:scalaæ²¡æœ‰è¿ç®—ç¬¦ï¼Œå®ƒè¿ç®—ç¬¦å…¨éƒ¨å°è£…æˆäº†æ–¹æ³•ã€‚"></a>è¿ç®—ç¬¦:scalaæ²¡æœ‰è¿ç®—ç¬¦ï¼Œå®ƒè¿ç®—ç¬¦å…¨éƒ¨å°è£…æˆäº†æ–¹æ³•ã€‚</h3><pre><code>ç®—æœ¯ï¼š+ - * / %æ¯”è¾ƒ: == != &gt; &lt; &gt;= &lt;= é€»è¾‘ï¼š&amp;&amp; || !èµ‹å€¼ï¼š= += -= *= /* %=ä½ï¼š&amp; | ~ ^ &gt;&gt; &lt;&lt; &gt;&gt;&gt; æ³¨ï¼šä¸Šé¢éƒ½æ˜¯æ–¹æ³•ã€‚ä¾‹ 1+2ç›¸å½“äº1.+(2)ï¼Œå…¶ä¸­+æ˜¯æ–¹æ³•ï¼Œ2æ˜¯å‚æ•°</code></pre><h3 id="æ§åˆ¶è¯­å¥"><a href="#æ§åˆ¶è¯­å¥" class="headerlink" title="æ§åˆ¶è¯­å¥"></a>æ§åˆ¶è¯­å¥</h3><pre><code>(1) ifï¼Œif...else...ï¼Œif...else if...else...(2) scalaä¸­çš„ifå¯ä»¥ä½œä¸ºè¡¨è¾¾å¼ç”¨    var x = if(&quot;hello&quot;==&quot;hell&quot;) 1 else 0(3) switchè¢«æ¨¡å¼åŒ¹é…æ›¿æ¢</code></pre><h3 id="å¾ªç¯è¯­å¥"><a href="#å¾ªç¯è¯­å¥" class="headerlink" title="å¾ªç¯è¯­å¥"></a>å¾ªç¯è¯­å¥</h3><pre><code>(1)while,do..whileå’Œforéƒ½æœ‰ï¼Œwhileå’Œdo..whileå¾ˆåƒï¼Œä½†æ˜¯forå·®åˆ«å¾ˆå¤§ã€‚(2)forå¾ªç¯æ ¼å¼ä¸åŒ    for(å˜é‡ &lt;- é›†åˆ if æ¡ä»¶åˆ¤æ–­1;if æ¡ä»¶åˆ¤æ–­2...) {        æ‰€æœ‰æ¡ä»¶åˆ¤æ–­éƒ½æ»¡è¶³æ‰æ‰§è¡Œ    }(3)æ²¡æœ‰breakå’Œcontinueï¼Œç”¨ä¸¤ç§æ–¹æ³•å¯ä»¥ä»£æ›¿    i) ç”¨forå¾ªç¯çš„æ¡ä»¶åˆ¤æ–­    ii)æ–¹æ³•2:éå†™breakï¼Œè¦åšä»¥ä¸‹ä¸¤æ­¥     //1) å¼•å…¥ä¸€ä¸ªåŒ…scala.util.control.Breaks._     //2) ä»£ç å—ç”¨breakableä¿®é¥°    for (value &lt;- 1 to 5) {        println(value)    }</code></pre><h3 id="é›†åˆæ¡†æ¶-Arrayï¼ŒList-Set-Map"><a href="#é›†åˆæ¡†æ¶-Arrayï¼ŒList-Set-Map" class="headerlink" title="é›†åˆæ¡†æ¶(Arrayï¼ŒList,Set,Map)"></a>é›†åˆæ¡†æ¶(Arrayï¼ŒList,Set,Map)</h3><pre><code>åœ¨scalaä¸­ï¼Œæ•°ç»„Arrayå½’åˆ°é›†åˆçš„èŒƒç•´åŒ…scala.collectionï¼Œä¸‹é¢æœ‰ä¸¤ä¸ªåˆ†æ”¯immutable(ä¸å¯æ”¹å˜çš„,é»˜è®¤)å’Œmutable(å¯å˜çš„)</code></pre><h4 id="å±‚æ¬¡ç»“æ„-1"><a href="#å±‚æ¬¡ç»“æ„-1" class="headerlink" title="å±‚æ¬¡ç»“æ„"></a>å±‚æ¬¡ç»“æ„</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> Traversable</span><br><span class="line">-Iterable</span><br><span class="line">**(immutableä¸å¯æ”¹å˜çš„)**</span><br><span class="line">-Set</span><br><span class="line">HashSet,TreeSt</span><br><span class="line">-Map</span><br><span class="line">HashMap,TreeMap</span><br><span class="line">-Seq</span><br><span class="line">-IndexedSeq</span><br><span class="line">Vector,Array,String,Range</span><br><span class="line">-LinearSeq</span><br><span class="line">List,Queue,Stack</span><br><span class="line"></span><br><span class="line">**(mutableå¯å˜çš„)**</span><br><span class="line">-Set</span><br><span class="line">HashSet</span><br><span class="line">-Map</span><br><span class="line">HashMap</span><br><span class="line">-Seq</span><br><span class="line">-IndexedSeq</span><br><span class="line">ArraySeq,StringBuilder</span><br><span class="line">-Buffer</span><br><span class="line">ArrayBuffer,ListBuffer</span><br><span class="line">-LinearSeq</span><br><span class="line">LinkedList,Queue</span><br><span class="line">Stack</span><br><span class="line">é‡ç‚¹è®°å¿†å‡ ä¸ª</span><br><span class="line">ä¸å¯å˜å¯å˜</span><br><span class="line">ArrayArrayBuffer</span><br><span class="line">ListListBuffer</span><br><span class="line">immutable.Mapmutable.Map</span><br><span class="line">immutable.Setmutable.Set</span><br></pre></td></tr></table></figure><h4 id="æ•°ç»„-éå¸¸é‡è¦-ï¼šæ•°æ®ç±»å‹ç›¸åŒçš„å…ƒç´ ï¼ŒæŒ‰ç…§ä¸€å®šé¡ºåºæ’åºçš„é›†åˆã€‚"><a href="#æ•°ç»„-éå¸¸é‡è¦-ï¼šæ•°æ®ç±»å‹ç›¸åŒçš„å…ƒç´ ï¼ŒæŒ‰ç…§ä¸€å®šé¡ºåºæ’åºçš„é›†åˆã€‚" class="headerlink" title="æ•°ç»„(éå¸¸é‡è¦)ï¼šæ•°æ®ç±»å‹ç›¸åŒçš„å…ƒç´ ï¼ŒæŒ‰ç…§ä¸€å®šé¡ºåºæ’åºçš„é›†åˆã€‚"></a>æ•°ç»„(éå¸¸é‡è¦)ï¼šæ•°æ®ç±»å‹ç›¸åŒçš„å…ƒç´ ï¼ŒæŒ‰ç…§ä¸€å®šé¡ºåºæ’åºçš„é›†åˆã€‚</h4><p>ä¸å¯å˜æ•°ç»„ scala.Array<br>å¯å˜é•¿æ•°ç»„ scala.collection.mutable.ArrayBuffer</p><ul><li><p>1.Arrayå’ŒArrayBuffer<br>  Arrayåˆ›å»º:<br>  var å˜é‡å = new Array<a href="é•¿åº¦">ç±»å‹</a>    //var arr = new Array<a href="10">Int</a><br>  var å˜é‡å = Array(å…ƒç´ 1,å…ƒç´ 2,â€¦) //var arr = Array(1,3,5,7)ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨Arrayçš„æ–¹æ³•apply</p><p>  å–å€¼ï¼šå˜é‡å(ä¸‹æ ‡)</p></li><li>2.ArrayBufferåˆ›å»º<br>  var å˜é‡å = new ArrayBuffer<a href="">ç±»å‹</a>    //var arr = new ArrayBuffer<a href="">Int</a><br>  var å˜é‡å = ArrayBuffer(å…ƒç´ 1,å…ƒç´ 2,â€¦) //var arr = ArrayBuffer(1,3,5,7)</li><li><p>3.å…±åŒæ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sum æ±‚å’Œ</span><br><span class="line">max æœ€å¤§å€¼</span><br><span class="line">min æœ€å°å€¼</span><br><span class="line">mkString(åˆ†éš”ç¬¦)ä¾‹ï¼šArray(1,3,5,7).mkString(&quot;|&quot;)//ç»“æœæ˜¯1|3|5|7|9</span><br><span class="line">sorted æ’åºï¼ˆä»å°åˆ°å¤§ï¼‰</span><br><span class="line">sortBy</span><br><span class="line">sortWith è‡ªå®šä¹‰æ’åº</span><br><span class="line">reverse ç¿»è½¬</span><br><span class="line">toArray ArrayBufferè½¬æˆArray</span><br><span class="line">toBuffer Arrayè½¬æˆArrayBuffer</span><br><span class="line">toMapï¼šå¦‚æœArrayå†…éƒ¨å…ƒç´ æ˜¯å¯¹å¶å…ƒç»„ï¼Œå¯ä»¥è½¬æˆmap</span><br></pre></td></tr></table></figure></li><li><p>4.ArrayBufferçš„ç‹¬æœ‰æ–¹æ³•<br>  += è¿½åŠ å…ƒç´ <br>  ++= è¿½åŠ é›†åˆ<br>  trimEnd(n):åˆ é™¤æœ«å°¾nä¸ªå…ƒç´ <br>  insert(index,value1,value2,..valueN):ç¬¬indexçš„ä½ç½®ï¼Œæ’å…¥value1,value2,â€¦valueN)<br>  remove(index,n):ç¬¬indexä¸ªä½ç½®åˆ é™¤nä¸ªå…ƒç´ <br>  clear():æ¸…ç©º</p></li><li>5.éå†<br>  i) é€šè¿‡ä¸‹æ ‡<pre><code>for (i &lt;- 0 to æ•°ç»„.length-1) {    println(i)) //iè¡¨ç¤ºæ•°ç»„çš„ä¸‹æ ‡}</code></pre>  ii)ç›´æ¥å–å€¼<pre><code>for (e &lt;- æ•°ç»„) {    println(e)}</code></pre></li><li>6.ä½¿ç”¨yieldåˆ›å»ºæ–°æ•°ç»„<br>  var arr = for (i &lt;- æ•°ç»„) yield i * 2</li><li>7.å¤šç»´æ•°ç»„<br>  var arr = Array(Array(å…ƒç´ 1â€¦),Array(å…ƒç´ ,â€¦)..)<br>  éå†<br>  for (i &lt;- arr) {<pre><code>for (j &lt;- i) {    println(j)}</code></pre>  }</li></ul><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><h4 id="Arrayå’ŒListå’ŒTupleéƒ½æ˜¯ä¸å¯å˜å…ƒç´ ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#Arrayå’ŒListå’ŒTupleéƒ½æ˜¯ä¸å¯å˜å…ƒç´ ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="Arrayå’ŒListå’ŒTupleéƒ½æ˜¯ä¸å¯å˜å…ƒç´ ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>Arrayå’ŒListå’ŒTupleéƒ½æ˜¯ä¸å¯å˜å…ƒç´ ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><h2 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;scalaç®€ä»‹&quot;&gt;&lt;a href=&quot;#scalaç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;scalaç®€ä»‹&quot;&gt;&lt;/a&gt;scalaç®€ä»‹&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;2004å¹´ï¼Œmartin orderskyå‘æ˜ï¼Œjavacçš„ç¼–è¯‘å™¨ï¼Œåæ¥spark,
      
    
    </summary>
    
      <category term="Scala" scheme="http://www.ihoge.cn/categories/Scala/"/>
    
    
  </entry>
  
</feed>
